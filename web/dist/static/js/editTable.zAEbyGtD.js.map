{"version":3,"file":"editTable.zAEbyGtD.js","sources":["../../../src/views/tool/gen/editTable.vue"],"sourcesContent":["<template>\r\n  <el-card>\r\n    <el-tabs v-model=\"activeName\">\r\n      <el-tab-pane label=\"基本信息\" name=\"basic\">\r\n        <basic-info-form ref=\"basicInfo\" :info=\"info\" />\r\n      </el-tab-pane>\r\n      <el-tab-pane label=\"字段信息\" name=\"columnInfo\">\r\n        <el-table ref=\"dragTable\" :data=\"columns\" row-key=\"columnId\" :max-height=\"tableHeight\">\r\n          <el-table-column label=\"序号\" type=\"index\" min-width=\"5%\"/>\r\n          <el-table-column\r\n            label=\"字段列名\"\r\n            prop=\"columnName\"\r\n            min-width=\"10%\"\r\n            :show-overflow-tooltip=\"true\"\r\n          />\r\n          <el-table-column label=\"字段描述\" min-width=\"10%\">\r\n            <template #default=\"scope\">\r\n              <el-input v-model=\"scope.row.columnComment\"></el-input>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column\r\n            label=\"物理类型\"\r\n            prop=\"columnType\"\r\n            min-width=\"10%\"\r\n            :show-overflow-tooltip=\"true\"\r\n          />\r\n          <el-table-column label=\"Java类型\" min-width=\"11%\">\r\n            <template #default=\"scope\">\r\n              <el-select v-model=\"scope.row.javaType\">\r\n                <el-option label=\"Long\" value=\"Long\" />\r\n                <el-option label=\"String\" value=\"String\" />\r\n                <el-option label=\"Integer\" value=\"Integer\" />\r\n                <el-option label=\"Double\" value=\"Double\" />\r\n                <el-option label=\"BigDecimal\" value=\"BigDecimal\" />\r\n                <el-option label=\"Date\" value=\"Date\" />\r\n                <el-option label=\"Boolean\" value=\"Boolean\" />\r\n              </el-select>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"java属性\" min-width=\"10%\">\r\n            <template #default=\"scope\">\r\n              <el-input v-model=\"scope.row.javaField\"></el-input>\r\n            </template>\r\n          </el-table-column>\r\n\r\n          <el-table-column label=\"插入\" min-width=\"5%\">\r\n            <template #default=\"scope\">\r\n              <el-checkbox true-label=\"1\" false-label=\"0\" v-model=\"scope.row.isInsert\"></el-checkbox>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"编辑\" min-width=\"5%\">\r\n            <template #default=\"scope\">\r\n              <el-checkbox true-label=\"1\" false-label=\"0\" v-model=\"scope.row.isEdit\"></el-checkbox>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"列表\" min-width=\"5%\">\r\n            <template #default=\"scope\">\r\n              <el-checkbox true-label=\"1\" false-label=\"0\" v-model=\"scope.row.isList\"></el-checkbox>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"查询\" min-width=\"5%\">\r\n            <template #default=\"scope\">\r\n              <el-checkbox true-label=\"1\" false-label=\"0\" v-model=\"scope.row.isQuery\"></el-checkbox>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"查询方式\" min-width=\"10%\">\r\n            <template #default=\"scope\">\r\n              <el-select v-model=\"scope.row.queryType\">\r\n                <el-option label=\"=\" value=\"EQ\" />\r\n                <el-option label=\"!=\" value=\"NE\" />\r\n                <el-option label=\">\" value=\"GT\" />\r\n                <el-option label=\">=\" value=\"GTE\" />\r\n                <el-option label=\"<\" value=\"LT\" />\r\n                <el-option label=\"<=\" value=\"LTE\" />\r\n                <el-option label=\"LIKE\" value=\"LIKE\" />\r\n                <el-option label=\"BETWEEN\" value=\"BETWEEN\" />\r\n              </el-select>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"必填\" min-width=\"5%\">\r\n            <template #default=\"scope\">\r\n              <el-checkbox true-label=\"1\" false-label=\"0\" v-model=\"scope.row.isRequired\"></el-checkbox>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"显示类型\" min-width=\"12%\">\r\n            <template #default=\"scope\">\r\n              <el-select v-model=\"scope.row.htmlType\">\r\n                <el-option label=\"文本框\" value=\"input\" />\r\n                <el-option label=\"文本域\" value=\"textarea\" />\r\n                <el-option label=\"下拉框\" value=\"select\" />\r\n                <el-option label=\"单选框\" value=\"radio\" />\r\n                <el-option label=\"复选框\" value=\"checkbox\" />\r\n                <el-option label=\"日期控件\" value=\"datetime\" />\r\n                <el-option label=\"图片上传\" value=\"imageUpload\" />\r\n                <el-option label=\"文件上传\" value=\"fileUpload\" />\r\n                <el-option label=\"富文本控件\" value=\"editor\" />\r\n              </el-select>\r\n            </template>\r\n          </el-table-column>\r\n          <el-table-column label=\"字典类型\" min-width=\"12%\">\r\n            <template #default=\"scope\">\r\n              <el-select v-model=\"scope.row.dictType\" clearable filterable placeholder=\"请选择\">\r\n                <el-option\r\n                  v-for=\"dict in dictOptions\"\r\n                  :key=\"dict.dictType\"\r\n                  :label=\"dict.dictName\"\r\n                  :value=\"dict.dictType\">\r\n                  <span style=\"float: left\">{{ dict.dictName }}</span>\r\n                  <span style=\"float: right; color: #8492a6; font-size: 13px\">{{ dict.dictType }}</span>\r\n              </el-option>\r\n              </el-select>\r\n            </template>\r\n          </el-table-column>\r\n        </el-table>\r\n      </el-tab-pane>\r\n      <el-tab-pane label=\"生成信息\" name=\"genInfo\">\r\n        <gen-info-form ref=\"genInfo\" :info=\"info\" :tables=\"tables\" />\r\n      </el-tab-pane>\r\n    </el-tabs>\r\n    <el-form label-width=\"100px\">\r\n      <div style=\"text-align: center;margin-left:-100px;margin-top:10px;\">\r\n        <el-button type=\"primary\" @click=\"submitForm()\">提交</el-button>\r\n        <el-button @click=\"close()\">返回</el-button>\r\n      </div>\r\n    </el-form>\r\n  </el-card>\r\n</template>\r\n\r\n<script setup name=\"GenEdit\">\r\nimport { getGenTable, updateGenTable } from \"@/api/tool/gen\";\r\nimport { optionselect as getDictOptionselect } from \"@/api/system/dict/type\";\r\nimport basicInfoForm from \"./basicInfoForm\";\r\nimport genInfoForm from \"./genInfoForm\";\r\n\r\nconst route = useRoute();\r\nconst { proxy } = getCurrentInstance();\r\n\r\nconst activeName = ref(\"columnInfo\");\r\nconst tableHeight = ref(document.documentElement.scrollHeight - 245 + \"px\");\r\nconst tables = ref([]);\r\nconst columns = ref([]);\r\nconst dictOptions = ref([]);\r\nconst info = ref({});\r\n\r\n/** 提交按钮 */\r\nfunction submitForm() {\r\n  const basicForm = proxy.$refs.basicInfo.$refs.basicInfoForm;\r\n  const genForm = proxy.$refs.genInfo.$refs.genInfoForm;\r\n  Promise.all([basicForm, genForm].map(getFormPromise)).then(res => {\r\n    const validateResult = res.every(item => !!item);\r\n    if (validateResult) {\r\n      const genTable = Object.assign({}, info.value);\r\n      genTable.columns = columns.value;\r\n      genTable.params = {\r\n        treeCode: info.value.treeCode,\r\n        treeName: info.value.treeName,\r\n        treeParentCode: info.value.treeParentCode,\r\n        parentMenuId: info.value.parentMenuId\r\n      };\r\n      updateGenTable(genTable).then(res => {\r\n        proxy.$modal.msgSuccess(res.msg);\r\n        if (res.code === 200) {\r\n          close();\r\n        }\r\n      });\r\n    } else {\r\n      proxy.$modal.msgError(\"表单校验未通过，请重新检查提交内容\");\r\n    }\r\n  });\r\n}\r\nfunction getFormPromise(form) {\r\n  return new Promise(resolve => {\r\n    form.validate(res => {\r\n      resolve(res);\r\n    });\r\n  });\r\n}\r\nfunction close() {\r\n  const obj = { path: \"/tool/gen\", query: { t: Date.now(), pageNum: route.query.pageNum } };\r\n  proxy.$tab.closeOpenPage(obj);\r\n}\r\n\r\n(() => {\r\n  const tableId = route.params && route.params.tableId;\r\n  if (tableId) {\r\n    // 获取表详细信息\r\n    getGenTable(tableId).then(res => {\r\n      columns.value = res.data.rows;\r\n      info.value = res.data.info;\r\n      tables.value = res.data.tables;\r\n    });\r\n    /** 查询字典下拉列表 */\r\n    getDictOptionselect().then(response => {\r\n      dictOptions.value = response.data;\r\n    });\r\n  }\r\n})();\r\n</script>\r\n"],"names":["route","useRoute","proxy","getCurrentInstance","activeName","ref","tableHeight","tables","columns","dictOptions","info","submitForm","basicForm","genForm","getFormPromise","res","item","genTable","updateGenTable","close","form","resolve","obj","tableId","getGenTable","getDictOptionselect","response"],"mappings":"6iBAsIA,MAAMA,EAAQC,EAAQ,EAChB,CAAE,MAAAC,CAAK,EAAKC,IAEZC,EAAaC,EAAI,YAAY,EAC7BC,EAAcD,EAAI,SAAS,gBAAgB,aAAe,IAAM,IAAI,EACpEE,EAASF,EAAI,CAAA,CAAE,EACfG,EAAUH,EAAI,CAAA,CAAE,EAChBI,EAAcJ,EAAI,CAAA,CAAE,EACpBK,EAAOL,EAAI,CAAA,CAAE,EAGnB,SAASM,GAAa,CACpB,MAAMC,EAAYV,EAAM,MAAM,UAAU,MAAM,cACxCW,EAAUX,EAAM,MAAM,QAAQ,MAAM,YAC1C,QAAQ,IAAI,CAACU,EAAWC,CAAO,EAAE,IAAIC,CAAc,CAAC,EAAE,KAAKC,GAAO,CAEhE,GADuBA,EAAI,MAAMC,GAAQ,CAAC,CAACA,CAAI,EAC3B,CAClB,MAAMC,EAAW,OAAO,OAAO,CAAA,EAAIP,EAAK,KAAK,EAC7CO,EAAS,QAAUT,EAAQ,MAC3BS,EAAS,OAAS,CAChB,SAAUP,EAAK,MAAM,SACrB,SAAUA,EAAK,MAAM,SACrB,eAAgBA,EAAK,MAAM,eAC3B,aAAcA,EAAK,MAAM,YACjC,EACMQ,EAAeD,CAAQ,EAAE,KAAKF,GAAO,CACnCb,EAAM,OAAO,WAAWa,EAAI,GAAG,EAC3BA,EAAI,OAAS,KACfI,GAEV,CAAO,CACP,MACMjB,EAAM,OAAO,SAAS,mBAAmB,CAE/C,CAAG,CACH,CACA,SAASY,EAAeM,EAAM,CAC5B,OAAO,IAAI,QAAQC,GAAW,CAC5BD,EAAK,SAASL,GAAO,CACnBM,EAAQN,CAAG,CACjB,CAAK,CACL,CAAG,CACH,CACA,SAASI,GAAQ,CACf,MAAMG,EAAM,CAAE,KAAM,YAAa,MAAO,CAAE,EAAG,KAAK,IAAG,EAAI,QAAStB,EAAM,MAAM,OAAS,CAAA,EACvFE,EAAM,KAAK,cAAcoB,CAAG,CAC9B,CAEA,OAAC,IAAM,CACL,MAAMC,EAAUvB,EAAM,QAAUA,EAAM,OAAO,QACzCuB,IAEFC,EAAYD,CAAO,EAAE,KAAKR,GAAO,CAC/BP,EAAQ,MAAQO,EAAI,KAAK,KACzBL,EAAK,MAAQK,EAAI,KAAK,KACtBR,EAAO,MAAQQ,EAAI,KAAK,MAC9B,CAAK,EAEDU,EAAqB,EAAC,KAAKC,GAAY,CACrCjB,EAAY,MAAQiB,EAAS,IACnC,CAAK,EAEL"}