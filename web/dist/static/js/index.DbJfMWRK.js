import{a as Ee,r as v,D as Ie,a0 as Pe,d as p,J as ae,o as i,c as b,I as _,U as ne,h as o,e,f as l,k as Te,P as $,a7 as E,l as g,p as r,$ as R,m as x,z as y,n as D,C as Ge,v as Re}from"./index.CHnR_MAu.js";import{l as De,c as Je,r as Fe,g as ue,u as Ke,a as Le,d as ze}from"./job.BHxHR-_9.js";import{C as Ae}from"./index.CTXGU5eB.js";const Be={class:"app-container"},Qe=x("div",null,[r(" Bean调用示例：ryTask.ryParams('ry') "),x("br"),r("Class类调用示例：com.ruoyi.quartz.task.RyTask.ryParams('ry') "),x("br"),r("参数说明：支持字符串，布尔类型，长整型，浮点型，整型 ")],-1),Oe=x("i",{class:"el-icon-time el-icon--right"},null,-1),He={class:"dialog-footer"},Me={key:0},We={key:1},Xe={key:0},Ye={key:1},Ze={key:0},el={key:1},ll={key:2},ol={key:3},tl={class:"dialog-footer"},al=Ge({name:"QtrJob"}),sl=Object.assign(al,{setup(nl){const re=Ee(),{proxy:m}=Re(),{sys_job_group:I,sys_job_status:M,sys_job_executor:W}=m.useDict("sys_job_group","sys_job_status","sys_job_executor"),X=v([]),V=v(!1),J=v(!0),P=v(!0),F=v([]),Y=v(!0),Z=v(!0),K=v(0),L=v(""),U=v(!1),N=v(!1),ee=v(""),de=Ie({form:{},queryParams:{pageNum:1,pageSize:10,jobName:void 0,jobGroup:void 0,status:void 0},rules:{jobName:[{required:!0,message:"任务名称不能为空",trigger:"blur"}],invokeTarget:[{required:!0,message:"调用目标字符串不能为空",trigger:"blur"}],cronExpression:[{required:!0,message:"cron执行表达式不能为空",trigger:"change"}]}}),{queryParams:f,form:n,rules:se}=Pe(de);function w(){J.value=!0,De(f.value).then(u=>{X.value=u.rows,K.value=u.total,J.value=!1})}function ie(u,a){return m.selectDictLabel(I.value,u.jobGroup)}function pe(u,a){return m.selectDictLabel(W.value,u.jobExecutor)}function ce(){V.value=!1,z()}function z(){n.value={jobId:void 0,jobName:void 0,jobGroup:void 0,invokeTarget:void 0,cronExpression:void 0,misfirePolicy:"1",concurrent:"1",status:"0"},m.resetForm("jobRef")}function A(){f.value.pageNum=1,w()}function me(){m.resetForm("queryRef"),A()}function fe(u){F.value=u.map(a=>a.jobId),Y.value=u.length!=1,Z.value=!u.length}function be(u){let a=u.status==="0"?"启用":"停用";m.$modal.confirm('确认要"'+a+'""'+u.jobName+'"任务吗?').then(function(){return Je(u.jobId,u.status)}).then(()=>{m.$modal.msgSuccess(a+"成功")}).catch(function(){u.status=u.status==="0"?"1":"0"})}function _e(u){m.$modal.confirm('确认要立即执行一次"'+u.jobName+'"任务吗?').then(function(){return Fe(u.jobId,u.jobGroup)}).then(()=>{m.$modal.msgSuccess("执行成功")}).catch(()=>{})}function ve(u){ue(u.jobId).then(a=>{n.value=a.data,U.value=!0})}function ge(){ee.value=n.value.cronExpression,N.value=!0}function ye(u){n.value.cronExpression=u}function le(u){const a=u.jobId||0;re.push("/qtr/qtr-job-log/index/"+a)}function je(){z(),V.value=!0,L.value="添加任务"}function oe(u){z();const a=u.jobId||F.value;ue(a).then(h=>{n.value=h.data,V.value=!0,L.value="修改任务"})}function Ve(){m.$refs.jobRef.validate(u=>{u&&(n.value.jobId!=null?Ke(n.value).then(a=>{m.$modal.msgSuccess("修改成功"),V.value=!1,w()}):Le(n.value).then(a=>{m.$modal.msgSuccess("新增成功"),V.value=!1,w()}))})}function te(u){const a=u.jobId||F.value;m.$modal.confirm('是否确认删除定时任务编号为"'+a+'"的数据项?').then(function(){return ze(a)}).then(()=>{w(),m.$modal.msgSuccess("删除成功")}).catch(()=>{})}function he(){m.download("qtr/job/export",{...f.value},`job_${new Date().getTime()}.xlsx`)}return w(),(u,a)=>{const h=p("el-input"),d=p("el-form-item"),T=p("el-option"),G=p("el-select"),c=p("el-button"),B=p("el-form"),s=p("el-col"),ke=p("right-toolbar"),Q=p("el-row"),k=p("el-table-column"),we=p("dict-tag"),Ce=p("el-switch"),q=p("el-tooltip"),xe=p("el-table"),qe=p("pagination"),Ue=p("question-filled"),Ne=p("el-icon"),Se=p("el-radio"),O=p("el-radio-group"),S=p("el-radio-button"),H=p("el-dialog"),j=ae("hasPermi"),$e=ae("loading");return i(),b("div",Be,[_(e(B,{model:o(f),ref:"queryRef",inline:!0},{default:l(()=>[e(d,{label:"任务名称",prop:"jobName"},{default:l(()=>[e(h,{modelValue:o(f).jobName,"onUpdate:modelValue":a[0]||(a[0]=t=>o(f).jobName=t),placeholder:"请输入任务名称",clearable:"",style:{width:"200px"},onKeyup:Te(A,["enter"])},null,8,["modelValue"])]),_:1}),e(d,{label:"任务组名",prop:"jobGroup"},{default:l(()=>[e(G,{modelValue:o(f).jobGroup,"onUpdate:modelValue":a[1]||(a[1]=t=>o(f).jobGroup=t),placeholder:"请选择任务组名",clearable:"",style:{width:"200px"}},{default:l(()=>[(i(!0),b($,null,E(o(I),t=>(i(),g(T,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"任务状态",prop:"status"},{default:l(()=>[e(G,{modelValue:o(f).status,"onUpdate:modelValue":a[2]||(a[2]=t=>o(f).status=t),placeholder:"请选择任务状态",clearable:"",style:{width:"200px"}},{default:l(()=>[(i(!0),b($,null,E(o(M),t=>(i(),g(T,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,null,{default:l(()=>[e(c,{type:"primary",icon:"Search",onClick:A},{default:l(()=>[r("搜索")]),_:1}),e(c,{icon:"Refresh",onClick:me},{default:l(()=>[r("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[ne,o(P)]]),e(Q,{gutter:10,class:"mb8"},{default:l(()=>[e(s,{span:1.5},{default:l(()=>[_((i(),g(c,{type:"primary",plain:"",icon:"Plus",onClick:je},{default:l(()=>[r("新增")]),_:1})),[[j,["qtr:job:add"]]])]),_:1}),e(s,{span:1.5},{default:l(()=>[_((i(),g(c,{type:"success",plain:"",icon:"Edit",disabled:o(Y),onClick:oe},{default:l(()=>[r("修改")]),_:1},8,["disabled"])),[[j,["qtr:job:edit"]]])]),_:1}),e(s,{span:1.5},{default:l(()=>[_((i(),g(c,{type:"danger",plain:"",icon:"Delete",disabled:o(Z),onClick:te},{default:l(()=>[r("删除")]),_:1},8,["disabled"])),[[j,["qtr:job:remove"]]])]),_:1}),e(s,{span:1.5},{default:l(()=>[_((i(),g(c,{type:"warning",plain:"",icon:"Download",onClick:he},{default:l(()=>[r("导出")]),_:1})),[[j,["qtr:job:export"]]])]),_:1}),e(s,{span:1.5},{default:l(()=>[_((i(),g(c,{type:"info",plain:"",icon:"Operation",onClick:le},{default:l(()=>[r("日志")]),_:1})),[[j,["qtr:job:query"]]])]),_:1}),e(ke,{showSearch:o(P),"onUpdate:showSearch":a[3]||(a[3]=t=>R(P)?P.value=t:null),onQueryTable:w},null,8,["showSearch"])]),_:1}),_((i(),g(xe,{data:o(X),onSelectionChange:fe},{default:l(()=>[e(k,{type:"selection",width:"55",align:"center"}),e(k,{label:"任务编号",width:"100",align:"center",prop:"jobId"}),e(k,{label:"任务名称",align:"center",prop:"jobName","show-overflow-tooltip":!0}),e(k,{label:"任务组名",align:"center",prop:"jobGroup"},{default:l(t=>[e(we,{options:o(I),value:t.row.jobGroup},null,8,["options","value"])]),_:1}),e(k,{label:"调用目标字符串",align:"center",prop:"invokeTarget","show-overflow-tooltip":!0}),e(k,{label:"cron执行表达式",align:"center",prop:"cronExpression","show-overflow-tooltip":!0}),e(k,{label:"状态",align:"center"},{default:l(t=>[e(Ce,{modelValue:t.row.status,"onUpdate:modelValue":C=>t.row.status=C,"active-value":"0","inactive-value":"1",onChange:C=>be(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(k,{label:"操作",align:"center",width:"200","class-name":"small-padding fixed-width"},{default:l(t=>[e(q,{content:"修改",placement:"top"},{default:l(()=>[_(e(c,{link:"",type:"primary",icon:"Edit",onClick:C=>oe(t.row)},null,8,["onClick"]),[[j,["qtr:job:edit"]]])]),_:2},1024),e(q,{content:"删除",placement:"top"},{default:l(()=>[_(e(c,{link:"",type:"primary",icon:"Delete",onClick:C=>te(t.row)},null,8,["onClick"]),[[j,["qtr:job:remove"]]])]),_:2},1024),e(q,{content:"执行一次",placement:"top"},{default:l(()=>[_(e(c,{link:"",type:"primary",icon:"CaretRight",onClick:C=>_e(t.row)},null,8,["onClick"]),[[j,["qtr:job:changeStatus"]]])]),_:2},1024),e(q,{content:"任务详细",placement:"top"},{default:l(()=>[_(e(c,{link:"",type:"primary",icon:"View",onClick:C=>ve(t.row)},null,8,["onClick"]),[[j,["qtr:job:query"]]])]),_:2},1024),e(q,{content:"调度日志",placement:"top"},{default:l(()=>[_(e(c,{link:"",type:"primary",icon:"Operation",onClick:C=>le(t.row)},null,8,["onClick"]),[[j,["qtr:job:query"]]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[$e,o(J)]]),_(e(qe,{total:o(K),page:o(f).pageNum,"onUpdate:page":a[4]||(a[4]=t=>o(f).pageNum=t),limit:o(f).pageSize,"onUpdate:limit":a[5]||(a[5]=t=>o(f).pageSize=t),onPagination:w},null,8,["total","page","limit"]),[[ne,o(K)>0]]),e(H,{title:o(L),modelValue:o(V),"onUpdate:modelValue":a[16]||(a[16]=t=>R(V)?V.value=t:null),width:"820px","append-to-body":""},{footer:l(()=>[x("div",He,[e(c,{type:"primary",onClick:Ve},{default:l(()=>[r("确 定")]),_:1}),e(c,{onClick:ce},{default:l(()=>[r("取 消")]),_:1})])]),default:l(()=>[e(B,{ref:"jobRef",model:o(n),rules:o(se),"label-width":"120px"},{default:l(()=>[e(Q,null,{default:l(()=>[e(s,{span:24},{default:l(()=>[e(d,{label:"任务名称",prop:"jobName"},{default:l(()=>[e(h,{modelValue:o(n).jobName,"onUpdate:modelValue":a[6]||(a[6]=t=>o(n).jobName=t),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"任务分组",prop:"jobGroup"},{default:l(()=>[e(G,{modelValue:o(n).jobGroup,"onUpdate:modelValue":a[7]||(a[7]=t=>o(n).jobGroup=t),placeholder:"请选择"},{default:l(()=>[(i(!0),b($,null,E(o(I),t=>(i(),g(T,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"任务执行器",prop:"jobGroup"},{default:l(()=>[e(G,{modelValue:o(n).jobExecutor,"onUpdate:modelValue":a[8]||(a[8]=t=>o(n).jobExecutor=t),placeholder:"请选择任务执行器"},{default:l(()=>[(i(!0),b($,null,E(o(W),t=>(i(),g(T,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(d,{prop:"invokeTarget"},{label:l(()=>[x("span",null,[r(" 调用方法 "),e(q,{placement:"top"},{content:l(()=>[Qe]),default:l(()=>[e(Ne,null,{default:l(()=>[e(Ue)]),_:1})]),_:1})])]),default:l(()=>[e(h,{modelValue:o(n).invokeTarget,"onUpdate:modelValue":a[9]||(a[9]=t=>o(n).invokeTarget=t),placeholder:"请输入调用目标字符串"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(d,{label:"位置参数",prop:"jobArgs"},{default:l(()=>[e(h,{modelValue:o(n).jobArgs,"onUpdate:modelValue":a[10]||(a[10]=t=>o(n).jobArgs=t),placeholder:"请输入位置参数"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(d,{label:"关键字参数",prop:"jobKwargs"},{default:l(()=>[e(h,{modelValue:o(n).jobKwargs,"onUpdate:modelValue":a[11]||(a[11]=t=>o(n).jobKwargs=t),placeholder:"请输入关键字参数"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(d,{label:"cron表达式",prop:"cronExpression"},{default:l(()=>[e(h,{modelValue:o(n).cronExpression,"onUpdate:modelValue":a[12]||(a[12]=t=>o(n).cronExpression=t),placeholder:"请输入cron执行表达式"},{append:l(()=>[e(c,{type:"primary",onClick:ge},{default:l(()=>[r(" 生成表达式 "),Oe]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(n).jobId!==void 0?(i(),g(s,{key:0,span:24},{default:l(()=>[e(d,{label:"状态"},{default:l(()=>[e(O,{modelValue:o(n).status,"onUpdate:modelValue":a[13]||(a[13]=t=>o(n).status=t)},{default:l(()=>[(i(!0),b($,null,E(o(M),t=>(i(),g(Se,{key:t.value,label:t.value},{default:l(()=>[r(y(t.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):D("",!0),e(s,{span:12},{default:l(()=>[e(d,{label:"执行策略",prop:"misfirePolicy"},{default:l(()=>[e(O,{modelValue:o(n).misfirePolicy,"onUpdate:modelValue":a[14]||(a[14]=t=>o(n).misfirePolicy=t)},{default:l(()=>[e(S,{label:"1"},{default:l(()=>[r("立即执行")]),_:1}),e(S,{label:"2"},{default:l(()=>[r("执行一次")]),_:1}),e(S,{label:"3"},{default:l(()=>[r("放弃执行")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"是否并发",prop:"concurrent"},{default:l(()=>[e(O,{modelValue:o(n).concurrent,"onUpdate:modelValue":a[15]||(a[15]=t=>o(n).concurrent=t)},{default:l(()=>[e(S,{label:"0"},{default:l(()=>[r("允许")]),_:1}),e(S,{label:"1"},{default:l(()=>[r("禁止")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),e(H,{title:"Cron表达式生成器",modelValue:o(N),"onUpdate:modelValue":a[18]||(a[18]=t=>R(N)?N.value=t:null),"append-to-body":"","destroy-on-close":""},{default:l(()=>[e(Ae,{ref:"crontabRef",onHide:a[17]||(a[17]=t=>N.value=!1),onFill:ye,expression:o(ee)},null,8,["expression"])]),_:1},8,["modelValue"]),e(H,{title:"任务详细",modelValue:o(U),"onUpdate:modelValue":a[20]||(a[20]=t=>R(U)?U.value=t:null),width:"700px","append-to-body":""},{footer:l(()=>[x("div",tl,[e(c,{onClick:a[19]||(a[19]=t=>U.value=!1)},{default:l(()=>[r("关 闭")]),_:1})])]),default:l(()=>[e(B,{model:o(n),"label-width":"120px"},{default:l(()=>[e(Q,null,{default:l(()=>[e(s,{span:12},{default:l(()=>[e(d,{label:"任务编号："},{default:l(()=>[r(y(o(n).jobId),1)]),_:1}),e(d,{label:"任务名称："},{default:l(()=>[r(y(o(n).jobName),1)]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"任务分组："},{default:l(()=>[r(y(ie(o(n))),1)]),_:1}),e(d,{label:"创建时间："},{default:l(()=>[r(y(u.parseTime(o(n).createTime)),1)]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"cron表达式："},{default:l(()=>[r(y(o(n).cronExpression),1)]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"下次执行时间："},{default:l(()=>[r(y(u.parseTime(o(n).nextValidTime)),1)]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"任务执行器："},{default:l(()=>[r(y(pe(o(n))),1)]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(d,{label:"调用目标方法："},{default:l(()=>[r(y(o(n).invokeTarget),1)]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(d,{label:"位置参数："},{default:l(()=>[r(y(o(n).jobArgs),1)]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(d,{label:"关键字参数："},{default:l(()=>[r(y(o(n).jobKwargs),1)]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"任务状态："},{default:l(()=>[o(n).status==0?(i(),b("div",Me,"正常")):o(n).status==1?(i(),b("div",We,"暂停")):D("",!0)]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"是否并发："},{default:l(()=>[o(n).concurrent==0?(i(),b("div",Xe,"允许")):o(n).concurrent==1?(i(),b("div",Ye,"禁止")):D("",!0)]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"执行策略："},{default:l(()=>[o(n).misfirePolicy=="0"?(i(),b("div",Ze,"默认策略")):o(n).misfirePolicy=="1"?(i(),b("div",el,"立即执行")):o(n).misfirePolicy=="2"?(i(),b("div",ll,"执行一次")):o(n).misfirePolicy=="3"?(i(),b("div",ol,"放弃执行")):D("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{sl as default};
