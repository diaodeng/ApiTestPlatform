{"version":3,"file":"index.BeXYflT4.js","sources":["../../../src/views/hrm/forward/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <el-form :model=\"queryParams\" ref=\"queryRef\" :inline=\"true\" v-show=\"showSearch\">\r\n      <el-form-item label=\"转发规则ID\" prop=\"ruleId\">\r\n        <el-input\r\n            v-model=\"queryParams.ruleId\"\r\n            placeholder=\"请输入转发规则Id\"\r\n            clearable\r\n            style=\"width: 200px\"\r\n            @keyup.enter=\"handleQuery\"\r\n        />\r\n      </el-form-item>\r\n      <el-form-item label=\"转发规则名称\" prop=\"ruleName\">\r\n        <el-input\r\n            v-model=\"queryParams.ruleName\"\r\n            placeholder=\"请输入转发规则名称\"\r\n            clearable\r\n            style=\"width: 200px\"\r\n            @keyup.enter=\"handleQuery\"\r\n        />\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-checkbox v-model=\"queryParams.onlySelf\" @change=\"handleQuery\">仅自己的数据</el-checkbox>\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" icon=\"Search\" @click=\"handleQuery\" :loading=\"loading.page\" :disabled=\"loading.page\">\r\n          搜索\r\n        </el-button>\r\n        <el-button type=\"default\" icon=\"Refresh\" @click=\"resetQuery\">重置</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n\r\n    <el-row :gutter=\"10\" class=\"mb8\">\r\n      <el-col :span=\"1.5\">\r\n        <el-button\r\n            type=\"primary\"\r\n            plain\r\n            icon=\"Plus\"\r\n            @click=\"handleAdd\"\r\n            v-hasPermi=\"['qtr:forwardRules:add']\"\r\n        >新增\r\n        </el-button>\r\n      </el-col>\r\n      <el-col :span=\"1.5\">\r\n        <el-button\r\n            type=\"danger\"\r\n            plain\r\n            icon=\"Delete\"\r\n            :disabled=\"multiple\"\r\n            @click=\"handleDelete\"\r\n            v-hasPermi=\"['qtr:forwardRules:remove']\"\r\n        >删除\r\n        </el-button>\r\n      </el-col>\r\n      <right-toolbar v-model:showSearch=\"showSearch\" @queryTable=\"getList\"></right-toolbar>\r\n    </el-row>\r\n\r\n    <el-table v-loading=\"loading.page\" :data=\"ruleList\"\r\n              @selection-change=\"handleSelectionChange\"\r\n              border\r\n              table-layout=\"fixed\"\r\n              max-height=\"calc(100vh - 280px)\"\r\n    >\r\n      <el-table-column type=\"selection\" width=\"55\" align=\"center\"/>\r\n      <el-table-column label=\"转发规则ID\" prop=\"ruleId\" width=\"150px\"/>\r\n      <el-table-column label=\"转发规则名称\" prop=\"ruleName\" width=\"auto\" min-width=\"200px\"/>\r\n      <el-table-column label=\"创建人\" align=\"center\" prop=\"createBy\" width=\"80px\"></el-table-column>\r\n      <el-table-column label=\"创建时间\" align=\"center\" prop=\"createTime\" class-name=\"small-padding fixed-width\"\r\n                       width=\"150px\">\r\n        <template #default=\"scope\">\r\n          <span>{{ parseTime(scope.row.createTime) }}</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"更新时间\" align=\"center\" prop=\"createTime\" class-name=\"small-padding fixed-width\"\r\n                       width=\"150px\">\r\n        <template #default=\"scope\">\r\n          <span>{{ parseTime(scope.row.updateTime) }}</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"操作\" width=\"170\" align=\"center\" class-name=\"small-padding fixed-width\" fixed=\"right\">\r\n        <template #default=\"scope\">\r\n          <el-button link type=\"warning\" icon=\"Histogram\" :loading=\"loading.edite\" @click=\"showDetail(scope.row)\"\r\n                     v-hasPermi=\"['qtr:forwardRules:edit']\" title=\"详情\">\r\n          </el-button>\r\n          <el-button link type=\"warning\" icon=\"Edit\" :loading=\"loading.edite\" @click=\"handleUpdate(scope.row)\"\r\n                     v-hasPermi=\"['qtr:forwardRules:edit']\" title=\"编辑\">\r\n          </el-button>\r\n          <el-button link type=\"warning\" icon=\"CopyDocument\" :loading=\"loading.copy\" @click=\"showCopyDialog(scope.row)\"\r\n                     v-hasPermi=\"['qtr:forwardRules:copy']\" title=\"复制\">\r\n          </el-button>\r\n          <el-button link type=\"danger\" icon=\"Delete\" @click=\"handleDelete(scope.row)\"\r\n                     v-hasPermi=\"['qtr:forwardRules:remove']\" title=\"删除\">\r\n          </el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <pagination\r\n        v-show=\"total > 0\"\r\n        :total=\"total\"\r\n        v-model:page=\"queryParams.pageNum\"\r\n        v-model:limit=\"queryParams.pageSize\"\r\n        @pagination=\"getList\"\r\n    />\r\n\r\n\r\n    <!-- 新增或者编辑转发规则 -->\r\n    <el-dialog :title=\"title + ' >> ' + currentRuleId + form?.ruleName\"\r\n               v-model=\"showDetailDialog\" append-to-body destroy-on-close>\r\n      <el-container style=\"height: 100%\">\r\n        <el-main style=\"max-height: calc(100vh - 95px);\">\r\n\r\n          <el-form>\r\n            <el-form-item label=\"规则名称：\">\r\n              <el-input v-model=\"form.ruleName\"></el-input>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"简要描述：\">\r\n              <el-input v-model=\"form.simpleDesc\"></el-input>\r\n            </el-form-item>\r\n          </el-form>\r\n        </el-main>\r\n        <el-footer>\r\n          <div class=\"dialog-footer\">\r\n            <el-button @click=\"showDetailDialog = false\">取消</el-button>\r\n            <el-button type=\"primary\" @click=\"saveForwardRules\">保存</el-button>\r\n          </div>\r\n\r\n        </el-footer>\r\n      </el-container>\r\n    </el-dialog>\r\n\r\n\r\n    <el-dialog :title=\"copyRulesInfo?.ruleName\" v-model=\"copyDialog\" append-to-body destroy-on-close>\r\n      <el-container style=\"height: 100%\">\r\n        <el-main style=\"max-height: calc(100vh - 95px);\">\r\n          <el-input placeholder=\"请输入转发规则名称\" v-model=\"copyRulesInfo.ruleName\">\r\n            <template #suffix>\r\n              <el-button @click=\"copyRulesHandle\">保存</el-button>\r\n            </template>\r\n          </el-input>\r\n        </el-main>\r\n      </el-container>\r\n    </el-dialog>\r\n\r\n    <!-- 转发规则详情列表 -->\r\n    <el-dialog fullscreen :title=\"title + ' >> ' + currentEditRulesDialogTitle\"\r\n               v-model=\"showDetailListDialog\" append-to-body destroy-on-close>\r\n      <el-container style=\"height: 100%\">\r\n        <el-main style=\"max-height: calc(100vh - 95px);\">\r\n          <ForwardDetailIndex :rules-id=\"currentEditRules?.ruleId\"></ForwardDetailIndex>\r\n        </el-main>\r\n      </el-container>\r\n    </el-dialog>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script setup name=\"Rules\">\r\nimport * as forwardApi from \"@/api/hrm/forward\";\r\nimport TagSelector from \"@/components/hrm/common/tag-selector.vue\";\r\nimport {initForwardRulesFormData} from \"@/components/hrm/data-template\";\r\nimport {ElMessage, ElMessageBox} from \"element-plus\";\r\nimport {Remove} from \"@element-plus/icons-vue\";\r\nimport ForwardDetailIndex from \"@/views/hrm/forward/forward_detail_index.vue\";\r\n\r\nconst {proxy} = getCurrentInstance();\r\n\r\n\r\nconst ruleList = ref([]);\r\nconst showSearch = ref(true);\r\nconst single = ref(true);\r\nconst multiple = ref(true);\r\nconst total = ref(0);\r\nconst title = ref(\"\");\r\n\r\nconst checkedIds = ref([]);\r\n\r\nconst showDetailDialog = ref(false);\r\nconst showDetailListDialog = ref(false);\r\nconst currentEditRules = ref(initForwardRulesFormData);\r\n\r\nconst copyDialog = ref(false);\r\nconst copyRulesInfo = ref(initForwardRulesFormData);\r\n\r\nconst queryParams = toRef({\r\n  pageNum: 1,\r\n  pageSize: 10,\r\n  ruleId: undefined,\r\n  ruleName: undefined,\r\n  status: undefined,\r\n  onlySelf: true\r\n});\r\n\r\nconst form = ref(initForwardRulesFormData);\r\nconst loading = ref({\r\n  page: false,\r\n  edite: false,\r\n  copy: false\r\n});\r\n\r\n\r\nconst currentRuleId = computed(() => {\r\n  return form.value.ruleId ? '【' + form.value.ruleId + '】' : \"\";\r\n});\r\n\r\nconst currentEditRulesDialogTitle = computed(() => {\r\n  const id_info = currentEditRules.value.ruleId ? '【' + currentEditRules.value.ruleId + '】' : \"\";\r\n  return id_info + currentEditRules.value.ruleName;\r\n});\r\n\r\n\r\nfunction lineStatusChange(selectValue, dataSource) {\r\n  changeRulesStatus({ruleId: dataSource.ruleId, status: selectValue}).then((response) => {\r\n    ElMessage.success(\"修改成功\");\r\n  }).catch(() => {\r\n    ElMessage.error(\"修改失败\");\r\n  });\r\n}\r\n\r\nfunction showDetail(row) {\r\n  showDetailListDialog.value = true;\r\n  currentEditRules.value = row;\r\n\r\n}\r\n\r\n/*\r\n* 换起转发规则复制弹窗\r\n* */\r\nfunction showCopyDialog(data) {\r\n  copyDialog.value = true;\r\n  copyRulesInfo.value = structuredClone(toValue(toRaw(data)));\r\n}\r\n\r\n\r\n/*\r\n* 复制转发规则\r\n* */\r\nfunction copyRulesHandle() {\r\n  copyDialog.value = true;\r\n  let data = {\r\n    ruleId: copyRulesInfo.value.ruleId,\r\n    ruleName: copyRulesInfo.value.ruleName,\r\n  }\r\n  forwardApi.copyRules(data).then(response => {\r\n    ElMessage.success(\"复制成功\");\r\n  }).finally(() => {\r\n    copyDialog.value = false;\r\n  });\r\n}\r\n\r\n\r\n/** 查询列表 */\r\nfunction getList() {\r\n  loading.value.page = true;\r\n  forwardApi.list(queryParams.value).then(response => {\r\n    ruleList.value = response.rows;\r\n    total.value = response.total;\r\n  }).finally(() => {\r\n    loading.value.page = false;\r\n  });\r\n}\r\n\r\n\r\n/** 搜索按钮操作 */\r\nfunction handleQuery() {\r\n  queryParams.value.pageNum = 1;\r\n  getList();\r\n}\r\n\r\n/** 重置按钮操作 */\r\nfunction resetQuery() {\r\n  proxy.resetForm(\"queryRef\");\r\n  handleQuery();\r\n}\r\n\r\n/** 多选框选中数据 */\r\nfunction handleSelectionChange(selection) {\r\n  checkedIds.value = selection.map(item => item.ruleId);\r\n  single.value = selection.length !== 1;\r\n  multiple.value = !selection.length;\r\n}\r\n\r\n/** 新增按钮操作 */\r\nfunction handleAdd() {\r\n\r\n  title.value = \"添加转发规则\";\r\n  form.value = JSON.parse(JSON.stringify(initForwardRulesFormData));\r\n  showDetailDialog.value = true;\r\n}\r\n\r\n/** 修改按钮操作 */\r\nfunction handleUpdate(row) {\r\n  loading.value.edite = true;\r\n  const ruleId = row.ruleId || checkedIds.value;\r\n  forwardApi.getDetail(ruleId).then(response => {\r\n    if (!response.data || Object.keys(response.data).length === 0) {\r\n      ElMessage.warning(\"未查到对应数据！\");\r\n      return;\r\n    }\r\n    form.value = response.data;\r\n\r\n    title.value = \"修改转发规则\";\r\n    showDetailDialog.value = true;\r\n  }).finally(() => {\r\n    loading.value.edite = false;\r\n  });\r\n}\r\n\r\n/*\r\n* 更新转发规则状态\r\n* */\r\nfunction changeStatus(row) {\r\n\r\n  forwardApi.changeRulesStatus({ruleId: row.ruleId, status: row.status}).then((response) => {\r\n    ElMessage.success(\"修改成功\");\r\n  }).catch(() => {\r\n    ElMessage.error(\"修改失败\");\r\n  });\r\n}\r\n\r\n/** 删除按钮操作 */\r\nfunction handleDelete(row) {\r\n  const ruleIds = row.ruleId ? [row.ruleId] : checkedIds.value;\r\n  proxy.$modal.confirm('是否确认删除ID为\"' + ruleIds + '\"的数据项？').then(function () {\r\n    return forwardApi.delRules({\"ruleId\": ruleIds});\r\n  }).then(() => {\r\n    getList();\r\n    proxy.$modal.msgSuccess(\"删除成功\");\r\n  }).catch(() => {\r\n  });\r\n}\r\n\r\n// 新增、编辑详情页相关\r\n// >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\r\nfunction addOriginUrl() {\r\n  form.value.originUrl.push(\"\");\r\n}\r\n\r\nfunction removeOriginUrl(index) {\r\n  if (form.value.originUrl.length <= 1) {\r\n    form.value.originUrl[0] = \"\";\r\n    return;\r\n  }\r\n  form.value.originUrl.splice(index, 1);\r\n}\r\n\r\nfunction saveForwardRules() {\r\n  loading.value.edite = true;\r\n\r\n  if (form.value.ruleId) {\r\n    forwardApi.updateRules(form.value).then((response) => {\r\n      ElMessage.success(response.msg);\r\n      showDetailDialog.value = false;\r\n    }).catch((e) => {\r\n      ElMessage.error(\"操作失败：\" + e);\r\n    }).finally(() => {\r\n      loading.value.edite = false;\r\n    });\r\n  } else {\r\n    forwardApi.addRules(form.value).then((response) => {\r\n      ElMessage.success(response.msg);\r\n      showDetailDialog.value = false;\r\n    }).catch((e) => {\r\n      ElMessage.error(\"操作失败：\" + e);\r\n    }).finally(() => {\r\n      loading.value.edite = false;\r\n    });\r\n  }\r\n\r\n\r\n}\r\n\r\n// <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<\r\n\r\n\r\nonMounted(() => {\r\n  getList();\r\n})\r\n\r\n</script>\r\n"],"names":["proxy","getCurrentInstance","ruleList","ref","showSearch","single","multiple","total","title","checkedIds","showDetailDialog","showDetailListDialog","currentEditRules","initForwardRulesFormData","copyDialog","copyRulesInfo","queryParams","toRef","form","loading","currentRuleId","computed","currentEditRulesDialogTitle","showDetail","row","showCopyDialog","data","toValue","toRaw","copyRulesHandle","forwardApi.copyRules","response","ElMessage","getList","forwardApi.list","handleQuery","resetQuery","handleSelectionChange","selection","item","handleAdd","handleUpdate","ruleId","forwardApi.getDetail","handleDelete","ruleIds","forwardApi.delRules","saveForwardRules","forwardApi.updateRules","e","forwardApi.addRules","onMounted"],"mappings":"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"}