{"version":3,"file":"authUser.btmR07UL.js","sources":["../../../src/views/system/role/authUser.vue"],"sourcesContent":["\r\n<template>\r\n   <div class=\"app-container\">\r\n      <el-form :model=\"queryParams\" ref=\"queryRef\" v-show=\"showSearch\" :inline=\"true\">\r\n         <el-form-item label=\"用户名称\" prop=\"userName\">\r\n            <el-input\r\n               v-model=\"queryParams.userName\"\r\n               placeholder=\"请输入用户名称\"\r\n               clearable\r\n               style=\"width: 240px\"\r\n               @keyup.enter=\"handleQuery\"\r\n            />\r\n         </el-form-item>\r\n         <el-form-item label=\"手机号码\" prop=\"phonenumber\">\r\n            <el-input\r\n               v-model=\"queryParams.phonenumber\"\r\n               placeholder=\"请输入手机号码\"\r\n               clearable\r\n               style=\"width: 240px\"\r\n               @keyup.enter=\"handleQuery\"\r\n            />\r\n         </el-form-item>\r\n         <el-form-item>\r\n            <el-button type=\"primary\" icon=\"Search\" @click=\"handleQuery\">搜索</el-button>\r\n            <el-button icon=\"Refresh\" @click=\"resetQuery\">重置</el-button>\r\n         </el-form-item>\r\n      </el-form>\r\n\r\n      <el-row :gutter=\"10\" class=\"mb8\">\r\n         <el-col :span=\"1.5\">\r\n            <el-button\r\n               type=\"primary\"\r\n               plain\r\n               icon=\"Plus\"\r\n               @click=\"openSelectUser\"\r\n               v-hasPermi=\"['system:role:add']\"\r\n            >添加用户</el-button>\r\n         </el-col>\r\n         <el-col :span=\"1.5\">\r\n            <el-button\r\n               type=\"danger\"\r\n               plain\r\n               icon=\"CircleClose\"\r\n               :disabled=\"multiple\"\r\n               @click=\"cancelAuthUserAll\"\r\n               v-hasPermi=\"['system:role:remove']\"\r\n            >批量取消授权</el-button>\r\n         </el-col>\r\n         <el-col :span=\"1.5\">\r\n            <el-button \r\n               type=\"warning\" \r\n               plain \r\n               icon=\"Close\"\r\n               @click=\"handleClose\"\r\n            >关闭</el-button>\r\n         </el-col>\r\n         <right-toolbar v-model:showSearch=\"showSearch\" @queryTable=\"getList\"></right-toolbar>\r\n      </el-row>\r\n\r\n      <el-table v-loading=\"loading\" :data=\"userList\" @selection-change=\"handleSelectionChange\">\r\n         <el-table-column type=\"selection\" width=\"55\" align=\"center\" />\r\n         <el-table-column label=\"用户名称\" prop=\"userName\" :show-overflow-tooltip=\"true\" />\r\n         <el-table-column label=\"用户昵称\" prop=\"nickName\" :show-overflow-tooltip=\"true\" />\r\n         <el-table-column label=\"邮箱\" prop=\"email\" :show-overflow-tooltip=\"true\" />\r\n         <el-table-column label=\"手机\" prop=\"phonenumber\" :show-overflow-tooltip=\"true\" />\r\n         <el-table-column label=\"状态\" align=\"center\" prop=\"status\">\r\n            <template #default=\"scope\">\r\n               <dict-tag :options=\"sys_normal_disable\" :value=\"scope.row.status\" />\r\n            </template>\r\n         </el-table-column>\r\n         <el-table-column label=\"创建时间\" align=\"center\" prop=\"createTime\" width=\"180\">\r\n            <template #default=\"scope\">\r\n               <span>{{ parseTime(scope.row.createTime) }}</span>\r\n            </template>\r\n         </el-table-column>\r\n         <el-table-column label=\"操作\" align=\"center\" class-name=\"small-padding fixed-width\">\r\n            <template #default=\"scope\">\r\n               <el-button link type=\"primary\" icon=\"CircleClose\" @click=\"cancelAuthUser(scope.row)\" v-hasPermi=\"['system:role:remove']\">取消授权</el-button>\r\n            </template>\r\n         </el-table-column>\r\n      </el-table>\r\n\r\n      <pagination\r\n         v-show=\"total > 0\"\r\n         :total=\"total\"\r\n         v-model:page=\"queryParams.pageNum\"\r\n         v-model:limit=\"queryParams.pageSize\"\r\n         @pagination=\"getList\"\r\n      />\r\n      <select-user ref=\"selectRef\" :roleId=\"queryParams.roleId\" @ok=\"handleQuery\" />\r\n   </div>\r\n</template>\r\n\r\n<script setup name=\"AuthUser\">\r\nimport selectUser from \"./selectUser\";\r\nimport { allocatedUserList, authUserCancel, authUserCancelAll } from \"@/api/system/role\";\r\n\r\nconst route = useRoute();\r\nconst { proxy } = getCurrentInstance();\r\nconst { sys_normal_disable } = proxy.useDict(\"sys_normal_disable\");\r\n\r\nconst userList = ref([]);\r\nconst loading = ref(true);\r\nconst showSearch = ref(true);\r\nconst multiple = ref(true);\r\nconst total = ref(0);\r\nconst userIds = ref([]);\r\n\r\nconst queryParams = reactive({\r\n  pageNum: 1,\r\n  pageSize: 10,\r\n  roleId: route.params.roleId,\r\n  userName: undefined,\r\n  phonenumber: undefined,\r\n});\r\n\r\n/** 查询授权用户列表 */\r\nfunction getList() {\r\n  loading.value = true;\r\n  allocatedUserList(queryParams).then(response => {\r\n    userList.value = response.rows;\r\n    total.value = response.total;\r\n    loading.value = false;\r\n  });\r\n}\r\n// 返回按钮\r\nfunction handleClose() {\r\n  const obj = { path: \"/system/role\" };\r\n  proxy.$tab.closeOpenPage(obj);\r\n}\r\n/** 搜索按钮操作 */\r\nfunction handleQuery() {\r\n  queryParams.pageNum = 1;\r\n  getList();\r\n}\r\n/** 重置按钮操作 */\r\nfunction resetQuery() {\r\n  proxy.resetForm(\"queryRef\");\r\n  handleQuery();\r\n}\r\n// 多选框选中数据\r\nfunction handleSelectionChange(selection) {\r\n  userIds.value = selection.map(item => item.userId);\r\n  multiple.value = !selection.length;\r\n}\r\n/** 打开授权用户表弹窗 */\r\nfunction openSelectUser() {\r\n  proxy.$refs[\"selectRef\"].show();\r\n}\r\n/** 取消授权按钮操作 */\r\nfunction cancelAuthUser(row) {\r\n  proxy.$modal.confirm('确认要取消该用户\"' + row.userName + '\"角色吗？').then(function () {\r\n    return authUserCancel({ userId: row.userId, roleId: queryParams.roleId });\r\n  }).then(() => {\r\n    getList();\r\n    proxy.$modal.msgSuccess(\"取消授权成功\");\r\n  }).catch(() => {});\r\n}\r\n/** 批量取消授权按钮操作 */\r\nfunction cancelAuthUserAll(row) {\r\n  const roleId = queryParams.roleId;\r\n  const uIds = userIds.value.join(\",\");\r\n  proxy.$modal.confirm(\"是否取消选中用户授权数据项?\").then(function () {\r\n    return authUserCancelAll({ roleId: roleId, userIds: uIds });\r\n  }).then(() => {\r\n    getList();\r\n    proxy.$modal.msgSuccess(\"取消授权成功\");\r\n  }).catch(() => {});\r\n}\r\n\r\ngetList();\r\n</script>\r\n"],"names":["route","useRoute","proxy","getCurrentInstance","sys_normal_disable","userList","ref","loading","showSearch","multiple","total","userIds","queryParams","reactive","getList","allocatedUserList","response","handleClose","obj","handleQuery","resetQuery","handleSelectionChange","selection","item","openSelectUser","cancelAuthUser","row","authUserCancel","cancelAuthUserAll","roleId","uIds","authUserCancelAll"],"mappings":"iWAiGA,MAAMA,EAAQC,EAAQ,EAChB,CAAE,MAAAC,CAAK,EAAKC,IACZ,CAAE,mBAAAC,CAAkB,EAAKF,EAAM,QAAQ,oBAAoB,EAE3DG,EAAWC,EAAI,CAAA,CAAE,EACjBC,EAAUD,EAAI,EAAI,EAClBE,EAAaF,EAAI,EAAI,EACrBG,EAAWH,EAAI,EAAI,EACnBI,EAAQJ,EAAI,CAAC,EACbK,EAAUL,EAAI,CAAA,CAAE,EAEhBM,EAAcC,EAAS,CAC3B,QAAS,EACT,SAAU,GACV,OAAQb,EAAM,OAAO,OACrB,SAAU,OACV,YAAa,MACf,CAAC,EAGD,SAASc,GAAU,CACjBP,EAAQ,MAAQ,GAChBQ,GAAkBH,CAAW,EAAE,KAAKI,GAAY,CAC9CX,EAAS,MAAQW,EAAS,KAC1BN,EAAM,MAAQM,EAAS,MACvBT,EAAQ,MAAQ,EACpB,CAAG,CACH,CAEA,SAASU,GAAc,CACrB,MAAMC,EAAM,CAAE,KAAM,gBACpBhB,EAAM,KAAK,cAAcgB,CAAG,CAC9B,CAEA,SAASC,GAAc,CACrBP,EAAY,QAAU,EACtBE,GACF,CAEA,SAASM,GAAa,CACpBlB,EAAM,UAAU,UAAU,EAC1BiB,GACF,CAEA,SAASE,EAAsBC,EAAW,CACxCX,EAAQ,MAAQW,EAAU,IAAIC,GAAQA,EAAK,MAAM,EACjDd,EAAS,MAAQ,CAACa,EAAU,MAC9B,CAEA,SAASE,GAAiB,CACxBtB,EAAM,MAAM,UAAa,KAAI,CAC/B,CAEA,SAASuB,EAAeC,EAAK,CAC3BxB,EAAM,OAAO,QAAQ,YAAcwB,EAAI,SAAW,OAAO,EAAE,KAAK,UAAY,CAC1E,OAAOC,GAAe,CAAE,OAAQD,EAAI,OAAQ,OAAQd,EAAY,MAAM,CAAE,CAC5E,CAAG,EAAE,KAAK,IAAM,CACZE,IACAZ,EAAM,OAAO,WAAW,QAAQ,CACpC,CAAG,EAAE,MAAM,IAAM,CAAA,CAAE,CACnB,CAEA,SAAS0B,EAAkBF,EAAK,CAC9B,MAAMG,EAASjB,EAAY,OACrBkB,EAAOnB,EAAQ,MAAM,KAAK,GAAG,EACnCT,EAAM,OAAO,QAAQ,gBAAgB,EAAE,KAAK,UAAY,CACtD,OAAO6B,GAAkB,CAAE,OAAQF,EAAQ,QAASC,CAAI,CAAE,CAC9D,CAAG,EAAE,KAAK,IAAM,CACZhB,IACAZ,EAAM,OAAO,WAAW,QAAQ,CACpC,CAAG,EAAE,MAAM,IAAM,CAAA,CAAE,CACnB,CAEA,OAAAY"}