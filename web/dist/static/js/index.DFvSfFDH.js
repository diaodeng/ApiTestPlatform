import{r as m,D as he,a0 as ye,d as r,J as G,o as d,c as j,I as g,U as W,h as t,e as l,f as o,P as D,a7 as S,l as p,k as Ve,p as c,$ as B,m as z,z as F,C as we,v as Ie,E as ke}from"./index.CHnR_MAu.js";import{l as je,g as Ue,u as xe,a as Ce,d as Ne}from"./module.BMNy9Seo.js";import{H as De,l as Se}from"./project.BpVuymad.js";import{_ as Pe}from"./run_dialog.B-H1ReCy.js";import"./run_detail.CgntWMNI.js";import"./env.jLYomLFD.js";const Te={class:"app-container"},$e={class:"dialog-footer"},Re=we({name:"Module"}),Qe=Object.assign(Re,{setup(qe){const{proxy:v}=Ie(),{sys_normal_disable:P}=v.useDict("sys_normal_disable"),L=m([]),U=m([]),b=m(!1),T=m(!0),x=m(!0),C=m([]),Q=m(!0),H=m(!0),$=m(0),R=m(""),N=m(!1),I=m([]),X=he({form:{testUser:void 0},queryParams:{pageNum:1,pageSize:10,projectId:void 0,moduleName:void 0,status:void 0},rules:{moduleName:[{required:!0,message:"模块名称不能为空",trigger:"blur"}],projectId:[{required:!0,message:"所属项目不能为空",trigger:"blur"}],testUser:[{required:!0,message:"测试负责人不能为空",trigger:"blur"}],sort:[{required:!0,message:"模块顺序不能为空",trigger:"blur"}]}}),{queryParams:s,form:u,rules:Y}=ye(X);function h(){T.value=!0,je(s.value).then(n=>{L.value=n.rows,$.value=n.total,T.value=!1})}function K(){Se(null).then(n=>{U.value=n.data})}function Z(n,a,V){return ee(n.projectId)}function ee(n){for(const a of U.value)if(n===a.projectId)return a.projectName}function le(){b.value=!1,q()}function q(){u.value={moduleId:void 0,projectId:void 0,moduleName:void 0,sort:0,status:"0",remark:void 0},v.resetForm("postRef")}function M(){s.value.pageNum=1,K(),h()}function te(){v.resetForm("queryRef"),M()}function ae(n){C.value=n.map(a=>a.moduleId),I.value=C.value,Q.value=n.length!=1,H.value=!n.length}function oe(){q(),b.value=!0,R.value="添加模块"}function O(n){q();const a=n.moduleId||C.value;Ue(a).then(V=>{u.value=V.data,b.value=!0,R.value="修改模块"})}function ne(){v.$refs.postRef.validate(n=>{n&&(u.value.moduleId!=null?xe(u.value).then(a=>{v.$modal.msgSuccess("修改成功"),b.value=!1,h()}):Ce(u.value).then(a=>{v.$modal.msgSuccess("新增成功"),b.value=!1,h()}))})}function A(n){const a=n.moduleId||C.value;v.$modal.confirm('是否确认删除模块编号为"'+a+'"的数据项？').then(function(){return Ne(a)}).then(()=>{h(),v.$modal.msgSuccess("删除成功")}).catch(()=>{})}function ue(){v.download("hrm/module/export",{...s.value},`Module_${new Date().getTime()}.xlsx`)}function re(n){if(n&&"moduleId"in n&&n.moduleId&&(I.value=[n.moduleId]),!I.value||I.value.length===0){ke.alert("请选择要运行的模块","提示！",{type:"warning"});return}N.value=!0}return K(),h(),(n,a)=>{const V=r("el-option"),E=r("el-select"),i=r("el-form-item"),w=r("el-input"),f=r("el-button"),J=r("el-form"),k=r("el-col"),de=r("right-toolbar"),se=r("el-row"),_=r("el-table-column"),ie=r("dict-tag"),me=r("el-table"),pe=r("pagination"),ce=r("el-input-number"),fe=r("el-radio"),_e=r("el-radio-group"),ge=r("el-dialog"),y=G("hasPermi"),ve=G("loading");return d(),j("div",Te,[g(l(J,{model:t(s),ref:"queryRef",inline:!0},{default:o(()=>[l(i,{label:"项目",prop:"projectId"},{default:o(()=>[l(E,{modelValue:t(s).projectId,"onUpdate:modelValue":a[0]||(a[0]=e=>t(s).projectId=e),placeholder:"请选择",clearable:"",style:{width:"150px"}},{default:o(()=>[(d(!0),j(D,null,S(t(U),e=>(d(),p(V,{key:e.projectId,label:e.projectName,value:e.projectId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"模块名称",prop:"moduleName"},{default:o(()=>[l(w,{modelValue:t(s).moduleName,"onUpdate:modelValue":a[1]||(a[1]=e=>t(s).moduleName=e),placeholder:"请输入模块名称",clearable:"",style:{width:"200px"},onKeyup:Ve(M,["enter"])},null,8,["modelValue"])]),_:1}),l(i,{label:"状态",prop:"status"},{default:o(()=>[l(E,{modelValue:t(s).status,"onUpdate:modelValue":a[2]||(a[2]=e=>t(s).status=e),placeholder:"模块状态",clearable:"",style:{width:"200px"}},{default:o(()=>[(d(!0),j(D,null,S(t(P),e=>(d(),p(V,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(i,null,{default:o(()=>[l(f,{type:"primary",icon:"Search",onClick:M},{default:o(()=>[c("搜索")]),_:1}),l(f,{icon:"Refresh",onClick:te},{default:o(()=>[c("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[W,t(x)]]),l(se,{gutter:10,class:"mb8"},{default:o(()=>[l(k,{span:1.5},{default:o(()=>[g((d(),p(f,{type:"primary",plain:"",icon:"Plus",onClick:oe},{default:o(()=>[c("新增 ")]),_:1})),[[y,["hrm:module:add"]]])]),_:1}),l(k,{span:1.5},{default:o(()=>[g((d(),p(f,{type:"success",plain:"",icon:"Edit",disabled:t(Q),onClick:O},{default:o(()=>[c("修改 ")]),_:1},8,["disabled"])),[[y,["hrm:module:edit"]]])]),_:1}),l(k,{span:1.5},{default:o(()=>[g((d(),p(f,{type:"danger",plain:"",icon:"Delete",disabled:t(H),onClick:A},{default:o(()=>[c("删除 ")]),_:1},8,["disabled"])),[[y,["hrm:module:remove"]]])]),_:1}),l(k,{span:1.5},{default:o(()=>[g((d(),p(f,{type:"warning",plain:"",icon:"Download",onClick:ue},{default:o(()=>[c("导出 ")]),_:1})),[[y,["hrm:module:export"]]])]),_:1}),l(k,{span:1.5},{default:o(()=>[g((d(),p(f,{type:"warning",icon:"CaretRight",onClick:re,title:"运行"},{default:o(()=>[c(" 执行 ")]),_:1})),[[y,["hrm:case:run"]]])]),_:1}),l(de,{showSearch:t(x),"onUpdate:showSearch":a[3]||(a[3]=e=>B(x)?x.value=e:null),onQueryTable:h},null,8,["showSearch"])]),_:1}),g((d(),p(me,{border:"",data:t(L),onSelectionChange:ae},{default:o(()=>[l(_,{type:"selection",width:"55",align:"center"}),l(_,{label:"模块ID",align:"center",prop:"moduleId"}),l(_,{label:"模块名称",align:"center",prop:"moduleName"}),l(_,{label:"所属项目",align:"center",formatter:Z}),l(_,{label:"测试人员",align:"center",prop:"testUser"}),l(_,{label:"模块排序",align:"center",prop:"sort"}),l(_,{label:"状态",align:"center",prop:"status"},{default:o(e=>[l(ie,{options:t(P),value:e.row.status},null,8,["options","value"])]),_:1}),l(_,{label:"创建时间",align:"center",prop:"createTime","class-name":"small-padding fixed-width"},{default:o(e=>[z("span",null,F(n.parseTime(e.row.createTime)),1)]),_:1}),l(_,{label:"更新时间",align:"center",prop:"createTime","class-name":"small-padding fixed-width"},{default:o(e=>[z("span",null,F(n.parseTime(e.row.updateTime)),1)]),_:1}),l(_,{label:"操作",width:"180",align:"center","class-name":"small-padding fixed-width"},{default:o(e=>[g((d(),p(f,{link:"",type:"primary",icon:"Edit",onClick:be=>O(e.row)},{default:o(()=>[c(" 修改 ")]),_:2},1032,["onClick"])),[[y,["hrm:module:edit"]]]),g((d(),p(f,{link:"",type:"primary",icon:"Delete",onClick:be=>A(e.row)},{default:o(()=>[c("删除 ")]),_:2},1032,["onClick"])),[[y,["hrm:module:remove"]]])]),_:1})]),_:1},8,["data"])),[[ve,t(T)]]),g(l(pe,{total:t($),page:t(s).pageNum,"onUpdate:page":a[4]||(a[4]=e=>t(s).pageNum=e),limit:t(s).pageSize,"onUpdate:limit":a[5]||(a[5]=e=>t(s).pageSize=e),onPagination:h},null,8,["total","page","limit"]),[[W,t($)>0]]),l(ge,{title:t(R),modelValue:t(b),"onUpdate:modelValue":a[14]||(a[14]=e=>B(b)?b.value=e:null),width:"600px","append-to-body":""},{footer:o(()=>[z("div",$e,[l(f,{type:"primary",onClick:ne},{default:o(()=>[c("确 定")]),_:1}),l(f,{onClick:le},{default:o(()=>[c("取 消")]),_:1})])]),default:o(()=>[l(J,{ref:"postRef",model:t(u),rules:t(Y),"label-width":"100px"},{default:o(()=>[l(i,{label:"模块名称",prop:"moduleName"},{default:o(()=>[l(w,{modelValue:t(u).moduleName,"onUpdate:modelValue":a[6]||(a[6]=e=>t(u).moduleName=e),placeholder:"请输入模块名称"},null,8,["modelValue"])]),_:1}),l(i,{label:"所属项目",prop:"projectId"},{default:o(()=>[l(E,{modelValue:t(u).projectId,"onUpdate:modelValue":a[7]||(a[7]=e=>t(u).projectId=e),placeholder:"请选择"},{default:o(()=>[(d(!0),j(D,null,S(t(U),e=>(d(),p(V,{key:e.projectId,label:e.projectName,value:e.projectId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"测试负责人",prop:"testUser"},{default:o(()=>[l(w,{modelValue:t(u).testUser,"onUpdate:modelValue":a[8]||(a[8]=e=>t(u).testUser=e),placeholder:"请输入测试负责人"},null,8,["modelValue"])]),_:1}),l(i,{label:"模块顺序",prop:"sort"},{default:o(()=>[l(ce,{modelValue:t(u).sort,"onUpdate:modelValue":a[9]||(a[9]=e=>t(u).sort=e),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1}),l(i,{label:"模块状态",prop:"status"},{default:o(()=>[l(_e,{modelValue:t(u).status,"onUpdate:modelValue":a[10]||(a[10]=e=>t(u).status=e)},{default:o(()=>[(d(!0),j(D,null,S(t(P),e=>(d(),p(fe,{key:e.value,label:e.value},{default:o(()=>[c(F(e.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(i,{label:"简要描述",prop:"simpleDesc"},{default:o(()=>[l(w,{type:"textarea",rows:4,modelValue:t(u).simpleDesc,"onUpdate:modelValue":a[11]||(a[11]=e=>t(u).simpleDesc=e),placeholder:"简要描述",maxlength:"100"},null,8,["modelValue"])]),_:1}),l(i,{label:"其他信息",prop:"otherDesc"},{default:o(()=>[l(w,{type:"textarea",rows:4,modelValue:t(u).otherDesc,"onUpdate:modelValue":a[12]||(a[12]=e=>t(u).otherDesc=e),placeholder:"其他信息",maxlength:"100"},null,8,["modelValue"])]),_:1}),l(i,{label:"备注",prop:"remark"},{default:o(()=>[l(w,{modelValue:t(u).remark,"onUpdate:modelValue":a[13]||(a[13]=e=>t(u).remark=e),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),l(Pe,{"dialog-visible":t(N),"onUpdate:dialogVisible":a[15]||(a[15]=e=>B(N)?N.value=e:null),"run-type":t(De).module,"run-ids":t(I)},null,8,["dialog-visible","run-type","run-ids"])])}}});export{Qe as default};
