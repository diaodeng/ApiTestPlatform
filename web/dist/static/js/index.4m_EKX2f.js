import{r as m,J as ye,N as Ve,d as r,H as G,o as d,c as x,I as c,M as W,h as a,e as t,f as o,O as D,P as S,m as g,l as we,p as _,K as B,i as F,y as z,F as he,s as Ie,E as ke}from"./index.B-ki0wTK.js";import{l as xe,g as je,u as Ue,a as Ne,d as Ce}from"./module.DGh92-sK.js";import{R as De,l as Se}from"./project.CjUq6QCv.js";import{_ as Pe}from"./run_dialog.hwjk6Wms.js";import"./run_detail.B7CDhMn4.js";import"./env.BXDgmL9O.js";const Re={class:"app-container"},Te={class:"dialog-footer"},qe=he({name:"Module"}),Le=Object.assign(qe,{setup(Me){const{proxy:v}=Ie(),{qtr_data_status:P}=v.useDict("qtr_data_status"),K=m([]),j=m([]),b=m(!1),R=m(!0),U=m(!0),N=m([]),L=m(!0),O=m(!0),T=m(0),q=m(""),C=m(!1),I=m([]),X=ye({form:{testUser:void 0},queryParams:{pageNum:1,pageSize:10,projectId:void 0,moduleName:void 0,status:void 0},rules:{moduleName:[{required:!0,message:"模块名称不能为空",trigger:"blur"}],projectId:[{required:!0,message:"所属项目不能为空",trigger:"blur"}],testUser:[{required:!0,message:"测试负责人不能为空",trigger:"blur"}],sort:[{required:!0,message:"模块顺序不能为空",trigger:"blur"}]}}),{queryParams:s,form:u,rules:Y}=Ve(X);function y(){R.value=!0,xe(s.value).then(n=>{K.value=n.rows,T.value=n.total,R.value=!1})}function Q(){Se({isPage:!1}).then(n=>{j.value=n.data})}function Z(n,e,w){return ee(n.projectId)}function ee(n){for(const e of j.value)if(n===e.projectId)return e.projectName}function le(){b.value=!1,M()}function M(){u.value={moduleId:void 0,projectId:void 0,moduleName:void 0,sort:0,status:"0",remark:void 0},v.resetForm("postRef")}function $(){s.value.pageNum=1,Q(),y()}function te(){v.resetForm("queryRef"),$()}function ae(n){N.value=n.map(e=>e.moduleId),I.value=N.value,L.value=n.length!=1,O.value=!n.length}function oe(){M(),b.value=!0,q.value="添加模块"}function A(n){M();const e=n.moduleId||N.value;je(e).then(w=>{u.value=w.data,b.value=!0,q.value="修改模块"})}function ne(){v.$refs.postRef.validate(n=>{n&&(u.value.moduleId!=null?Ue(u.value).then(e=>{v.$modal.msgSuccess("修改成功"),b.value=!1,y()}):Ne(u.value).then(e=>{v.$modal.msgSuccess("新增成功"),b.value=!1,y()}))})}function H(n){const e=n.moduleId||N.value;v.$modal.confirm('是否确认删除模块编号为"'+e+'"的数据项？').then(function(){return Ce(e)}).then(()=>{y(),v.$modal.msgSuccess("删除成功")}).catch(()=>{})}function ue(){v.download("hrm/module/export",{...s.value},`Module_${new Date().getTime()}.xlsx`)}function re(n){if(n&&"moduleId"in n&&n.moduleId&&(I.value=[n.moduleId]),!I.value||I.value.length===0){ke.alert("请选择要运行的模块","提示！",{type:"warning"});return}C.value=!0}return Q(),y(),(n,e)=>{const w=r("el-option"),E=r("el-select"),i=r("el-form-item"),h=r("el-input"),p=r("el-button"),J=r("el-form"),k=r("el-col"),de=r("right-toolbar"),se=r("el-row"),f=r("el-table-column"),ie=r("dict-tag"),me=r("el-table"),pe=r("pagination"),fe=r("el-input-number"),ce=r("el-radio"),ge=r("el-radio-group"),_e=r("el-dialog"),V=G("hasPermi"),ve=G("loading");return d(),x("div",Re,[c(t(J,{model:a(s),ref:"queryRef",inline:!0},{default:o(()=>[t(i,{label:"项目",prop:"projectId"},{default:o(()=>[t(E,{modelValue:a(s).projectId,"onUpdate:modelValue":e[0]||(e[0]=l=>a(s).projectId=l),placeholder:"请选择",clearable:"",style:{width:"150px"}},{default:o(()=>[(d(!0),x(D,null,S(a(j),l=>(d(),g(w,{key:l.projectId,label:l.projectName,value:l.projectId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"模块名称",prop:"moduleName"},{default:o(()=>[t(h,{modelValue:a(s).moduleName,"onUpdate:modelValue":e[1]||(e[1]=l=>a(s).moduleName=l),placeholder:"请输入模块名称",clearable:"",style:{width:"200px"},onKeyup:we($,["enter"])},null,8,["modelValue"])]),_:1}),t(i,{label:"状态",prop:"status"},{default:o(()=>[t(E,{modelValue:a(s).status,"onUpdate:modelValue":e[2]||(e[2]=l=>a(s).status=l),placeholder:"模块状态",clearable:"",style:{width:"200px"}},{default:o(()=>[(d(!0),x(D,null,S(a(P),l=>(d(),g(w,{key:l.value*1,label:l.label,value:l.value*1},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,null,{default:o(()=>[t(p,{type:"primary",icon:"Search",onClick:$},{default:o(()=>e[16]||(e[16]=[_("搜索")])),_:1}),t(p,{icon:"Refresh",onClick:te},{default:o(()=>e[17]||(e[17]=[_("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[W,a(U)]]),t(se,{gutter:10,class:"mb8"},{default:o(()=>[t(k,{span:1.5},{default:o(()=>[c((d(),g(p,{type:"primary",plain:"",icon:"Plus",onClick:oe},{default:o(()=>e[18]||(e[18]=[_("新增 ")])),_:1})),[[V,["hrm:module:add"]]])]),_:1}),t(k,{span:1.5},{default:o(()=>[c((d(),g(p,{type:"success",plain:"",icon:"Edit",disabled:a(L),onClick:A},{default:o(()=>e[19]||(e[19]=[_("修改 ")])),_:1},8,["disabled"])),[[V,["hrm:module:edit"]]])]),_:1}),t(k,{span:1.5},{default:o(()=>[c((d(),g(p,{type:"danger",plain:"",icon:"Delete",disabled:a(O),onClick:H},{default:o(()=>e[20]||(e[20]=[_("删除 ")])),_:1},8,["disabled"])),[[V,["hrm:module:remove"]]])]),_:1}),t(k,{span:1.5},{default:o(()=>[c((d(),g(p,{type:"warning",plain:"",icon:"Download",onClick:ue},{default:o(()=>e[21]||(e[21]=[_("导出 ")])),_:1})),[[V,["hrm:module:export"]]])]),_:1}),t(k,{span:1.5},{default:o(()=>[c((d(),g(p,{type:"warning",icon:"CaretRight",onClick:re,title:"运行"},{default:o(()=>e[22]||(e[22]=[_(" 执行 ")])),_:1})),[[V,["hrm:case:run"]]])]),_:1}),t(de,{showSearch:a(U),"onUpdate:showSearch":e[3]||(e[3]=l=>B(U)?U.value=l:null),onQueryTable:y},null,8,["showSearch"])]),_:1}),c((d(),g(me,{border:"",data:a(K),onSelectionChange:ae,"table-layout":"fixed","max-height":"calc(100vh - 280px)"},{default:o(()=>[t(f,{type:"selection",width:"55",align:"center"}),t(f,{label:"模块ID",align:"center",prop:"moduleId",width:"150"}),t(f,{label:"模块名称",align:"center",prop:"moduleName"}),t(f,{label:"所属项目",align:"center",formatter:Z}),t(f,{label:"测试人员",align:"center",prop:"testUser",width:"80"}),t(f,{label:"模块排序",align:"center",prop:"sort",width:"80"}),t(f,{label:"状态",align:"center",prop:"status",width:"70"},{default:o(l=>[t(ie,{options:a(P),value:l.row.status+""},null,8,["options","value"])]),_:1}),t(f,{label:"创建时间",align:"center",prop:"createTime","class-name":"small-padding fixed-width",width:"150"},{default:o(l=>[F("span",null,z(n.parseTime(l.row.createTime)),1)]),_:1}),t(f,{label:"更新时间",align:"center",prop:"createTime","class-name":"small-padding fixed-width",width:"150"},{default:o(l=>[F("span",null,z(n.parseTime(l.row.updateTime)),1)]),_:1}),t(f,{label:"操作",width:"80",align:"center","class-name":"small-padding fixed-width",fixed:"right"},{default:o(l=>[c(t(p,{link:"",type:"primary",icon:"Edit",onClick:be=>A(l.row)},null,8,["onClick"]),[[V,["hrm:module:edit"]]]),c(t(p,{link:"",type:"primary",icon:"Delete",onClick:be=>H(l.row)},null,8,["onClick"]),[[V,["hrm:module:remove"]]])]),_:1})]),_:1},8,["data"])),[[ve,a(R)]]),c(t(pe,{total:a(T),page:a(s).pageNum,"onUpdate:page":e[4]||(e[4]=l=>a(s).pageNum=l),limit:a(s).pageSize,"onUpdate:limit":e[5]||(e[5]=l=>a(s).pageSize=l),onPagination:y},null,8,["total","page","limit"]),[[W,a(T)>0]]),t(_e,{title:a(q),modelValue:a(b),"onUpdate:modelValue":e[14]||(e[14]=l=>B(b)?b.value=l:null),width:"600px","append-to-body":""},{footer:o(()=>[F("div",Te,[t(p,{type:"primary",onClick:ne},{default:o(()=>e[23]||(e[23]=[_("确 定")])),_:1}),t(p,{onClick:le},{default:o(()=>e[24]||(e[24]=[_("取 消")])),_:1})])]),default:o(()=>[t(J,{ref:"postRef",model:a(u),rules:a(Y),"label-width":"100px"},{default:o(()=>[t(i,{label:"模块名称",prop:"moduleName"},{default:o(()=>[t(h,{modelValue:a(u).moduleName,"onUpdate:modelValue":e[6]||(e[6]=l=>a(u).moduleName=l),placeholder:"请输入模块名称"},null,8,["modelValue"])]),_:1}),t(i,{label:"所属项目",prop:"projectId"},{default:o(()=>[t(E,{modelValue:a(u).projectId,"onUpdate:modelValue":e[7]||(e[7]=l=>a(u).projectId=l),placeholder:"请选择"},{default:o(()=>[(d(!0),x(D,null,S(a(j),l=>(d(),g(w,{key:l.projectId,label:l.projectName,value:l.projectId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"测试负责人",prop:"testUser"},{default:o(()=>[t(h,{modelValue:a(u).testUser,"onUpdate:modelValue":e[8]||(e[8]=l=>a(u).testUser=l),placeholder:"请输入测试负责人"},null,8,["modelValue"])]),_:1}),t(i,{label:"模块顺序",prop:"sort"},{default:o(()=>[t(fe,{modelValue:a(u).sort,"onUpdate:modelValue":e[9]||(e[9]=l=>a(u).sort=l),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1}),t(i,{label:"模块状态",prop:"status"},{default:o(()=>[t(ge,{modelValue:a(u).status,"onUpdate:modelValue":e[10]||(e[10]=l=>a(u).status=l)},{default:o(()=>[(d(!0),x(D,null,S(a(P),l=>(d(),g(ce,{key:l.value*1,label:l.value*1},{default:o(()=>[_(z(l.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"简要描述",prop:"simpleDesc"},{default:o(()=>[t(h,{type:"textarea",rows:4,modelValue:a(u).simpleDesc,"onUpdate:modelValue":e[11]||(e[11]=l=>a(u).simpleDesc=l),placeholder:"简要描述",maxlength:"100"},null,8,["modelValue"])]),_:1}),t(i,{label:"其他信息",prop:"otherDesc"},{default:o(()=>[t(h,{type:"textarea",rows:4,modelValue:a(u).otherDesc,"onUpdate:modelValue":e[12]||(e[12]=l=>a(u).otherDesc=l),placeholder:"其他信息",maxlength:"100"},null,8,["modelValue"])]),_:1}),t(i,{label:"备注",prop:"remark"},{default:o(()=>[t(h,{modelValue:a(u).remark,"onUpdate:modelValue":e[13]||(e[13]=l=>a(u).remark=l),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),t(Pe,{"dialog-visible":a(C),"onUpdate:dialogVisible":e[15]||(e[15]=l=>B(C)?C.value=l:null),"run-type":a(De).module,"run-ids":a(I)},null,8,["dialog-visible","run-type","run-ids"])])}}});export{Le as default};
