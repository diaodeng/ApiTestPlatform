{"version":3,"file":"suite-table-query.rRUnmKkE.js","sources":["../../../src/api/qtr/suite.js","../../../src/components/qtr/util-data-table/suite-table-query.vue"],"sourcesContent":["import request from '@/utils/request'\r\n\r\n// 查询测试套件列表\r\nexport function listSuite(query) {\r\n  return request({\r\n    url: '/qtr/suite/list',\r\n    method: 'get',\r\n    params: query\r\n  })\r\n}\r\n\r\n// 查询测试套件详细\r\nexport function getSuite(suiteId) {\r\n  return request({\r\n    url: '/qtr/suite/' + suiteId,\r\n    method: 'get'\r\n  })\r\n}\r\n\r\n// 新增测试套件\r\nexport function addSuite(data) {\r\n  return request({\r\n    url: '/qtr/suite',\r\n    method: 'post',\r\n    data: data\r\n  })\r\n}\r\n\r\n// 修改测试套件\r\nexport function updateSuite(data) {\r\n  return request({\r\n    url: '/qtr/suite',\r\n    method: 'put',\r\n    data: data\r\n  })\r\n}\r\n\r\n// 删除测试套件\r\nexport function delSuite(suiteId) {\r\n  return request({\r\n    url: '/qtr/suite/' + suiteId,\r\n    method: 'delete'\r\n  })\r\n}\r\n\r\n/**************测试套件详细**************/\r\n//查询测试套件详细列表\r\nexport function listDetailSuite(query){\r\n  return request({\r\n    url: '/qtr/suite/detailList',\r\n    method: 'get',\r\n    params: query\r\n  })\r\n}\r\n\r\n// 新增测试套件详情\r\nexport function addSuiteDetail(data) {\r\n  return request({\r\n    url: '/qtr/suite/addSuiteDetail',\r\n    method: 'post',\r\n    data: data\r\n  })\r\n}\r\n\r\n// 修改测试套件详细\r\nexport function updateSuiteDetail(data) {\r\n  return request({\r\n    url: '/qtr/suite/editSuiteDetail',\r\n    method: 'put',\r\n    data: data\r\n  })\r\n}\r\n\r\n// 查询测试套件详细\r\nexport function getSuiteDetail(suiteDetailId) {\r\n  return request({\r\n    url: '/qtr/suite/getSuiteDetail/' + suiteDetailId,\r\n    method: 'get'\r\n  })\r\n}\r\n\r\n\r\n// 修改套件内数据的顺序\r\nexport function changeContentOrder(data) {\r\n  return request({\r\n    url: '/qtr/suite/changeOrder',\r\n    method: 'post',\r\n    data: data\r\n  })\r\n}\r\n","<template>\r\n  <div class=\"app-container\">\r\n    <el-form :model=\"queryParams\" ref=\"queryRef\" :inline=\"true\" v-show=\"showSearch\">\r\n      <el-form-item label=\"套件名称\" prop=\"suiteName\">\r\n        <el-input\r\n            v-model=\"queryParams.suiteName\"\r\n            placeholder=\"请输入套件名称\"\r\n            clearable\r\n            style=\"width: 200px\"\r\n            @keyup.enter=\"handleQuery\"\r\n        />\r\n      </el-form-item>\r\n      <el-form-item label=\"状态\" prop=\"status\">\r\n        <el-select v-model=\"queryParams.status\" placeholder=\"套件状态\" clearable style=\"width: 200px\">\r\n          <el-option\r\n              v-for=\"dict in qtr_data_status\"\r\n              :key=\"dict.value * 1\"\r\n              :label=\"dict.label\"\r\n              :value=\"dict.value * 1\"\r\n          />\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" icon=\"Search\" @click=\"handleQuery\">搜索</el-button>\r\n        <el-button icon=\"Refresh\" @click=\"resetQuery\">重置</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n\r\n    <el-row :gutter=\"10\" class=\"mb8\">\r\n      <slot name=\"table-tool\"></slot>\r\n      <right-toolbar v-model:showSearch=\"showSearch\" @queryTable=\"getList\"></right-toolbar>\r\n    </el-row>\r\n\r\n    <el-table\r\n        border\r\n        ref=\"tableRef\"\r\n        v-if=\"refreshTable\"\r\n        v-loading=\"loading\"\r\n        :data=\"suiteList\"\r\n        row-key=\"suiteId\"\r\n        :default-expand-all=\"isExpandAll\"\r\n        @selection-change=\"handleSelectionChange\"\r\n        @select=\"handleSelect\"\r\n        @select-all=\"handleSelectAll\"\r\n    >\r\n      <el-table-column type=\"selection\" width=\"55\" align=\"center\"/>\r\n      <el-table-column prop=\"suiteId\" label=\"ID\" width=\"160\"></el-table-column>\r\n      <el-table-column prop=\"suiteName\" label=\"套件名称\" width=\"200\"></el-table-column>\r\n      <el-table-column prop=\"orderNum\" label=\"排序\" width=\"200\"></el-table-column>\r\n      <el-table-column prop=\"status\" label=\"状态\" width=\"100\">\r\n        <template #default=\"scope\">\r\n          <dict-tag :options=\"qtr_data_status\" :value=\"scope.row.status + ''\"/>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"创建时间\" align=\"center\" prop=\"createTime\" class-name=\"small-padding fixed-width\">\r\n        <template #default=\"scope\">\r\n          <span>{{ parseTime(scope.row.createTime) }}</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"更新时间\" align=\"center\" prop=\"updateTime\" class-name=\"small-padding fixed-width\">\r\n        <template #default=\"scope\">\r\n          <span>{{ parseTime(scope.row.updateTime) }}</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"操作\" align=\"center\" class-name=\"small-padding fixed-width\" v-if=\"$slots.tableOperate\">\r\n        <template #default=\"scope\">\r\n          <slot name=\"tableOperate\" :scope=\"scope\"></slot>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <pagination\r\n        v-show=\"total > 0 && showPagination\"\r\n        :total=\"total\"\r\n        v-model:page=\"queryParams.pageNum\"\r\n        v-model:limit=\"queryParams.pageSize\"\r\n        @pagination=\"getList\"\r\n    />\r\n\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {listSuite} from \"@/api/qtr/suite\";\r\n\r\n\r\nconst {proxy} = getCurrentInstance();\r\nconst {qtr_data_status} = proxy.useDict(\"qtr_data_status\");\r\nconst props = defineProps({\r\n  showPagination: {type: Boolean, default: true},\r\n  checkedIds: {type: Array, default: []}\r\n});\r\nconst emits = defineEmits(['selectChange']);\r\ndefineExpose({handleQuery, getSelectedIds});\r\n\r\nconst tableRef = ref(null);\r\nconst suiteList = ref([]);\r\nconst open = ref(false);\r\nconst loading = ref(true);\r\nconst showSearch = ref(true);\r\nconst title = ref(\"\");\r\nconst isExpandAll = ref(true);\r\nconst refreshTable = ref(true);\r\nconst total = ref(0);\r\nconst runIds = ref([]);\r\nconst allSelectIds = ref([]);\r\n\r\nconst data = reactive({\r\n  queryParams: {\r\n    pageNum: 1,\r\n    pageSize: 10,\r\n    suiteName: undefined,\r\n    status: undefined\r\n  },\r\n  rules: {\r\n    suiteName: [{required: true, message: \"套件名称不能为空\", trigger: \"blur\"}],\r\n    orderNum: [{required: true, message: \"显示排序不能为空\", trigger: \"blur\"}]\r\n  },\r\n});\r\n\r\nconst {queryParams, rules} = toRefs(data);\r\n\r\n/** 查询套件列表 */\r\nfunction getList() {\r\n  loading.value = true;\r\n  listSuite(queryParams.value).then(response => {\r\n    suiteList.value = response.rows;\r\n    total.value = response.total;\r\n    nextTick(() => {\r\n      if (tableRef.value) {\r\n        tableRef.value.clearSelection();\r\n      }\r\n      if (props.checkedIds && props.checkedIds.length > 0) {\r\n        if (tableRef.value && suiteList.value) {\r\n          suiteList.value.forEach(item => {\r\n            if (props.checkedIds.find(dataId => dataId === item.suiteId)) {\r\n              tableRef.value.toggleRowSelection(item, true);\r\n            }\r\n          });\r\n        }\r\n      }\r\n    });\r\n    loading.value = false;\r\n  });\r\n}\r\n\r\nfunction handleSelectionChange(selection) {\r\n  emits('selectChange', selection);\r\n  runIds.value = selection.map(item => item.suiteId);\r\n}\r\n\r\nfunction getSelectedIds() {\r\n  return runIds.value;\r\n}\r\n\r\n/** 搜索按钮操作 */\r\nfunction handleQuery() {\r\n  getList();\r\n}\r\n\r\n/** 重置按钮操作 */\r\nfunction resetQuery() {\r\n  proxy.resetForm(\"queryRef\");\r\n  handleQuery();\r\n}\r\n\r\n\r\nfunction handleSelect(selection, row) {\r\n  let pageIds = suiteList.value.map(item => item.suiteId);\r\n  let pageSelectIds = selection.map(item => item.suiteId);\r\n  let delIds = pageIds.filter(item => !pageSelectIds.includes(item));\r\n  pageSelectIds.forEach((dataId) => {\r\n    if (!allSelectIds.value.some((suiteId) => suiteId === dataId)) {\r\n      allSelectIds.value.push(dataId);\r\n    }\r\n  });\r\n  allSelectIds.value = allSelectIds.value.filter(item => !delIds.includes(item));\r\n}\r\n\r\n\r\nfunction handleSelectAll(selection) {\r\n  let pageSelectIds = selection.map(item => item.suiteId);\r\n  if (pageSelectIds && pageSelectIds.length > 0) {\r\n    pageSelectIds.forEach((item) => {\r\n      if (!allSelectIds.value.some((suiteId) => suiteId === item)) {\r\n        allSelectIds.value.push(item);\r\n      }\r\n    });\r\n  } else {\r\n    let pageIds = suiteList.value.map(item => item.suiteId);\r\n    allSelectIds.value = allSelectIds.value.filter(item => !pageIds.includes(item));\r\n  }\r\n\r\n}\r\n\r\nonMounted(() => {\r\n  allSelectIds.value = toRaw(props.checkedIds);\r\n  getList();\r\n});\r\n\r\n</script>\r\n"],"names":["listSuite","query","request","getSuite","suiteId","addSuite","data","updateSuite","delSuite","listDetailSuite","addSuiteDetail","updateSuiteDetail","getSuiteDetail","suiteDetailId","changeContentOrder","proxy","getCurrentInstance","qtr_data_status","props","__props","emits","__emit","__expose","handleQuery","getSelectedIds","tableRef","ref","suiteList","loading","showSearch","isExpandAll","refreshTable","total","runIds","allSelectIds","reactive","queryParams","rules","toRefs","getList","response","nextTick","item","dataId","handleSelectionChange","selection","resetQuery","handleSelect","row","pageIds","pageSelectIds","delIds","handleSelectAll","onMounted","toRaw"],"mappings":"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"}