import{X as L,F as _e,av as Ae,A as ie,r as w,J as Ve,au as T,d as g,o as x,c as B,e as l,h as t,f as o,i as H,m as E,aw as Ee,p as I,n as O,q as ue,ax as Me,ay as Re,O as pe,E as Fe,a6 as de,C as Ue,v as Pe,ab as ye,H as qe,I as Ie,K as $,P as $e,y as Be,s as He}from"./index.DgyczuKs.js";import{C as Oe,a as Le,_ as We,S as Ke,b as je,c as Xe,d as ze,g as Je}from"./run-detail.CuvFN77U.js";import{_ as Qe}from"./edit-label-text.B8tq-cA7.js";import{C as k,H as P,R as Ye,r as Ge}from"./enum.Cve1eJHF.js";import{r as Ze}from"./tools.DGA99u3Z.js";import"./data-template.CBoE4CJQ.js";import"./env-selector.CY0X6zlK.js";import"./env.D40RgY2q.js";import"./case.DjTsuh8x.js";import"./table-variables.UtV75Lvs.js";import"./ace-editor.BsmS0mEK.js";import"./ResizeObserver.es.B1PUzC5B.js";import"./module.Ckx2ii-L.js";import"./project.Ta7DfENy.js";import"./forward.Bd-7Bd9U.js";import"./agent.Dph-1RM_.js";function et(_){return L({url:"/hrm/api/mult/tree",method:"get",params:_})}function tt(_){return L({url:"/hrm/api/detail/"+_,method:"get"})}function se(_){return L({url:"/hrm/api",method:"post",data:_})}function re(_){return L({url:"/hrm/api",method:"put",data:_})}function at(_){return L({url:"/hrm/api/"+_,method:"delete"})}function lt(_){return L({url:"/hrm/api/copyAsCase",method:"post",data:_})}const nt=["onDblclick","onClick","onMouseenter","onMouseleave"],ot={key:4},it=_e({__name:"tree-view",props:{dataSource:{},dataSourceModifiers:{},filterText:{},filterTextModifiers:{},treeRef:{},treeRefModifiers:{}},emits:Ae(["nodeDbClick","delNode","filter","addNode","moveNode","editNode","currentNodeChange"],["update:dataSource","update:filterText","update:treeRef"]),setup(_,{emit:j}){const Y=ie(_,"dataSource");ie(_,"filterText");const G=ie(_,"treeRef"),A=w({e:null,data:null,node:null,nodeRef:null}),S=Ve({show:!1,x:0,y:0,data:[{title:"新增文件夹",apiType:k.folder,icon:"Menu"},{title:"新增http请求",apiType:k.http,icon:"Menu",divided:!0},{title:"新增websocket请求",apiType:k.websocket,icon:"Menu",divided:!0}],onSelect:s=>{W(A.value.data,s.apiType)}}),V=j,f=(s,i,r,N)=>{};function u(s,i,r,N){s.preventDefault(),A.value.e=s,A.value.data=i,A.value.node=r,A.value.nodeRef=N,S.x=s.clientX,S.y=s.clientY,S.show=!0}const C={key:"apiId",children:"children",label:"name",isLeaf:"isParent",parentId:"parentId"},W=(s,i)=>{if(!s.isParent){T.warning("只能在文件夹中新增节点");return}const r=Ze(10),b={id:null,name:"新增API",children:[],isNew:!0,apiId:r,isParent:i===k.folder,parentId:s.apiId,type:i!==k.folder?P.api:P.folder,apiType:i,edit:!1};s.children||(s.children=[]),s.children.splice(0,0,b),V("addNode",i,b,s)},M=(s,i,r)=>{Fe.confirm(`确定删除吗？
对应目录下的所有内容都将被删除`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{console.log(r),at(r.apiId).then(N=>{const b=i.parent,v=b.data.children||b.data,y=v.findIndex(m=>m.apiId===r.apiId);v.splice(y,1),T.success("删除成功"),V("delNode",r)}).catch(()=>{})}).catch(()=>{})},q=(s,i,r)=>{V("nodeDbClick",s,i,r)};function p(s,i,r){return!s||i.name.indexOf(s)!==-1||i.title.indexOf(s)!==-1}const R=(s,i)=>{},D=(s,i,r)=>{},U=(s,i,r)=>{},Z=(s,i,r)=>{console.log("tree drag over:",i.label)},X=(s,i,r,N)=>{if(r==="none")return!1},z=(s,i,r,N)=>{let b=null,v=s.data.apiId,y=0;r==="inner"?b=i.data.apiId:(r==="after"||r==="before")&&(b=i.parent.data.apiId),b!==v&&V("moveNode",b,v,y)},ee=(s,i,r)=>!(!i.data.isParent&&r==="inner"||i.data.apiId===s.data.apiId),K=(s,i,r)=>{V("editNode",s,i,r)},te=(s,i)=>{V("currentNodeChange",s,i)};return(s,i)=>{const r=g("el-icon"),N=g("el-button"),b=g("el-tree");return x(),B(pe,null,[l(Oe,{visible:t(S).show,"onUpdate:visible":i[0]||(i[0]=v=>t(S).show=v),x:t(S).x,y:t(S).y,onSelect:t(S).onSelect,menus:t(S).data},null,8,["visible","x","y","onSelect","menus"]),l(b,{style:{"max-width":"600px"},data:Y.value,"highlight-current":"",props:C,"node-key":"apiId","expand-on-click-node":!1,ref_key:"treeRef",ref:G,"filter-node-method":p,onNodeContextmenu:u,draggable:"","allow-drop":ee,onNodeDragStart:R,onNodeDragEnter:D,onNodeDragLeave:U,onNodeDragOver:Z,onNodeDragEnd:X,onNodeDrop:z,onCurrentChange:te},{default:o(({node:v,data:y})=>[H("span",{onDblclick:m=>{q(m,v,y)},onClick:m=>{f(y,v,m)},onMouseenter:m=>{v.data.edit=!0},onMouseleave:m=>{v.data.edit=!1}},[y.apiType===t(k).folder?(x(),E(r,{key:0},{default:o(()=>[l(t(Ee))]),_:1})):y.apiType===t(k).http?(x(),E(N,{key:1,type:"success",link:""},{default:o(()=>i[1]||(i[1]=[I("RQ")])),_:1})):y.apiType===t(k).websocket?(x(),E(N,{key:2,type:"primary",link:""},{default:o(()=>i[2]||(i[2]=[I("WS")])),_:1})):y.apiType===t(k).webui?(x(),E(N,{key:3,type:"warning",link:""},{default:o(()=>i[3]||(i[3]=[I("WB")])),_:1})):O("",!0),H("span",null,[l(Qe,{content:y.name,"onUpdate:content":m=>y.name=m,"show-edite":v.data.edit,"onUpdate:showEdite":m=>v.data.edit=m,onEdite:m=>{K(m,y,v)}},null,8,["content","onUpdate:content","show-edite","onUpdate:showEdite","onEdite"])]),v.data.edit?(x(),B("span",ot,[y.apiType===t(k).folder?(x(),E(r,{key:0,color:"green",onClick:ue(m=>{u(m,y,v)},["stop"])},{default:o(()=>[l(t(Me))]),_:2},1032,["onClick"])):O("",!0),l(r,{color:"red",onClick:ue(m=>M(m,v,y),["stop"])},{default:o(()=>[l(t(Re))]),_:2},1032,["onClick"])])):O("",!0)],40,nt)]),_:1},8,["data"])],64)}}}),dt={class:"app-container",style:{height:"100%"}},st={style:{display:"flex"}},rt={style:{margin:"0px",padding:"0px"}},ut=["onDblclick"],pt={key:0,style:{"flex-grow":"1",display:"flex","flex-direction":"column"}},ft=_e({name:"Api"}),At=Object.assign(ft,{setup(_){const{proxy:j}=He(),{sys_normal_disable:Y}=j.useDict("sys_normal_disable"),{hrm_data_type:G}=j.useDict("hrm_data_type");de("hrm_data_type",G),de("sys_normal_disable",Y);const A=w([]),S=w({}),V=w({parentId:null,name:null}),f=w([]),u=w(f.value[0]||null),C=w(0),W=w({runHistoryDialog:!1}),M=w(!1),q=w(!0),p=w({page:!1,loadApiTree:!1,loadApiInfo:!1,saveApi:!1,debugApi:!1,preSaveDialog:!1,preSaveFolderDialog:!1,filter:!1}),R=w(""),D=w(null),U=w();Ue(()=>{K(),Le().then(a=>{S.value=a.data})});const Z=Pe(()=>{const a=ye(u.value);return a?{request:a.requestInfo,type:a.type,name:a.name,caseId:a.apiId}:{}});de("hrm_case_config_list",S);function X(a){p.value.saveApi=!0;let e=ye(u.value);if(e=structuredClone(e),e.type=P.api,e.requestInfo.teststeps.forEach(n=>{n.result=null}),e.id&&e.apiId&&!e.isNew)a==="copy2case"?lt(e).then(n=>{T({message:"API复制成功",type:"success"})}).catch(n=>{T.error("API复制失败")}).finally(()=>{p.value.saveApi=!1,p.value.preSaveDialog=!1}):re(e).then(n=>{T({message:"API保存成功",type:"success"}),z(n,e.apiId)}).catch(n=>{T({message:"API保存失败",type:"success"})}).finally(()=>{p.value.saveApi=!1,p.value.preSaveDialog=!1});else{const n=e.apiId;delete e.isNew,delete e.apiId,delete e.id,se(e).then(c=>{T({message:"API保存成功",type:"success"}),z(c,n)}).finally(()=>{p.value.saveApi=!1,p.value.preSaveDialog=!1})}}function z(a,e){let n=a;if(n){let c=D.value.getNode(e);c.data.apiId=n.data.apiId,c.data.name=n.data.name,c.data.isNew=!1,c.apiId=n.data.apiId,c.name=n.data.name,f.value.forEach(F=>{F.apiId===e&&(F.apiId=n.data.apiId,C.value=n.data.apiId)})}}function ee(){let a=null;U.value&&(a=U.apiId,a=D.value.getNode(a)?a:null),p.value.preSaveFolderDialog=!0;let e=V.value;e.type=P.folder,e.apiType=k.folder,e.parentId=a,se(e).then(n=>{a?D.value.getNode(a).data.children.splice(0,0,n.data):A.value.splice(0,0,n.data),T({message:"Folder保存成功",type:"success"})}).finally(()=>{p.value.preSaveFolderDialog=!1})}function K(){D.value.setCurrentKey(null,!1),M.value=!0,et({onlySelf:q.value}).then(a=>{A.value=a.data}).finally(()=>{M.value=!1})}function te(a,e,n){if(e.data.isParent)e.expanded=!e.expanded;else{const c=e.data.apiId,F=f.value.findIndex(h=>h.apiId===c);if(F!==-1)C.value=c,u.value=f.value[F],M.value=!1;else{if(M.value=!0,e.data.isNew){let h=Je(e.data.apiType);h.isNew=!0,h.type=e.data.type,h.apiType=e.data.apiType,h.requestInfo.name=e.name,h.parentId=e.data.parentId,h.apiId=e.data.apiId,f.value.push(h),u.value=f.value[f.value.length-1],C.value=h.apiId,f.value[0].isEmpty&&f.value.splice(0,1),M.value=!1;return}tt(e.data.apiId).then(h=>{f.value.push(h.data),u.value=f.value[f.value.length-1],C.value=h.data.apiId,f.value[0].isEmpty&&f.value.splice(0,1),console.log("当前tab："+C.value)}).catch(()=>{}).finally(()=>{M.value=!1})}}}function s(a){const e=f.value.findIndex(n=>n.apiId===a.apiId);e!==-1&&f.value.splice(e,1)}function i(a,e){const n=f.value.findIndex(c=>c.apiId===e);n!==-1&&(f.value.length===1?u.value=!1:f.value.length-1===n?(u.value=f.value[n-1],C.value=u.value.apiId):(u.value=f.value[n+1],C.value=u.value.apiId),f.value.splice(n,1),console.log("删除了tab:"+e))}function r(a,e){}function N(a){const e=f.value.findIndex(n=>n.apiId===a);u.value=f.value[e],C.value=a,D.value.setCurrentKey(a)}function b(a){for(const e in a.data)u.value.requestInfo.teststeps.find(n=>n.step_id===e).result=a.data[e]}function v(){p.value.filter=!0,D.value.filter(R.value),p.value.filter=!1}const y=(a,e,n)=>{re({parentId:a,apiId:e}).then(c=>{T.success("移动节点成功")}).catch(c=>{})},m=(a,e,n)=>{re({name:e.name,apiId:e.apiId}).then(c=>{T.success("修改成功")}).catch(c=>{})},xe=(a,e,n)=>{if(a!==k.folder)return;let c=a===k.folder?P.folder:P.api;se({type:c,apiType:a,name:e.name,parentId:n.apiId}).then(F=>{T.success("文件夹【"+e.name+"】新增成功")}).catch(F=>{})};function be(){if(!u.value){T.warning("请先选择一个接口");return}W.value.runHistoryDialog=!0}function he(a,e){!a||a&&a.type===P.folder||f.value.findIndex(c=>c.apiId===a.apiId)===-1||(C.value=a.apiId,N(a.apiId))}function ke(){p.value.preSaveFolderDialog=!0;let a=D.value.getCurrentNode();a&&!a.isParent&&(a=D.value.getNode(a.patentId)),a?U.value=a:U.value=null}return(a,e)=>{var ce,ve,me;const n=g("el-button"),c=g("el-dropdown-item"),F=g("el-dropdown-menu"),h=g("el-dropdown"),ae=g("el-row"),Ce=g("el-checkbox"),J=g("el-input"),Ne=g("el-col"),we=g("el-scrollbar"),De=g("el-badge"),Se=g("el-tab-pane"),Te=g("el-tabs"),Q=g("el-text"),le=g("el-container"),ne=g("el-main"),oe=g("el-dialog"),fe=qe("loading");return Ie((x(),B("div",dt,[l(ae,{gutter:10},{default:o(()=>[l(n,{onClick:K,icon:"RefreshRight"}),l(n,{onClick:ke,type:"primary"},{default:o(()=>e[20]||(e[20]=[I("新增文件夹")])),_:1}),e[25]||(e[25]=H("span",{style:{"flex-grow":"1"}},null,-1)),Ie((x(),E(h,{"split-button":"",type:"primary",onClick:e[2]||(e[2]=d=>t(p).preSaveDialog=!0),disabled:t(p).saveApi},{dropdown:o(()=>[l(F,null,{default:o(()=>[l(c,{onClick:e[0]||(e[0]=d=>{X("copy2case")})},{default:o(()=>e[21]||(e[21]=[I("另存为用例")])),_:1}),l(c,{onClick:e[1]||(e[1]=d=>console.log("复制API"))},{default:o(()=>e[22]||(e[22]=[I("复制")])),_:1}),l(c,{onClick:be},{default:o(()=>e[23]||(e[23]=[I("执行历史")])),_:1})]),_:1})]),default:o(()=>[e[24]||(e[24]=I(" 保存 "))]),_:1},8,["disabled"])),[[fe,t(p).saveApi]]),l(We,{"run-type":t(Ye).api,"case-data":t(Z),onDebugRun:b},null,8,["run-type","case-data"])]),_:1}),l(le,null,{default:o(()=>[l(Ke,{"left-width":"250px","window-height":"calc(100vh - 156px)"},{left:o(()=>[l(ae,null,{default:o(()=>[l(Ce,{modelValue:t(q),"onUpdate:modelValue":e[3]||(e[3]=d=>$(q)?q.value=d:null),onChange:K},{default:o(()=>e[26]||(e[26]=[I("仅自己的数据")])),_:1},8,["modelValue"])]),_:1}),l(ae,null,{default:o(()=>[l(Ne,{span:24},{default:o(()=>[l(J,{modelValue:t(R),"onUpdate:modelValue":e[4]||(e[4]=d=>$(R)?R.value=d:null),clearable:"",placeholder:"输入名称或者接口或者path"},{suffix:o(()=>[l(n,{icon:"Search",type:"info",onClick:v,loading:t(p).filter,disabled:t(p).filter,link:""},null,8,["loading","disabled"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(we,{height:"calc(100% - 70px)"},{default:o(()=>[H("div",st,[l(it,{"data-source":t(A),"onUpdate:dataSource":e[5]||(e[5]=d=>$(A)?A.value=d:null),onNodeDbClick:te,"filter-text":t(R),"onUpdate:filterText":e[6]||(e[6]=d=>$(R)?R.value=d:null),"tree-ref":t(D),"onUpdate:treeRef":e[7]||(e[7]=d=>$(D)?D.value=d:null),onDelNode:s,onMoveNode:y,onEditNode:m,onAddNode:xe,onCurrentNodeChange:he},null,8,["data-source","filter-text","tree-ref"])])]),_:1})]),right:o(()=>[l(le,{style:{display:"flex","flex-direction":"column",height:"100%","padding-left":"5px"}},{default:o(()=>[l(Te,{type:"card",modelValue:t(C),"onUpdate:modelValue":e[8]||(e[8]=d=>$(C)?C.value=d:null),onTabClick:r,onTabChange:N},{default:o(()=>[(x(!0),B(pe,null,$e(t(f),(d,ct)=>(x(),E(Se,{label:d.name,key:d.requestInfo.teststeps[0].step_id,name:d.apiId},{label:o(()=>[l(De,{"is-dot":"",hidden:!d.modify},{default:o(()=>[H("span",rt,[H("span",{onDblclick:ge=>{N(d.apiId)}},Be(d.name),41,ut),l(n,{onClick:ue(ge=>{i(ge,d.apiId)},["stop"]),icon:"Close",link:""},null,8,["onClick"])])]),_:2},1032,["hidden"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"]),t(u)?(x(),B(pe,{key:0},[t(u)?(x(),B("div",pt,[t(u).requestInfo.teststeps[0].step_type===t(k).http?(x(),E(je,{key:0,"step-detail-data":t(u).requestInfo.teststeps[0],"onUpdate:stepDetailData":e[9]||(e[9]=d=>t(u).requestInfo.teststeps[0]=d),"request-container-height":"calc(100vh - 165px)"},null,8,["step-detail-data"])):O("",!0),t(u).requestInfo.teststeps[0].step_type===t(k).websocket?(x(),E(Xe,{key:1,"step-detail-data":t(u).requestInfo.teststeps[0],"onUpdate:stepDetailData":e[10]||(e[10]=d=>t(u).requestInfo.teststeps[0]=d),"step-container-height":"calc(100vh - 245px)"},null,8,["step-detail-data"])):O("",!0)])):O("",!0)],64)):(x(),E(Q,{key:1,type:"warning",size:"large"},{default:o(()=>e[27]||(e[27]=[I("请选择api或者新增api")])),_:1}))]),_:1})]),_:1})]),_:1}),l(oe,{title:(ce=t(u))==null?void 0:ce.name,onClose:e[13]||(e[13]=d=>t(p).preSaveDialog=!1),modelValue:t(p).preSaveDialog,"onUpdate:modelValue":e[14]||(e[14]=d=>t(p).preSaveDialog=d)},{default:o(()=>[l(ne,null,{default:o(()=>[l(J,{modelValue:t(u).name,"onUpdate:modelValue":e[11]||(e[11]=d=>t(u).name=d),placeholder:"请输入名称"},{prepend:o(()=>[l(Q,null,{default:o(()=>e[28]||(e[28]=[I("API名称:")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(n,{type:"info",onClick:e[12]||(e[12]=d=>t(p).preSaveDialog=!1)},{default:o(()=>e[29]||(e[29]=[I("取消")])),_:1}),l(n,{type:"primary",onClick:X,disabled:t(p).saveApi,loading:t(p).saveApi},{default:o(()=>e[30]||(e[30]=[I("保存 ")])),_:1},8,["disabled","loading"])]),_:1},8,["title","modelValue"]),l(oe,{title:t(V).name,onClose:e[17]||(e[17]=d=>t(p).preSaveFolderDialog=!1),modelValue:t(p).preSaveFolderDialog,"onUpdate:modelValue":e[18]||(e[18]=d=>t(p).preSaveFolderDialog=d)},{default:o(()=>[l(ne,null,{default:o(()=>[l(J,{"model-value":t(U)?t(U).name:"根目录",placeholder:"请输入文件夹名称",disabled:""},{prepend:o(()=>[l(Q,null,{default:o(()=>e[31]||(e[31]=[I("父级目录:")])),_:1})]),_:1},8,["model-value"]),l(J,{modelValue:t(V).name,"onUpdate:modelValue":e[15]||(e[15]=d=>t(V).name=d),placeholder:"请输入文件夹名称",style:{"padding-top":"5px"}},{prepend:o(()=>[l(Q,null,{default:o(()=>e[32]||(e[32]=[I("文件夹名称:")])),_:1})]),_:1},8,["modelValue"])]),_:1}),l(n,{type:"info",onClick:e[16]||(e[16]=d=>t(p).preSaveFolderDialog=!1)},{default:o(()=>e[33]||(e[33]=[I("取消")])),_:1}),l(n,{type:"primary",onClick:ee,disabled:t(p).saveApi},{default:o(()=>e[34]||(e[34]=[I("保存")])),_:1},8,["disabled"])]),_:1},8,["title","modelValue"]),l(oe,{fullscreen:"",title:"【"+((ve=t(u))==null?void 0:ve.apiId)+"】"+((me=t(u))==null?void 0:me.name),modelValue:t(W).runHistoryDialog,"onUpdate:modelValue":e[19]||(e[19]=d=>t(W).runHistoryDialog=d),"append-to-body":"","destroy-on-close":""},{default:o(()=>[l(le,{style:{height:"100%"}},{default:o(()=>[l(ne,{style:{"max-height":"calc(100vh - 95px)"}},{default:o(()=>[l(ze,{"run-id":t(u).apiId,"view-type":t(Ge).api},null,8,["run-id","view-type"])]),_:1})]),_:1})]),_:1},8,["title","modelValue"])])),[[fe,t(M)]])}}});export{At as default};
