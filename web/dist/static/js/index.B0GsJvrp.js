import{g as ce,d as me,c as pe,a as fe}from"./case.ClJHBfiF.js";import{_ as ye}from"./tag-selector.DDD2vd4J.js";import{e as ge,d as ve}from"./run-detail.DBJ4uq6l.js";import{a as q}from"./data-template.BrUbBjfC.js";import{_ as _e}from"./run_dialog.CVJLGgG4.js";import{H as _,r as he,R as Ce}from"./enum.BYy-eByp.js";import{_ as ke}from"./case-table-query.BDMVIWkL.js";import{d as Ie,v as X,r as o,a5 as we,e as h,H as be,c as De,o as d,f as n,j as m,k as N,i as l,I as r,l as a,n as C,K as T,au as S,E as Ve,az as xe,ab as Ne,a7 as H}from"./index.DLM0P_FN.js";import"./run_detail.BJTn3gqP.js";import"./report.CGKmgNVL.js";import"./tools.De_J0dJF.js";import"./table-variables.B-u5fhkB.js";import"./ace-editor.DzAKNVzR.js";import"./ResizeObserver.es.B1PUzC5B.js";import"./module.CsavA2LQ.js";import"./project.NehpJ71d.js";import"./env-selector.BKBox_zM.js";import"./env.DaAQ5naB.js";import"./forward.CYnhzzK1.js";import"./agent.DUVcbZuN.js";import"./run-config.DU_xBo-W.js";const Te={class:"app-container"},Xe={__name:"index",props:{dataType:{type:Number,default:_.case},formRules:{type:Object,default:{caseName:[{required:!0,message:"用例名称不能为空",trigger:"blur"}],projectId:[{required:!0,message:"所属项目不能为空",trigger:"blur"}],moduleId:[{required:!0,message:"所属模块不能为空",trigger:"blur"}]}}},setup(c){const{proxy:p}=Ie(),{sys_normal_disable:Y}=p.useDict("sys_normal_disable"),{hrm_data_type:Z}=p.useDict("hrm_data_type"),{qtr_case_status:j}=p.useDict("qtr_case_status"),O=c,B=X(()=>O.dataType===_.case?"用例":"配置");H("hrm_data_type",Z),H("sys_normal_disable",Y),H("qtr_case_status",j);const $=o(null);o([]);const k=o(!1);o(!0);const I=o([]),P=o(!0),E=o(!0);o(0);const R=o(""),ee=o(!0),V=o(!1),w=o([]),x=o(!1),U=o(null),Q=o(),f=o(!1),y=o(q),ae=we({pageNum:1,pageSize:10,type:O.dataType,caseId:void 0,caseName:void 0,projectId:void 0,moduleId:void 0,status:void 0,onlySelf:ee}),g=o(q),b=o({page:!1,edite:!1,run:!1,copy:!1}),te=X(()=>{const t=g.value.caseId?"【"+g.value.caseId+"】":"";return R.value+">> "+t+g.value.caseName});function le(t,e){pe({caseId:e.caseId,status:t}).then(i=>{S.success("修改成功")}).catch(()=>{S.error("修改失败")})}function z(t){if(t&&"caseId"in t&&t.caseId?w.value=[t.caseId]:w.value=I.value,!w.value||w.value.length===0){Ve.alert("请选择要运行的用例","提示！",{type:"warning"});return}V.value=!0}function ne(t){f.value=!0,y.value=structuredClone(xe(Ne(t)))}function se(){f.value=!0;let t={caseId:y.value.caseId,caseName:y.value.caseName};fe(t).then(e=>{S.success("复制成功")}).finally(()=>{f.value=!1})}function oe(){R.value="添加"+B.value,g.value=JSON.parse(JSON.stringify(q)),k.value=!0}function J(t){b.value.edite=!0;const e=t.caseId||I.value;ce(e).then(i=>{if(!i.data||Object.keys(i.data).length===0){S.warning("未查到对应数据！");return}g.value=i.data,R.value="修改"+B.value,k.value=!0}).finally(()=>{b.value.edite=!1})}function ie(t){const e=t.caseId||I.value;U.value=t,Q.value=e,x.value=!0}function M(t){const e=t.caseId||I.value;p.$modal.confirm('是否确认删除ID为"'+e+'"的数据项？').then(function(){return me(e)}).then(()=>{$.value&&$.value.handleQuery(),p.$modal.msgSuccess("删除成功")}).catch(()=>{})}function ue(){p.download("hrm/case/export",{...ae.value},`Case_${new Date().getTime()}.xlsx`)}function re(t){I.value=t.map(e=>e.caseId),P.value=t.length!==1,E.value=!t.length}return(t,e)=>{var G,L,W;const i=h("el-button"),D=h("el-col"),A=h("el-main"),F=h("el-container"),K=h("el-dialog"),de=h("el-input"),u=be("hasPermi");return d(),De("div",Te,[n(ke,{onSelectChange:re,"data-type":c.dataType,ref_key:"caseQueryViewRef",ref:$},{"table-tool":l(()=>[n(D,{span:1.5},{default:l(()=>[r((d(),m(i,{type:"primary",plain:"",icon:"Plus",onClick:oe},{default:l(()=>e[5]||(e[5]=[C("新增 ")])),_:1,__:[5]})),[[u,["hrm:case:add"]]])]),_:1}),n(D,{span:1.5},{default:l(()=>[r((d(),m(i,{type:"success",plain:"",icon:"Edit",disabled:a(P),onClick:J},{default:l(()=>e[6]||(e[6]=[C("修改 ")])),_:1,__:[6]},8,["disabled"])),[[u,["hrm:case:edit"]]])]),_:1}),n(D,{span:1.5},{default:l(()=>[r((d(),m(i,{type:"danger",plain:"",icon:"Delete",disabled:a(E),onClick:M},{default:l(()=>e[7]||(e[7]=[C("删除 ")])),_:1,__:[7]},8,["disabled"])),[[u,["hrm:case:remove"]]])]),_:1}),n(D,{span:1.5},{default:l(()=>[r((d(),m(i,{type:"warning",plain:"",icon:"Download",onClick:ue},{default:l(()=>e[8]||(e[8]=[C("导出 ")])),_:1,__:[8]})),[[u,["hrm:case:export"]]])]),_:1}),n(D,{span:1.5},{default:l(()=>[c.dataType===a(_).case?r((d(),m(i,{key:0,type:"warning",icon:"CaretRight",onClick:z,title:"运行",disabled:a(E)},{default:l(()=>e[9]||(e[9]=[C(" 执行 ")])),_:1,__:[9]},8,["disabled"])),[[u,["hrm:case:run"]]]):N("",!0)]),_:1})]),caseStatus:l(({scope:s})=>[n(ye,{"selected-value":s.row.status,"onUpdate:selectedValue":v=>s.row.status=v,options:a(j),"selector-width":"90px","source-data":s.row,onSelectChanged:le},null,8,["selected-value","onUpdate:selectedValue","options","source-data"])]),tableOperate:l(({scope:s})=>[c.dataType===a(_).case?r((d(),m(i,{key:0,link:"",type:"primary",icon:"Histogram",onClick:v=>ie(s.row),title:"执行历史"},null,8,["onClick"])),[[u,["hrm:case:history"]]]):N("",!0),r(n(i,{link:"",type:"warning",icon:"Edit",loading:a(b).edite,onClick:v=>J(s.row),title:"编辑"},null,8,["loading","onClick"]),[[u,["hrm:case:edit"]]]),c.dataType===a(_).case?r((d(),m(i,{key:1,link:"",type:"warning",icon:"CaretRight",loading:a(b).run,onClick:v=>z(s.row),title:"运行"},null,8,["loading","onClick"])),[[u,["hrm:case:run"]]]):N("",!0),r(n(i,{link:"",type:"warning",icon:"CopyDocument",loading:a(b).copy,onClick:v=>ne(s.row),title:"复制"},null,8,["loading","onClick"]),[[u,["hrm:case:copy"]]]),r(n(i,{link:"",type:"danger",icon:"Delete",onClick:v=>M(s.row),title:"删除"},null,8,["onClick"]),[[u,["hrm:case:remove"]]])]),_:1},8,["data-type"]),n(ge,{"form-datas":a(g),"data-type":c.dataType,"form-rules":c.formRules,"open-case-edit-dialog":a(k),"onUpdate:openCaseEditDialog":e[0]||(e[0]=s=>T(k)?k.value=s:null),title:a(te)},null,8,["form-datas","data-type","form-rules","open-case-edit-dialog","title"]),c.dataType===a(_).case?(d(),m(K,{key:0,fullscreen:"",title:"【"+((G=a(U))==null?void 0:G.caseId)+"】"+((L=a(U))==null?void 0:L.caseName),modelValue:a(x),"onUpdate:modelValue":e[1]||(e[1]=s=>T(x)?x.value=s:null),"append-to-body":"","destroy-on-close":""},{default:l(()=>[n(F,{style:{height:"100%"}},{default:l(()=>[n(A,{style:{"max-height":"calc(100vh - 95px)"}},{default:l(()=>[n(ve,{"run-id":a(Q),"view-type":a(he).case},null,8,["run-id","view-type"])]),_:1})]),_:1})]),_:1},8,["title","modelValue"])):N("",!0),n(K,{title:(W=a(y))==null?void 0:W.caseName,modelValue:a(f),"onUpdate:modelValue":e[3]||(e[3]=s=>T(f)?f.value=s:null),"append-to-body":"","destroy-on-close":""},{default:l(()=>[n(F,{style:{height:"100%"}},{default:l(()=>[n(A,{style:{"max-height":"calc(100vh - 95px)"}},{default:l(()=>[n(de,{placeholder:"请输入用例名称",modelValue:a(y).caseName,"onUpdate:modelValue":e[2]||(e[2]=s=>a(y).caseName=s)},{suffix:l(()=>[n(i,{onClick:se},{default:l(()=>e[10]||(e[10]=[C("保存")])),_:1,__:[10]})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["title","modelValue"]),n(_e,{"dialog-visible":a(V),"onUpdate:dialogVisible":e[4]||(e[4]=s=>T(V)?V.value=s:null),"run-type":a(Ce).case,"run-ids":a(w)},null,8,["dialog-visible","run-type","run-ids"])])}}};export{Xe as default};
//# sourceMappingURL=index.B0GsJvrp.js.map
