{"version":3,"file":"index.BcTJQaOs.js","sources":["../../../src/views/hrm/agent/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <el-form :model=\"queryParams\" ref=\"queryRef\" :inline=\"true\" v-show=\"showSearch\">\r\n      <el-form-item label=\"AgentCode\" prop=\"agentId\">\r\n        <el-input\r\n            v-model=\"queryParams.agentCode\"\r\n            placeholder=\"请输入AgentCode\"\r\n            clearable\r\n            style=\"width: 200px\"\r\n            @keyup.enter=\"handleQuery\"\r\n        />\r\n      </el-form-item>\r\n      <el-form-item label=\"Agent名称\" prop=\"agentName\">\r\n        <el-input\r\n            v-model=\"queryParams.agentName\"\r\n            placeholder=\"请输入Agent名称\"\r\n            clearable\r\n            style=\"width: 200px\"\r\n            @keyup.enter=\"handleQuery\"\r\n        />\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" icon=\"Search\" @click=\"handleQuery\" :loading=\"loading.page\" :disabled=\"loading.page\">\r\n          搜索\r\n        </el-button>\r\n        <el-button type=\"default\" icon=\"Refresh\" @click=\"resetQuery\">重置</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n\r\n    <el-row :gutter=\"10\" class=\"mb8\">\r\n      <el-col :span=\"1.5\">\r\n        <el-button\r\n            type=\"danger\"\r\n            plain\r\n            icon=\"Delete\"\r\n            :disabled=\"multiple\"\r\n            @click=\"handleDelete\"\r\n            v-hasPermi=\"['qtr:agent:remove']\"\r\n        >删除\r\n        </el-button>\r\n      </el-col>\r\n      <right-toolbar v-model:showSearch=\"showSearch\" @queryTable=\"getList\"></right-toolbar>\r\n    </el-row>\r\n\r\n    <el-table v-loading=\"loading.page\" :data=\"pageDataList\"\r\n              @selection-change=\"handleSelectionChange\"\r\n              border\r\n              table-layout=\"fixed\"\r\n              max-height=\"calc(100vh - 280px)\"\r\n    >\r\n      <el-table-column type=\"selection\" width=\"55\" align=\"center\"/>\r\n      <el-table-column label=\"AgentID\" prop=\"agentId\" width=\"150px\"/>\r\n      <el-table-column label=\"Agent名称\" prop=\"agentName\" width=\"auto\" min-width=\"200px\"/>\r\n      <el-table-column label=\"AgentCode\" prop=\"agentCode\" width=\"auto\" min-width=\"200px\"/>\r\n      <el-table-column label=\"状态\" prop=\"status\" width=\"100px\" min-width=\"100px\">\r\n        <template #default=\"scope\">\r\n          <TagEnum :options=\"Object.values(AgentStatusEnum)\" :value=\"[scope.row.status]\"/>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"在线时间\" align=\"center\" prop=\"onlineTime\" class-name=\"small-padding fixed-width\"\r\n                       width=\"150px\">\r\n        <template #default=\"scope\">\r\n          <span>{{ parseTime(scope.row.onlineTime) }}</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"离线时间\" align=\"center\" prop=\"offlineTime\" class-name=\"small-padding fixed-width\"\r\n                       width=\"150px\">\r\n        <template #default=\"scope\">\r\n          <span>{{ parseTime(scope.row.offlineTime) }}</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"操作\" width=\"170\" align=\"center\" class-name=\"small-padding fixed-width\" fixed=\"right\">\r\n        <template #default=\"scope\">\r\n          <el-button link type=\"warning\" icon=\"Edit\" :loading=\"loading.edite\" @click=\"handleUpdate(scope.row)\"\r\n                     v-hasPermi=\"['qtr:agent:edit']\" title=\"编辑\">\r\n          </el-button>\r\n          <el-button link type=\"danger\" icon=\"Delete\" @click=\"handleDelete(scope.row)\"\r\n                     v-hasPermi=\"['qtr:agent:remove']\" title=\"删除\">\r\n          </el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <pagination\r\n        v-show=\"total > 0\"\r\n        :total=\"total\"\r\n        v-model:page=\"queryParams.pageNum\"\r\n        v-model:limit=\"queryParams.pageSize\"\r\n        @pagination=\"getList\"\r\n    />\r\n\r\n\r\n    <!-- 新增或者编辑Agent -->\r\n    <el-dialog :title=\"title + ' >> ' + currentAgentDialogTile\"\r\n               v-model=\"showDetailDialog\" append-to-body destroy-on-close>\r\n      <el-container style=\"height: 100%\">\r\n        <el-main style=\"max-height: calc(100vh - 95px);\">\r\n\r\n          <el-form>\r\n            <el-form-item label=\"Agent名称：\">\r\n              <el-input v-model=\"form.agentName\"></el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"AgentCode：\">\r\n              <el-text>{{ form.agentCode }}</el-text>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"简要描述：\">\r\n              <el-input v-model=\"form.simpleDesc\"></el-input>\r\n            </el-form-item>\r\n          </el-form>\r\n        </el-main>\r\n        <el-footer>\r\n          <div class=\"dialog-footer\">\r\n            <el-button @click=\"showDetailDialog = false\">取消</el-button>\r\n            <el-button type=\"primary\" @click=\"saveAgent\">保存</el-button>\r\n          </div>\r\n\r\n        </el-footer>\r\n      </el-container>\r\n    </el-dialog>\r\n\r\n\r\n    <el-dialog :title=\"copyAgentInfo?.agentName\" v-model=\"copyDialog\" append-to-body destroy-on-close>\r\n      <el-container style=\"height: 100%\">\r\n        <el-main style=\"max-height: calc(100vh - 95px);\">\r\n          <el-input placeholder=\"请输入Agent名称\" v-model=\"copyAgentInfo.agentName\">\r\n            <template #suffix>\r\n              <el-button @click=\"copyAgentHandle\">保存</el-button>\r\n            </template>\r\n          </el-input>\r\n        </el-main>\r\n      </el-container>\r\n    </el-dialog>\r\n\r\n\r\n  </div>\r\n</template>\r\n\r\n<script setup name=\"Agent\">\r\nimport * as agentApi from \"@/api/hrm/agent.js\";\r\nimport {initAgentFormData} from \"@/components/hrm/data-template\";\r\nimport {ElMessage} from \"element-plus\";\r\nimport {AgentStatusEnum} from \"@/components/hrm/enum.js\";\r\nimport TagEnum from \"@/components/hrm/common/tag-enum.vue\";\r\n\r\nconst {proxy} = getCurrentInstance();\r\n\r\n\r\nconst pageDataList = ref([]);\r\nconst showSearch = ref(true);\r\nconst single = ref(true);\r\nconst multiple = ref(true);\r\nconst total = ref(0);\r\nconst title = ref(\"\");\r\n\r\nconst checkedIds = ref([]);\r\n\r\nconst showDetailDialog = ref(false);\r\n\r\nconst copyDialog = ref(false);\r\nconst copyAgentInfo = ref(initAgentFormData);\r\n\r\nconst queryParams = toRef({\r\n  pageNum: 1,\r\n  pageSize: 10,\r\n  agentCode: undefined,\r\n  agentName: undefined,\r\n  status: undefined,\r\n});\r\n\r\nconst form = ref(initAgentFormData);\r\nconst loading = ref({\r\n  page: false,\r\n  edite: false,\r\n  copy: false\r\n});\r\n\r\n\r\nconst currentAgentDialogTile = computed(() => {\r\n  const dataId = form.value.agentId ? '【' + form.value.agentId + '】' : \"\";\r\n  return dataId + form.value.agentName\r\n});\r\n\r\n\r\n/** 查询列表 */\r\nfunction getList() {\r\n  loading.value.page = true;\r\n  agentApi.list(queryParams.value).then(response => {\r\n    pageDataList.value = response.rows;\r\n    total.value = response.total;\r\n  }).finally(() => {\r\n    loading.value.page = false;\r\n  });\r\n}\r\n\r\n\r\n/** 搜索按钮操作 */\r\nfunction handleQuery() {\r\n  queryParams.value.pageNum = 1;\r\n  getList();\r\n}\r\n\r\n/** 重置按钮操作 */\r\nfunction resetQuery() {\r\n  proxy.resetForm(\"queryRef\");\r\n  handleQuery();\r\n}\r\n\r\n/** 多选框选中数据 */\r\nfunction handleSelectionChange(selection) {\r\n  checkedIds.value = selection.map(item => item.agentId);\r\n  single.value = selection.length !== 1;\r\n  multiple.value = !selection.length;\r\n}\r\n\r\n/** 新增按钮操作 */\r\nfunction handleAdd() {\r\n\r\n  title.value = \"添加Agent\";\r\n  form.value = JSON.parse(JSON.stringify(initAgentFormData));\r\n  showDetailDialog.value = true;\r\n}\r\n\r\n/** 修改按钮操作 */\r\nfunction handleUpdate(row) {\r\n  loading.value.edite = true;\r\n  const agentId = row.agentId || checkedIds.value;\r\n  agentApi.getDetail(agentId).then(response => {\r\n    if (!response.data || Object.keys(response.data).length === 0) {\r\n      ElMessage.warning(\"未查到对应数据！\");\r\n      return;\r\n    }\r\n    form.value = response.data;\r\n\r\n    title.value = \"修改Agent\";\r\n    showDetailDialog.value = true;\r\n  }).finally(() => {\r\n    loading.value.edite = false;\r\n  });\r\n}\r\n\r\n\r\n/** 删除按钮操作 */\r\nfunction handleDelete(row) {\r\n  const agentIds = row.agentId ? [row.agentId] : checkedIds.value;\r\n  proxy.$modal.confirm('是否确认删除ID为\"' + agentIds + '\"的数据项？').then(function () {\r\n    return agentApi.delAgent({\"agentId\": agentIds});\r\n  }).then(() => {\r\n    getList();\r\n    proxy.$modal.msgSuccess(\"删除成功\");\r\n  }).catch(() => {\r\n  });\r\n}\r\n\r\n// 编辑详情页相关\r\n// >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\r\n\r\nfunction saveAgent() {\r\n  loading.value.edite = true;\r\n\r\n  agentApi.updateAgent(form.value).then((response) => {\r\n    ElMessage.success(response.msg);\r\n    showDetailDialog.value = false;\r\n  }).catch((e) => {\r\n    ElMessage.error(\"操作失败：\" + e);\r\n  }).finally(() => {\r\n    loading.value.edite = false;\r\n  });\r\n\r\n\r\n}\r\n\r\n// <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<\r\n\r\n\r\nonMounted(() => {\r\n  getList();\r\n})\r\n\r\n</script>\r\n"],"names":["proxy","getCurrentInstance","pageDataList","ref","showSearch","single","multiple","total","title","checkedIds","showDetailDialog","copyDialog","copyAgentInfo","initAgentFormData","queryParams","toRef","form","loading","currentAgentDialogTile","computed","getList","agentApi.list","response","handleQuery","resetQuery","handleSelectionChange","selection","item","handleUpdate","row","agentId","agentApi.getDetail","ElMessage","handleDelete","agentIds","agentApi.delAgent","saveAgent","agentApi.updateAgent","e","onMounted"],"mappings":"qhBAiJA,KAAM,CAAC,MAAAA,CAAK,EAAIC,KAGVC,EAAeC,EAAI,CAAA,CAAE,EACrBC,EAAaD,EAAI,EAAI,EACrBE,EAASF,EAAI,EAAI,EACjBG,EAAWH,EAAI,EAAI,EACnBI,EAAQJ,EAAI,CAAC,EACbK,EAAQL,EAAI,EAAE,EAEdM,EAAaN,EAAI,CAAA,CAAE,EAEnBO,EAAmBP,EAAI,EAAK,EAE5BQ,EAAaR,EAAI,EAAK,EACtBS,EAAgBT,EAAIU,CAAiB,EAErCC,EAAcC,GAAM,CACxB,QAAS,EACT,SAAU,GACV,UAAW,OACX,UAAW,OACX,OAAQ,MACV,CAAC,EAEKC,EAAOb,EAAIU,CAAiB,EAC5BI,EAAUd,EAAI,CAClB,KAAM,GACN,MAAO,GACP,KAAM,EACR,CAAC,EAGKe,EAAyBC,GAAS,KACvBH,EAAK,MAAM,QAAU,IAAMA,EAAK,MAAM,QAAU,IAAM,IACrDA,EAAK,MAAM,SAC5B,EAID,SAASI,GAAU,CACjBH,EAAQ,MAAM,KAAO,GACrBI,GAAcP,EAAY,KAAK,EAAE,KAAKQ,GAAY,CAChDpB,EAAa,MAAQoB,EAAS,KAC9Bf,EAAM,MAAQe,EAAS,KAC3B,CAAG,EAAE,QAAQ,IAAM,CACfL,EAAQ,MAAM,KAAO,EACzB,CAAG,CACH,CAIA,SAASM,GAAc,CACrBT,EAAY,MAAM,QAAU,EAC5BM,GACF,CAGA,SAASI,GAAa,CACpBxB,EAAM,UAAU,UAAU,EAC1BuB,GACF,CAGA,SAASE,EAAsBC,EAAW,CACxCjB,EAAW,MAAQiB,EAAU,IAAIC,GAAQA,EAAK,OAAO,EACrDtB,EAAO,MAAQqB,EAAU,SAAW,EACpCpB,EAAS,MAAQ,CAACoB,EAAU,MAC9B,CAWA,SAASE,EAAaC,EAAK,CACzBZ,EAAQ,MAAM,MAAQ,GACtB,MAAMa,EAAUD,EAAI,SAAWpB,EAAW,MAC1CsB,GAAmBD,CAAO,EAAE,KAAKR,GAAY,CAC3C,GAAI,CAACA,EAAS,MAAQ,OAAO,KAAKA,EAAS,IAAI,EAAE,SAAW,EAAG,CAC7DU,EAAU,QAAQ,UAAU,EAC5B,MACD,CACDhB,EAAK,MAAQM,EAAS,KAEtBd,EAAM,MAAQ,UACdE,EAAiB,MAAQ,EAC7B,CAAG,EAAE,QAAQ,IAAM,CACfO,EAAQ,MAAM,MAAQ,EAC1B,CAAG,CACH,CAIA,SAASgB,EAAaJ,EAAK,CACzB,MAAMK,EAAWL,EAAI,QAAU,CAACA,EAAI,OAAO,EAAIpB,EAAW,MAC1DT,EAAM,OAAO,QAAQ,aAAekC,EAAW,QAAQ,EAAE,KAAK,UAAY,CACxE,OAAOC,GAAkB,CAAC,QAAWD,CAAQ,CAAC,CAClD,CAAG,EAAE,KAAK,IAAM,CACZd,IACApB,EAAM,OAAO,WAAW,MAAM,CAClC,CAAG,EAAE,MAAM,IAAM,CACjB,CAAG,CACH,CAKA,SAASoC,GAAY,CACnBnB,EAAQ,MAAM,MAAQ,GAEtBoB,GAAqBrB,EAAK,KAAK,EAAE,KAAMM,GAAa,CAClDU,EAAU,QAAQV,EAAS,GAAG,EAC9BZ,EAAiB,MAAQ,EAC7B,CAAG,EAAE,MAAO4B,GAAM,CACdN,EAAU,MAAM,QAAUM,CAAC,CAC/B,CAAG,EAAE,QAAQ,IAAM,CACfrB,EAAQ,MAAM,MAAQ,EAC1B,CAAG,CAGH,CAKA,OAAAsB,GAAU,IAAM,CACdnB,GACF,CAAC"}