import{X as I,r as v,u as fe,J as ce,N as be,d,H as E,o as m,c as k,I as w,M as K,h as t,e,f as o,l as _e,O as Y,P as z,m as j,K as G,p as u,i as O,y as f,n as Q,F as ge,s as ve}from"./index.N0ypA0wQ.js";import{g as je}from"./job.CdihWwAa.js";function we(x){return I({url:"/monitor/jobLog/list",method:"get",params:x})}function ye(x){return I({url:"/monitor/jobLog/"+x,method:"delete"})}function he(){return I({url:"/monitor/jobLog/clean",method:"delete"})}const ke={class:"app-container"},xe={key:0},Ve={key:1},Ce={class:"dialog-footer"},Le=ge({name:"JobLog"}),Ge=Object.assign(Le,{setup(x){const{proxy:c}=ve(),{sys_common_status:R,sys_job_group:L,sys_job_executor:A}=c.useDict("sys_common_status","sys_job_group","sys_job_executor"),U=v([]),y=v(!1),N=v(!0),V=v(!0),D=v([]),$=v(!0),S=v(0),h=v([]),P=fe(),H=ce({form:{},queryParams:{pageNum:1,pageSize:10,dictName:void 0,dictType:void 0,status:void 0}}),{queryParams:s,form:i,rules:Ne}=be(H);function _(){N.value=!0,we(c.addDateRange(s.value,h.value)).then(n=>{U.value=n.rows,S.value=n.total,N.value=!1})}function X(n,l){return c.selectDictLabel(L.value,n.jobGroup)}function W(n,l){return c.selectDictLabel(A.value,n.jobExecutor)}function Z(){const n={path:"/monitor/job"};c.$tab.closeOpenPage(n)}function T(){s.value.pageNum=1,_()}function ee(){h.value=[],c.resetForm("queryRef"),T()}function oe(n){D.value=n.map(l=>l.jobLogId),$.value=!n.length}function le(n){y.value=!0,i.value=n}function te(n){c.$modal.confirm('是否确认删除调度日志编号为"'+D.value+'"的数据项?').then(function(){return ye(D.value)}).then(()=>{_(),c.$modal.msgSuccess("删除成功")}).catch(()=>{})}function ae(){c.$modal.confirm("是否确认清空所有调度日志数据项?").then(function(){return he()}).then(()=>{_(),c.$modal.msgSuccess("清空成功")}).catch(()=>{})}function ne(){c.download("monitor/jobLog/export",{...s.value},`job_log_${new Date().getTime()}.xlsx`)}return(()=>{const n=P.params&&P.params.jobId;n!==void 0&&n!=0?je(n).then(l=>{s.value.jobName=l.data.jobName,s.value.jobGroup=l.data.jobGroup,_()}):_()})(),_(),(n,l)=>{const ue=d("el-input"),r=d("el-form-item"),J=d("el-option"),q=d("el-select"),re=d("el-date-picker"),g=d("el-button"),F=d("el-form"),p=d("el-col"),se=d("right-toolbar"),M=d("el-row"),b=d("el-table-column"),B=d("dict-tag"),ie=d("el-table"),de=d("pagination"),pe=d("el-dialog"),C=E("hasPermi"),me=E("loading");return m(),k("div",ke,[w(e(F,{model:t(s),ref:"queryRef",inline:!0,"label-width":"68px"},{default:o(()=>[e(r,{label:"任务名称",prop:"jobName"},{default:o(()=>[e(ue,{modelValue:t(s).jobName,"onUpdate:modelValue":l[0]||(l[0]=a=>t(s).jobName=a),placeholder:"请输入任务名称",clearable:"",style:{width:"240px"},onKeyup:_e(T,["enter"])},null,8,["modelValue"])]),_:1}),e(r,{label:"任务组名",prop:"jobGroup"},{default:o(()=>[e(q,{modelValue:t(s).jobGroup,"onUpdate:modelValue":l[1]||(l[1]=a=>t(s).jobGroup=a),placeholder:"请选择任务组名",clearable:"",style:{width:"240px"}},{default:o(()=>[(m(!0),k(Y,null,z(t(L),a=>(m(),j(J,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"执行状态",prop:"status"},{default:o(()=>[e(q,{modelValue:t(s).status,"onUpdate:modelValue":l[2]||(l[2]=a=>t(s).status=a),placeholder:"请选择执行状态",clearable:"",style:{width:"240px"}},{default:o(()=>[(m(!0),k(Y,null,z(t(R),a=>(m(),j(J,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"执行时间",style:{width:"308px"}},{default:o(()=>[e(re,{modelValue:t(h),"onUpdate:modelValue":l[3]||(l[3]=a=>G(h)?h.value=a:null),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),e(r,null,{default:o(()=>[e(g,{type:"primary",icon:"Search",onClick:T},{default:o(()=>l[9]||(l[9]=[u("搜索")])),_:1}),e(g,{icon:"Refresh",onClick:ee},{default:o(()=>l[10]||(l[10]=[u("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[K,t(V)]]),e(M,{gutter:10,class:"mb8"},{default:o(()=>[e(p,{span:1.5},{default:o(()=>[w((m(),j(g,{type:"danger",plain:"",icon:"Delete",disabled:t($),onClick:te},{default:o(()=>l[11]||(l[11]=[u("删除")])),_:1},8,["disabled"])),[[C,["monitor:job:remove"]]])]),_:1}),e(p,{span:1.5},{default:o(()=>[w((m(),j(g,{type:"danger",plain:"",icon:"Delete",onClick:ae},{default:o(()=>l[12]||(l[12]=[u("清空")])),_:1})),[[C,["monitor:job:remove"]]])]),_:1}),e(p,{span:1.5},{default:o(()=>[w((m(),j(g,{type:"warning",plain:"",icon:"Download",onClick:ne},{default:o(()=>l[13]||(l[13]=[u("导出")])),_:1})),[[C,["monitor:job:export"]]])]),_:1}),e(p,{span:1.5},{default:o(()=>[e(g,{type:"warning",plain:"",icon:"Close",onClick:Z},{default:o(()=>l[14]||(l[14]=[u("关闭")])),_:1})]),_:1}),e(se,{showSearch:t(V),"onUpdate:showSearch":l[4]||(l[4]=a=>G(V)?V.value=a:null),onQueryTable:_},null,8,["showSearch"])]),_:1}),w((m(),j(ie,{data:t(U),onSelectionChange:oe},{default:o(()=>[e(b,{type:"selection",width:"55",align:"center"}),e(b,{label:"日志编号",width:"80",align:"center",prop:"jobLogId"}),e(b,{label:"任务名称",align:"center",prop:"jobName","show-overflow-tooltip":!0}),e(b,{label:"任务组名",align:"center",prop:"jobGroup","show-overflow-tooltip":!0},{default:o(a=>[e(B,{options:t(L),value:a.row.jobGroup},null,8,["options","value"])]),_:1}),e(b,{label:"调用目标字符串",align:"center",prop:"invokeTarget","show-overflow-tooltip":!0}),e(b,{label:"日志信息",align:"center",prop:"jobMessage","show-overflow-tooltip":!0}),e(b,{label:"执行状态",align:"center",prop:"status"},{default:o(a=>[e(B,{options:t(R),value:a.row.status},null,8,["options","value"])]),_:1}),e(b,{label:"执行时间",align:"center",prop:"createTime",width:"180"},{default:o(a=>[O("span",null,f(n.parseTime(a.row.createTime)),1)]),_:1}),e(b,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:o(a=>[w((m(),j(g,{link:"",type:"primary",icon:"View",onClick:De=>le(a.row)},{default:o(()=>l[15]||(l[15]=[u("详细")])),_:2},1032,["onClick"])),[[C,["monitor:job:query"]]])]),_:1})]),_:1},8,["data"])),[[me,t(N)]]),w(e(de,{total:t(S),page:t(s).pageNum,"onUpdate:page":l[5]||(l[5]=a=>t(s).pageNum=a),limit:t(s).pageSize,"onUpdate:limit":l[6]||(l[6]=a=>t(s).pageSize=a),onPagination:_},null,8,["total","page","limit"]),[[K,t(S)>0]]),e(pe,{title:"调度日志详细",modelValue:t(y),"onUpdate:modelValue":l[8]||(l[8]=a=>G(y)?y.value=a:null),width:"700px","append-to-body":""},{footer:o(()=>[O("div",Ce,[e(g,{onClick:l[7]||(l[7]=a=>y.value=!1)},{default:o(()=>l[16]||(l[16]=[u("关 闭")])),_:1})])]),default:o(()=>[e(F,{model:t(i),"label-width":"100px"},{default:o(()=>[e(M,null,{default:o(()=>[e(p,{span:12},{default:o(()=>[e(r,{label:"日志序号："},{default:o(()=>[u(f(t(i).jobLogId),1)]),_:1}),e(r,{label:"任务名称："},{default:o(()=>[u(f(t(i).jobName),1)]),_:1})]),_:1}),e(p,{span:12},{default:o(()=>[e(r,{label:"任务分组："},{default:o(()=>[u(f(X(t(i))),1)]),_:1}),e(r,{label:"执行时间："},{default:o(()=>[u(f(n.parseTime(t(i).createTime)),1)]),_:1})]),_:1}),e(p,{span:24},{default:o(()=>[e(r,{label:"任务执行器："},{default:o(()=>[u(f(W(t(i))),1)]),_:1})]),_:1}),e(p,{span:24},{default:o(()=>[e(r,{label:"任务触发器："},{default:o(()=>[u(f(t(i).jobTrigger),1)]),_:1})]),_:1}),e(p,{span:24},{default:o(()=>[e(r,{label:"调用方法："},{default:o(()=>[u(f(t(i).invokeTarget),1)]),_:1})]),_:1}),e(p,{span:24},{default:o(()=>[e(r,{label:"位置参数："},{default:o(()=>[u(f(t(i).jobArgs),1)]),_:1})]),_:1}),e(p,{span:24},{default:o(()=>[e(r,{label:"关键字参数："},{default:o(()=>[u(f(t(i).jobKwargs),1)]),_:1})]),_:1}),e(p,{span:24},{default:o(()=>[e(r,{label:"日志信息："},{default:o(()=>[u(f(t(i).jobMessage),1)]),_:1})]),_:1}),e(p,{span:24},{default:o(()=>[e(r,{label:"执行状态："},{default:o(()=>[t(i).status==0?(m(),k("div",xe,"正常")):t(i).status==1?(m(),k("div",Ve,"失败")):Q("",!0)]),_:1})]),_:1}),e(p,{span:24},{default:o(()=>[t(i).status==1?(m(),j(r,{key:0,label:"异常信息："},{default:o(()=>[u(f(t(i).exceptionInfo),1)]),_:1})):Q("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{Ge as default};
//# sourceMappingURL=log.DnBzgL6B.js.map
