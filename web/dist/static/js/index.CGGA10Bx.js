import{a as Ge,r as v,J as Je,N as Re,d as p,H as ue,o as i,c as _,I as c,M as R,h as a,e,f as l,l as De,O as I,P as $,m as g,p as r,K as D,i as q,y,n as F,F as Fe,s as Ae,au as re}from"./index.DgyczuKs.js";import{l as Ke,a as Be,c as Le,r as Qe,g as se,u as ze,b as Oe,s as He,d as Me}from"./job.tc8BsnXL.js";import{C as We}from"./index.D6FD1oC1.js";import{A as Xe}from"./ace-editor.BsmS0mEK.js";import"./tools.DGA99u3Z.js";import"./ResizeObserver.es.B1PUzC5B.js";const Ye={class:"app-container"},Ze={class:"dialog-footer"},el={key:0},ll={key:1},ol={key:0},tl={key:1},al={key:0},nl={key:1},ul={key:2},rl={key:3},sl={class:"dialog-footer"},dl=Fe({name:"QtrJob"}),vl=Object.assign(dl,{setup(il){const de=Ge(),{proxy:m}=Ae(),{sys_job_group:P,sys_job_status:W,sys_job_executor:X}=m.useDict("sys_job_group","sys_job_status","sys_job_executor"),{job_run_status:ie}=m.useDict("job_run_status"),Y=v([]),V=v(!1),S=v(!0),T=v(!0),A=v([]),Z=v(!0),ee=v(!0),K=v(0),B=v(""),N=v(!1),U=v(!1),le=v(""),pe=Je({form:{},queryParams:{pageNum:1,pageSize:10,jobName:void 0,jobGroup:void 0,status:void 0},rules:{jobName:[{required:!0,message:"任务名称不能为空",trigger:"blur"}],invokeTarget:[{required:!0,message:"调用目标字符串不能为空",trigger:"blur"}],cronExpression:[{required:!0,message:"cron执行表达式不能为空",trigger:"change"}]}}),{queryParams:b,form:n,rules:fe}=Re(pe);function C(){S.value=!0,Ke(b.value).then(u=>{Y.value=u.rows,K.value=u.total,S.value=!1})}function me(){S.value=!0,Be(b.value).then(u=>{console.log(u)}).finally(()=>{S.value=!1})}function be(u,o){return m.selectDictLabel(P.value,u.jobGroup)}function ce(u,o){return m.selectDictLabel(X.value,u.jobExecutor)}function _e(){V.value=!1,L()}function L(){n.value={jobId:void 0,jobName:void 0,jobGroup:void 0,invokeTarget:void 0,cronExpression:void 0,misfirePolicy:"1",concurrent:"1",status:"0"},m.resetForm("jobRef")}function Q(){b.value.pageNum=1,C()}function ve(){m.resetForm("queryRef"),Q()}function ge(u){A.value=u.map(o=>o.jobId),Z.value=u.length!=1,ee.value=!u.length}function je(u){let o=u.status==="0"?"启用":"停用";m.$modal.confirm('确认要"'+o+'""'+u.jobName+'"任务吗?').then(function(){return Le(u.jobId,u.status)}).then(()=>{m.$modal.msgSuccess(o+"成功")}).catch(function(){u.status=u.status==="0"?"1":"0"})}function ye(u){m.$modal.confirm('确认要立即执行一次"'+u.jobName+'"任务吗?').then(function(){return Qe(u.jobId,u.jobGroup)}).then(()=>{m.$modal.msgSuccess("执行成功")}).catch(()=>{})}function ke(u){se(u.jobId).then(o=>{n.value=o.data,N.value=!0})}function Ve(){le.value=n.value.cronExpression,U.value=!0}function we(u){n.value.cronExpression=u}function oe(u){const o=u.jobId||0;de.push("/qtr/qtr-job-log/index/"+o)}function Ce(){L(),V.value=!0,B.value="添加任务"}function te(u){L();const o=u.jobId||A.value;se(o).then(x=>{n.value=x.data,V.value=!0,B.value="修改任务"})}function xe(){m.$refs.jobRef.validate(u=>{u&&(n.value.jobId!=null?ze(n.value).then(o=>{m.$modal.msgSuccess("修改成功"),V.value=!1,C()}):Oe(n.value).then(o=>{m.$modal.msgSuccess("新增成功"),V.value=!1,C()}))})}function he(u){He({jobId:u.jobId}).then(o=>{re.success("完成停止")}).catch(o=>{console.log(o),re.error("停止异常")})}function ae(u){const o=u.jobId||A.value;m.$modal.confirm('是否确认删除定时任务编号为"'+o+'"的数据项?').then(function(){return Me(o)}).then(()=>{C(),m.$modal.msgSuccess("删除成功")}).catch(()=>{})}function qe(){m.download("qtr/job/export",{...b.value},`job_${new Date().getTime()}.xlsx`)}return C(),(u,o)=>{const x=p("el-input"),s=p("el-form-item"),G=p("el-option"),J=p("el-select"),f=p("el-button"),z=p("el-form"),d=p("el-col"),Se=p("right-toolbar"),O=p("el-row"),k=p("el-table-column"),ne=p("dict-tag"),Ne=p("el-switch"),h=p("el-tooltip"),Ue=p("el-table"),Ee=p("pagination"),Ie=p("question-filled"),$e=p("el-icon"),Pe=p("el-radio"),H=p("el-radio-group"),E=p("el-radio-button"),M=p("el-dialog"),j=ue("hasPermi"),Te=ue("loading");return i(),_("div",Ye,[c(e(z,{model:a(b),ref:"queryRef",inline:!0},{default:l(()=>[e(s,{label:"任务名称",prop:"jobName"},{default:l(()=>[e(x,{modelValue:a(b).jobName,"onUpdate:modelValue":o[0]||(o[0]=t=>a(b).jobName=t),placeholder:"请输入任务名称",clearable:"",style:{width:"200px"},onKeyup:De(Q,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"任务组名",prop:"jobGroup"},{default:l(()=>[e(J,{modelValue:a(b).jobGroup,"onUpdate:modelValue":o[1]||(o[1]=t=>a(b).jobGroup=t),placeholder:"请选择任务组名",clearable:"",style:{width:"200px"}},{default:l(()=>[(i(!0),_(I,null,$(a(P),t=>(i(),g(G,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"任务状态",prop:"status"},{default:l(()=>[e(J,{modelValue:a(b).status,"onUpdate:modelValue":o[2]||(o[2]=t=>a(b).status=t),placeholder:"请选择任务状态",clearable:"",style:{width:"200px"}},{default:l(()=>[(i(!0),_(I,null,$(a(W),t=>(i(),g(G,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,null,{default:l(()=>[e(f,{type:"primary",icon:"Search",onClick:Q},{default:l(()=>o[21]||(o[21]=[r("搜索")])),_:1}),c(e(f,{type:"warning",icon:"Search",onClick:me,title:"显示scheduler加载的任务"},{default:l(()=>o[22]||(o[22]=[r("搜索 ")])),_:1},512),[[R,!1]]),e(f,{icon:"Refresh",onClick:ve},{default:l(()=>o[23]||(o[23]=[r("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[R,a(T)]]),e(O,{gutter:10,class:"mb8"},{default:l(()=>[e(d,{span:1.5},{default:l(()=>[c((i(),g(f,{type:"primary",plain:"",icon:"Plus",onClick:Ce},{default:l(()=>o[24]||(o[24]=[r("新增 ")])),_:1})),[[j,["qtr:job:add"]]])]),_:1}),e(d,{span:1.5},{default:l(()=>[c((i(),g(f,{type:"success",plain:"",icon:"Edit",disabled:a(Z),onClick:te},{default:l(()=>o[25]||(o[25]=[r("修改 ")])),_:1},8,["disabled"])),[[j,["qtr:job:edit"]]])]),_:1}),e(d,{span:1.5},{default:l(()=>[c((i(),g(f,{type:"danger",plain:"",icon:"Delete",disabled:a(ee),onClick:ae},{default:l(()=>o[26]||(o[26]=[r("删除 ")])),_:1},8,["disabled"])),[[j,["qtr:job:remove"]]])]),_:1}),e(d,{span:1.5},{default:l(()=>[c((i(),g(f,{type:"warning",plain:"",icon:"Download",onClick:qe},{default:l(()=>o[27]||(o[27]=[r("导出 ")])),_:1})),[[j,["qtr:job:export"]]])]),_:1}),e(d,{span:1.5},{default:l(()=>[c((i(),g(f,{type:"info",plain:"",icon:"Operation",onClick:oe},{default:l(()=>o[28]||(o[28]=[r("日志 ")])),_:1})),[[j,["qtr:job:query"]]])]),_:1}),e(Se,{showSearch:a(T),"onUpdate:showSearch":o[3]||(o[3]=t=>D(T)?T.value=t:null),onQueryTable:C},null,8,["showSearch"])]),_:1}),c((i(),g(Ue,{data:a(Y),onSelectionChange:ge},{default:l(()=>[e(k,{type:"selection",width:"55",align:"center"}),e(k,{label:"任务编号",width:"100",align:"center",prop:"jobId"}),e(k,{label:"任务名称",align:"center",prop:"jobName","show-overflow-tooltip":!0}),e(k,{label:"任务组名",align:"center",prop:"jobGroup"},{default:l(t=>[e(ne,{options:a(P),value:t.row.jobGroup},null,8,["options","value"])]),_:1}),e(k,{label:"调用目标字符串",align:"center",prop:"invokeTarget","show-overflow-tooltip":!0}),e(k,{label:"cron执行表达式",align:"center",prop:"cronExpression","show-overflow-tooltip":!0}),e(k,{prop:"status",label:"执行状态",align:"center",width:"70"},{default:l(t=>[e(ne,{options:a(ie),value:t.row.runStatus},null,8,["options","value"])]),_:1}),e(k,{label:"状态",align:"center"},{default:l(t=>[e(Ne,{modelValue:t.row.status,"onUpdate:modelValue":w=>t.row.status=w,"active-value":"0","inactive-value":"1",onChange:w=>je(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(k,{label:"操作",align:"center",width:"200","class-name":"small-padding fixed-width"},{default:l(t=>[e(h,{content:"停止进行中的任务",placement:"top"},{default:l(()=>[c(e(f,{link:"",type:"danger",icon:"SwitchButton",onClick:w=>he(t.row)},null,8,["onClick"]),[[j,["qtr:job:edit"]],[R,!1]])]),_:2},1024),e(h,{content:"修改",placement:"top"},{default:l(()=>[c(e(f,{link:"",type:"primary",icon:"Edit",onClick:w=>te(t.row)},null,8,["onClick"]),[[j,["qtr:job:edit"]]])]),_:2},1024),e(h,{content:"删除",placement:"top"},{default:l(()=>[c(e(f,{link:"",type:"primary",icon:"Delete",onClick:w=>ae(t.row)},null,8,["onClick"]),[[j,["qtr:job:remove"]]])]),_:2},1024),e(h,{content:"执行一次",placement:"top"},{default:l(()=>[c(e(f,{link:"",type:"primary",icon:"CaretRight",onClick:w=>ye(t.row)},null,8,["onClick"]),[[j,["qtr:job:changeStatus"]]])]),_:2},1024),e(h,{content:"任务详细",placement:"top"},{default:l(()=>[c(e(f,{link:"",type:"primary",icon:"View",onClick:w=>ke(t.row)},null,8,["onClick"]),[[j,["qtr:job:query"]]])]),_:2},1024),e(h,{content:"调度日志",placement:"top"},{default:l(()=>[c(e(f,{link:"",type:"primary",icon:"Operation",onClick:w=>oe(t.row)},null,8,["onClick"]),[[j,["qtr:job:query"]]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Te,a(S)]]),c(e(Ee,{total:a(K),page:a(b).pageNum,"onUpdate:page":o[4]||(o[4]=t=>a(b).pageNum=t),limit:a(b).pageSize,"onUpdate:limit":o[5]||(o[5]=t=>a(b).pageSize=t),onPagination:C},null,8,["total","page","limit"]),[[R,a(K)>0]]),e(M,{title:a(B),modelValue:a(V),"onUpdate:modelValue":o[16]||(o[16]=t=>D(V)?V.value=t:null),width:"820px","append-to-body":""},{footer:l(()=>[q("div",Ze,[e(f,{type:"primary",onClick:xe},{default:l(()=>o[37]||(o[37]=[r("确 定")])),_:1}),e(f,{onClick:_e},{default:l(()=>o[38]||(o[38]=[r("取 消")])),_:1})])]),default:l(()=>[e(z,{ref:"jobRef",model:a(n),rules:a(fe),"label-width":"120px"},{default:l(()=>[e(O,null,{default:l(()=>[e(d,{span:24},{default:l(()=>[e(s,{label:"任务名称",prop:"jobName"},{default:l(()=>[e(x,{modelValue:a(n).jobName,"onUpdate:modelValue":o[6]||(o[6]=t=>a(n).jobName=t),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"任务分组",prop:"jobGroup"},{default:l(()=>[e(J,{modelValue:a(n).jobGroup,"onUpdate:modelValue":o[7]||(o[7]=t=>a(n).jobGroup=t),placeholder:"请选择"},{default:l(()=>[(i(!0),_(I,null,$(a(P),t=>(i(),g(G,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"任务执行器",prop:"jobGroup"},{default:l(()=>[e(J,{modelValue:a(n).jobExecutor,"onUpdate:modelValue":o[8]||(o[8]=t=>a(n).jobExecutor=t),placeholder:"请选择任务执行器"},{default:l(()=>[(i(!0),_(I,null,$(a(X),t=>(i(),g(G,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[e(s,{prop:"invokeTarget"},{label:l(()=>[q("span",null,[o[30]||(o[30]=r(" 调用方法 ")),e(h,{placement:"top"},{content:l(()=>o[29]||(o[29]=[q("div",null,[r(" Bean调用示例：ryTask.ryParams('ry') "),q("br"),r("Class类调用示例：com.ruoyi.quartz.task.RyTask.ryParams('ry') "),q("br"),r("参数说明：支持字符串，布尔类型，长整型，浮点型，整型 ")],-1)])),default:l(()=>[e($e,null,{default:l(()=>[e(Ie)]),_:1})]),_:1})])]),default:l(()=>[e(x,{modelValue:a(n).invokeTarget,"onUpdate:modelValue":o[9]||(o[9]=t=>a(n).invokeTarget=t),placeholder:"请输入调用目标字符串"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[e(s,{label:"位置参数",prop:"jobArgs"},{default:l(()=>[e(x,{modelValue:a(n).jobArgs,"onUpdate:modelValue":o[10]||(o[10]=t=>a(n).jobArgs=t),placeholder:"请输入位置参数"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[e(s,{label:"关键字参数",prop:"jobKwargs"},{default:l(()=>[e(Xe,{content:a(n).jobKwargs,"onUpdate:content":o[11]||(o[11]=t=>a(n).jobKwargs=t),lang:"json",themes:"monokai",height:"300px",width:"670px",placeholder:"请输入关键字参数"},null,8,["content"])]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[e(s,{label:"cron表达式",prop:"cronExpression"},{default:l(()=>[e(x,{modelValue:a(n).cronExpression,"onUpdate:modelValue":o[12]||(o[12]=t=>a(n).cronExpression=t),placeholder:"请输入cron执行表达式"},{append:l(()=>[e(f,{type:"primary",onClick:Ve},{default:l(()=>o[31]||(o[31]=[r(" 生成表达式 "),q("i",{class:"el-icon-time el-icon--right"},null,-1)])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),a(n).jobId!==void 0?(i(),g(d,{key:0,span:24},{default:l(()=>[e(s,{label:"状态"},{default:l(()=>[e(H,{modelValue:a(n).status,"onUpdate:modelValue":o[13]||(o[13]=t=>a(n).status=t)},{default:l(()=>[(i(!0),_(I,null,$(a(W),t=>(i(),g(Pe,{key:t.value,label:t.value},{default:l(()=>[r(y(t.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):F("",!0),e(d,{span:12},{default:l(()=>[e(s,{label:"执行策略",prop:"misfirePolicy"},{default:l(()=>[e(H,{modelValue:a(n).misfirePolicy,"onUpdate:modelValue":o[14]||(o[14]=t=>a(n).misfirePolicy=t)},{default:l(()=>[e(E,{label:"1"},{default:l(()=>o[32]||(o[32]=[r("立即执行")])),_:1}),e(E,{label:"2"},{default:l(()=>o[33]||(o[33]=[r("执行一次")])),_:1}),e(E,{label:"3"},{default:l(()=>o[34]||(o[34]=[r("放弃执行")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"是否并发",prop:"concurrent"},{default:l(()=>[e(H,{modelValue:a(n).concurrent,"onUpdate:modelValue":o[15]||(o[15]=t=>a(n).concurrent=t)},{default:l(()=>[e(E,{label:"0"},{default:l(()=>o[35]||(o[35]=[r("允许")])),_:1}),e(E,{label:"1"},{default:l(()=>o[36]||(o[36]=[r("禁止")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),e(M,{title:"Cron表达式生成器",modelValue:a(U),"onUpdate:modelValue":o[18]||(o[18]=t=>D(U)?U.value=t:null),"append-to-body":"","destroy-on-close":""},{default:l(()=>[e(We,{ref:"crontabRef",onHide:o[17]||(o[17]=t=>U.value=!1),onFill:we,expression:a(le)},null,8,["expression"])]),_:1},8,["modelValue"]),e(M,{title:"任务详细",modelValue:a(N),"onUpdate:modelValue":o[20]||(o[20]=t=>D(N)?N.value=t:null),width:"700px","append-to-body":""},{footer:l(()=>[q("div",sl,[e(f,{onClick:o[19]||(o[19]=t=>N.value=!1)},{default:l(()=>o[39]||(o[39]=[r("关 闭")])),_:1})])]),default:l(()=>[e(z,{model:a(n),"label-width":"120px"},{default:l(()=>[e(O,null,{default:l(()=>[e(d,{span:12},{default:l(()=>[e(s,{label:"任务编号："},{default:l(()=>[r(y(a(n).jobId),1)]),_:1}),e(s,{label:"任务名称："},{default:l(()=>[r(y(a(n).jobName),1)]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"任务分组："},{default:l(()=>[r(y(be(a(n))),1)]),_:1}),e(s,{label:"创建时间："},{default:l(()=>[r(y(u.parseTime(a(n).createTime)),1)]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"cron表达式："},{default:l(()=>[r(y(a(n).cronExpression),1)]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"下次执行时间："},{default:l(()=>[r(y(u.parseTime(a(n).nextValidTime)),1)]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"任务执行器："},{default:l(()=>[r(y(ce(a(n))),1)]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[e(s,{label:"调用目标方法："},{default:l(()=>[r(y(a(n).invokeTarget),1)]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[e(s,{label:"位置参数："},{default:l(()=>[r(y(a(n).jobArgs),1)]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[e(s,{label:"关键字参数："},{default:l(()=>[r(y(a(n).jobKwargs),1)]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"任务状态："},{default:l(()=>[a(n).status==0?(i(),_("div",el,"正常")):a(n).status==1?(i(),_("div",ll,"暂停")):F("",!0)]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"是否并发："},{default:l(()=>[a(n).concurrent==0?(i(),_("div",ol,"允许")):a(n).concurrent==1?(i(),_("div",tl,"禁止")):F("",!0)]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"执行策略："},{default:l(()=>[a(n).misfirePolicy=="0"?(i(),_("div",al,"默认策略")):a(n).misfirePolicy=="1"?(i(),_("div",nl,"立即执行")):a(n).misfirePolicy=="2"?(i(),_("div",ul,"执行一次")):a(n).misfirePolicy=="3"?(i(),_("div",rl,"放弃执行")):F("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{vl as default};
