{"version":3,"file":"run_dialog.DpBuEVxn.js","sources":["../../../src/components/hrm/common/run/run_dialog.vue"],"sourcesContent":["<script setup>\r\nimport {ElDialog, ElMessage} from \"element-plus\";\r\nimport EnvSelector from \"@/components/hrm/common/env-selector.vue\";\r\nimport RunCofig from \"@/components/hrm/common/run/run-config.vue\";\r\nimport {testRun} from \"@/api/hrm/run_detail.js\";\r\nimport {all as getAllForwardRules} from \"@/api/hrm/forward\";\r\nimport {all as getAllAgent} from \"@/api/hrm/agent.js\";\r\nimport {RunTypeEnum} from \"@/components/hrm/enum.js\";\r\n\r\n\r\nconst dialogVisible = defineModel(\"dialogVisible\");\r\nconst runIds = defineModel(\"runIds\");\r\nconst allForwardRules = ref([]);\r\nconst allAgent = ref([]);\r\n\r\nconst props = defineProps({\r\n  runType: Number,\r\n  // runIds: {type: Array, default: []},\r\n  showDialog: {type: Boolean, default: false}\r\n});\r\n\r\n// const dialogVisible = props.showDialog;\r\nconst dialogTestLoading = ref(false);\r\nconst dialogCanClose = ref(true);\r\nconst disableCanRun = ref(false);\r\n\r\nconst form = ref({\r\n  ids: runIds,\r\n  runType: props.runType,\r\n  env: null,\r\n  reportName: null,\r\n  isAsync: false,\r\n  repeatNum: 1,\r\n  concurrent: 1,\r\n  push: false,\r\n  forwardConfig: {\r\n    forward: false,\r\n    agentId: undefined,\r\n    forwardRuleIds: undefined,\r\n  },\r\n  runBySort: false\r\n});\r\n\r\n\r\nfunction handleRun(env) {\r\n  // const loading = ElLoading.service({\r\n  //   lock: true,\r\n  //   text: '用例执行中',\r\n  //   background: 'rgba(0, 0, 0, 0.7)',\r\n  // });\r\n\r\n  try {\r\n    disableCanRun.value = true;\r\n    dialogCanClose.value = false;\r\n    form.value.ids = runIds;\r\n    form.value.runType = props.runType;\r\n    if (form.value.ids.length === 0) {\r\n      ElMessage.error({\r\n        message: \"请选择要执行的数据\",\r\n        type: \"error\"\r\n      });\r\n      dialogCanClose.value = true;\r\n      disableCanRun.value = false;\r\n      return;\r\n    }\r\n\r\n    dialogTestLoading.value = true;\r\n    testRun(form.value).then(response => {\r\n      ElMessage.success({\r\n        message: response.msg,\r\n        type: \"success\"\r\n      });\r\n      dialogVisible.value = false;\r\n\r\n    }).finally(\r\n        () => {\r\n          dialogTestLoading.value = false;\r\n          dialogCanClose.value = true;\r\n          disableCanRun.value = false;\r\n          // loading.close();\r\n        }\r\n    )\r\n    // dialogVisible.value = false;\r\n  } catch (e) {\r\n    console.log(e);\r\n  } finally {\r\n    // dialogTesting.value = false;\r\n    // loading.close();\r\n  }\r\n\r\n}\r\n\r\n\r\nfunction handleClose() {\r\n  dialogCanClose.value = true;\r\n  dialogVisible.value = false;\r\n}\r\n\r\nfunction beforeClose(done) {\r\n  if (dialogCanClose) {\r\n    done();\r\n    dialogVisible.value = false;\r\n  } else {\r\n    done(false);\r\n    dialogVisible.value = true;\r\n  }\r\n}\r\n\r\nfunction runConfigChange(runConfigData) {\r\n  form.value = {...form.value, ...runConfigData}\r\n}\r\n\r\n\r\n</script>\r\n\r\n<template>\r\n  <el-dialog\r\n      v-model=\"dialogVisible\"\r\n      title=\"测试确认\"\r\n      width=\"500\"\r\n      append-to-body\r\n      @close=\"handleClose\"\r\n      :before-close=\"beforeClose\"\r\n      :close-on-click-modal=\"false\"\r\n      :close-on-press-escape=\"false\"\r\n  >\r\n    <RunCofig @update=\"runConfigChange\" v-loading.fullscreen.lock=\"dialogTestLoading\">\r\n    </RunCofig>\r\n    <template #footer>\r\n      <div class=\"dialog-footer\">\r\n        <el-button @click=\"handleClose\">取消</el-button>\r\n        <el-button\r\n            :disabled=\"disableCanRun\"\r\n            type=\"primary\"\r\n            @click=\"handleRun\">\r\n          执行\r\n        </el-button>\r\n      </div>\r\n    </template>\r\n  </el-dialog>\r\n\r\n</template>\r\n\r\n<style scoped lang=\"scss\">\r\n\r\n</style>"],"names":["dialogVisible","_useModel","runIds","__props","ref","props","dialogTestLoading","dialogCanClose","disableCanRun","form","handleRun","env","ElMessage","testRun","response","handleClose","beforeClose","done","runConfigChange","runConfigData"],"mappings":"+dAUA,MAAMA,EAAgBC,IAAY,eAAe,EAC3CC,EAASD,EAAWE,EAAC,QAAQ,EACXC,EAAI,EAAE,EACbA,EAAI,EAAE,EAEvB,MAAMC,EAAQF,EAORG,EAAoBF,EAAI,EAAK,EAC7BG,EAAiBH,EAAI,EAAI,EACzBI,EAAgBJ,EAAI,EAAK,EAEzBK,EAAOL,EAAI,CACf,IAAKF,EACL,QAASG,EAAM,QACf,IAAK,KACL,WAAY,KACZ,QAAS,GACT,UAAW,EACX,WAAY,EACZ,KAAM,GACN,cAAe,CACb,QAAS,GACT,QAAS,OACT,eAAgB,MACjB,EACD,UAAW,EACb,CAAC,EAGD,SAASK,EAAUC,EAAK,CAOtB,GAAI,CAKF,GAJAH,EAAc,MAAQ,GACtBD,EAAe,MAAQ,GACvBE,EAAK,MAAM,IAAMP,EACjBO,EAAK,MAAM,QAAUJ,EAAM,QACvBI,EAAK,MAAM,IAAI,SAAW,EAAG,CAC/BG,EAAU,MAAM,CACd,QAAS,YACT,KAAM,OACd,CAAO,EACDL,EAAe,MAAQ,GACvBC,EAAc,MAAQ,GACtB,MACD,CAEDF,EAAkB,MAAQ,GAC1BO,EAAQJ,EAAK,KAAK,EAAE,KAAKK,GAAY,CACnCF,EAAU,QAAQ,CAChB,QAASE,EAAS,IAClB,KAAM,SACd,CAAO,EACDd,EAAc,MAAQ,EAEvB,CAAA,EAAE,QACC,IAAM,CACJM,EAAkB,MAAQ,GAC1BC,EAAe,MAAQ,GACvBC,EAAc,MAAQ,EAEvB,CACJ,CAEF,OAAQ,EAAG,CACV,QAAQ,IAAI,CAAC,CACjB,QAAY,CAGT,CAEH,CAGA,SAASO,GAAc,CACrBR,EAAe,MAAQ,GACvBP,EAAc,MAAQ,EACxB,CAEA,SAASgB,EAAYC,EAAM,CACrBV,GACFU,IACAjB,EAAc,MAAQ,KAEtBiB,EAAK,EAAK,EACVjB,EAAc,MAAQ,GAE1B,CAEA,SAASkB,EAAgBC,EAAe,CACtCV,EAAK,MAAQ,CAAC,GAAGA,EAAK,MAAO,GAAGU,CAAa,CAC/C"}