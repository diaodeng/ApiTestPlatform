import{r as s,v as ye,a6 as W,a5 as Be,C as ze,d,H as ve,o as i,c as P,I as c,M as _e,h as e,e as t,f as n,O as X,P as Y,m as p,l as be,K as x,p as v,n as H,i as M,y as B,F as Fe,s as Ke,au as z,E as Le,az as Qe,ab as Je}from"./index.DgyczuKs.js";import{c as Ae,a as Ge,l as We,g as Xe,d as Ye}from"./case.DjTsuh8x.js";import{s as Ze}from"./module.Ckx2ii-L.js";import{l as ea}from"./project.Ta7DfENy.js";import{_ as aa}from"./tag-selector.BEiILwwx.js";import{e as la,d as ta}from"./run-detail.CuvFN77U.js";import{a as Z}from"./data-template.CBoE4CJQ.js";import{_ as na}from"./run_dialog.Cj7v-l2H.js";import{H as N,r as oa,R as sa}from"./enum.Cve1eJHF.js";import"./env-selector.CY0X6zlK.js";import"./env.D40RgY2q.js";import"./tools.DGA99u3Z.js";import"./table-variables.UtV75Lvs.js";import"./ace-editor.BsmS0mEK.js";import"./ResizeObserver.es.B1PUzC5B.js";import"./forward.Bd-7Bd9U.js";import"./agent.Dph-1RM_.js";const ua={class:"app-container"},da=Fe({name:"Case"}),xa=Object.assign(da,{props:{dataType:{type:Number,default:N.case},formRules:{type:Object,default:{caseName:[{required:!0,message:"用例名称不能为空",trigger:"blur"}],projectId:[{required:!0,message:"所属项目不能为空",trigger:"blur"}],moduleId:[{required:!0,message:"所属模块不能为空",trigger:"blur"}]}}},setup(h){s(!1),s("久啊联发科打了飞机啊漏打卡飞机啦电极法立卡登记说法法兰对接法拉克束带结发法拉第会计法垃圾");const{proxy:_}=Ke(),{sys_normal_disable:he}=_.useDict("sys_normal_disable");_.useDict("sys_request_method");const{hrm_data_type:we}=_.useDict("hrm_data_type"),{qtr_case_status:F}=_.useDict("qtr_case_status"),ee=h,y=ye(()=>ee.dataType===N.case?"用例":"配置");W("hrm_data_type",we),W("sys_normal_disable",he),W("qtr_case_status",F);const ae=s([]),le=s([]),te=s([]),D=s(!1),E=s(!0),S=s([]),ne=s(!0),K=s(!0),L=s(0),Q=s(""),$=s(!0),q=s(!1),T=s([]),O=s(!1),J=s(null),oe=s(),C=s(!1),I=s(Z),u=Be({pageNum:1,pageSize:10,type:ee.dataType,caseId:void 0,caseName:void 0,projectId:void 0,moduleId:void 0,status:void 0,onlySelf:$}),k=s(Z),m=s({page:!1,edite:!1,run:!1,copy:!1});function se(o){return o||"全局"}const Ce=ye(()=>{const o=k.value.caseId?"【"+k.value.caseId+"】":"";return Q.value+">> "+o+k.value.caseName});function Ie(o,a){Ae({caseId:a.caseId,status:o}).then(b=>{z.success("修改成功")}).catch(()=>{z.error("修改失败")})}function ue(o){if(o&&"caseId"in o&&o.caseId&&(T.value=[o.caseId]),!T.value||T.value.length===0){Le.alert("请选择要运行的用例","提示！",{type:"warning"});return}q.value=!0}function ke(o){C.value=!0,I.value=structuredClone(Qe(Je(o)))}function Ve(){C.value=!0;let o={caseId:I.value.caseId,caseName:I.value.caseName};Ge(o).then(a=>{z.success("复制成功")}).finally(()=>{C.value=!1})}function U(){m.value.page=!0,We(u.value).then(o=>{ae.value=o.rows,L.value=o.total}).finally(()=>{m.value.page=!1})}function xe(){ea({isPage:!1}).then(o=>{le.value=o.data})}function Ne(){Ze(u.value).then(o=>{te.value=o.data})}function De(){u.value.moduleId=void 0,Ne()}function j(){u.value.pageNum=1,U()}function Se(){_.resetForm("queryRef"),j()}function Te(o){S.value=o.map(a=>a.caseId),T.value=S.value,ne.value=o.length!==1,K.value=!o.length}function Ue(){Q.value="添加"+y.value,k.value=JSON.parse(JSON.stringify(Z)),D.value=!0}function de(o){m.value.edite=!0;const a=o.caseId||S.value;Xe(a).then(b=>{if(!b.data||Object.keys(b.data).length===0){z.warning("未查到对应数据！");return}k.value=b.data,Q.value="修改"+y.value,D.value=!0}).finally(()=>{m.value.edite=!1})}function je(o){const a=o.caseId||S.value;J.value=o,oe.value=a,O.value=!0}function ie(o){const a=o.caseId||S.value;_.$modal.confirm('是否确认删除ID为"'+a+'"的数据项？').then(function(){return Ye(a)}).then(()=>{U(),_.$modal.msgSuccess("删除成功")}).catch(()=>{})}function Re(){_.download("hrm/case/export",{...u.value},`Case_${new Date().getTime()}.xlsx`)}return ze(()=>{xe(),U()}),(o,a)=>{var me,fe,ge;const b=d("el-option"),A=d("el-select"),w=d("el-form-item"),G=d("el-input"),Ee=d("el-checkbox"),r=d("el-button"),$e=d("el-form"),R=d("el-col"),qe=d("right-toolbar"),Oe=d("el-row"),f=d("el-table-column"),Pe=d("el-table"),He=d("pagination"),re=d("el-main"),ce=d("el-container"),pe=d("el-dialog"),g=ve("hasPermi"),Me=ve("loading");return i(),P("div",ua,[c(t($e,{model:e(u),ref:"queryRef",inline:!0},{default:n(()=>[t(w,{label:"所属项目",prop:"projectId"},{default:n(()=>[t(A,{modelValue:e(u).projectId,"onUpdate:modelValue":a[0]||(a[0]=l=>e(u).projectId=l),placeholder:"请选择",onChange:De,clearable:"",filterable:"",style:{width:"150px"}},{default:n(()=>[(i(!0),P(X,null,Y(e(le),l=>(i(),p(b,{key:l.projectId,label:l.projectName,value:l.projectId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"所属模块",prop:"moduleId"},{default:n(()=>[t(A,{modelValue:e(u).moduleId,"onUpdate:modelValue":a[1]||(a[1]=l=>e(u).moduleId=l),placeholder:"请选择",clearable:"",filterable:"",style:{width:"150px"}},{default:n(()=>[(i(!0),P(X,null,Y(e(te),l=>(i(),p(b,{key:l.moduleId,label:l.moduleName,value:l.moduleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(w,{label:e(y)+"ID",prop:"caseId"},{default:n(()=>[t(G,{modelValue:e(u).caseId,"onUpdate:modelValue":a[2]||(a[2]=l=>e(u).caseId=l),placeholder:"请输入"+e(y)+"名称",clearable:"",style:{width:"200px"},onKeyup:be(j,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(w,{label:e(y)+"名称",prop:"caseName"},{default:n(()=>[t(G,{modelValue:e(u).caseName,"onUpdate:modelValue":a[3]||(a[3]=l=>e(u).caseName=l),placeholder:"请输入"+e(y)+"名称",clearable:"",style:{width:"200px"},onKeyup:be(j,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(w,{label:"状态",prop:"status"},{default:n(()=>[t(A,{modelValue:e(u).status,"onUpdate:modelValue":a[4]||(a[4]=l=>e(u).status=l),placeholder:e(y)+"状态",clearable:"",style:{width:"100px"}},{default:n(()=>[(i(!0),P(X,null,Y(e(F),l=>(i(),p(b,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1}),t(w,null,{default:n(()=>[t(Ee,{modelValue:e($),"onUpdate:modelValue":a[5]||(a[5]=l=>x($)?$.value=l:null),onChange:j},{default:n(()=>a[14]||(a[14]=[v("仅自己的数据")])),_:1},8,["modelValue"])]),_:1}),t(w,null,{default:n(()=>[t(r,{type:"primary",icon:"Search",onClick:j,loading:e(m).page,disabled:e(m).page},{default:n(()=>a[15]||(a[15]=[v(" 搜索 ")])),_:1},8,["loading","disabled"]),t(r,{type:"default",icon:"Refresh",onClick:Se},{default:n(()=>a[16]||(a[16]=[v("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[_e,e(E)]]),t(Oe,{gutter:10,class:"mb8"},{default:n(()=>[t(R,{span:1.5},{default:n(()=>[c((i(),p(r,{type:"primary",plain:"",icon:"Plus",onClick:Ue},{default:n(()=>a[17]||(a[17]=[v("新增 ")])),_:1})),[[g,["hrm:case:add"]]])]),_:1}),t(R,{span:1.5},{default:n(()=>[c((i(),p(r,{type:"success",plain:"",icon:"Edit",disabled:e(ne),onClick:de},{default:n(()=>a[18]||(a[18]=[v("修改 ")])),_:1},8,["disabled"])),[[g,["hrm:case:edit"]]])]),_:1}),t(R,{span:1.5},{default:n(()=>[c((i(),p(r,{type:"danger",plain:"",icon:"Delete",disabled:e(K),onClick:ie},{default:n(()=>a[19]||(a[19]=[v("删除 ")])),_:1},8,["disabled"])),[[g,["hrm:case:remove"]]])]),_:1}),t(R,{span:1.5},{default:n(()=>[c((i(),p(r,{type:"warning",plain:"",icon:"Download",onClick:Re},{default:n(()=>a[20]||(a[20]=[v("导出 ")])),_:1})),[[g,["hrm:case:export"]]])]),_:1}),t(R,{span:1.5},{default:n(()=>[h.dataType===e(N).case?c((i(),p(r,{key:0,type:"warning",icon:"CaretRight",onClick:ue,title:"运行",disabled:e(K)},{default:n(()=>a[21]||(a[21]=[v(" 执行 ")])),_:1},8,["disabled"])),[[g,["hrm:case:run"]]]):H("",!0)]),_:1}),t(qe,{showSearch:e(E),"onUpdate:showSearch":a[6]||(a[6]=l=>x(E)?E.value=l:null),onQueryTable:U},null,8,["showSearch"])]),_:1}),c((i(),p(Pe,{data:e(ae),onSelectionChange:Te,border:"","table-layout":"fixed","max-height":"calc(100vh - 280px)"},{default:n(()=>[t(f,{type:"selection",width:"55",align:"center"}),t(f,{label:e(y)+"ID",prop:"caseId",width:"150px"},null,8,["label"]),t(f,{label:e(y)+"名称",prop:"caseName",width:"auto","min-width":"200px"},null,8,["label"]),t(f,{label:"所属项目",prop:"projectName"},{default:n(l=>[M("span",null,B(se(l.row.projectName)),1)]),_:1}),t(f,{label:"所属模块",prop:"moduleName"},{default:n(l=>[M("span",null,B(se(l.row.moduleName)),1)]),_:1}),t(f,{label:"状态",align:"center",prop:"status",width:"120px"},{default:n(l=>[t(aa,{"selected-value":l.row.status,"onUpdate:selectedValue":V=>l.row.status=V,options:e(F),"selector-width":"90px","source-data":l.row,onSelectChanged:Ie},null,8,["selected-value","onUpdate:selectedValue","options","source-data"])]),_:1}),t(f,{label:"创建人",align:"center",prop:"createBy",width:"80px"}),t(f,{label:"创建时间",align:"center",prop:"createTime","class-name":"small-padding fixed-width",width:"150px"},{default:n(l=>[M("span",null,B(o.parseTime(l.row.createTime)),1)]),_:1}),t(f,{label:"更新时间",align:"center",prop:"createTime","class-name":"small-padding fixed-width",width:"150px"},{default:n(l=>[M("span",null,B(o.parseTime(l.row.updateTime)),1)]),_:1}),t(f,{label:"操作",width:"170",align:"center","class-name":"small-padding fixed-width",fixed:"right"},{default:n(l=>[h.dataType===e(N).case?c((i(),p(r,{key:0,link:"",type:"primary",icon:"Histogram",onClick:V=>je(l.row),title:"执行历史"},null,8,["onClick"])),[[g,["hrm:case:history"]]]):H("",!0),c(t(r,{link:"",type:"warning",icon:"Edit",loading:e(m).edite,onClick:V=>de(l.row),title:"编辑"},null,8,["loading","onClick"]),[[g,["hrm:case:edit"]]]),h.dataType===e(N).case?c((i(),p(r,{key:1,link:"",type:"warning",icon:"CaretRight",loading:e(m).run,onClick:V=>ue(l.row),title:"运行"},null,8,["loading","onClick"])),[[g,["hrm:case:run"]]]):H("",!0),c(t(r,{link:"",type:"warning",icon:"CopyDocument",loading:e(m).copy,onClick:V=>ke(l.row),title:"复制"},null,8,["loading","onClick"]),[[g,["hrm:case:copy"]]]),c(t(r,{link:"",type:"danger",icon:"Delete",onClick:V=>ie(l.row),title:"删除"},null,8,["onClick"]),[[g,["hrm:case:remove"]]])]),_:1})]),_:1},8,["data"])),[[Me,e(m).page]]),c(t(He,{total:e(L),page:e(u).pageNum,"onUpdate:page":a[7]||(a[7]=l=>e(u).pageNum=l),limit:e(u).pageSize,"onUpdate:limit":a[8]||(a[8]=l=>e(u).pageSize=l),onPagination:U},null,8,["total","page","limit"]),[[_e,e(L)>0]]),t(la,{"form-datas":e(k),"data-type":h.dataType,"form-rules":h.formRules,"open-case-edit-dialog":e(D),"onUpdate:openCaseEditDialog":a[9]||(a[9]=l=>x(D)?D.value=l:null),title:e(Ce)},null,8,["form-datas","data-type","form-rules","open-case-edit-dialog","title"]),h.dataType===e(N).case?(i(),p(pe,{key:0,fullscreen:"",title:"【"+((me=e(J))==null?void 0:me.caseId)+"】"+((fe=e(J))==null?void 0:fe.caseName),modelValue:e(O),"onUpdate:modelValue":a[10]||(a[10]=l=>x(O)?O.value=l:null),"append-to-body":"","destroy-on-close":""},{default:n(()=>[t(ce,{style:{height:"100%"}},{default:n(()=>[t(re,{style:{"max-height":"calc(100vh - 95px)"}},{default:n(()=>[t(ta,{"run-id":e(oe),"view-type":e(oa).case},null,8,["run-id","view-type"])]),_:1})]),_:1})]),_:1},8,["title","modelValue"])):H("",!0),t(pe,{title:(ge=e(I))==null?void 0:ge.caseName,modelValue:e(C),"onUpdate:modelValue":a[12]||(a[12]=l=>x(C)?C.value=l:null),"append-to-body":"","destroy-on-close":""},{default:n(()=>[t(ce,{style:{height:"100%"}},{default:n(()=>[t(re,{style:{"max-height":"calc(100vh - 95px)"}},{default:n(()=>[t(G,{placeholder:"请输入用例名称",modelValue:e(I).caseName,"onUpdate:modelValue":a[11]||(a[11]=l=>e(I).caseName=l)},{suffix:n(()=>[t(r,{onClick:Ve},{default:n(()=>a[22]||(a[22]=[v("保存")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["title","modelValue"]),t(na,{"dialog-visible":e(q),"onUpdate:dialogVisible":a[13]||(a[13]=l=>x(q)?q.value=l:null),"run-type":e(sa).case,"run-ids":e(T)},null,8,["dialog-visible","run-type","run-ids"])])}}});export{xa as default};
