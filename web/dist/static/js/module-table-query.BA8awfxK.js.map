{"version":3,"file":"module-table-query.BA8awfxK.js","sources":["../../../src/components/hrm/util-data-table/module-table-query.vue"],"sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <el-form :model=\"queryParams\" ref=\"queryRef\" :inline=\"true\" v-show=\"showSearch\">\r\n      <el-form-item label=\"项目\" prop=\"projectId\">\r\n        <el-select v-model=\"queryParams.projectId\" placeholder=\"请选择\" clearable style=\"width: 150px\">\r\n          <el-option\r\n              v-for=\"option in projectOptions\"\r\n              :key=\"option.projectId\"\r\n              :label=\"option.projectName\"\r\n              :value=\"option.projectId\">\r\n          </el-option>\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item label=\"模块名称\" prop=\"moduleName\">\r\n        <el-input\r\n            v-model=\"queryParams.moduleName\"\r\n            placeholder=\"请输入模块名称\"\r\n            clearable\r\n            style=\"width: 200px\"\r\n            @keyup.enter=\"handleQuery\"\r\n        />\r\n      </el-form-item>\r\n      <el-form-item label=\"状态\" prop=\"status\">\r\n        <el-select v-model=\"queryParams.status\" placeholder=\"模块状态\" clearable style=\"width: 200px\">\r\n          <el-option\r\n              v-for=\"dict in qtr_data_status\"\r\n              :key=\"dict.value * 1\"\r\n              :label=\"dict.label\"\r\n              :value=\"dict.value * 1\"\r\n          />\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" icon=\"Search\" @click=\"handleQuery\">搜索</el-button>\r\n        <el-button icon=\"Refresh\" @click=\"resetQuery\">重置</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n\r\n    <el-row :gutter=\"10\" class=\"mb8\">\r\n      <slot name=\"table-tool\"></slot>\r\n      <right-toolbar v-model:showSearch=\"showSearch\" @queryTable=\"getList\"></right-toolbar>\r\n    </el-row>\r\n\r\n    <el-table border\r\n              ref=\"tableRef\"\r\n              v-loading=\"loading\"\r\n              :data=\"moduleList\"\r\n              @selection-change=\"handleSelectionChange\"\r\n              @select=\"handleSelect\"\r\n              @select-all=\"handleSelectAll\"\r\n              table-layout=\"fixed\"\r\n              max-height=\"calc(100vh - 280px)\"\r\n    >\r\n      <el-table-column type=\"selection\" width=\"55\" align=\"center\"/>\r\n      <el-table-column label=\"模块ID\" align=\"center\" prop=\"moduleId\" width=\"150\"/>\r\n      <el-table-column label=\"模块名称\" align=\"center\" prop=\"moduleName\"/>\r\n      <el-table-column label=\"所属项目\" align=\"center\" :formatter=\"formatProject\"/>\r\n      <el-table-column label=\"测试人员\" align=\"center\" prop=\"testUser\" width=\"80\"/>\r\n      <el-table-column label=\"模块排序\" align=\"center\" prop=\"sort\" width=\"80\"/>\r\n      <el-table-column label=\"状态\" align=\"center\" prop=\"status\" width=\"70\">\r\n        <template #default=\"scope\">\r\n          <dict-tag :options=\"qtr_data_status\" :value=\"scope.row.status + ''\"/>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"创建时间\" align=\"center\" prop=\"createTime\" class-name=\"small-padding fixed-width\"\r\n                       width=\"150\">\r\n        <template #default=\"scope\">\r\n          <span>{{ parseTime(scope.row.createTime) }}</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"更新时间\" align=\"center\" prop=\"createTime\" class-name=\"small-padding fixed-width\"\r\n                       width=\"150\">\r\n        <template #default=\"scope\">\r\n          <span>{{ parseTime(scope.row.updateTime) }}</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"操作\" width=\"80\" align=\"center\" class-name=\"small-padding fixed-width\" fixed=\"right\"\r\n                       v-if=\"$slots.tableOperate\">\r\n        <template #default=\"scope\">\r\n          <slot name=\"tableOperate\" :scope=\"scope\"></slot>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <pagination\r\n        v-show=\"total > 0 && showPagination\"\r\n        :total=\"total\"\r\n        v-model:page=\"queryParams.pageNum\"\r\n        v-model:limit=\"queryParams.pageSize\"\r\n        @pagination=\"getList\"\r\n    />\r\n\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {listModule} from \"@/api/hrm/module\";\r\nimport {listProject} from \"@/api/hrm/project\";\r\n\r\nconst {proxy} = getCurrentInstance();\r\nconst {qtr_data_status} = proxy.useDict(\"qtr_data_status\");\r\nconst props = defineProps({\r\n  showPagination: {type: Boolean, default: true},\r\n  checkedIds: {type: Array, default: []}\r\n});\r\n\r\nconst tableRef = ref(null);\r\nconst moduleList = ref([]);\r\nconst projectOptions = ref([]);\r\nconst open = ref(false);\r\nconst loading = ref(true);\r\nconst showSearch = ref(true);\r\nconst ids = ref([]);\r\nconst single = ref(true);\r\nconst multiple = ref(true);\r\nconst total = ref(0);\r\nconst title = ref(\"\");\r\nconst allSelectIds = ref([]);\r\n\r\nconst runIds = ref([]);\r\n\r\nconst data = reactive({\r\n  queryParams: {\r\n    pageNum: 1,\r\n    pageSize: 10,\r\n    projectId: undefined,\r\n    moduleName: undefined,\r\n    status: undefined\r\n  },\r\n  rules: {\r\n    moduleName: [{required: true, message: \"模块名称不能为空\", trigger: \"blur\"}],\r\n    projectId: [{required: true, message: \"所属项目不能为空\", trigger: \"blur\"}],\r\n    testUser: [{required: true, message: \"测试负责人不能为空\", trigger: \"blur\"}],\r\n    sort: [{required: true, message: \"模块顺序不能为空\", trigger: \"blur\"}]\r\n  }\r\n});\r\n\r\nconst emits = defineEmits(['selectChange']);\r\ndefineExpose({handleQuery, getSelectedIds});\r\n\r\nconst {queryParams, rules} = toRefs(data);\r\n\r\n/** 查询模块列表 */\r\nfunction getList() {\r\n  loading.value = true;\r\n  listModule(queryParams.value).then(response => {\r\n    moduleList.value = response.rows;\r\n    total.value = response.total;\r\n    nextTick(() => {\r\n      if (tableRef.value) {\r\n        tableRef.value.clearSelection();\r\n      }\r\n      if (props.checkedIds && props.checkedIds.length > 0) {\r\n        if (tableRef.value && moduleList.value) {\r\n          moduleList.value.forEach(item => {\r\n            if (props.checkedIds.find(dataId => dataId === item.moduleId)) {\r\n              tableRef.value.toggleRowSelection(item, true);\r\n            }\r\n          });\r\n        }\r\n      }\r\n    });\r\n    loading.value = false;\r\n  });\r\n}\r\n\r\n/** 查询项目列表 */\r\nfunction getProjectSelect() {\r\n  listProject({isPage: false}).then(response => {\r\n    projectOptions.value = response.data;\r\n  });\r\n}\r\n\r\n// 格式化项目名称的函数\r\nfunction formatProject(row, column, cellValue) {\r\n  // 假设每个debugtalk对象都有一个projectId属性，用于从其他地方获取项目名称\r\n  return getProjectName(row.projectId); // getProjectName是一个根据projectId获取项目名称的函数\r\n}\r\n\r\n// 获取项目名称的函数（这里应该是你的实际逻辑）\r\nfunction getProjectName(projectId) {\r\n  // 根据projectId从某个地方（例如另一个数组或API）获取项目名称\r\n  for (const project of projectOptions.value) {\r\n    if (projectId === project.projectId) {\r\n      return project.projectName;\r\n    }\r\n  }\r\n}\r\n\r\n/** 搜索按钮操作 */\r\nfunction handleQuery() {\r\n  queryParams.value.pageNum = 1;\r\n  getList();\r\n}\r\n\r\n/** 重置按钮操作 */\r\nfunction resetQuery() {\r\n  proxy.resetForm(\"queryRef\");\r\n  handleQuery();\r\n}\r\n\r\n/** 多选框选中数据 */\r\nfunction handleSelectionChange(selection) {\r\n  emits('selectChange', selection);\r\n  ids.value = selection.map(item => item.moduleId);\r\n  runIds.value = ids.value;\r\n  single.value = selection.length !== 1;\r\n  multiple.value = !selection.length;\r\n}\r\n\r\nfunction getSelectedIds() {\r\n  return ids.value;\r\n}\r\n\r\nfunction handleSelect(selection, row) {\r\n  let pageIds = moduleList.value.map(item => item.moduleId);\r\n  let pageSelectIds = selection.map(item => item.moduleId);\r\n  let delIds = pageIds.filter(item => !pageSelectIds.includes(item));\r\n  pageSelectIds.forEach((dataId) => {\r\n    if (!allSelectIds.value.some((moduleId) => moduleId === dataId)) {\r\n      allSelectIds.value.push(dataId);\r\n    }\r\n  });\r\n  allSelectIds.value = allSelectIds.value.filter(item => !delIds.includes(item));\r\n}\r\n\r\n\r\nfunction handleSelectAll(selection) {\r\n  let pageSelectIds = selection.map(item => item.moduleId);\r\n  if (pageSelectIds && pageSelectIds.length > 0) {\r\n    pageSelectIds.forEach((item) => {\r\n      if (!allSelectIds.value.some((moduleId) => moduleId === item)) {\r\n        allSelectIds.value.push(item);\r\n      }\r\n    });\r\n  } else {\r\n    let pageIds = moduleList.value.map(item => item.moduleId);\r\n    allSelectIds.value = allSelectIds.value.filter(item => !pageIds.includes(item));\r\n  }\r\n\r\n}\r\n\r\nonMounted(() => {\r\n  allSelectIds.value = toRaw(props.checkedIds);\r\n  getProjectSelect();\r\n  getList();\r\n});\r\n\r\n</script>\r\n"],"names":["proxy","getCurrentInstance","qtr_data_status","props","__props","tableRef","ref","moduleList","projectOptions","loading","showSearch","ids","single","multiple","total","allSelectIds","runIds","data","reactive","emits","__emit","__expose","handleQuery","getSelectedIds","queryParams","rules","toRefs","getList","listModule","response","nextTick","item","dataId","getProjectSelect","listProject","formatProject","row","column","cellValue","getProjectName","projectId","project","resetQuery","handleSelectionChange","selection","handleSelect","pageIds","pageSelectIds","delIds","moduleId","handleSelectAll","onMounted","toRaw"],"mappings":"+fAmGA,KAAM,CAAC,MAAAA,CAAK,EAAIC,KACV,CAAC,gBAAAC,CAAe,EAAIF,EAAM,QAAQ,iBAAiB,EACnDG,EAAQC,EAKRC,EAAWC,EAAI,IAAI,EACnBC,EAAaD,EAAI,CAAA,CAAE,EACnBE,EAAiBF,EAAI,CAAA,CAAE,EAChBA,EAAI,EAAK,EACtB,MAAMG,EAAUH,EAAI,EAAI,EAClBI,EAAaJ,EAAI,EAAI,EACrBK,EAAML,EAAI,CAAA,CAAE,EACZM,EAASN,EAAI,EAAI,EACjBO,EAAWP,EAAI,EAAI,EACnBQ,EAAQR,EAAI,CAAC,EACLA,EAAI,EAAE,EACpB,MAAMS,EAAeT,EAAI,CAAA,CAAE,EAErBU,EAASV,EAAI,CAAA,CAAE,EAEfW,EAAOC,GAAS,CACpB,YAAa,CACX,QAAS,EACT,SAAU,GACV,UAAW,OACX,WAAY,OACZ,OAAQ,MACT,EACD,MAAO,CACL,WAAY,CAAC,CAAC,SAAU,GAAM,QAAS,WAAY,QAAS,MAAM,CAAC,EACnE,UAAW,CAAC,CAAC,SAAU,GAAM,QAAS,WAAY,QAAS,MAAM,CAAC,EAClE,SAAU,CAAC,CAAC,SAAU,GAAM,QAAS,YAAa,QAAS,MAAM,CAAC,EAClE,KAAM,CAAC,CAAC,SAAU,GAAM,QAAS,WAAY,QAAS,MAAM,CAAC,CAC9D,CACH,CAAC,EAEKC,EAAQC,EACdC,EAAa,CAAC,YAAAC,EAAa,eAAAC,CAAc,CAAC,EAE1C,KAAM,CAAC,YAAAC,EAAa,MAAAC,EAAK,EAAIC,GAAOT,CAAI,EAGxC,SAASU,GAAU,CACjBlB,EAAQ,MAAQ,GAChBmB,GAAWJ,EAAY,KAAK,EAAE,KAAKK,GAAY,CAC7CtB,EAAW,MAAQsB,EAAS,KAC5Bf,EAAM,MAAQe,EAAS,MACvBC,GAAS,IAAM,CACTzB,EAAS,OACXA,EAAS,MAAM,iBAEbF,EAAM,YAAcA,EAAM,WAAW,OAAS,GAC5CE,EAAS,OAASE,EAAW,OAC/BA,EAAW,MAAM,QAAQwB,GAAQ,CAC3B5B,EAAM,WAAW,KAAK6B,GAAUA,IAAWD,EAAK,QAAQ,GAC1D1B,EAAS,MAAM,mBAAmB0B,EAAM,EAAI,CAE1D,CAAW,CAGX,CAAK,EACDtB,EAAQ,MAAQ,EACpB,CAAG,CACH,CAGA,SAASwB,GAAmB,CAC1BC,GAAY,CAAC,OAAQ,EAAK,CAAC,EAAE,KAAKL,GAAY,CAC5CrB,EAAe,MAAQqB,EAAS,IACpC,CAAG,CACH,CAGA,SAASM,EAAcC,EAAKC,EAAQC,EAAW,CAE7C,OAAOC,EAAeH,EAAI,SAAS,CACrC,CAGA,SAASG,EAAeC,EAAW,CAEjC,UAAWC,KAAWjC,EAAe,MACnC,GAAIgC,IAAcC,EAAQ,UACxB,OAAOA,EAAQ,WAGrB,CAGA,SAASnB,GAAc,CACrBE,EAAY,MAAM,QAAU,EAC5BG,GACF,CAGA,SAASe,GAAa,CACpB1C,EAAM,UAAU,UAAU,EAC1BsB,GACF,CAGA,SAASqB,EAAsBC,EAAW,CACxCzB,EAAM,eAAgByB,CAAS,EAC/BjC,EAAI,MAAQiC,EAAU,IAAIb,GAAQA,EAAK,QAAQ,EAC/Cf,EAAO,MAAQL,EAAI,MACnBC,EAAO,MAAQgC,EAAU,SAAW,EACpC/B,EAAS,MAAQ,CAAC+B,EAAU,MAC9B,CAEA,SAASrB,GAAiB,CACxB,OAAOZ,EAAI,KACb,CAEA,SAASkC,EAAaD,EAAWR,EAAK,CACpC,IAAIU,EAAUvC,EAAW,MAAM,IAAIwB,GAAQA,EAAK,QAAQ,EACpDgB,EAAgBH,EAAU,IAAIb,GAAQA,EAAK,QAAQ,EACnDiB,EAASF,EAAQ,OAAOf,GAAQ,CAACgB,EAAc,SAAShB,CAAI,CAAC,EACjEgB,EAAc,QAASf,GAAW,CAC3BjB,EAAa,MAAM,KAAMkC,GAAaA,IAAajB,CAAM,GAC5DjB,EAAa,MAAM,KAAKiB,CAAM,CAEpC,CAAG,EACDjB,EAAa,MAAQA,EAAa,MAAM,OAAOgB,GAAQ,CAACiB,EAAO,SAASjB,CAAI,CAAC,CAC/E,CAGA,SAASmB,GAAgBN,EAAW,CAClC,IAAIG,EAAgBH,EAAU,IAAIb,GAAQA,EAAK,QAAQ,EACvD,GAAIgB,GAAiBA,EAAc,OAAS,EAC1CA,EAAc,QAAShB,GAAS,CACzBhB,EAAa,MAAM,KAAMkC,GAAaA,IAAalB,CAAI,GAC1DhB,EAAa,MAAM,KAAKgB,CAAI,CAEpC,CAAK,MACI,CACL,IAAIe,EAAUvC,EAAW,MAAM,IAAIwB,GAAQA,EAAK,QAAQ,EACxDhB,EAAa,MAAQA,EAAa,MAAM,OAAOgB,GAAQ,CAACe,EAAQ,SAASf,CAAI,CAAC,CAC/E,CAEH,CAEA,OAAAoB,GAAU,IAAM,CACdpC,EAAa,MAAQqC,GAAMjD,EAAM,UAAU,EAC3C8B,IACAN,GACF,CAAC"}