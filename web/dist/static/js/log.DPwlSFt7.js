import{X as G,r as v,u as fe,J as ce,N as be,d as i,H as E,o as m,c as k,I as w,M as K,h as o,e,f as l,l as _e,O as Q,P as Y,m as j,K as T,p as u,i as z,y as f,n as O,F as ge,s as ve}from"./index.N0ypA0wQ.js";import{g as je}from"./job.C76VByNn.js";function we(x){return G({url:"/qtr/jobLog/list",method:"get",params:x})}function ye(x){return G({url:"/qtr/jobLog/"+x,method:"delete"})}function he(){return G({url:"/qtr/jobLog/clean",method:"delete"})}const ke={class:"app-container"},xe={key:0},Ve={key:1},Ce={class:"dialog-footer"},Le=ge({name:"QtrJobLog"}),Te=Object.assign(Le,{setup(x){const{proxy:c}=ve(),{sys_common_status:I,sys_job_group:L,sys_job_executor:A}=c.useDict("sys_common_status","sys_job_group","sys_job_executor"),R=v([]),y=v(!1),N=v(!0),V=v(!0),q=v([]),U=v(!0),D=v(0),h=v([]),$=fe(),H=ce({form:{},queryParams:{pageNum:1,pageSize:10,dictName:void 0,dictType:void 0,status:void 0}}),{queryParams:s,form:d,rules:Ne}=be(H);function _(){N.value=!0,we(c.addDateRange(s.value,h.value)).then(n=>{R.value=n.rows,D.value=n.total,N.value=!1})}function X(n,t){return c.selectDictLabel(L.value,n.jobGroup)}function W(n,t){return c.selectDictLabel(A.value,n.jobExecutor)}function Z(){const n={path:"/hrm/qtr/qtr/job"};c.$tab.closeOpenPage(n)}function S(){s.value.pageNum=1,_()}function ee(){h.value=[],c.resetForm("queryRef"),S()}function le(n){q.value=n.map(t=>t.jobLogId),U.value=!n.length}function te(n){y.value=!0,d.value=n}function oe(n){c.$modal.confirm('是否确认删除调度日志编号为"'+q.value+'"的数据项?').then(function(){return ye(q.value)}).then(()=>{_(),c.$modal.msgSuccess("删除成功")}).catch(()=>{})}function ae(){c.$modal.confirm("是否确认清空所有调度日志数据项?").then(function(){return he()}).then(()=>{_(),c.$modal.msgSuccess("清空成功")}).catch(()=>{})}function ne(){c.download("qtr/jobLog/export",{...s.value},`job_log_${new Date().getTime()}.xlsx`)}return(()=>{const n=$.params&&$.params.jobId;n!==void 0&&n!=0?je(n).then(t=>{s.value.jobName=t.data.jobName,s.value.jobGroup=t.data.jobGroup,_()}):_()})(),_(),(n,t)=>{const ue=i("el-input"),r=i("el-form-item"),P=i("el-option"),J=i("el-select"),re=i("el-date-picker"),g=i("el-button"),F=i("el-form"),p=i("el-col"),se=i("right-toolbar"),M=i("el-row"),b=i("el-table-column"),B=i("dict-tag"),de=i("el-table"),ie=i("pagination"),pe=i("el-dialog"),C=E("hasPermi"),me=E("loading");return m(),k("div",ke,[w(e(F,{model:o(s),ref:"queryRef",inline:!0,"label-width":"68px"},{default:l(()=>[e(r,{label:"任务名称",prop:"jobName"},{default:l(()=>[e(ue,{modelValue:o(s).jobName,"onUpdate:modelValue":t[0]||(t[0]=a=>o(s).jobName=a),placeholder:"请输入任务名称",clearable:"",style:{width:"240px"},onKeyup:_e(S,["enter"])},null,8,["modelValue"])]),_:1}),e(r,{label:"任务组名",prop:"jobGroup"},{default:l(()=>[e(J,{modelValue:o(s).jobGroup,"onUpdate:modelValue":t[1]||(t[1]=a=>o(s).jobGroup=a),placeholder:"请选择任务组名",clearable:"",style:{width:"240px"}},{default:l(()=>[(m(!0),k(Q,null,Y(o(L),a=>(m(),j(P,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"执行状态",prop:"status"},{default:l(()=>[e(J,{modelValue:o(s).status,"onUpdate:modelValue":t[2]||(t[2]=a=>o(s).status=a),placeholder:"请选择执行状态",clearable:"",style:{width:"240px"}},{default:l(()=>[(m(!0),k(Q,null,Y(o(I),a=>(m(),j(P,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"执行时间",style:{width:"308px"}},{default:l(()=>[e(re,{modelValue:o(h),"onUpdate:modelValue":t[3]||(t[3]=a=>T(h)?h.value=a:null),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),e(r,null,{default:l(()=>[e(g,{type:"primary",icon:"Search",onClick:S},{default:l(()=>t[9]||(t[9]=[u("搜索")])),_:1}),e(g,{icon:"Refresh",onClick:ee},{default:l(()=>t[10]||(t[10]=[u("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[K,o(V)]]),e(M,{gutter:10,class:"mb8"},{default:l(()=>[e(p,{span:1.5},{default:l(()=>[w((m(),j(g,{type:"danger",plain:"",icon:"Delete",disabled:o(U),onClick:oe},{default:l(()=>t[11]||(t[11]=[u("删除")])),_:1},8,["disabled"])),[[C,["qtr:job:remove"]]])]),_:1}),e(p,{span:1.5},{default:l(()=>[w((m(),j(g,{type:"danger",plain:"",icon:"Delete",onClick:ae},{default:l(()=>t[12]||(t[12]=[u("清空")])),_:1})),[[C,["qtr:job:remove"]]])]),_:1}),e(p,{span:1.5},{default:l(()=>[w((m(),j(g,{type:"warning",plain:"",icon:"Download",onClick:ne},{default:l(()=>t[13]||(t[13]=[u("导出")])),_:1})),[[C,["qtr:job:export"]]])]),_:1}),e(p,{span:1.5},{default:l(()=>[e(g,{type:"warning",plain:"",icon:"Close",onClick:Z},{default:l(()=>t[14]||(t[14]=[u("关闭")])),_:1})]),_:1}),e(se,{showSearch:o(V),"onUpdate:showSearch":t[4]||(t[4]=a=>T(V)?V.value=a:null),onQueryTable:_},null,8,["showSearch"])]),_:1}),w((m(),j(de,{data:o(R),onSelectionChange:le},{default:l(()=>[e(b,{type:"selection",width:"55",align:"center"}),e(b,{label:"日志编号",width:"80",align:"center",prop:"jobLogId"}),e(b,{label:"任务名称",align:"center",prop:"jobName","show-overflow-tooltip":!0}),e(b,{label:"任务组名",align:"center",prop:"jobGroup","show-overflow-tooltip":!0},{default:l(a=>[e(B,{options:o(L),value:a.row.jobGroup},null,8,["options","value"])]),_:1}),e(b,{label:"调用目标字符串",align:"center",prop:"invokeTarget","show-overflow-tooltip":!0}),e(b,{label:"日志信息",align:"center",prop:"jobMessage","show-overflow-tooltip":!0}),e(b,{label:"执行状态",align:"center",prop:"status"},{default:l(a=>[e(B,{options:o(I),value:a.row.status},null,8,["options","value"])]),_:1}),e(b,{label:"执行时间",align:"center",prop:"createTime",width:"180"},{default:l(a=>[z("span",null,f(n.parseTime(a.row.createTime)),1)]),_:1}),e(b,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:l(a=>[w((m(),j(g,{link:"",type:"primary",icon:"View",onClick:qe=>te(a.row)},{default:l(()=>t[15]||(t[15]=[u("详细")])),_:2},1032,["onClick"])),[[C,["qtr:job:query"]]])]),_:1})]),_:1},8,["data"])),[[me,o(N)]]),w(e(ie,{total:o(D),page:o(s).pageNum,"onUpdate:page":t[5]||(t[5]=a=>o(s).pageNum=a),limit:o(s).pageSize,"onUpdate:limit":t[6]||(t[6]=a=>o(s).pageSize=a),onPagination:_},null,8,["total","page","limit"]),[[K,o(D)>0]]),e(pe,{title:"调度日志详细",modelValue:o(y),"onUpdate:modelValue":t[8]||(t[8]=a=>T(y)?y.value=a:null),width:"700px","append-to-body":""},{footer:l(()=>[z("div",Ce,[e(g,{onClick:t[7]||(t[7]=a=>y.value=!1)},{default:l(()=>t[16]||(t[16]=[u("关 闭")])),_:1})])]),default:l(()=>[e(F,{model:o(d),"label-width":"100px"},{default:l(()=>[e(M,null,{default:l(()=>[e(p,{span:12},{default:l(()=>[e(r,{label:"日志序号："},{default:l(()=>[u(f(o(d).jobLogId),1)]),_:1}),e(r,{label:"任务名称："},{default:l(()=>[u(f(o(d).jobName),1)]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(r,{label:"任务分组："},{default:l(()=>[u(f(X(o(d))),1)]),_:1}),e(r,{label:"执行时间："},{default:l(()=>[u(f(n.parseTime(o(d).createTime)),1)]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(r,{label:"任务执行器："},{default:l(()=>[u(f(W(o(d))),1)]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(r,{label:"任务触发器："},{default:l(()=>[u(f(o(d).jobTrigger),1)]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(r,{label:"调用方法："},{default:l(()=>[u(f(o(d).invokeTarget),1)]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(r,{label:"位置参数："},{default:l(()=>[u(f(o(d).jobArgs),1)]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(r,{label:"关键字参数："},{default:l(()=>[u(f(o(d).jobKwargs),1)]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(r,{label:"日志信息："},{default:l(()=>[u(f(o(d).jobMessage),1)]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(r,{label:"执行状态："},{default:l(()=>[o(d).status==0?(m(),k("div",xe,"正常")):o(d).status==1?(m(),k("div",Ve,"失败")):O("",!0)]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[o(d).status==1?(m(),j(r,{key:0,label:"异常信息："},{default:l(()=>[u(f(o(d).exceptionInfo),1)]),_:1})):O("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{Te as default};
//# sourceMappingURL=log.DPwlSFt7.js.map
