{"version":3,"file":"index.8m3txVFo.js","sources":["../../../src/views/hrm/env/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <el-form :model=\"queryParams\" ref=\"queryRef\" :inline=\"true\" v-show=\"showSearch\">\r\n      <el-form-item label=\"环境名称\" prop=\"envName\">\r\n        <el-input\r\n            v-model=\"queryParams.envName\"\r\n            placeholder=\"请输入环境名称\"\r\n            clearable\r\n            style=\"width: 200px\"\r\n            @keyup.enter=\"handleQuery\"\r\n        />\r\n      </el-form-item>\r\n      <el-form-item label=\"状态\" prop=\"status\">\r\n        <el-select v-model=\"queryParams.status\" placeholder=\"环境状态\" clearable style=\"width: 200px\">\r\n          <el-option\r\n              v-for=\"dict in sys_normal_disable\"\r\n              :key=\"dict.value\"\r\n              :label=\"dict.label\"\r\n              :value=\"dict.value\"\r\n          />\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-checkbox>仅自己的数据</el-checkbox>\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" icon=\"Search\" @click=\"handleQuery\">搜索</el-button>\r\n        <el-button icon=\"Refresh\" @click=\"resetQuery\">重置</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n\r\n    <el-row :gutter=\"10\" class=\"mb8\">\r\n      <el-col :span=\"1.5\">\r\n        <el-button\r\n            type=\"primary\"\r\n            plain\r\n            icon=\"Plus\"\r\n            @click=\"handleAdd\"\r\n            v-hasPermi=\"['hrm:env:add']\"\r\n        >新增\r\n        </el-button>\r\n      </el-col>\r\n      <right-toolbar v-model:showSearch=\"showSearch\" @queryTable=\"getList\"></right-toolbar>\r\n    </el-row>\r\n\r\n    <el-table\r\n        border\r\n        v-if=\"refreshTable\"\r\n        v-loading=\"loading\"\r\n        :data=\"envList\"\r\n        row-key=\"envId\"\r\n        :default-expand-all=\"isExpandAll\"\r\n        table-layout=\"fixed\"\r\n        max-height=\"calc(100vh - 280px)\"\r\n    >\r\n      <el-table-column prop=\"envId\" label=\"ID\" width=\"160\"></el-table-column>\r\n      <el-table-column prop=\"envName\" label=\"环境名称\"></el-table-column>\r\n      <el-table-column prop=\"envUrl\" label=\"环境URL\"></el-table-column>\r\n      <el-table-column prop=\"orderNum\" label=\"排序\" width=\"70\"></el-table-column>\r\n      <el-table-column prop=\"status\" label=\"状态\" width=\"70\">\r\n        <template #default=\"scope\">\r\n          <dict-tag :options=\"sys_normal_disable\" :value=\"scope.row.status\"/>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"创建时间\" align=\"center\" prop=\"createTime\" class-name=\"small-padding fixed-width\"\r\n                       width=\"150\">\r\n        <template #default=\"scope\">\r\n          <span>{{ parseTime(scope.row.createTime) }}</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"更新时间\" align=\"center\" prop=\"updateTime\" class-name=\"small-padding fixed-width\"\r\n                       width=\"150\">\r\n        <template #default=\"scope\">\r\n          <span>{{ parseTime(scope.row.updateTime) }}</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"操作\" align=\"center\" class-name=\"small-padding fixed-width\" width=\"110px\" fixed=\"right\">\r\n        <template #default=\"scope\">\r\n          <el-button link type=\"primary\" icon=\"Edit\" @click=\"handleUpdate(scope.row)\"\r\n                     v-hasPermi=\"['hrm:env:edit', 'hrm:env:detail']\">\r\n          </el-button>\r\n          <el-button link type=\"warning\" icon=\"CopyDocument\" @click=\"handleCopy(scope.row)\"\r\n                     v-hasPermi=\"['hrm:env:copy']\">\r\n          </el-button>\r\n          <el-button link type=\"danger\" icon=\"Delete\" @click=\"handleDelete(scope.row)\" v-hasPermi=\"['hrm:env:remove']\">\r\n          </el-button>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <pagination\r\n        v-show=\"total > 0\"\r\n        :total=\"total\"\r\n        v-model:page=\"queryParams.pageNum\"\r\n        v-model:limit=\"queryParams.pageSize\"\r\n        @pagination=\"getList\"\r\n    />\r\n\r\n    <!-- 添加或修改环境对话框 -->\r\n    <el-dialog :title=\"title\" v-model=\"open\" width=\"70%\" append-to-body>\r\n      <el-form ref=\"envRef\" :model=\"form\" :rules=\"rules\" label-width=\"80px\">\r\n        <el-row>\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"环境名称\" prop=\"envName\">\r\n              <el-input v-model=\"form.envName\" placeholder=\"请输入环境名称\"/>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"显示排序\" prop=\"orderNum\">\r\n              <el-input-number v-model=\"form.orderNum\" controls-position=\"right\" :min=\"0\"/>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"环境地址\" prop=\"envUrl\">\r\n              <el-input v-model=\"form.envUrl\" placeholder=\"请输入URL地址\" maxlength=\"200\"/>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"环境描述\" prop=\"simpleDesc\">\r\n              <el-input v-model=\"form.simpleDesc\" placeholder=\"请输入描述\" maxlength=\"400\"/>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"12\">\r\n            <el-form-item label=\"环境状态\">\r\n              <el-radio-group v-model=\"form.status\">\r\n                <el-radio\r\n                    v-for=\"dict in sys_normal_disable\"\r\n                    :key=\"dict.value\"\r\n                    :value=\"dict.value\"\r\n                >{{ dict.label }}\r\n                </el-radio>\r\n              </el-radio-group>\r\n            </el-form-item>\r\n          </el-col>\r\n        </el-row>\r\n        <el-row style=\"padding-bottom: 20px\">\r\n          <el-col>\r\n            <el-text>添加环境分组：</el-text>\r\n            <el-tooltip content=\"添加环境变量分组\"\r\n                        placement=\"top-start\"\r\n            >\r\n              <el-button size=\"small\" type=\"success\" icon=\"Plus\" @click=\"addEnvGroup\"></el-button>\r\n            </el-tooltip>\r\n          </el-col>\r\n        </el-row>\r\n\r\n        <el-row>\r\n\r\n          <el-col v-for=\"(item, index) in form.envConfig.variables\" :key=\"index\" style=\"padding-bottom: 20px\">\r\n            <div style=\"padding-bottom: 10px\">\r\n              <el-text>分组名称：</el-text>\r\n              <EditLabelText v-model:content=\"item.key\"></EditLabelText>\r\n\r\n              <el-tooltip content=\"删除环境变量分组\"\r\n                          placement=\"top-start\"\r\n              >\r\n                <el-button size=\"small\" type=\"danger\" icon=\"Delete\" @click=\"delEnvGroup(index)\"></el-button>\r\n              </el-tooltip>\r\n            </div>\r\n            <TableVariables v-model=\"item.value\"></TableVariables>\r\n          </el-col>\r\n\r\n        </el-row>\r\n      </el-form>\r\n      <template #footer>\r\n        <el-affix position=\"bottom\" :offset=\"20\">\r\n          <div class=\"dialog-footer\">\r\n            <el-button type=\"primary\" @click=\"submitForm\" v-hasPermi=\"['hrm:env:edit']\">确 定</el-button>\r\n            <el-button @click=\"cancel\">取 消</el-button>\r\n          </div>\r\n        </el-affix>\r\n\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script setup name=\"Env\">\r\nimport {listEnv, getEnv, delEnv, addEnv, updateEnv, copyEnv} from \"@/api/hrm/env\";\r\nimport TableVariables from '../../../components/hrm/table-variables.vue';\r\nimport EditLabelText from \"@/components/hrm/common/edit-label-text.vue\";\r\nimport {ElMessage} from \"element-plus\";\r\n\r\nconst {proxy} = getCurrentInstance();\r\nconst {sys_normal_disable} = proxy.useDict(\"sys_normal_disable\");\r\nconst {hrm_data_type} = proxy.useDict(\"hrm_data_type\");\r\n\r\nprovide(\"hrm_data_type\", hrm_data_type);\r\n\r\nconst envList = ref([]);\r\nconst open = ref(false);\r\nconst loading = ref(true);\r\nconst showSearch = ref(true);\r\nconst title = ref(\"\");\r\nconst isExpandAll = ref(true);\r\nconst refreshTable = ref(true);\r\nconst total = ref(0);\r\n\r\nconst data = reactive({\r\n  queryParams: {\r\n    pageNum: 1,\r\n    pageSize: 10,\r\n    envName: undefined,\r\n    status: undefined\r\n  },\r\n  rules: {\r\n    envName: [{required: true, message: \"环境名称不能为空\", trigger: \"blur\"}],\r\n    orderNum: [{required: true, message: \"显示排序不能为空\", trigger: \"blur\"}],\r\n    envUrl: [{required: true, message: \"环境地址不能为空\", trigger: \"blur\"}]\r\n  },\r\n});\r\n\r\nconst {queryParams, rules} = toRefs(data);\r\nconst form = ref({\r\n  envConfig: {variables: [{key: \"default\", value: []}]},\r\n  envName: \"\",\r\n  envUrl: \"\",\r\n  orderNum: 0,\r\n  simpleDesc: \"\"\r\n});\r\n\r\n\r\nfunction addEnvGroup() {\r\n  form.value.envConfig.variables.push({\r\n    key: \"default\",\r\n    desc: \"\",\r\n    value: []\r\n  })\r\n}\r\n\r\nfunction delEnvGroup(index) {\r\n  form.value.envConfig.variables.splice(index, 1);\r\n}\r\n\r\n/** 查询环境列表 */\r\nfunction getList() {\r\n  loading.value = true;\r\n  listEnv(queryParams.value).then(response => {\r\n    envList.value = response.rows;\r\n    total.value = response.total;\r\n    loading.value = false;\r\n  });\r\n}\r\n\r\n/** 取消按钮 */\r\nfunction cancel() {\r\n  open.value = false;\r\n  reset();\r\n}\r\n\r\n/** 表单重置 */\r\nfunction reset() {\r\n  form.value = {\r\n    envId: undefined,\r\n    envName: undefined,\r\n    orderNum: 0,\r\n    envUrl: undefined,\r\n    simpleDesc: undefined,\r\n    status: \"0\",\r\n    envConfig: {variables: [{value: [], key: \"default\"}]}\r\n  };\r\n  proxy.resetForm(\"envRef\");\r\n}\r\n\r\n/** 搜索按钮操作 */\r\nfunction handleQuery() {\r\n  getList();\r\n}\r\n\r\n/** 重置按钮操作 */\r\nfunction resetQuery() {\r\n  proxy.resetForm(\"queryRef\");\r\n  handleQuery();\r\n}\r\n\r\n/** 新增按钮操作 */\r\nfunction handleAdd(row) {\r\n  reset();\r\n  // listEnv().then(response => {\r\n  //   envOptions.value = proxy.handleTree(response.data, \"envId\");\r\n  // });\r\n  open.value = true;\r\n  title.value = \"添加环境\";\r\n}\r\n\r\n/** 展开/折叠操作 */\r\nfunction toggleExpandAll() {\r\n  refreshTable.value = false;\r\n  isExpandAll.value = !isExpandAll.value;\r\n  nextTick(() => {\r\n    refreshTable.value = true;\r\n  });\r\n}\r\n\r\n/** 修改按钮操作 */\r\nfunction handleUpdate(row) {\r\n  reset();\r\n  getEnv(row.envId).then(response => {\r\n    form.value = response.data;\r\n    open.value = true;\r\n    title.value = response.data.envId + \"  >>  \" + response.data.envName;\r\n  });\r\n}\r\n\r\n/** 提交按钮 */\r\nfunction submitForm() {\r\n  proxy.$refs[\"envRef\"].validate(valid => {\r\n    if (valid) {\r\n      if (form.value.envId != undefined) {\r\n        updateEnv(form.value).then(response => {\r\n          proxy.$modal.msgSuccess(\"修改成功\");\r\n          open.value = false;\r\n          getList();\r\n        });\r\n      } else {\r\n        addEnv(form.value).then(response => {\r\n          proxy.$modal.msgSuccess(\"新增成功\");\r\n          open.value = false;\r\n          getList();\r\n        });\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n/** 删除按钮操作 */\r\nfunction handleDelete(row) {\r\n  proxy.$modal.confirm('是否确认删除名称为\"' + row.envName + '\"的数据项?').then(function () {\r\n    return delEnv(row.envId);\r\n  }).then(() => {\r\n    getList();\r\n    proxy.$modal.msgSuccess(\"删除成功\");\r\n  }).catch(() => {\r\n  });\r\n}\r\n\r\n/** 删除按钮操作 */\r\nfunction handleCopy(row) {\r\n  copyEnv({envId: row.envId}).then(()=>{\r\n    ElMessage.success(\"复制成功\");\r\n  }).catch((e)=>{\r\n    ElMessage.error(\"复制异常\");\r\n  });\r\n}\r\n\r\ngetList();\r\n</script>\r\n"],"names":["proxy","getCurrentInstance","sys_normal_disable","hrm_data_type","provide","envList","ref","open","loading","showSearch","title","isExpandAll","refreshTable","total","data","reactive","queryParams","rules","toRefs","form","addEnvGroup","delEnvGroup","index","getList","listEnv","response","cancel","reset","handleQuery","resetQuery","handleAdd","row","handleUpdate","getEnv","submitForm","valid","updateEnv","addEnv","handleDelete","delEnv","handleCopy","copyEnv","ElMessage","e"],"mappings":"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"}