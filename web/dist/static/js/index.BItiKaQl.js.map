{"version":3,"file":"index.BItiKaQl.js","sources":["../../../src/views/tool/gen/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <div>我是代码生成</div>\r\n    <!-- <el-form :model=\"queryParams\" ref=\"queryRef\" :inline=\"true\" v-show=\"showSearch\">\r\n      <el-form-item label=\"表名称\" prop=\"tableName\">\r\n        <el-input\r\n          v-model=\"queryParams.tableName\"\r\n          placeholder=\"请输入表名称\"\r\n          clearable\r\n          style=\"width: 200px\"\r\n          @keyup.enter=\"handleQuery\"\r\n        />\r\n      </el-form-item>\r\n      <el-form-item label=\"表描述\" prop=\"tableComment\">\r\n        <el-input\r\n          v-model=\"queryParams.tableComment\"\r\n          placeholder=\"请输入表描述\"\r\n          clearable\r\n          style=\"width: 200px\"\r\n          @keyup.enter=\"handleQuery\"\r\n        />\r\n      </el-form-item>\r\n      <el-form-item label=\"创建时间\" style=\"width: 308px\">\r\n        <el-date-picker\r\n          v-model=\"dateRange\"\r\n          value-format=\"YYYY-MM-DD\"\r\n          type=\"daterange\"\r\n          range-separator=\"-\"\r\n          start-placeholder=\"开始日期\"\r\n          end-placeholder=\"结束日期\"\r\n        ></el-date-picker>\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" icon=\"Search\" @click=\"handleQuery\">搜索</el-button>\r\n        <el-button icon=\"Refresh\" @click=\"resetQuery\">重置</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n\r\n    <el-row :gutter=\"10\" class=\"mb8\">\r\n      <el-col :span=\"1.5\">\r\n        <el-button\r\n          type=\"primary\"\r\n          plain\r\n          icon=\"Download\"\r\n          @click=\"handleGenTable\"\r\n          v-hasPermi=\"['tool:gen:code']\"\r\n        >生成</el-button>\r\n      </el-col>\r\n      <el-col :span=\"1.5\">\r\n        <el-button\r\n          type=\"info\"\r\n          plain\r\n          icon=\"Upload\"\r\n          @click=\"openImportTable\"\r\n          v-hasPermi=\"['tool:gen:import']\"\r\n        >导入</el-button>\r\n      </el-col>\r\n      <el-col :span=\"1.5\">\r\n        <el-button\r\n          type=\"success\"\r\n          plain\r\n          icon=\"Edit\"\r\n          :disabled=\"single\"\r\n          @click=\"handleEditTable\"\r\n          v-hasPermi=\"['tool:gen:edit']\"\r\n        >修改</el-button>\r\n      </el-col>\r\n      <el-col :span=\"1.5\">\r\n        <el-button\r\n          type=\"danger\"\r\n          plain\r\n          icon=\"Delete\"\r\n          :disabled=\"multiple\"\r\n          @click=\"handleDelete\"\r\n          v-hasPermi=\"['tool:gen:remove']\"\r\n        >删除</el-button>\r\n      </el-col>\r\n      <right-toolbar v-model:showSearch=\"showSearch\" @queryTable=\"getList\"></right-toolbar>\r\n    </el-row>\r\n\r\n    <el-table v-loading=\"loading\" :data=\"tableList\" @selection-change=\"handleSelectionChange\">\r\n      <el-table-column type=\"selection\" align=\"center\" width=\"55\"></el-table-column>\r\n      <el-table-column label=\"序号\" type=\"index\" width=\"50\" align=\"center\">\r\n        <template #default=\"scope\">\r\n          <span>{{(queryParams.pageNum - 1) * queryParams.pageSize + scope.$index + 1}}</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column\r\n        label=\"表名称\"\r\n        align=\"center\"\r\n        prop=\"tableName\"\r\n        :show-overflow-tooltip=\"true\"\r\n      />\r\n      <el-table-column\r\n        label=\"表描述\"\r\n        align=\"center\"\r\n        prop=\"tableComment\"\r\n        :show-overflow-tooltip=\"true\"\r\n      />\r\n      <el-table-column\r\n        label=\"实体\"\r\n        align=\"center\"\r\n        prop=\"className\"\r\n        :show-overflow-tooltip=\"true\"\r\n      />\r\n      <el-table-column label=\"创建时间\" align=\"center\" prop=\"createTime\" width=\"160\" />\r\n      <el-table-column label=\"更新时间\" align=\"center\" prop=\"updateTime\" width=\"160\" />\r\n      <el-table-column label=\"操作\" align=\"center\" width=\"330\" class-name=\"small-padding fixed-width\">\r\n        <template #default=\"scope\">\r\n          <el-tooltip content=\"预览\" placement=\"top\">\r\n            <el-button link type=\"primary\" icon=\"View\" @click=\"handlePreview(scope.row)\" v-hasPermi=\"['tool:gen:preview']\"></el-button>\r\n          </el-tooltip>\r\n          <el-tooltip content=\"编辑\" placement=\"top\">\r\n            <el-button link type=\"primary\" icon=\"Edit\" @click=\"handleEditTable(scope.row)\" v-hasPermi=\"['tool:gen:edit']\"></el-button>\r\n          </el-tooltip>\r\n          <el-tooltip content=\"删除\" placement=\"top\">\r\n            <el-button link type=\"primary\" icon=\"Delete\" @click=\"handleDelete(scope.row)\" v-hasPermi=\"['tool:gen:remove']\"></el-button>\r\n          </el-tooltip>\r\n          <el-tooltip content=\"同步\" placement=\"top\">\r\n            <el-button link type=\"primary\" icon=\"Refresh\" @click=\"handleSynchDb(scope.row)\" v-hasPermi=\"['tool:gen:edit']\"></el-button>\r\n          </el-tooltip>\r\n          <el-tooltip content=\"生成代码\" placement=\"top\">\r\n            <el-button link type=\"primary\" icon=\"Download\" @click=\"handleGenTable(scope.row)\" v-hasPermi=\"['tool:gen:code']\"></el-button>\r\n          </el-tooltip>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <pagination\r\n      v-show=\"total>0\"\r\n      :total=\"total\"\r\n      v-model:page=\"queryParams.pageNum\"\r\n      v-model:limit=\"queryParams.pageSize\"\r\n      @pagination=\"getList\"\r\n    /> -->\r\n    <!-- 预览界面 -->\r\n    <!-- <el-dialog :title=\"preview.title\" v-model=\"preview.open\" width=\"80%\" top=\"5vh\" append-to-body class=\"scrollbar\">\r\n      <el-tabs v-model=\"preview.activeName\">\r\n        <el-tab-pane\r\n          v-for=\"(value, key) in preview.data\"\r\n          :label=\"key.substring(key.lastIndexOf('/')+1,key.indexOf('.vm'))\"\r\n          :name=\"key.substring(key.lastIndexOf('/')+1,key.indexOf('.vm'))\"\r\n          :key=\"value\"\r\n        >\r\n          <el-link :underline=\"false\" icon=\"DocumentCopy\" v-copyText=\"value\" v-copyText:callback=\"copyTextSuccess\" style=\"float:right\">&nbsp;复制</el-link>\r\n          <pre>{{ value }}</pre>\r\n        </el-tab-pane>\r\n      </el-tabs>\r\n    </el-dialog>\r\n    <import-table ref=\"importRef\" @ok=\"handleQuery\" /> -->\r\n  </div>\r\n</template>\r\n\r\n<script setup name=\"Gen\">\r\nimport { listTable, previewTable, delTable, genCode, synchDb } from \"@/api/tool/gen\";\r\nimport router from \"@/router\";\r\nimport importTable from \"./importTable\";\r\n\r\nconst route = useRoute();\r\nconst { proxy } = getCurrentInstance();\r\n\r\nconst tableList = ref([]);\r\nconst loading = ref(true);\r\nconst showSearch = ref(true);\r\nconst ids = ref([]);\r\nconst single = ref(true);\r\nconst multiple = ref(true);\r\nconst total = ref(0);\r\nconst tableNames = ref([]);\r\nconst dateRange = ref([]);\r\nconst uniqueId = ref(\"\");\r\n\r\nconst data = reactive({\r\n  queryParams: {\r\n    pageNum: 1,\r\n    pageSize: 10,\r\n    tableName: undefined,\r\n    tableComment: undefined\r\n  },\r\n  preview: {\r\n    open: false,\r\n    title: \"代码预览\",\r\n    data: {},\r\n    activeName: \"domain.java\"\r\n  }\r\n});\r\n\r\nconst { queryParams, preview } = toRefs(data);\r\n\r\nonActivated(() => {\r\n  const time = route.query.t;\r\n  if (time != null && time != uniqueId.value) {\r\n    uniqueId.value = time;\r\n    queryParams.value.pageNum = Number(route.query.pageNum);\r\n    dateRange.value = [];\r\n    proxy.resetForm(\"queryForm\");\r\n    getList();\r\n  }\r\n})\r\n\r\n/** 查询表集合 */\r\nfunction getList() {\r\n  loading.value = true;\r\n  listTable(proxy.addDateRange(queryParams.value, dateRange.value)).then(response => {\r\n    tableList.value = response.rows;\r\n    total.value = response.total;\r\n    loading.value = false;\r\n  });\r\n}\r\n/** 搜索按钮操作 */\r\nfunction handleQuery() {\r\n  queryParams.value.pageNum = 1;\r\n  getList();\r\n}\r\n/** 生成代码操作 */\r\nfunction handleGenTable(row) {\r\n  const tbNames = row.tableName || tableNames.value;\r\n  if (tbNames == \"\") {\r\n    proxy.$modal.msgError(\"请选择要生成的数据\");\r\n    return;\r\n  }\r\n  if (row.genType === \"1\") {\r\n    genCode(row.tableName).then(response => {\r\n      proxy.$modal.msgSuccess(\"成功生成到自定义路径：\" + row.genPath);\r\n    });\r\n  } else {\r\n    proxy.$download.zip(\"/tool/gen/batchGenCode?tables=\" + tbNames, \"ruoyi.zip\");\r\n  }\r\n}\r\n/** 同步数据库操作 */\r\nfunction handleSynchDb(row) {\r\n  const tableName = row.tableName;\r\n  proxy.$modal.confirm('确认要强制同步\"' + tableName + '\"表结构吗？').then(function () {\r\n    return synchDb(tableName);\r\n  }).then(() => {\r\n    proxy.$modal.msgSuccess(\"同步成功\");\r\n  }).catch(() => {});\r\n}\r\n/** 打开导入表弹窗 */\r\nfunction openImportTable() {\r\n  proxy.$refs[\"importRef\"].show();\r\n}\r\n/** 重置按钮操作 */\r\nfunction resetQuery() {\r\n  dateRange.value = [];\r\n  proxy.resetForm(\"queryRef\");\r\n  handleQuery();\r\n}\r\n/** 预览按钮 */\r\nfunction handlePreview(row) {\r\n  previewTable(row.tableId).then(response => {\r\n    preview.value.data = response.data;\r\n    preview.value.open = true;\r\n    preview.value.activeName = \"domain.java\";\r\n  });\r\n}\r\n/** 复制代码成功 */\r\nfunction copyTextSuccess() {\r\n  proxy.$modal.msgSuccess(\"复制成功\");\r\n}\r\n// 多选框选中数据\r\nfunction handleSelectionChange(selection) {\r\n  ids.value = selection.map(item => item.tableId);\r\n  tableNames.value = selection.map(item => item.tableName);\r\n  single.value = selection.length != 1;\r\n  multiple.value = !selection.length;\r\n}\r\n/** 修改按钮操作 */\r\nfunction handleEditTable(row) {\r\n  const tableId = row.tableId || ids.value[0];\r\n  router.push({ path: \"/tool/gen-edit/index/\" + tableId, query: { pageNum: queryParams.value.pageNum } });\r\n}\r\n/** 删除按钮操作 */\r\nfunction handleDelete(row) {\r\n  const tableIds = row.tableId || ids.value;\r\n  proxy.$modal.confirm('是否确认删除表编号为\"' + tableIds + '\"的数据项？').then(function () {\r\n    return delTable(tableIds);\r\n  }).then(() => {\r\n    getList();\r\n    proxy.$modal.msgSuccess(\"删除成功\");\r\n  }).catch(() => {});\r\n}\r\n\r\n// getList();\r\n</script>\r\n"],"names":["route","useRoute","proxy","getCurrentInstance","tableList","ref","loading","total","dateRange","uniqueId","data","reactive","queryParams","preview","toRefs","onActivated","time","getList","listTable","response"],"mappings":"4NA6JA,MAAMA,EAAQC,EAAQ,EAChB,CAAE,MAAAC,CAAK,EAAKC,IAEZC,EAAYC,EAAI,CAAA,CAAE,EAClBC,EAAUD,EAAI,EAAI,EACLA,EAAI,EAAI,EACfA,EAAI,EAAE,EACHA,EAAI,EAAI,EACNA,EAAI,EAAI,EACzB,MAAME,EAAQF,EAAI,CAAC,EACAA,EAAI,EAAE,EACzB,MAAMG,EAAYH,EAAI,CAAA,CAAE,EAClBI,EAAWJ,EAAI,EAAE,EAEjBK,EAAOC,EAAS,CACpB,YAAa,CACX,QAAS,EACT,SAAU,GACV,UAAW,OACX,aAAc,MACf,EACD,QAAS,CACP,KAAM,GACN,MAAO,OACP,KAAM,CAAE,EACR,WAAY,aACb,CACH,CAAC,EAEK,CAAE,YAAAC,EAAa,QAAAC,CAAO,EAAKC,EAAOJ,CAAI,EAE5CK,EAAY,IAAM,CAChB,MAAMC,EAAOhB,EAAM,MAAM,EACrBgB,GAAQ,MAAQA,GAAQP,EAAS,QACnCA,EAAS,MAAQO,EACjBJ,EAAY,MAAM,QAAU,OAAOZ,EAAM,MAAM,OAAO,EACtDQ,EAAU,MAAQ,GAClBN,EAAM,UAAU,WAAW,EAC3Be,IAEJ,CAAC,EAGD,SAASA,GAAU,CACjBX,EAAQ,MAAQ,GAChBY,EAAUhB,EAAM,aAAaU,EAAY,MAAOJ,EAAU,KAAK,CAAC,EAAE,KAAKW,GAAY,CACjFf,EAAU,MAAQe,EAAS,KAC3BZ,EAAM,MAAQY,EAAS,MACvBb,EAAQ,MAAQ,EACpB,CAAG,CACH"}