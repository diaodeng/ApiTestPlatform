import{d as ce,v as me,r as d,a5 as fe,w as ge,C as be,ab as he,e as c,H as ve,c as N,o as g,I as D,f as t,M as z,l,i as n,O as U,P,j as w,m as A,K as H,n as q,aE as B,k as _e,h as k,y as C,aD as we,L as ye,a7 as Ie}from"./index.DLM0P_FN.js";import{l as Se}from"./case.ClJHBfiF.js";import{s as Ve}from"./module.CsavA2LQ.js";import{l as xe}from"./project.NehpJ71d.js";import{H as Q}from"./enum.BYy-eByp.js";const Ne={class:"app-container"},De={__name:"case-table-query",props:{dataType:{type:Number,default:Q.case},showPagination:{type:Boolean,default:!0},checkedIds:{type:Array,default:[]}},emits:["selectChange"],setup(E,{expose:F,emit:G}){const{proxy:O}=ce(),{qtr_case_status:T}=O.useDict("qtr_case_status"),y=E,J=G;F({handleQuery:v,getSelectedIds:ne});const b=me(()=>y.dataType===Q.case?"用例":"配置");Ie("qtr_case_status",T);const I=d(null),h=d([]),L=d([]),M=d([]);d(!1);const S=d(!0),r=d([]),W=d(!0),X=d(!0),j=d(0);d("");const V=d(!0);d(new Set);const s=fe({pageNum:1,pageSize:10,type:y.dataType,caseId:void 0,caseName:void 0,projectId:void 0,moduleId:void 0,status:void 0,onlySelf:V}),_=d({page:!1,edite:!1,run:!1,copy:!1});function K(o){return o||"全局"}function x(){_.value.page=!0,Se(s.value).then(o=>{h.value=o.rows,j.value=o.total,ye(()=>{r.value&&r.value.length>0&&I.value&&h.value&&h.value.forEach(a=>{r.value.some(u=>u===a.caseId)?I.value.toggleRowSelection(a,!0):I.value.toggleRowSelection(a,!1)})})}).finally(()=>{_.value.page=!1})}function Y(){xe({isPage:!1}).then(o=>{L.value=o.data})}function Z(){Ve(s.value).then(o=>{M.value=o.data})}function ee(){s.value.moduleId=void 0,Z()}function v(){s.value.pageNum=1,x()}function le(){O.resetForm("queryRef"),v()}function ae(o,a){let u=h.value.map(p=>p.caseId),i=o.map(p=>p.caseId),f=u.filter(p=>!i.includes(p));i.forEach(p=>{r.value.some(R=>R===p)||r.value.push(p)}),r.value=r.value.filter(p=>!f.includes(p))}function te(o){J("selectChange",o),W.value=o.length!==1,X.value=!o.length}function oe(o){let a=o.map(u=>u.caseId);if(a&&a.length>0)a.forEach(u=>{r.value.some(i=>i===u)||r.value.push(u)});else{let u=h.value.map(i=>i.caseId);r.value=r.value.filter(i=>!u.includes(i))}}function ne(){return r.value}return ge(()=>y.checkedIds,o=>{console.log("数据变化了")},{deep:!0}),be(()=>{r.value=he(y.checkedIds),Y(),x()}),(o,a)=>{const u=c("el-option"),i=c("el-select"),f=c("el-form-item"),p=c("el-input"),R=c("el-checkbox"),$=c("el-button"),se=c("el-form"),ue=c("right-toolbar"),de=c("el-row"),m=c("el-table-column"),re=c("el-table"),pe=c("pagination"),ie=ve("loading");return g(),N("div",Ne,[D(t(se,{model:l(s),ref:"queryRef",inline:!0},{default:n(()=>[t(f,{label:"所属项目",prop:"projectId"},{default:n(()=>[t(i,{modelValue:l(s).projectId,"onUpdate:modelValue":a[0]||(a[0]=e=>l(s).projectId=e),placeholder:"请选择",onChange:ee,clearable:"",filterable:"",style:{width:"150px"}},{default:n(()=>[(g(!0),N(U,null,P(l(L),e=>(g(),w(u,{key:e.projectId,label:e.projectName,value:e.projectId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(f,{label:"所属模块",prop:"moduleId"},{default:n(()=>[t(i,{modelValue:l(s).moduleId,"onUpdate:modelValue":a[1]||(a[1]=e=>l(s).moduleId=e),placeholder:"请选择",clearable:"",filterable:"",style:{width:"150px"}},{default:n(()=>[(g(!0),N(U,null,P(l(M),e=>(g(),w(u,{key:e.moduleId,label:e.moduleName,value:e.moduleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(f,{label:l(b)+"ID",prop:"caseId"},{default:n(()=>[t(p,{modelValue:l(s).caseId,"onUpdate:modelValue":a[2]||(a[2]=e=>l(s).caseId=e),placeholder:"请输入"+l(b)+"名称",clearable:"",style:{width:"200px"},onKeyup:A(v,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:l(b)+"名称",prop:"caseName"},{default:n(()=>[t(p,{modelValue:l(s).caseName,"onUpdate:modelValue":a[3]||(a[3]=e=>l(s).caseName=e),placeholder:"请输入"+l(b)+"名称",clearable:"",style:{width:"200px"},onKeyup:A(v,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),t(f,{label:"状态",prop:"status"},{default:n(()=>[t(i,{modelValue:l(s).status,"onUpdate:modelValue":a[4]||(a[4]=e=>l(s).status=e),placeholder:l(b)+"状态",clearable:"",style:{width:"100px"}},{default:n(()=>[(g(!0),N(U,null,P(l(T),e=>(g(),w(u,{key:e.value*1,label:e.label,value:e.value*1},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1}),t(f,null,{default:n(()=>[t(R,{modelValue:l(V),"onUpdate:modelValue":a[5]||(a[5]=e=>H(V)?V.value=e:null),onChange:v},{default:n(()=>a[9]||(a[9]=[q("仅自己的数据")])),_:1,__:[9]},8,["modelValue"])]),_:1}),t(f,null,{default:n(()=>[t($,{type:"primary",icon:"Search",onClick:v,loading:l(_).page,disabled:l(_).page},{default:n(()=>a[10]||(a[10]=[q(" 搜索 ")])),_:1,__:[10]},8,["loading","disabled"]),t($,{type:"default",icon:"Refresh",onClick:le},{default:n(()=>a[11]||(a[11]=[q("重置")])),_:1,__:[11]})]),_:1})]),_:1},8,["model"]),[[z,l(S)]]),t(de,{gutter:10,class:"mb8"},{default:n(()=>[B(o.$slots,"table-tool"),t(ue,{showSearch:l(S),"onUpdate:showSearch":a[6]||(a[6]=e=>H(S)?S.value=e:null),onQueryTable:x},null,8,["showSearch"])]),_:3}),D((g(),w(re,{ref_key:"tableRef",ref:I,data:l(h),onSelect:ae,onSelectAll:oe,onSelectionChange:te,border:"","table-layout":"fixed","max-height":"calc(100vh - 280px)"},{default:n(()=>[t(m,{type:"selection",width:"55",align:"center"}),t(m,{label:l(b)+"ID",prop:"caseId",width:"150px"},null,8,["label"]),t(m,{label:l(b)+"名称",prop:"caseName",width:"auto","min-width":"200px"},null,8,["label"]),t(m,{label:"所属项目",prop:"projectName"},{default:n(e=>[k("span",null,C(K(e.row.projectName)),1)]),_:1}),t(m,{label:"所属模块",prop:"moduleName"},{default:n(e=>[k("span",null,C(K(e.row.moduleName)),1)]),_:1}),t(m,{label:"状态",align:"center",prop:"status",width:"120px"},{default:n(e=>[B(o.$slots,"caseStatus",{scope:e},()=>[t(we,{options:l(T),value:e.row.status},null,8,["options","value"])])]),_:3}),t(m,{label:"创建人",align:"center",prop:"createBy",width:"80px"}),t(m,{label:"创建时间",align:"center",prop:"createTime","class-name":"small-padding fixed-width",width:"150px"},{default:n(e=>[k("span",null,C(o.parseTime(e.row.createTime)),1)]),_:1}),t(m,{label:"更新时间",align:"center",prop:"createTime","class-name":"small-padding fixed-width",width:"150px"},{default:n(e=>[k("span",null,C(o.parseTime(e.row.updateTime)),1)]),_:1}),o.$slots.tableOperate?(g(),w(m,{key:0,label:"操作",width:"170",align:"center","class-name":"small-padding fixed-width",fixed:"right"},{default:n(e=>[B(o.$slots,"tableOperate",{scope:e})]),_:3})):_e("",!0)]),_:3},8,["data"])),[[ie,l(_).page]]),D(t(pe,{total:l(j),page:l(s).pageNum,"onUpdate:page":a[7]||(a[7]=e=>l(s).pageNum=e),limit:l(s).pageSize,"onUpdate:limit":a[8]||(a[8]=e=>l(s).pageSize=e),onPagination:x},null,8,["total","page","limit"]),[[z,l(j)>0&&E.showPagination]])])}}};export{De as _};
//# sourceMappingURL=case-table-query.BDMVIWkL.js.map
