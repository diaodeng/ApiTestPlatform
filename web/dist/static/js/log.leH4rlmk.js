import{af as G,r as v,u as me,D as _e,a0 as fe,d as i,J as F,o as c,c as k,I as j,U as M,h as t,e,f as l,k as be,P as Q,a7 as Y,l as h,$ as T,p as u,m as K,z as m,n as O,C as ge,v as ve}from"./index.CHnR_MAu.js";import{g as he}from"./job.BHxHR-_9.js";function je(x){return G({url:"/qtr/jobLog/list",method:"get",params:x})}function we(x){return G({url:"/qtr/jobLog/"+x,method:"delete"})}function ye(){return G({url:"/qtr/jobLog/clean",method:"delete"})}const ke={class:"app-container"},xe={key:0},Ve={key:1},Ce={class:"dialog-footer"},Le=ge({name:"QtrJobLog"}),Te=Object.assign(Le,{setup(x){const{proxy:_}=ve(),{sys_common_status:U,sys_job_group:L,sys_job_executor:A}=_.useDict("sys_common_status","sys_job_group","sys_job_executor"),$=v([]),w=v(!1),N=v(!0),V=v(!0),q=v([]),I=v(!0),D=v(0),y=v([]),R=me(),H=_e({form:{},queryParams:{pageNum:1,pageSize:10,dictName:void 0,dictType:void 0,status:void 0}}),{queryParams:s,form:d,rules:Ne}=fe(H);function b(){N.value=!0,je(_.addDateRange(s.value,y.value)).then(n=>{$.value=n.rows,D.value=n.total,N.value=!1})}function W(n,a){return _.selectDictLabel(L.value,n.jobGroup)}function X(n,a){return _.selectDictLabel(A.value,n.jobExecutor)}function Z(){const n={path:"/hrm/qtr/qtr/job"};_.$tab.closeOpenPage(n)}function S(){s.value.pageNum=1,b()}function ee(){y.value=[],_.resetForm("queryRef"),S()}function le(n){q.value=n.map(a=>a.jobLogId),I.value=!n.length}function te(n){w.value=!0,d.value=n}function oe(n){_.$modal.confirm('是否确认删除调度日志编号为"'+q.value+'"的数据项?').then(function(){return we(q.value)}).then(()=>{b(),_.$modal.msgSuccess("删除成功")}).catch(()=>{})}function ae(){_.$modal.confirm("是否确认清空所有调度日志数据项?").then(function(){return ye()}).then(()=>{b(),_.$modal.msgSuccess("清空成功")}).catch(()=>{})}function ne(){_.download("qtr/jobLog/export",{...s.value},`job_log_${new Date().getTime()}.xlsx`)}return(()=>{const n=R.params&&R.params.jobId;n!==void 0&&n!=0?he(n).then(a=>{s.value.jobName=a.data.jobName,s.value.jobGroup=a.data.jobGroup,b()}):b()})(),b(),(n,a)=>{const ue=i("el-input"),r=i("el-form-item"),P=i("el-option"),J=i("el-select"),re=i("el-date-picker"),g=i("el-button"),z=i("el-form"),p=i("el-col"),se=i("right-toolbar"),B=i("el-row"),f=i("el-table-column"),E=i("dict-tag"),de=i("el-table"),ie=i("pagination"),pe=i("el-dialog"),C=F("hasPermi"),ce=F("loading");return c(),k("div",ke,[j(e(z,{model:t(s),ref:"queryRef",inline:!0,"label-width":"68px"},{default:l(()=>[e(r,{label:"任务名称",prop:"jobName"},{default:l(()=>[e(ue,{modelValue:t(s).jobName,"onUpdate:modelValue":a[0]||(a[0]=o=>t(s).jobName=o),placeholder:"请输入任务名称",clearable:"",style:{width:"240px"},onKeyup:be(S,["enter"])},null,8,["modelValue"])]),_:1}),e(r,{label:"任务组名",prop:"jobGroup"},{default:l(()=>[e(J,{modelValue:t(s).jobGroup,"onUpdate:modelValue":a[1]||(a[1]=o=>t(s).jobGroup=o),placeholder:"请选择任务组名",clearable:"",style:{width:"240px"}},{default:l(()=>[(c(!0),k(Q,null,Y(t(L),o=>(c(),h(P,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"执行状态",prop:"status"},{default:l(()=>[e(J,{modelValue:t(s).status,"onUpdate:modelValue":a[2]||(a[2]=o=>t(s).status=o),placeholder:"请选择执行状态",clearable:"",style:{width:"240px"}},{default:l(()=>[(c(!0),k(Q,null,Y(t(U),o=>(c(),h(P,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(r,{label:"执行时间",style:{width:"308px"}},{default:l(()=>[e(re,{modelValue:t(y),"onUpdate:modelValue":a[3]||(a[3]=o=>T(y)?y.value=o:null),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),e(r,null,{default:l(()=>[e(g,{type:"primary",icon:"Search",onClick:S},{default:l(()=>[u("搜索")]),_:1}),e(g,{icon:"Refresh",onClick:ee},{default:l(()=>[u("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[M,t(V)]]),e(B,{gutter:10,class:"mb8"},{default:l(()=>[e(p,{span:1.5},{default:l(()=>[j((c(),h(g,{type:"danger",plain:"",icon:"Delete",disabled:t(I),onClick:oe},{default:l(()=>[u("删除")]),_:1},8,["disabled"])),[[C,["qtr:job:remove"]]])]),_:1}),e(p,{span:1.5},{default:l(()=>[j((c(),h(g,{type:"danger",plain:"",icon:"Delete",onClick:ae},{default:l(()=>[u("清空")]),_:1})),[[C,["qtr:job:remove"]]])]),_:1}),e(p,{span:1.5},{default:l(()=>[j((c(),h(g,{type:"warning",plain:"",icon:"Download",onClick:ne},{default:l(()=>[u("导出")]),_:1})),[[C,["qtr:job:export"]]])]),_:1}),e(p,{span:1.5},{default:l(()=>[e(g,{type:"warning",plain:"",icon:"Close",onClick:Z},{default:l(()=>[u("关闭")]),_:1})]),_:1}),e(se,{showSearch:t(V),"onUpdate:showSearch":a[4]||(a[4]=o=>T(V)?V.value=o:null),onQueryTable:b},null,8,["showSearch"])]),_:1}),j((c(),h(de,{data:t($),onSelectionChange:le},{default:l(()=>[e(f,{type:"selection",width:"55",align:"center"}),e(f,{label:"日志编号",width:"80",align:"center",prop:"jobLogId"}),e(f,{label:"任务名称",align:"center",prop:"jobName","show-overflow-tooltip":!0}),e(f,{label:"任务组名",align:"center",prop:"jobGroup","show-overflow-tooltip":!0},{default:l(o=>[e(E,{options:t(L),value:o.row.jobGroup},null,8,["options","value"])]),_:1}),e(f,{label:"调用目标字符串",align:"center",prop:"invokeTarget","show-overflow-tooltip":!0}),e(f,{label:"日志信息",align:"center",prop:"jobMessage","show-overflow-tooltip":!0}),e(f,{label:"执行状态",align:"center",prop:"status"},{default:l(o=>[e(E,{options:t(U),value:o.row.status},null,8,["options","value"])]),_:1}),e(f,{label:"执行时间",align:"center",prop:"createTime",width:"180"},{default:l(o=>[K("span",null,m(n.parseTime(o.row.createTime)),1)]),_:1}),e(f,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:l(o=>[j((c(),h(g,{link:"",type:"primary",icon:"View",onClick:qe=>te(o.row)},{default:l(()=>[u("详细")]),_:2},1032,["onClick"])),[[C,["qtr:job:query"]]])]),_:1})]),_:1},8,["data"])),[[ce,t(N)]]),j(e(ie,{total:t(D),page:t(s).pageNum,"onUpdate:page":a[5]||(a[5]=o=>t(s).pageNum=o),limit:t(s).pageSize,"onUpdate:limit":a[6]||(a[6]=o=>t(s).pageSize=o),onPagination:b},null,8,["total","page","limit"]),[[M,t(D)>0]]),e(pe,{title:"调度日志详细",modelValue:t(w),"onUpdate:modelValue":a[8]||(a[8]=o=>T(w)?w.value=o:null),width:"700px","append-to-body":""},{footer:l(()=>[K("div",Ce,[e(g,{onClick:a[7]||(a[7]=o=>w.value=!1)},{default:l(()=>[u("关 闭")]),_:1})])]),default:l(()=>[e(z,{model:t(d),"label-width":"100px"},{default:l(()=>[e(B,null,{default:l(()=>[e(p,{span:12},{default:l(()=>[e(r,{label:"日志序号："},{default:l(()=>[u(m(t(d).jobLogId),1)]),_:1}),e(r,{label:"任务名称："},{default:l(()=>[u(m(t(d).jobName),1)]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(r,{label:"任务分组："},{default:l(()=>[u(m(W(t(d))),1)]),_:1}),e(r,{label:"执行时间："},{default:l(()=>[u(m(n.parseTime(t(d).createTime)),1)]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(r,{label:"任务执行器："},{default:l(()=>[u(m(X(t(d))),1)]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(r,{label:"任务触发器："},{default:l(()=>[u(m(t(d).jobTrigger),1)]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(r,{label:"调用方法："},{default:l(()=>[u(m(t(d).invokeTarget),1)]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(r,{label:"位置参数："},{default:l(()=>[u(m(t(d).jobArgs),1)]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(r,{label:"关键字参数："},{default:l(()=>[u(m(t(d).jobKwargs),1)]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(r,{label:"日志信息："},{default:l(()=>[u(m(t(d).jobMessage),1)]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(r,{label:"执行状态："},{default:l(()=>[t(d).status==0?(c(),k("div",xe,"正常")):t(d).status==1?(c(),k("div",Ve,"失败")):O("",!0)]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[t(d).status==1?(c(),h(r,{key:0,label:"异常信息："},{default:l(()=>[u(m(t(d).exceptionInfo),1)]),_:1})):O("",!0)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{Te as default};
