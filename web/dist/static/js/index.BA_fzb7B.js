import{a as Ae,r as v,D as te,aT as Qe,J as je,w as Ge,d,B as ae,o as u,c as S,e as t,f as a,i as h,h as o,G as K,C as k,l as oe,K as T,L as D,m as r,p as g,I as ne,n as y,y as se,F as He,s as Je}from"./index.D1UU-JKR.js";import{e as We,l as Xe,f as Ze,h as el,r as ll,i as ue,j as tl,k as al}from"./user.Ds6AURlk.js";const ol={class:"app-container"},nl={class:"head-container"},sl={class:"head-container"},ul={class:"dialog-footer"},dl={class:"el-upload__tip text-center"},rl={class:"el-upload__tip"},il={class:"dialog-footer"},pl=He({name:"User"}),vl=Object.assign(pl,{setup(ml){const de=Ae(),{proxy:i}=Je(),{sys_normal_disable:G,sys_user_sex:re}=i.useDict("sys_normal_disable","sys_user_sex"),H=v([]),x=v(!1),O=v(!0),P=v(!0),z=v([]),J=v(!0),W=v(!0),E=v(0),M=v(""),$=v([]),F=v(""),Y=v(void 0),ie=v(void 0),A=v([]),Q=v([]),_=te({open:!1,title:"",isUploading:!1,updateSupport:0,headers:{Authorization:"Bearer "+Qe()},url:"https://testautoapi.rta-os.com//system/user/importData"}),I=v([{key:0,label:"用户编号",visible:!0},{key:1,label:"用户名称",visible:!0},{key:2,label:"用户昵称",visible:!0},{key:3,label:"部门",visible:!0},{key:4,label:"手机号码",visible:!0},{key:5,label:"状态",visible:!0},{key:6,label:"创建时间",visible:!0}]),pe=te({form:{},queryParams:{pageNum:1,pageSize:10,userName:void 0,phonenumber:void 0,status:void 0,deptId:void 0},rules:{userName:[{required:!0,message:"用户名称不能为空",trigger:"blur"},{min:2,max:20,message:"用户名称长度必须介于 2 和 20 之间",trigger:"blur"}],nickName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],password:[{required:!0,message:"用户密码不能为空",trigger:"blur"},{min:5,max:20,message:"用户密码长度必须介于 5 和 20 之间",trigger:"blur"}],email:[{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}],phonenumber:[{pattern:/^1[3|4|5|6|7|8|9][0-9]\d{8}$/,message:"请输入正确的手机号码",trigger:"blur"}]}}),{queryParams:f,form:s,rules:me}=je(pe),fe=(n,e)=>n?e.label.indexOf(n)!==-1:!0;Ge(F,n=>{i.$refs.deptTreeRef.filter(n)});function ce(){We().then(n=>{Y.value=n.data})}function U(){O.value=!0,Xe(i.addDateRange(f.value,$.value)).then(n=>{O.value=!1,H.value=n.rows,E.value=n.total})}function ve(n){f.value.deptId=n.id,R()}function R(){f.value.pageNum=1,U()}function _e(){$.value=[],i.resetForm("queryRef"),f.value.deptId=void 0,i.$refs.deptTreeRef.setCurrentKey(null),R()}function X(n){const e=n.userId||z.value;i.$modal.confirm('是否确认删除用户编号为"'+e+'"的数据项？').then(function(){return Ze(e)}).then(()=>{U(),i.$modal.msgSuccess("删除成功")}).catch(()=>{})}function be(){i.download("system/user/export",{...f.value},`user_${new Date().getTime()}.xlsx`)}function ge(n){let e=n.status==="0"?"启用":"停用";i.$modal.confirm('确认要"'+e+'""'+n.userName+'"用户吗?').then(function(){return el(n.userId,n.status)}).then(()=>{i.$modal.msgSuccess(e+"成功")}).catch(function(){n.status=n.status==="0"?"1":"0"})}function ye(n){const e=n.userId;de.push("/system/user-auth/role/"+e)}function ke(n){i.$prompt('请输入"'+n.userName+'"的新密码',"提示",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,inputPattern:/^.{5,20}$/,inputErrorMessage:"用户密码长度必须介于 5 和 20 之间"}).then(({value:e})=>{ll(n.userId,e).then(p=>{i.$modal.msgSuccess("修改成功，新密码是："+e)})}).catch(()=>{})}function he(n){z.value=n.map(e=>e.userId),J.value=n.length!=1,W.value=!n.length}function Ve(){_.title="用户导入",_.open=!0}function we(){i.download("system/user/importTemplate",{},`user_template_${new Date().getTime()}.xlsx`)}const xe=(n,e,p)=>{_.isUploading=!0},Ie=(n,e,p)=>{_.open=!1,_.isUploading=!1,i.$refs.uploadRef.handleRemove(e),i.$alert("<div style='overflow: auto;overflow-x: hidden;max-height: 70vh;padding: 10px 20px 0;'>"+n.msg+"</div>","导入结果",{dangerouslyUseHTMLString:!0}),U()};function Ue(){i.$refs.uploadRef.submit()}function j(){s.value={userId:void 0,deptId:void 0,userName:void 0,nickName:void 0,password:void 0,phonenumber:void 0,email:void 0,sex:void 0,status:"0",remark:void 0,postIds:[],roleIds:[]},i.resetForm("userRef")}function Ce(){x.value=!1,j()}function Ne(){j(),ue().then(n=>{A.value=n.posts,Q.value=n.roles,x.value=!0,M.value="添加用户",s.value.password=ie.value})}function Z(n){j();const e=n.userId||z.value;ue(e).then(p=>{s.value=p.data,A.value=p.posts,Q.value=p.roles,s.value.postIds=p.postIds,s.value.roleIds=p.roleIds,x.value=!0,M.value="修改用户",s.password=""})}function Se(){i.$refs.userRef.validate(n=>{n&&(s.value.userId!=null?tl(s.value).then(e=>{i.$modal.msgSuccess("修改成功"),x.value=!1,U()}):al(s.value).then(e=>{i.$modal.msgSuccess("新增成功"),x.value=!1,U()}))})}return ce(),U(),(n,e)=>{const p=d("el-input"),$e=d("el-tree"),m=d("el-col"),c=d("el-form-item"),B=d("el-option"),q=d("el-select"),Re=d("el-date-picker"),b=d("el-button"),ee=d("el-form"),Te=d("right-toolbar"),C=d("el-row"),V=d("el-table-column"),De=d("el-switch"),L=d("el-tooltip"),Pe=d("el-table"),Fe=d("pagination"),Be=d("el-tree-select"),qe=d("el-radio"),Le=d("el-radio-group"),le=d("el-dialog"),Ke=d("upload-filled"),Oe=d("el-icon"),ze=d("el-checkbox"),Ee=d("el-link"),Me=d("el-upload"),w=ae("hasPermi"),Ye=ae("loading");return u(),S("div",ol,[t(C,{gutter:20},{default:a(()=>[t(m,{span:4,xs:24},{default:a(()=>[h("div",nl,[t(p,{modelValue:o(F),"onUpdate:modelValue":e[0]||(e[0]=l=>K(F)?F.value=l:null),placeholder:"请输入部门名称",clearable:"","prefix-icon":"Search",style:{"margin-bottom":"20px"}},null,8,["modelValue"])]),h("div",sl,[t($e,{data:o(Y),props:{label:"label",children:"children"},"expand-on-click-node":!1,"filter-node-method":fe,ref:"deptTreeRef","node-key":"id","highlight-current":"","default-expand-all":"",onNodeClick:ve},null,8,["data"])])]),_:1}),t(m,{span:20,xs:24},{default:a(()=>[k(t(ee,{model:o(f),ref:"queryRef",inline:!0,"label-width":"68px"},{default:a(()=>[t(c,{label:"用户名称",prop:"userName"},{default:a(()=>[t(p,{modelValue:o(f).userName,"onUpdate:modelValue":e[1]||(e[1]=l=>o(f).userName=l),placeholder:"请输入用户名称",clearable:"",style:{width:"240px"},onKeyup:oe(R,["enter"])},null,8,["modelValue"])]),_:1}),t(c,{label:"手机号码",prop:"phonenumber"},{default:a(()=>[t(p,{modelValue:o(f).phonenumber,"onUpdate:modelValue":e[2]||(e[2]=l=>o(f).phonenumber=l),placeholder:"请输入手机号码",clearable:"",style:{width:"240px"},onKeyup:oe(R,["enter"])},null,8,["modelValue"])]),_:1}),t(c,{label:"状态",prop:"status"},{default:a(()=>[t(q,{modelValue:o(f).status,"onUpdate:modelValue":e[3]||(e[3]=l=>o(f).status=l),placeholder:"用户状态",clearable:"",style:{width:"240px"}},{default:a(()=>[(u(!0),S(T,null,D(o(G),l=>(u(),r(B,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"创建时间",style:{width:"308px"}},{default:a(()=>[t(Re,{modelValue:o($),"onUpdate:modelValue":e[4]||(e[4]=l=>K($)?$.value=l:null),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),t(c,null,{default:a(()=>[t(b,{type:"primary",icon:"Search",onClick:R},{default:a(()=>e[23]||(e[23]=[g("搜索")])),_:1}),t(b,{icon:"Refresh",onClick:_e},{default:a(()=>e[24]||(e[24]=[g("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[ne,o(P)]]),t(C,{gutter:10,class:"mb8"},{default:a(()=>[t(m,{span:1.5},{default:a(()=>[k((u(),r(b,{type:"primary",plain:"",icon:"Plus",onClick:Ne},{default:a(()=>e[25]||(e[25]=[g("新增")])),_:1})),[[w,["system:user:add"]]])]),_:1}),t(m,{span:1.5},{default:a(()=>[k((u(),r(b,{type:"success",plain:"",icon:"Edit",disabled:o(J),onClick:Z},{default:a(()=>e[26]||(e[26]=[g("修改")])),_:1},8,["disabled"])),[[w,["system:user:edit"]]])]),_:1}),t(m,{span:1.5},{default:a(()=>[k((u(),r(b,{type:"danger",plain:"",icon:"Delete",disabled:o(W),onClick:X},{default:a(()=>e[27]||(e[27]=[g("删除")])),_:1},8,["disabled"])),[[w,["system:user:remove"]]])]),_:1}),t(m,{span:1.5},{default:a(()=>[k((u(),r(b,{type:"info",plain:"",icon:"Upload",onClick:Ve},{default:a(()=>e[28]||(e[28]=[g("导入")])),_:1})),[[w,["system:user:import"]]])]),_:1}),t(m,{span:1.5},{default:a(()=>[k((u(),r(b,{type:"warning",plain:"",icon:"Download",onClick:be},{default:a(()=>e[29]||(e[29]=[g("导出")])),_:1})),[[w,["system:user:export"]]])]),_:1}),t(Te,{showSearch:o(P),"onUpdate:showSearch":e[5]||(e[5]=l=>K(P)?P.value=l:null),onQueryTable:U,columns:o(I)},null,8,["showSearch","columns"])]),_:1}),k((u(),r(Pe,{data:o(H),onSelectionChange:he},{default:a(()=>[t(V,{type:"selection",width:"50",align:"center"}),o(I)[0].visible?(u(),r(V,{label:"用户编号",align:"center",key:"userId",prop:"userId"})):y("",!0),o(I)[1].visible?(u(),r(V,{label:"用户名称",align:"center",key:"userName",prop:"userName","show-overflow-tooltip":!0})):y("",!0),o(I)[2].visible?(u(),r(V,{label:"用户昵称",align:"center",key:"nickName",prop:"nickName","show-overflow-tooltip":!0})):y("",!0),o(I)[3].visible?(u(),r(V,{label:"部门",align:"center",key:"deptName",prop:"dept.deptName","show-overflow-tooltip":!0})):y("",!0),o(I)[4].visible?(u(),r(V,{label:"手机号码",align:"center",key:"phonenumber",prop:"phonenumber",width:"120"})):y("",!0),o(I)[5].visible?(u(),r(V,{label:"状态",align:"center",key:"status"},{default:a(l=>[t(De,{modelValue:l.row.status,"onUpdate:modelValue":N=>l.row.status=N,"active-value":"0","inactive-value":"1",onChange:N=>ge(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})):y("",!0),o(I)[6].visible?(u(),r(V,{key:6,label:"创建时间",align:"center",prop:"createTime",width:"160"},{default:a(l=>[h("span",null,se(n.parseTime(l.row.createTime)),1)]),_:1})):y("",!0),t(V,{label:"操作",align:"center",width:"150","class-name":"small-padding fixed-width"},{default:a(l=>[l.row.userId!==1?(u(),r(L,{key:0,content:"修改",placement:"top"},{default:a(()=>[k(t(b,{link:"",type:"primary",icon:"Edit",onClick:N=>Z(l.row)},null,8,["onClick"]),[[w,["system:user:edit"]]])]),_:2},1024)):y("",!0),l.row.userId!==1?(u(),r(L,{key:1,content:"删除",placement:"top"},{default:a(()=>[k(t(b,{link:"",type:"primary",icon:"Delete",onClick:N=>X(l.row)},null,8,["onClick"]),[[w,["system:user:remove"]]])]),_:2},1024)):y("",!0),l.row.userId!==1?(u(),r(L,{key:2,content:"重置密码",placement:"top"},{default:a(()=>[k(t(b,{link:"",type:"primary",icon:"Key",onClick:N=>ke(l.row)},null,8,["onClick"]),[[w,["system:user:resetPwd"]]])]),_:2},1024)):y("",!0),l.row.userId!==1?(u(),r(L,{key:3,content:"分配角色",placement:"top"},{default:a(()=>[k(t(b,{link:"",type:"primary",icon:"CircleCheck",onClick:N=>ye(l.row)},null,8,["onClick"]),[[w,["system:user:edit"]]])]),_:2},1024)):y("",!0)]),_:1})]),_:1},8,["data"])),[[Ye,o(O)]]),k(t(Fe,{total:o(E),page:o(f).pageNum,"onUpdate:page":e[6]||(e[6]=l=>o(f).pageNum=l),limit:o(f).pageSize,"onUpdate:limit":e[7]||(e[7]=l=>o(f).pageSize=l),onPagination:U},null,8,["total","page","limit"]),[[ne,o(E)>0]])]),_:1})]),_:1}),t(le,{title:o(M),modelValue:o(x),"onUpdate:modelValue":e[19]||(e[19]=l=>K(x)?x.value=l:null),width:"600px","append-to-body":""},{footer:a(()=>[h("div",ul,[t(b,{type:"primary",onClick:Se},{default:a(()=>e[30]||(e[30]=[g("确 定")])),_:1}),t(b,{onClick:Ce},{default:a(()=>e[31]||(e[31]=[g("取 消")])),_:1})])]),default:a(()=>[t(ee,{model:o(s),rules:o(me),ref:"userRef","label-width":"80px"},{default:a(()=>[t(C,null,{default:a(()=>[t(m,{span:12},{default:a(()=>[t(c,{label:"用户昵称",prop:"nickName"},{default:a(()=>[t(p,{modelValue:o(s).nickName,"onUpdate:modelValue":e[8]||(e[8]=l=>o(s).nickName=l),placeholder:"请输入用户昵称",maxlength:"30"},null,8,["modelValue"])]),_:1})]),_:1}),t(m,{span:12},{default:a(()=>[t(c,{label:"归属部门",prop:"deptId"},{default:a(()=>[t(Be,{modelValue:o(s).deptId,"onUpdate:modelValue":e[9]||(e[9]=l=>o(s).deptId=l),data:o(Y),props:{value:"id",label:"label",children:"children"},"value-key":"id",placeholder:"请选择归属部门","check-strictly":""},null,8,["modelValue","data"])]),_:1})]),_:1})]),_:1}),t(C,null,{default:a(()=>[t(m,{span:12},{default:a(()=>[t(c,{label:"手机号码",prop:"phonenumber"},{default:a(()=>[t(p,{modelValue:o(s).phonenumber,"onUpdate:modelValue":e[10]||(e[10]=l=>o(s).phonenumber=l),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])]),_:1})]),_:1}),t(m,{span:12},{default:a(()=>[t(c,{label:"邮箱",prop:"email"},{default:a(()=>[t(p,{modelValue:o(s).email,"onUpdate:modelValue":e[11]||(e[11]=l=>o(s).email=l),placeholder:"请输入邮箱",maxlength:"50"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(C,null,{default:a(()=>[t(m,{span:12},{default:a(()=>[o(s).userId==null?(u(),r(c,{key:0,label:"用户名称",prop:"userName"},{default:a(()=>[t(p,{modelValue:o(s).userName,"onUpdate:modelValue":e[12]||(e[12]=l=>o(s).userName=l),placeholder:"请输入用户名称",maxlength:"30"},null,8,["modelValue"])]),_:1})):y("",!0)]),_:1}),t(m,{span:12},{default:a(()=>[o(s).userId==null?(u(),r(c,{key:0,label:"用户密码",prop:"password"},{default:a(()=>[t(p,{modelValue:o(s).password,"onUpdate:modelValue":e[13]||(e[13]=l=>o(s).password=l),placeholder:"请输入用户密码",type:"password",maxlength:"20","show-password":""},null,8,["modelValue"])]),_:1})):y("",!0)]),_:1})]),_:1}),t(C,null,{default:a(()=>[t(m,{span:12},{default:a(()=>[t(c,{label:"用户性别"},{default:a(()=>[t(q,{modelValue:o(s).sex,"onUpdate:modelValue":e[14]||(e[14]=l=>o(s).sex=l),placeholder:"请选择"},{default:a(()=>[(u(!0),S(T,null,D(o(re),l=>(u(),r(B,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(m,{span:12},{default:a(()=>[t(c,{label:"状态"},{default:a(()=>[t(Le,{modelValue:o(s).status,"onUpdate:modelValue":e[15]||(e[15]=l=>o(s).status=l)},{default:a(()=>[(u(!0),S(T,null,D(o(G),l=>(u(),r(qe,{key:l.value,label:l.value},{default:a(()=>[g(se(l.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(C,null,{default:a(()=>[t(m,{span:12},{default:a(()=>[t(c,{label:"岗位"},{default:a(()=>[t(q,{modelValue:o(s).postIds,"onUpdate:modelValue":e[16]||(e[16]=l=>o(s).postIds=l),multiple:"",placeholder:"请选择"},{default:a(()=>[(u(!0),S(T,null,D(o(A),l=>(u(),r(B,{key:l.postId,label:l.postName,value:l.postId,disabled:l.status==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(m,{span:12},{default:a(()=>[t(c,{label:"角色"},{default:a(()=>[t(q,{modelValue:o(s).roleIds,"onUpdate:modelValue":e[17]||(e[17]=l=>o(s).roleIds=l),multiple:"",placeholder:"请选择"},{default:a(()=>[(u(!0),S(T,null,D(o(Q),l=>(u(),r(B,{key:l.roleId,label:l.roleName,value:l.roleId,disabled:l.status==1},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(C,null,{default:a(()=>[t(m,{span:24},{default:a(()=>[t(c,{label:"备注"},{default:a(()=>[t(p,{modelValue:o(s).remark,"onUpdate:modelValue":e[18]||(e[18]=l=>o(s).remark=l),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),t(le,{title:o(_).title,modelValue:o(_).open,"onUpdate:modelValue":e[22]||(e[22]=l=>o(_).open=l),width:"400px","append-to-body":""},{footer:a(()=>[h("div",il,[t(b,{type:"primary",onClick:Ue},{default:a(()=>e[36]||(e[36]=[g("确 定")])),_:1}),t(b,{onClick:e[21]||(e[21]=l=>o(_).open=!1)},{default:a(()=>e[37]||(e[37]=[g("取 消")])),_:1})])]),default:a(()=>[t(Me,{ref:"uploadRef",limit:1,accept:".xlsx, .xls",headers:o(_).headers,action:o(_).url+"?updateSupport="+o(_).updateSupport,disabled:o(_).isUploading,"on-progress":xe,"on-success":Ie,"auto-upload":!1,drag:""},{tip:a(()=>[h("div",dl,[h("div",rl,[t(ze,{modelValue:o(_).updateSupport,"onUpdate:modelValue":e[20]||(e[20]=l=>o(_).updateSupport=l)},null,8,["modelValue"]),e[32]||(e[32]=g("是否更新已经存在的用户数据 "))]),e[34]||(e[34]=h("span",null,"仅允许导入xls、xlsx格式文件。",-1)),t(Ee,{type:"primary",underline:!1,style:{"font-size":"12px","vertical-align":"baseline"},onClick:we},{default:a(()=>e[33]||(e[33]=[g("下载模板")])),_:1})])]),default:a(()=>[t(Oe,{class:"el-icon--upload"},{default:a(()=>[t(Ke)]),_:1}),e[35]||(e[35]=h("div",{class:"el-upload__text"},[g("将文件拖到此处，或"),h("em",null,"点击上传")],-1))]),_:1},8,["headers","action","disabled"])]),_:1},8,["title","modelValue"])])}}});export{vl as default};
