{"version":3,"file":"index.DfOPgvVm.js","sources":["../../../src/views/hrm/case/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <CaseTableQuery @select-change=\"handleSelectionChange\" :data-type=\"dataType\" ref=\"caseQueryViewRef\">\r\n      <template #table-tool>\r\n        <el-col :span=\"1.5\">\r\n          <el-button\r\n              type=\"primary\"\r\n              plain\r\n              icon=\"Plus\"\r\n              @click=\"handleAdd\"\r\n              v-hasPermi=\"['hrm:case:add']\"\r\n          >新增\r\n          </el-button>\r\n        </el-col>\r\n        <el-col :span=\"1.5\">\r\n          <el-button\r\n              type=\"success\"\r\n              plain\r\n              icon=\"Edit\"\r\n              :disabled=\"single\"\r\n              @click=\"handleUpdate\"\r\n              v-hasPermi=\"['hrm:case:edit']\"\r\n          >修改\r\n          </el-button>\r\n        </el-col>\r\n        <el-col :span=\"1.5\">\r\n          <el-button\r\n              type=\"danger\"\r\n              plain\r\n              icon=\"Delete\"\r\n              :disabled=\"multiple\"\r\n              @click=\"handleDelete\"\r\n              v-hasPermi=\"['hrm:case:remove']\"\r\n          >删除\r\n          </el-button>\r\n        </el-col>\r\n        <el-col :span=\"1.5\">\r\n          <el-button\r\n              type=\"warning\"\r\n              plain\r\n              icon=\"Download\"\r\n              @click=\"handleExport\"\r\n              v-hasPermi=\"['hrm:case:export']\"\r\n          >导出\r\n          </el-button>\r\n        </el-col>\r\n        <el-col :span=\"1.5\">\r\n          <el-button type=\"warning\"\r\n                     icon=\"CaretRight\"\r\n                     @click=\"runTest\"\r\n                     v-hasPermi=\"['hrm:case:run']\"\r\n                     title=\"运行\"\r\n                     v-if=\"dataType === HrmDataTypeEnum.case\"\r\n                     :disabled=\"multiple\"\r\n          >\r\n            执行\r\n          </el-button>\r\n        </el-col>\r\n      </template>\r\n      <template #caseStatus=\"{scope}\">\r\n        <TagSelector v-model:selected-value=\"scope.row.status\"\r\n                     :options=\"qtr_case_status\"\r\n                     selector-width=\"90px\"\r\n                     :source-data=\"scope.row\"\r\n                     @selectChanged=\"lineStatusChange\"\r\n        ></TagSelector>\r\n      </template>\r\n      <template #tableOperate=\"{scope}\">\r\n        <el-button link type=\"primary\" icon=\"Histogram\" @click=\"showHistory(scope.row)\"\r\n                   v-hasPermi=\"['hrm:case:history']\"\r\n                   title=\"执行历史\" v-if=\"dataType === HrmDataTypeEnum.case\">\r\n        </el-button>\r\n        <el-button link type=\"warning\" icon=\"Edit\" :loading=\"loading.edite\" @click=\"handleUpdate(scope.row)\"\r\n                   v-hasPermi=\"['hrm:case:edit']\" title=\"编辑\">\r\n        </el-button>\r\n        <el-button link type=\"warning\" icon=\"CaretRight\" :loading=\"loading.run\" @click=\"runTest(scope.row)\"\r\n                   v-hasPermi=\"['hrm:case:run']\" title=\"运行\" v-if=\"dataType === HrmDataTypeEnum.case\">\r\n        </el-button>\r\n        <el-button link type=\"warning\" icon=\"CopyDocument\" :loading=\"loading.copy\" @click=\"showCopyDialog(scope.row)\"\r\n                   v-hasPermi=\"['hrm:case:copy']\" title=\"复制\">\r\n        </el-button>\r\n        <el-button link type=\"danger\" icon=\"Delete\" @click=\"handleDelete(scope.row)\"\r\n                   v-hasPermi=\"['hrm:case:remove']\" title=\"删除\">\r\n        </el-button>\r\n      </template>\r\n    </CaseTableQuery>\r\n\r\n    <!-- 添加或修改用例对话框 -->\r\n    <CaseEditDialog :form-datas=\"form\"\r\n                    :data-type=\"dataType\"\r\n                    :form-rules=\"formRules\"\r\n                    v-model:open-case-edit-dialog=\"open\"\r\n                    :title=caseEditDialogTitle\r\n\r\n    ></CaseEditDialog>\r\n\r\n    <!-- 用例执行历史对话框 -->\r\n    <el-dialog fullscreen :title=\"'【' + currentCaseInfo?.caseId + '】' + currentCaseInfo?.caseName\"\r\n               v-model=\"showHistoryDialog\" append-to-body\r\n               v-if=\"dataType===HrmDataTypeEnum.case\" destroy-on-close>\r\n      <el-container style=\"height: 100%\">\r\n        <!--          <el-header height=\"20px\" border=\"2px\" style=\"border-bottom-color: #97a8be;text-align: right\">-->\r\n        <!--          </el-header>-->\r\n        <el-main style=\"max-height: calc(100vh - 95px);\">\r\n          <RunDetail :run-id=\"currentRunId\" :view-type=\"runDetailViewTypeEnum.case\"></RunDetail>\r\n        </el-main>\r\n      </el-container>\r\n    </el-dialog>\r\n\r\n    <!-- 复制用例对话框 -->\r\n    <el-dialog :title=\"copyCaseInfo?.caseName\" v-model=\"copyDialog\" append-to-body destroy-on-close>\r\n      <el-container style=\"height: 100%\">\r\n        <!--          <el-header height=\"20px\" border=\"2px\" style=\"border-bottom-color: #97a8be;text-align: right\">-->\r\n        <!--          </el-header>-->\r\n        <el-main style=\"max-height: calc(100vh - 95px);\">\r\n          <el-input placeholder=\"请输入用例名称\" v-model=\"copyCaseInfo.caseName\">\r\n            <template #suffix>\r\n              <el-button @click=\"copyCaseHandle\">保存</el-button>\r\n            </template>\r\n          </el-input>\r\n        </el-main>\r\n      </el-container>\r\n    </el-dialog>\r\n\r\n    <!-- 运行用例对话框 -->\r\n    <RunDialog v-model:dialog-visible=\"runDialogShow\" :run-type=\"RunTypeEnum.case\" :run-ids=\"runIds\"></RunDialog>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {changeCaseStatus, copyCase, delCase, getCase, listCase} from \"@/api/hrm/case\";\r\nimport TagSelector from \"@/components/hrm/common/tag-selector.vue\";\r\nimport CaseEditDialog from \"@/components/hrm/case/case-edit-dialog.vue\"\r\nimport {initCaseFormData} from \"@/components/hrm/data-template.js\";\r\nimport RunDetail from '@/components/hrm/common/run/run-detail.vue';\r\nimport RunDialog from '@/components/hrm/common/run/run_dialog.vue';\r\nimport {HrmDataTypeEnum, runDetailViewTypeEnum, RunTypeEnum} from \"@/components/hrm/enum.js\";\r\nimport {ElMessage, ElMessageBox} from \"element-plus\";\r\nimport CaseTableQuery from \"@/components/hrm/util-data-table/case-table-query.vue\";\r\n// import JsonEditorVue from \"json-editor-vue3\";\r\n\r\nconst {proxy} = getCurrentInstance();\r\nconst {sys_normal_disable} = proxy.useDict(\"sys_normal_disable\");\r\nconst {hrm_data_type} = proxy.useDict(\"hrm_data_type\");\r\nconst {qtr_case_status} = proxy.useDict(\"qtr_case_status\");\r\n\r\nconst props = defineProps({\r\n  dataType: {type: Number, default: HrmDataTypeEnum.case},\r\n  formRules: {\r\n    type: Object,\r\n    default: {\r\n      caseName: [{required: true, message: \"用例名称不能为空\", trigger: \"blur\"}],\r\n      projectId: [{required: true, message: \"所属项目不能为空\", trigger: \"blur\"}],\r\n      moduleId: [{required: true, message: \"所属模块不能为空\", trigger: \"blur\"}]\r\n    }\r\n  }\r\n});\r\n\r\nconst dataName = computed(() => {\r\n  return props.dataType === HrmDataTypeEnum.case ? \"用例\" : \"配置\";\r\n});\r\n\r\nprovide(\"hrm_data_type\", hrm_data_type);\r\nprovide('sys_normal_disable', sys_normal_disable);\r\nprovide('qtr_case_status', qtr_case_status);\r\n\r\nconst caseQueryViewRef = ref(null);\r\nconst projectOptions = ref([]);\r\nconst open = ref(false);\r\n// const loading = ref(true);\r\nconst showSearch = ref(true);\r\nconst selectIds = ref([]);\r\nconst single = ref(true);\r\nconst multiple = ref(true);\r\nconst total = ref(0);\r\nconst title = ref(\"\");\r\nconst onlySelf = ref(true);\r\n\r\nconst runDialogShow = ref(false);\r\nconst runIds = ref([]);\r\n\r\nconst showHistoryDialog = ref(false);\r\nconst currentCaseInfo = ref(null);\r\nconst currentRunId = ref();\r\n\r\nconst copyDialog = ref(false);\r\nconst copyCaseInfo = ref(initCaseFormData);\r\n\r\nconst queryParams = toRef({\r\n  pageNum: 1,\r\n  pageSize: 10,\r\n  type: props.dataType,\r\n  caseId: undefined,\r\n  caseName: undefined,\r\n  projectId: undefined,\r\n  moduleId: undefined,\r\n  status: undefined,\r\n  onlySelf: onlySelf\r\n});\r\n\r\nconst form = ref(initCaseFormData);\r\nconst loading = ref({\r\n  page: false,\r\n  edite: false,\r\n  run: false,\r\n  copy: false\r\n});\r\n\r\nconst caseEditDialogTitle = computed(() => {\r\n  const caseId = form.value.caseId ? '【' + form.value.caseId + '】' : \"\";\r\n  return title.value + '>> ' + caseId + form.value.caseName;\r\n});\r\n\r\nfunction lineStatusChange(selectValue, dataSource) {\r\n  changeCaseStatus({caseId: dataSource.caseId, status: selectValue}).then((response) => {\r\n    ElMessage.success(\"修改成功\");\r\n  }).catch(() => {\r\n    ElMessage.error(\"修改失败\");\r\n  });\r\n}\r\n\r\n/*\r\n* 行执行用例\r\n* **/\r\nfunction runTest(row) {\r\n  if (row && \"caseId\" in row && row.caseId) {\r\n    runIds.value = [row.caseId];\r\n  }else {\r\n    runIds.value = selectIds.value;\r\n  }\r\n\r\n  if (!runIds.value || runIds.value.length === 0) {\r\n    ElMessageBox.alert('请选择要运行的用例', \"提示！\", {type: \"warning\"});\r\n    return;\r\n  }\r\n  runDialogShow.value = true;\r\n}\r\n\r\n/*\r\n* 换起用例复制弹窗\r\n* */\r\nfunction showCopyDialog(data) {\r\n  copyDialog.value = true;\r\n  copyCaseInfo.value = structuredClone(toValue(toRaw(data)));\r\n}\r\n\r\n/*\r\n* 复制用例\r\n* */\r\nfunction copyCaseHandle() {\r\n  copyDialog.value = true;\r\n  let data = {\r\n    caseId: copyCaseInfo.value.caseId,\r\n    caseName: copyCaseInfo.value.caseName,\r\n  }\r\n  copyCase(data).then(response => {\r\n    ElMessage.success(\"复制成功\");\r\n  }).finally(() => {\r\n    copyDialog.value = false;\r\n  });\r\n}\r\n\r\n/** 新增按钮操作 */\r\nfunction handleAdd() {\r\n  title.value = \"添加\" + dataName.value;\r\n  form.value = JSON.parse(JSON.stringify(initCaseFormData));\r\n  open.value = true;\r\n}\r\n\r\n/** 修改按钮操作 */\r\nfunction handleUpdate(row) {\r\n  loading.value.edite = true;\r\n  const caseId = row.caseId || selectIds.value;\r\n  getCase(caseId).then((response) => {\r\n    if (!response.data || Object.keys(response.data).length === 0) {\r\n      ElMessage.warning(\"未查到对应数据！\");\r\n      return;\r\n    }\r\n    form.value = response.data;\r\n\r\n    title.value = \"修改\" + dataName.value;\r\n    open.value = true;\r\n  }).finally(() => {\r\n    loading.value.edite = false;\r\n  });\r\n}\r\n\r\nfunction showHistory(row) {\r\n  const caseId = row.caseId || selectIds.value;\r\n  currentCaseInfo.value = row;\r\n  currentRunId.value = caseId;\r\n  showHistoryDialog.value = true;\r\n}\r\n\r\n/** 删除按钮操作 */\r\nfunction handleDelete(row) {\r\n  const caseIds = row.caseId || selectIds.value;\r\n  proxy.$modal.confirm('是否确认删除ID为\"' + caseIds + '\"的数据项？').then(function () {\r\n    return delCase(caseIds);\r\n  }).then(() => {\r\n    if (caseQueryViewRef.value){\r\n      caseQueryViewRef.value.handleQuery();\r\n    }\r\n    proxy.$modal.msgSuccess(\"删除成功\");\r\n  }).catch(() => {\r\n  });\r\n}\r\n\r\n/** 导出按钮操作 */\r\nfunction handleExport() {\r\n  proxy.download(\"hrm/case/export\", {\r\n    ...queryParams.value\r\n  }, `Case_${new Date().getTime()}.xlsx`);\r\n}\r\n\r\n/** 多选框选中数据 */\r\nfunction handleSelectionChange(selection) {\r\n  selectIds.value = selection.map(item => item.caseId);\r\n  single.value = selection.length !== 1;\r\n  multiple.value = !selection.length;\r\n}\r\n\r\n</script>\r\n"],"names":["proxy","getCurrentInstance","sys_normal_disable","hrm_data_type","qtr_case_status","props","__props","dataName","computed","HrmDataTypeEnum","provide","caseQueryViewRef","ref","open","selectIds","single","multiple","title","onlySelf","runDialogShow","runIds","showHistoryDialog","currentCaseInfo","currentRunId","copyDialog","copyCaseInfo","initCaseFormData","queryParams","toRef","form","loading","caseEditDialogTitle","caseId","lineStatusChange","selectValue","dataSource","changeCaseStatus","response","ElMessage","runTest","row","ElMessageBox","showCopyDialog","data","toValue","toRaw","copyCaseHandle","copyCase","handleAdd","handleUpdate","getCase","showHistory","handleDelete","caseIds","delCase","handleExport","handleSelectionChange","selection","item"],"mappings":"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"}