import{a as Ie,r as v,D as Pe,a0 as Te,d as p,J as ae,o as i,c as b,I as _,U as ne,h as o,e,f as l,k as Ge,P as E,a7 as I,l as g,p as r,$ as R,m as C,z as j,n as D,C as qe,v as Re}from"./index.CHnR_MAu.js";import{l as De,c as Je,r as Fe,g as ue,u as Ae,a as Ke,d as Le}from"./job.e-kpm1MU.js";import{C as ze}from"./index.CTXGU5eB.js";import{A as Be}from"./ace-editor.UAWmui2X.js";import"./tools.B8u06WSF.js";import"./ResizeObserver.es.B1PUzC5B.js";const Oe={class:"app-container"},Qe=C("div",null,[r(" Bean调用示例：ryTask.ryParams('ry') "),C("br"),r("Class类调用示例：com.ruoyi.quartz.task.RyTask.ryParams('ry') "),C("br"),r("参数说明：支持字符串，布尔类型，长整型，浮点型，整型 ")],-1),He=C("i",{class:"el-icon-time el-icon--right"},null,-1),Me={class:"dialog-footer"},We={key:0},Xe={key:1},Ye={key:0},Ze={key:1},el={key:0},ll={key:1},ol={key:2},tl={key:3},al={class:"dialog-footer"},nl=qe({name:"Job"}),cl=Object.assign(nl,{setup(ul){const re=Ie(),{proxy:c}=Re(),{sys_job_group:P,sys_job_status:M,sys_job_executor:W}=c.useDict("sys_job_group","sys_job_status","sys_job_executor"),X=v([]),h=v(!1),J=v(!0),T=v(!0),F=v([]),Y=v(!0),Z=v(!0),A=v(0),K=v(""),N=v(!1),S=v(!1),ee=v(""),de=Pe({form:{},queryParams:{pageNum:1,pageSize:10,jobName:void 0,jobGroup:void 0,status:void 0},rules:{jobName:[{required:!0,message:"任务名称不能为空",trigger:"blur"}],invokeTarget:[{required:!0,message:"调用目标字符串不能为空",trigger:"blur"}],cronExpression:[{required:!0,message:"cron执行表达式不能为空",trigger:"change"}]}}),{queryParams:f,form:n,rules:se}=Te(de);function k(){J.value=!0,De(f.value).then(u=>{X.value=u.rows,A.value=u.total,J.value=!1})}function ie(u,a){return c.selectDictLabel(P.value,u.jobGroup)}function pe(u,a){return c.selectDictLabel(W.value,u.jobExecutor)}function me(){h.value=!1,L()}function L(){n.value={jobId:void 0,jobName:void 0,jobGroup:void 0,invokeTarget:void 0,cronExpression:void 0,misfirePolicy:"1",concurrent:"1",status:"0"},c.resetForm("jobRef")}function z(){f.value.pageNum=1,k()}function ce(){c.resetForm("queryRef"),z()}function fe(u){F.value=u.map(a=>a.jobId),Y.value=u.length!=1,Z.value=!u.length}function be(u){let a=u.status==="0"?"启用":"停用";c.$modal.confirm('确认要"'+a+'""'+u.jobName+'"任务吗?').then(function(){return Je(u.jobId,u.status)}).then(()=>{c.$modal.msgSuccess(a+"成功")}).catch(function(){u.status=u.status==="0"?"1":"0"})}function _e(u){c.$modal.confirm('确认要立即执行一次"'+u.jobName+'"任务吗?').then(function(){return Fe(u.jobId,u.jobGroup)}).then(()=>{c.$modal.msgSuccess("执行成功")}).catch(()=>{})}function ve(u){ue(u.jobId).then(a=>{n.value=a.data,N.value=!0})}function ge(){ee.value=n.value.cronExpression,S.value=!0}function je(u){n.value.cronExpression=u}function le(u){const a=u.jobId||0;re.push("/monitor/job-log/index/"+a)}function ye(){L(),h.value=!0,K.value="添加任务"}function oe(u){L();const a=u.jobId||F.value;ue(a).then(w=>{n.value=w.data,h.value=!0,K.value="修改任务"})}function he(){c.$refs.jobRef.validate(u=>{u&&(n.value.jobId!=null?Ae(n.value).then(a=>{c.$modal.msgSuccess("修改成功"),h.value=!1,k()}):Ke(n.value).then(a=>{c.$modal.msgSuccess("新增成功"),h.value=!1,k()}))})}function te(u){const a=u.jobId||F.value;c.$modal.confirm('是否确认删除定时任务编号为"'+a+'"的数据项?').then(function(){return Le(a)}).then(()=>{k(),c.$modal.msgSuccess("删除成功")}).catch(()=>{})}function Ve(){c.download("monitor/job/export",{...f.value},`job_${new Date().getTime()}.xlsx`)}return k(),(u,a)=>{const w=p("el-input"),d=p("el-form-item"),G=p("el-option"),q=p("el-select"),m=p("el-button"),B=p("el-form"),s=p("el-col"),ke=p("right-toolbar"),O=p("el-row"),V=p("el-table-column"),we=p("dict-tag"),xe=p("el-switch"),U=p("el-tooltip"),Ce=p("el-table"),Ue=p("pagination"),Ne=p("question-filled"),Se=p("el-icon"),$e=p("el-radio"),Q=p("el-radio-group"),$=p("el-radio-button"),H=p("el-dialog"),y=ae("hasPermi"),Ee=ae("loading");return i(),b("div",Oe,[_(e(B,{model:o(f),ref:"queryRef",inline:!0},{default:l(()=>[e(d,{label:"任务名称",prop:"jobName"},{default:l(()=>[e(w,{modelValue:o(f).jobName,"onUpdate:modelValue":a[0]||(a[0]=t=>o(f).jobName=t),placeholder:"请输入任务名称",clearable:"",style:{width:"200px"},onKeyup:Ge(z,["enter"])},null,8,["modelValue"])]),_:1}),e(d,{label:"任务组名",prop:"jobGroup"},{default:l(()=>[e(q,{modelValue:o(f).jobGroup,"onUpdate:modelValue":a[1]||(a[1]=t=>o(f).jobGroup=t),placeholder:"请选择任务组名",clearable:"",style:{width:"200px"}},{default:l(()=>[(i(!0),b(E,null,I(o(P),t=>(i(),g(G,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,{label:"任务状态",prop:"status"},{default:l(()=>[e(q,{modelValue:o(f).status,"onUpdate:modelValue":a[2]||(a[2]=t=>o(f).status=t),placeholder:"请选择任务状态",clearable:"",style:{width:"200px"}},{default:l(()=>[(i(!0),b(E,null,I(o(M),t=>(i(),g(G,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(d,null,{default:l(()=>[e(m,{type:"primary",icon:"Search",onClick:z},{default:l(()=>[r("搜索")]),_:1}),e(m,{icon:"Refresh",onClick:ce},{default:l(()=>[r("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[ne,o(T)]]),e(O,{gutter:10,class:"mb8"},{default:l(()=>[e(s,{span:1.5},{default:l(()=>[_((i(),g(m,{type:"primary",plain:"",icon:"Plus",onClick:ye},{default:l(()=>[r("新增")]),_:1})),[[y,["monitor:job:add"]]])]),_:1}),e(s,{span:1.5},{default:l(()=>[_((i(),g(m,{type:"success",plain:"",icon:"Edit",disabled:o(Y),onClick:oe},{default:l(()=>[r("修改")]),_:1},8,["disabled"])),[[y,["monitor:job:edit"]]])]),_:1}),e(s,{span:1.5},{default:l(()=>[_((i(),g(m,{type:"danger",plain:"",icon:"Delete",disabled:o(Z),onClick:te},{default:l(()=>[r("删除")]),_:1},8,["disabled"])),[[y,["monitor:job:remove"]]])]),_:1}),e(s,{span:1.5},{default:l(()=>[_((i(),g(m,{type:"warning",plain:"",icon:"Download",onClick:Ve},{default:l(()=>[r("导出")]),_:1})),[[y,["monitor:job:export"]]])]),_:1}),e(s,{span:1.5},{default:l(()=>[_((i(),g(m,{type:"info",plain:"",icon:"Operation",onClick:le},{default:l(()=>[r("日志")]),_:1})),[[y,["monitor:job:query"]]])]),_:1}),e(ke,{showSearch:o(T),"onUpdate:showSearch":a[3]||(a[3]=t=>R(T)?T.value=t:null),onQueryTable:k},null,8,["showSearch"])]),_:1}),_((i(),g(Ce,{data:o(X),onSelectionChange:fe},{default:l(()=>[e(V,{type:"selection",width:"55",align:"center"}),e(V,{label:"任务编号",width:"100",align:"center",prop:"jobId"}),e(V,{label:"任务名称",align:"center",prop:"jobName","show-overflow-tooltip":!0}),e(V,{label:"任务组名",align:"center",prop:"jobGroup"},{default:l(t=>[e(we,{options:o(P),value:t.row.jobGroup},null,8,["options","value"])]),_:1}),e(V,{label:"调用目标字符串",align:"center",prop:"invokeTarget","show-overflow-tooltip":!0}),e(V,{label:"cron执行表达式",align:"center",prop:"cronExpression","show-overflow-tooltip":!0}),e(V,{label:"状态",align:"center"},{default:l(t=>[e(xe,{modelValue:t.row.status,"onUpdate:modelValue":x=>t.row.status=x,"active-value":"0","inactive-value":"1",onChange:x=>be(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(V,{label:"操作",align:"center",width:"200","class-name":"small-padding fixed-width"},{default:l(t=>[e(U,{content:"修改",placement:"top"},{default:l(()=>[_(e(m,{link:"",type:"primary",icon:"Edit",onClick:x=>oe(t.row)},null,8,["onClick"]),[[y,["monitor:job:edit"]]])]),_:2},1024),e(U,{content:"删除",placement:"top"},{default:l(()=>[_(e(m,{link:"",type:"primary",icon:"Delete",onClick:x=>te(t.row)},null,8,["onClick"]),[[y,["monitor:job:remove"]]])]),_:2},1024),e(U,{content:"执行一次",placement:"top"},{default:l(()=>[_(e(m,{link:"",type:"primary",icon:"CaretRight",onClick:x=>_e(t.row)},null,8,["onClick"]),[[y,["monitor:job:changeStatus"]]])]),_:2},1024),e(U,{content:"任务详细",placement:"top"},{default:l(()=>[_(e(m,{link:"",type:"primary",icon:"View",onClick:x=>ve(t.row)},null,8,["onClick"]),[[y,["monitor:job:query"]]])]),_:2},1024),e(U,{content:"调度日志",placement:"top"},{default:l(()=>[_(e(m,{link:"",type:"primary",icon:"Operation",onClick:x=>le(t.row)},null,8,["onClick"]),[[y,["monitor:job:query"]]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ee,o(J)]]),_(e(Ue,{total:o(A),page:o(f).pageNum,"onUpdate:page":a[4]||(a[4]=t=>o(f).pageNum=t),limit:o(f).pageSize,"onUpdate:limit":a[5]||(a[5]=t=>o(f).pageSize=t),onPagination:k},null,8,["total","page","limit"]),[[ne,o(A)>0]]),e(H,{title:o(K),modelValue:o(h),"onUpdate:modelValue":a[16]||(a[16]=t=>R(h)?h.value=t:null),width:"820px","append-to-body":""},{footer:l(()=>[C("div",Me,[e(m,{type:"primary",onClick:he},{default:l(()=>[r("确 定")]),_:1}),e(m,{onClick:me},{default:l(()=>[r("取 消")]),_:1})])]),default:l(()=>[e(B,{ref:"jobRef",model:o(n),rules:o(se),"label-width":"120px"},{default:l(()=>[e(O,null,{default:l(()=>[e(s,{span:24},{default:l(()=>[e(d,{label:"任务名称",prop:"jobName"},{default:l(()=>[e(w,{modelValue:o(n).jobName,"onUpdate:modelValue":a[6]||(a[6]=t=>o(n).jobName=t),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"任务分组",prop:"jobGroup"},{default:l(()=>[e(q,{modelValue:o(n).jobGroup,"onUpdate:modelValue":a[7]||(a[7]=t=>o(n).jobGroup=t),placeholder:"请选择"},{default:l(()=>[(i(!0),b(E,null,I(o(P),t=>(i(),g(G,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"任务执行器",prop:"jobGroup"},{default:l(()=>[e(q,{modelValue:o(n).jobExecutor,"onUpdate:modelValue":a[8]||(a[8]=t=>o(n).jobExecutor=t),placeholder:"请选择任务执行器"},{default:l(()=>[(i(!0),b(E,null,I(o(W),t=>(i(),g(G,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(d,{prop:"invokeTarget"},{label:l(()=>[C("span",null,[r(" 调用方法 "),e(U,{placement:"top"},{content:l(()=>[Qe]),default:l(()=>[e(Se,null,{default:l(()=>[e(Ne)]),_:1})]),_:1})])]),default:l(()=>[e(w,{modelValue:o(n).invokeTarget,"onUpdate:modelValue":a[9]||(a[9]=t=>o(n).invokeTarget=t),placeholder:"请输入调用目标字符串"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(d,{label:"位置参数",prop:"jobArgs"},{default:l(()=>[e(w,{modelValue:o(n).jobArgs,"onUpdate:modelValue":a[10]||(a[10]=t=>o(n).jobArgs=t),placeholder:"请输入位置参数"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(d,{label:"关键字参数",prop:"jobKwargs"},{default:l(()=>[e(Be,{content:o(n).jobKwargs,"onUpdate:content":a[11]||(a[11]=t=>o(n).jobKwargs=t),lang:"json",themes:"monokai",height:"300px",width:"670px",placeholder:"请输入关键字参数"},null,8,["content"])]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(d,{label:"cron表达式",prop:"cronExpression"},{default:l(()=>[e(w,{modelValue:o(n).cronExpression,"onUpdate:modelValue":a[12]||(a[12]=t=>o(n).cronExpression=t),placeholder:"请输入cron执行表达式"},{append:l(()=>[e(m,{type:"primary",onClick:ge},{default:l(()=>[r(" 生成表达式 "),He]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(n).jobId!==void 0?(i(),g(s,{key:0,span:24},{default:l(()=>[e(d,{label:"状态"},{default:l(()=>[e(Q,{modelValue:o(n).status,"onUpdate:modelValue":a[13]||(a[13]=t=>o(n).status=t)},{default:l(()=>[(i(!0),b(E,null,I(o(M),t=>(i(),g($e,{key:t.value,label:t.value},{default:l(()=>[r(j(t.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):D("",!0),e(s,{span:12},{default:l(()=>[e(d,{label:"执行策略",prop:"misfirePolicy"},{default:l(()=>[e(Q,{modelValue:o(n).misfirePolicy,"onUpdate:modelValue":a[14]||(a[14]=t=>o(n).misfirePolicy=t)},{default:l(()=>[e($,{label:"1"},{default:l(()=>[r("立即执行")]),_:1}),e($,{label:"2"},{default:l(()=>[r("执行一次")]),_:1}),e($,{label:"3"},{default:l(()=>[r("放弃执行")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"是否并发",prop:"concurrent"},{default:l(()=>[e(Q,{modelValue:o(n).concurrent,"onUpdate:modelValue":a[15]||(a[15]=t=>o(n).concurrent=t)},{default:l(()=>[e($,{label:"0"},{default:l(()=>[r("允许")]),_:1}),e($,{label:"1"},{default:l(()=>[r("禁止")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),e(H,{title:"Cron表达式生成器",modelValue:o(S),"onUpdate:modelValue":a[18]||(a[18]=t=>R(S)?S.value=t:null),"append-to-body":"","destroy-on-close":""},{default:l(()=>[e(o(ze),{ref:"crontabRef",onHide:a[17]||(a[17]=t=>S.value=!1),onFill:je,expression:o(ee)},null,8,["expression"])]),_:1},8,["modelValue"]),e(H,{title:"任务详细",modelValue:o(N),"onUpdate:modelValue":a[20]||(a[20]=t=>R(N)?N.value=t:null),width:"700px","append-to-body":""},{footer:l(()=>[C("div",al,[e(m,{onClick:a[19]||(a[19]=t=>N.value=!1)},{default:l(()=>[r("关 闭")]),_:1})])]),default:l(()=>[e(B,{model:o(n),"label-width":"120px"},{default:l(()=>[e(O,null,{default:l(()=>[e(s,{span:12},{default:l(()=>[e(d,{label:"任务编号："},{default:l(()=>[r(j(o(n).jobId),1)]),_:1}),e(d,{label:"任务名称："},{default:l(()=>[r(j(o(n).jobName),1)]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"任务分组："},{default:l(()=>[r(j(ie(o(n))),1)]),_:1}),e(d,{label:"创建时间："},{default:l(()=>[r(j(u.parseTime(o(n).createTime)),1)]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"cron表达式："},{default:l(()=>[r(j(o(n).cronExpression),1)]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"下次执行时间："},{default:l(()=>[r(j(u.parseTime(o(n).nextValidTime)),1)]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"任务执行器："},{default:l(()=>[r(j(pe(o(n))),1)]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(d,{label:"调用目标方法："},{default:l(()=>[r(j(o(n).invokeTarget),1)]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(d,{label:"位置参数："},{default:l(()=>[r(j(o(n).jobArgs),1)]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(d,{label:"关键字参数："},{default:l(()=>[r(j(o(n).jobKwargs),1)]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"任务状态："},{default:l(()=>[o(n).status==0?(i(),b("div",We,"正常")):o(n).status==1?(i(),b("div",Xe,"暂停")):D("",!0)]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"是否并发："},{default:l(()=>[o(n).concurrent==0?(i(),b("div",Ye,"允许")):o(n).concurrent==1?(i(),b("div",Ze,"禁止")):D("",!0)]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(d,{label:"执行策略："},{default:l(()=>[o(n).misfirePolicy=="0"?(i(),b("div",el,"默认策略")):o(n).misfirePolicy=="1"?(i(),b("div",ll,"立即执行")):o(n).misfirePolicy=="2"?(i(),b("div",ol,"执行一次")):o(n).misfirePolicy=="3"?(i(),b("div",tl,"放弃执行")):D("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{cl as default};
