{"version":3,"file":"project-table-query.DHBG36L_.js","sources":["../../../src/components/hrm/util-data-table/project-table-query.vue"],"sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <el-form :model=\"queryParams\" ref=\"queryRef\" :inline=\"true\" v-show=\"showSearch\">\r\n      <el-form-item label=\"项目名称\" prop=\"projectName\">\r\n        <el-input\r\n            v-model=\"queryParams.projectName\"\r\n            placeholder=\"请输入项目名称\"\r\n            clearable\r\n            style=\"width: 200px\"\r\n            @keyup.enter=\"handleQuery\"\r\n        />\r\n      </el-form-item>\r\n      <el-form-item label=\"状态\" prop=\"status\">\r\n        <el-select v-model=\"queryParams.status\" placeholder=\"项目状态\" clearable style=\"width: 200px\">\r\n          <el-option\r\n              v-for=\"dict in qtr_data_status\"\r\n              :key=\"dict.value * 1\"\r\n              :label=\"dict.label\"\r\n              :value=\"dict.value * 1\"\r\n          />\r\n        </el-select>\r\n      </el-form-item>\r\n      <el-form-item>\r\n        <el-button type=\"primary\" icon=\"Search\" @click=\"handleQuery\">搜索</el-button>\r\n        <el-button icon=\"Refresh\" @click=\"resetQuery\">重置</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n\r\n    <el-row :gutter=\"10\" class=\"mb8\">\r\n      <slot name=\"table-tool\"></slot>\r\n      <right-toolbar v-model:showSearch=\"showSearch\" @queryTable=\"getList\"></right-toolbar>\r\n    </el-row>\r\n\r\n    <el-table\r\n        border\r\n        ref=\"tableRef\"\r\n        v-if=\"refreshTable\"\r\n        v-loading=\"loading\"\r\n        :data=\"projectList\"\r\n        row-key=\"projectId\"\r\n        table-layout=\"fixed\"\r\n        :default-expand-all=\"isExpandAll\"\r\n        @selection-change=\"handleSelectionChange\"\r\n        @select=\"handleSelect\"\r\n        @select-all=\"handleSelectAll\"\r\n        max-height=\"calc(100vh - 280px)\"\r\n    >\r\n      <el-table-column type=\"selection\" width=\"55\" align=\"center\"/>\r\n      <el-table-column prop=\"projectId\" label=\"ID\" width=\"150\"></el-table-column>\r\n      <el-table-column prop=\"projectName\" align=\"left\" label=\"项目名称\" min-width=\"200\"></el-table-column>\r\n      <el-table-column prop=\"responsibleName\" align=\"center\" label=\"负责人\" width=\"100\"></el-table-column>\r\n      <el-table-column prop=\"testUser\" label=\"测试负责人\" align=\"center\" width=\"100\"></el-table-column>\r\n      <el-table-column prop=\"devUser\" label=\"开发负责人\" align=\"center\" width=\"100\"></el-table-column>\r\n      <el-table-column prop=\"orderNum\" label=\"排序\" align=\"center\" width=\"70\"></el-table-column>\r\n      <el-table-column prop=\"status\" label=\"状态\" align=\"center\" width=\"70\">\r\n        <template #default=\"scope\">\r\n          <dict-tag :options=\"qtr_data_status\" :value=\"scope.row.status\"/>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"创建时间\" align=\"center\" prop=\"createTime\" class-name=\"small-padding fixed-width\"\r\n                       width=\"150\">\r\n        <template #default=\"scope\">\r\n          <span>{{ parseTime(scope.row.createTime) }}</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"更新时间\" align=\"center\" prop=\"updateTime\" class-name=\"small-padding fixed-width\"\r\n                       width=\"150\">\r\n        <template #default=\"scope\">\r\n          <span>{{ parseTime(scope.row.updateTime) }}</span>\r\n        </template>\r\n      </el-table-column>\r\n      <el-table-column label=\"操作\" align=\"center\" class-name=\"small-padding fixed-width\" fixed=\"right\" width=\"120\"\r\n                       v-if=\"$slots.tableOperate\">\r\n        <template #default=\"scope\">\r\n          <slot name=\"tableOperate\" :scope=\"scope\"></slot>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n\r\n    <pagination\r\n        v-show=\"total > 0 && showPagination\"\r\n        :total=\"total\"\r\n        v-model:page=\"queryParams.pageNum\"\r\n        v-model:limit=\"queryParams.pageSize\"\r\n        @pagination=\"getList\"\r\n    />\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {listProject} from \"@/api/hrm/project.js\";\r\n\r\nconst {proxy} = getCurrentInstance();\r\nconst {qtr_data_status} = proxy.useDict(\"qtr_data_status\");\r\nconst props = defineProps({\r\n  showPagination: {type: Boolean, default: true},\r\n  checkedIds: {type: Array, default: []}\r\n});\r\nconst emits = defineEmits(['selectChange']);\r\ndefineExpose({handleQuery, getSelectedIds});\r\n\r\nconst tableRef = ref(null);\r\nconst projectList = ref([]);\r\nconst total = ref(0);\r\nconst open = ref(false);\r\nconst loading = ref(true);\r\nconst showSearch = ref(true);\r\nconst title = ref(\"\");\r\nconst isExpandAll = ref(true);\r\nconst refreshTable = ref(true);\r\nconst allSelectIds = ref([]);\r\n\r\nconst runIds = ref([]);\r\n\r\nconst data = reactive({\r\n  form: {},\r\n  queryParams: {\r\n    projectName: undefined,\r\n    status: undefined,\r\n    pageNum: 1,\r\n    pageSize: 10\r\n  },\r\n  rules: {\r\n    projectName: [{required: true, message: \"项目名称不能为空\", trigger: \"blur\"}],\r\n    orderNum: [{required: true, message: \"显示排序不能为空\", trigger: \"blur\"}]\r\n  },\r\n});\r\n\r\nconst {queryParams, form, rules} = toRefs(data);\r\n\r\n/** 查询项目列表 */\r\nfunction getList() {\r\n  loading.value = true;\r\n  listProject(queryParams.value).then(response => {\r\n    projectList.value = response.rows;\r\n    total.value = response.total;\r\n    nextTick(() => {\r\n      if (tableRef.value) {\r\n        tableRef.value.clearSelection();\r\n      }\r\n      if (props.checkedIds && props.checkedIds.length > 0) {\r\n        if (tableRef.value && projectList.value) {\r\n          projectList.value.forEach(item => {\r\n            if (props.checkedIds.find(dataId => dataId === item.projectId)) {\r\n              tableRef.value.toggleRowSelection(item, true);\r\n            }\r\n          });\r\n        }\r\n      }\r\n    });\r\n    loading.value = false;\r\n  });\r\n}\r\n\r\nfunction handleSelectionChange(selection) {\r\n  emits('selectChange', selection);\r\n  runIds.value = selection.map(item => item.projectId);\r\n}\r\n\r\nfunction getSelectedIds() {\r\n  return runIds.value;\r\n}\r\n\r\n/** 搜索按钮操作 */\r\nfunction handleQuery() {\r\n  getList();\r\n}\r\n\r\n/** 重置按钮操作 */\r\nfunction resetQuery() {\r\n  proxy.resetForm(\"queryRef\");\r\n  handleQuery();\r\n}\r\n\r\nfunction handleSelect(selection, row) {\r\n  let pageIds = projectList.value.map(item => item.projectId);\r\n  let pageSelectIds = selection.map(item => item.projectId);\r\n  let delIds = pageIds.filter(item => !pageSelectIds.includes(item));\r\n  pageSelectIds.forEach((dataId) => {\r\n    if (!allSelectIds.value.some((projectId) => projectId === dataId)) {\r\n      allSelectIds.value.push(dataId);\r\n    }\r\n  });\r\n  allSelectIds.value = allSelectIds.value.filter(item => !delIds.includes(item));\r\n}\r\n\r\n\r\nfunction handleSelectAll(selection) {\r\n  let pageSelectIds = selection.map(item => item.projectId);\r\n  if (pageSelectIds && pageSelectIds.length > 0) {\r\n    pageSelectIds.forEach((item) => {\r\n      if (!allSelectIds.value.some((projectId) => projectId === item)) {\r\n        allSelectIds.value.push(item);\r\n      }\r\n    });\r\n  } else {\r\n    let pageIds = projectList.value.map(item => item.projectId);\r\n    allSelectIds.value = allSelectIds.value.filter(item => !pageIds.includes(item));\r\n  }\r\n\r\n}\r\n\r\nonMounted(() => {\r\n  allSelectIds.value = toRaw(props.checkedIds);\r\n  getList();\r\n});\r\n\r\n</script>\r\n"],"names":["proxy","getCurrentInstance","qtr_data_status","props","__props","emits","__emit","__expose","handleQuery","getSelectedIds","tableRef","ref","projectList","total","loading","showSearch","isExpandAll","refreshTable","allSelectIds","runIds","data","reactive","queryParams","form","rules","toRefs","getList","listProject","response","nextTick","item","dataId","handleSelectionChange","selection","resetQuery","handleSelect","row","pageIds","pageSelectIds","delIds","projectId","handleSelectAll","onMounted","toRaw"],"mappings":"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"}