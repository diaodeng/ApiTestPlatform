import{d as ue,r as u,J as de,N as ie,C as ce,ab as pe,e as i,H as me,c as x,o as f,I as q,f as a,M as T,l as o,i as n,O as U,P as B,j as S,m as fe,n as D,aE as E,K as ge,k as he,h as L,y as O,L as ve}from"./index.DLM0P_FN.js";import{l as _e}from"./module.CsavA2LQ.js";import{l as be}from"./project.NehpJ71d.js";const we={class:"app-container"},Ne={__name:"module-table-query",props:{showPagination:{type:Boolean,default:!0},checkedIds:{type:Array,default:[]}},emits:["selectChange"],setup(C,{expose:z,emit:A}){const{proxy:P}=ue(),{qtr_data_status:R}=P.useDict("qtr_data_status"),_=C,v=u(null),g=u([]),j=u([]);u(!1);const N=u(!0),b=u(!0),k=u([]),K=u(!0),M=u(!0),V=u(0);u("");const m=u([]),Q=u([]),$=de({queryParams:{pageNum:1,pageSize:10,projectId:void 0,moduleName:void 0,status:void 0},rules:{moduleName:[{required:!0,message:"模块名称不能为空",trigger:"blur"}],projectId:[{required:!0,message:"所属项目不能为空",trigger:"blur"}],testUser:[{required:!0,message:"测试负责人不能为空",trigger:"blur"}],sort:[{required:!0,message:"模块顺序不能为空",trigger:"blur"}]}}),F=A;z({handleQuery:I,getSelectedIds:Y});const{queryParams:s,rules:Ie}=ie($);function w(){N.value=!0,_e(s.value).then(l=>{g.value=l.rows,V.value=l.total,ve(()=>{v.value&&v.value.clearSelection(),_.checkedIds&&_.checkedIds.length>0&&v.value&&g.value&&g.value.forEach(e=>{_.checkedIds.find(r=>r===e.moduleId)&&v.value.toggleRowSelection(e,!0)})}),N.value=!1})}function H(){be({isPage:!1}).then(l=>{j.value=l.data})}function J(l,e,r){return G(l.projectId)}function G(l){for(const e of j.value)if(l===e.projectId)return e.projectName}function I(){s.value.pageNum=1,w()}function W(){P.resetForm("queryRef"),I()}function X(l){F("selectChange",l),k.value=l.map(e=>e.moduleId),Q.value=k.value,K.value=l.length!==1,M.value=!l.length}function Y(){return k.value}function Z(l,e){let r=g.value.map(d=>d.moduleId),c=l.map(d=>d.moduleId),h=r.filter(d=>!c.includes(d));c.forEach(d=>{m.value.some(y=>y===d)||m.value.push(d)}),m.value=m.value.filter(d=>!h.includes(d))}function ee(l){let e=l.map(r=>r.moduleId);if(e&&e.length>0)e.forEach(r=>{m.value.some(c=>c===r)||m.value.push(r)});else{let r=g.value.map(c=>c.moduleId);m.value=m.value.filter(c=>!r.includes(c))}}return ce(()=>{m.value=pe(_.checkedIds),H(),w()}),(l,e)=>{const r=i("el-option"),c=i("el-select"),h=i("el-form-item"),d=i("el-input"),y=i("el-button"),te=i("el-form"),le=i("right-toolbar"),ae=i("el-row"),p=i("el-table-column"),oe=i("dict-tag"),ne=i("el-table"),re=i("pagination"),se=me("loading");return f(),x("div",we,[q(a(te,{model:o(s),ref:"queryRef",inline:!0},{default:n(()=>[a(h,{label:"项目",prop:"projectId"},{default:n(()=>[a(c,{modelValue:o(s).projectId,"onUpdate:modelValue":e[0]||(e[0]=t=>o(s).projectId=t),placeholder:"请选择",clearable:"",style:{width:"150px"}},{default:n(()=>[(f(!0),x(U,null,B(o(j),t=>(f(),S(r,{key:t.projectId,label:t.projectName,value:t.projectId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(h,{label:"模块名称",prop:"moduleName"},{default:n(()=>[a(d,{modelValue:o(s).moduleName,"onUpdate:modelValue":e[1]||(e[1]=t=>o(s).moduleName=t),placeholder:"请输入模块名称",clearable:"",style:{width:"200px"},onKeyup:fe(I,["enter"])},null,8,["modelValue"])]),_:1}),a(h,{label:"状态",prop:"status"},{default:n(()=>[a(c,{modelValue:o(s).status,"onUpdate:modelValue":e[2]||(e[2]=t=>o(s).status=t),placeholder:"模块状态",clearable:"",style:{width:"200px"}},{default:n(()=>[(f(!0),x(U,null,B(o(R),t=>(f(),S(r,{key:t.value*1,label:t.label,value:t.value*1},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(h,null,{default:n(()=>[a(y,{type:"primary",icon:"Search",onClick:I},{default:n(()=>e[6]||(e[6]=[D("搜索")])),_:1,__:[6]}),a(y,{icon:"Refresh",onClick:W},{default:n(()=>e[7]||(e[7]=[D("重置")])),_:1,__:[7]})]),_:1})]),_:1},8,["model"]),[[T,o(b)]]),a(ae,{gutter:10,class:"mb8"},{default:n(()=>[E(l.$slots,"table-tool"),a(le,{showSearch:o(b),"onUpdate:showSearch":e[3]||(e[3]=t=>ge(b)?b.value=t:null),onQueryTable:w},null,8,["showSearch"])]),_:3}),q((f(),S(ne,{border:"",ref_key:"tableRef",ref:v,data:o(g),onSelectionChange:X,onSelect:Z,onSelectAll:ee,"table-layout":"fixed","max-height":"calc(100vh - 280px)"},{default:n(()=>[a(p,{type:"selection",width:"55",align:"center"}),a(p,{label:"模块ID",align:"center",prop:"moduleId",width:"150"}),a(p,{label:"模块名称",align:"center",prop:"moduleName"}),a(p,{label:"所属项目",align:"center",formatter:J}),a(p,{label:"测试人员",align:"center",prop:"testUser",width:"80"}),a(p,{label:"模块排序",align:"center",prop:"sort",width:"80"}),a(p,{label:"状态",align:"center",prop:"status",width:"70"},{default:n(t=>[a(oe,{options:o(R),value:t.row.status+""},null,8,["options","value"])]),_:1}),a(p,{label:"创建时间",align:"center",prop:"createTime","class-name":"small-padding fixed-width",width:"150"},{default:n(t=>[L("span",null,O(l.parseTime(t.row.createTime)),1)]),_:1}),a(p,{label:"更新时间",align:"center",prop:"createTime","class-name":"small-padding fixed-width",width:"150"},{default:n(t=>[L("span",null,O(l.parseTime(t.row.updateTime)),1)]),_:1}),l.$slots.tableOperate?(f(),S(p,{key:0,label:"操作",width:"80",align:"center","class-name":"small-padding fixed-width",fixed:"right"},{default:n(t=>[E(l.$slots,"tableOperate",{scope:t})]),_:3})):he("",!0)]),_:3},8,["data"])),[[se,o(N)]]),q(a(re,{total:o(V),page:o(s).pageNum,"onUpdate:page":e[4]||(e[4]=t=>o(s).pageNum=t),limit:o(s).pageSize,"onUpdate:limit":e[5]||(e[5]=t=>o(s).pageSize=t),onPagination:w},null,8,["total","page","limit"]),[[T,o(V)>0&&C.showPagination]])])}}};export{Ne as _};
//# sourceMappingURL=module-table-query.R1B7p_Uc.js.map
