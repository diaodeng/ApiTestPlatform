import{y as fe,V as ge,r as u,S as Be,F as He,d,J as ye,o as i,c as q,I as c,U as _e,h as e,e as a,f as t,P as G,a7 as W,l as p,k as ve,$ as C,p as _,n as B,m as H,z as M,C as Me,v as ze,E as Fe,az as Le,a1 as Je,ay as Ke}from"./index.CHnR_MAu.js";import{c as Qe,l as Ae,a as Ge,b as We}from"./case.CZLC1pq4.js";import{s as Xe}from"./module.BMNy9Seo.js";import{H as I,r as Ye,l as Ze}from"./project.BpVuymad.js";import{d as el,c as ll}from"./run-detail.CU1qKOwv.js";import{i as X}from"./data-template.CF-ivY4r.js";import{_ as al}from"./run_dialog.B-H1ReCy.js";import"./tools.B8u06WSF.js";import"./run_detail.CgntWMNI.js";import"./table-variables.iSiz_YnM.js";import"./ace-editor.UAWmui2X.js";import"./ResizeObserver.es.B1PUzC5B.js";import"./env.jLYomLFD.js";const tl={class:"app-container"},nl=Me({name:"Case"}),vl=Object.assign(nl,{props:{dataType:{type:Number,default:I.case},formRules:{type:Object,default:{caseName:[{required:!0,message:"用例名称不能为空",trigger:"blur"}],projectId:[{required:!0,message:"所属项目不能为空",trigger:"blur"}],moduleId:[{required:!0,message:"所属模块不能为空",trigger:"blur"}]}}},setup(v){const{proxy:h}=ze(),{sys_normal_disable:z}=h.useDict("sys_normal_disable");h.useDict("sys_request_method");const{hrm_data_type:he}=h.useDict("hrm_data_type"),Y=v,y=fe(()=>Y.dataType===I.case?"用例":"配置"),be=fe(()=>J.value+"【"+S.value.caseId+" - "+S.value.caseName+"】");ge("hrm_data_type",he),ge("sys_normal_disable",z);const Z=u([]),ee=u([]),le=u([]),x=u(!1),$=u(!0),N=u([]),ae=u(!0),F=u(!0),L=u(0),J=u(""),E=u(!0),R=u(!1),D=u([]),O=u(!1),K=u(null),te=u(),k=u(!1),V=u(X),s=Be({pageNum:1,pageSize:10,type:Y.dataType,caseId:void 0,caseName:void 0,projectId:void 0,moduleId:void 0,status:void 0,onlySelf:E}),S=u(X),m=u({page:!1,edite:!1,run:!1,copy:!1});function ne(o){return o||"全局"}function oe(o){if(o&&"caseId"in o&&o.caseId&&(D.value=[o.caseId]),!D.value||D.value.length===0){Fe.alert("请选择要运行的用例","提示！",{type:"warning"});return}R.value=!0}function we(o){k.value=!0,console.log(C(o)),V.value=structuredClone(Le(Je(o)))}function Ce(){k.value=!0;let o={caseId:V.value.caseId,caseName:V.value.caseName};Qe(o).then(n=>{Ke.success("复制成功")}).finally(()=>{k.value=!1})}function T(){m.value.page=!0,Ae(s.value).then(o=>{Z.value=o.rows,L.value=o.total}).finally(()=>{m.value.page=!1})}function Ie(){Ze(null).then(o=>{ee.value=o.data})}function ke(){Xe(s.value).then(o=>{le.value=o.data})}function Ve(){s.value.moduleId=void 0,ke()}function j(){s.value.pageNum=1,T()}function xe(){h.resetForm("queryRef"),j()}function Ne(o){N.value=o.map(n=>n.caseId),D.value=N.value,ae.value=o.length!==1,F.value=!o.length}function De(){x.value=!0,J.value="添加"+y.value,S.value=JSON.parse(JSON.stringify(X))}function se(o){m.value.edite=!0;const n=o.caseId||N.value;Ge(n).then(b=>{if(!b.data||Object.keys(b.data).length===0){alert("未查到对应数据！");return}S.value=b.data,x.value=!0,J.value="修改"+y.value}).finally(()=>{m.value.edite=!1})}function Se(o){const n=o.caseId||N.value;K.value=o,te.value=n,O.value=!0}function ue(o){const n=o.caseId||N.value;h.$modal.confirm('是否确认删除ID为"'+n+'"的数据项？').then(function(){return We(n)}).then(()=>{T(),h.$modal.msgSuccess("删除成功")}).catch(()=>{})}function Te(){h.download("hrm/case/export",{...s.value},`Case_${new Date().getTime()}.xlsx`)}return He(()=>{Ie(),T()}),(o,n)=>{var ce,pe,me;const b=d("el-option"),Q=d("el-select"),w=d("el-form-item"),A=d("el-input"),je=d("el-checkbox"),r=d("el-button"),Ue=d("el-form"),U=d("el-col"),$e=d("right-toolbar"),Ee=d("el-row"),f=d("el-table-column"),Re=d("dict-tag"),Oe=d("el-table"),Pe=d("pagination"),de=d("el-main"),ie=d("el-container"),re=d("el-dialog"),g=ye("hasPermi"),qe=ye("loading");return i(),q("div",tl,[c(a(Ue,{model:e(s),ref:"queryRef",inline:!0},{default:t(()=>[a(w,{label:"所属项目",prop:"projectId"},{default:t(()=>[a(Q,{modelValue:e(s).projectId,"onUpdate:modelValue":n[0]||(n[0]=l=>e(s).projectId=l),placeholder:"请选择",onChange:Ve,clearable:"",style:{width:"150px"}},{default:t(()=>[(i(!0),q(G,null,W(e(ee),l=>(i(),p(b,{key:l.projectId,label:l.projectName,value:l.projectId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(w,{label:"所属模块",prop:"moduleId"},{default:t(()=>[a(Q,{modelValue:e(s).moduleId,"onUpdate:modelValue":n[1]||(n[1]=l=>e(s).moduleId=l),placeholder:"请选择",clearable:"",style:{width:"150px"}},{default:t(()=>[(i(!0),q(G,null,W(e(le),l=>(i(),p(b,{key:l.moduleId,label:l.moduleName,value:l.moduleId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(w,{label:e(y)+"ID",prop:"caseId"},{default:t(()=>[a(A,{modelValue:e(s).caseId,"onUpdate:modelValue":n[2]||(n[2]=l=>e(s).caseId=l),placeholder:"请输入"+e(y)+"名称",clearable:"",style:{width:"200px"},onKeyup:ve(j,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(w,{label:e(y)+"名称",prop:"caseName"},{default:t(()=>[a(A,{modelValue:e(s).caseName,"onUpdate:modelValue":n[3]||(n[3]=l=>e(s).caseName=l),placeholder:"请输入"+e(y)+"名称",clearable:"",style:{width:"200px"},onKeyup:ve(j,["enter"])},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),a(w,{label:"状态",prop:"status"},{default:t(()=>[a(Q,{modelValue:e(s).status,"onUpdate:modelValue":n[4]||(n[4]=l=>e(s).status=l),placeholder:e(y)+"状态",clearable:"",style:{width:"100px"}},{default:t(()=>[(i(!0),q(G,null,W(e(z),l=>(i(),p(b,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1}),a(w,null,{default:t(()=>[a(je,{modelValue:e(E),"onUpdate:modelValue":n[5]||(n[5]=l=>C(E)?E.value=l:null),onChange:j},{default:t(()=>[_("仅自己的数据")]),_:1},8,["modelValue"])]),_:1}),a(w,null,{default:t(()=>[a(r,{type:"primary",icon:"Search",onClick:j,loading:e(m).page,disabled:e(m).page},{default:t(()=>[_(" 搜索 ")]),_:1},8,["loading","disabled"]),a(r,{type:"default",icon:"Refresh",onClick:xe},{default:t(()=>[_("重置")]),_:1})]),_:1})]),_:1},8,["model"]),[[_e,e($)]]),a(Ee,{gutter:10,class:"mb8"},{default:t(()=>[a(U,{span:1.5},{default:t(()=>[c((i(),p(r,{type:"primary",plain:"",icon:"Plus",onClick:De},{default:t(()=>[_("新增 ")]),_:1})),[[g,["hrm:case:add"]]])]),_:1}),a(U,{span:1.5},{default:t(()=>[c((i(),p(r,{type:"success",plain:"",icon:"Edit",disabled:e(ae),onClick:se},{default:t(()=>[_("修改 ")]),_:1},8,["disabled"])),[[g,["hrm:case:edit"]]])]),_:1}),a(U,{span:1.5},{default:t(()=>[c((i(),p(r,{type:"danger",plain:"",icon:"Delete",disabled:e(F),onClick:ue},{default:t(()=>[_("删除 ")]),_:1},8,["disabled"])),[[g,["hrm:case:remove"]]])]),_:1}),a(U,{span:1.5},{default:t(()=>[c((i(),p(r,{type:"warning",plain:"",icon:"Download",onClick:Te},{default:t(()=>[_("导出 ")]),_:1})),[[g,["hrm:case:export"]]])]),_:1}),a(U,{span:1.5},{default:t(()=>[v.dataType===e(I).case?c((i(),p(r,{key:0,type:"warning",icon:"CaretRight",onClick:oe,title:"运行",disabled:e(F)},{default:t(()=>[_(" 执行 ")]),_:1},8,["disabled"])),[[g,["hrm:case:run"]]]):B("",!0)]),_:1}),a($e,{showSearch:e($),"onUpdate:showSearch":n[6]||(n[6]=l=>C($)?$.value=l:null),onQueryTable:T},null,8,["showSearch"])]),_:1}),c((i(),p(Oe,{data:e(Z),onSelectionChange:Ne,border:"","table-layout":"fixed","max-height":"calc(100vh - 280px)"},{default:t(()=>[a(f,{type:"selection",width:"55",align:"center"}),a(f,{label:e(y)+"ID",prop:"caseId",width:"150px"},null,8,["label"]),a(f,{label:e(y)+"名称",prop:"caseName",width:"auto"},null,8,["label"]),a(f,{label:"所属项目",prop:"projectName"},{default:t(l=>[H("span",null,M(ne(l.row.projectName)),1)]),_:1}),a(f,{label:"所属模块",prop:"moduleName"},{default:t(l=>[H("span",null,M(ne(l.row.moduleName)),1)]),_:1}),a(f,{label:"状态",align:"center",prop:"status",width:"70px"},{default:t(l=>[a(Re,{options:e(z),value:l.row.status},null,8,["options","value"])]),_:1}),a(f,{label:"创建人",align:"center",prop:"createBy"}),a(f,{label:"创建时间",align:"center",prop:"createTime","class-name":"small-padding fixed-width",width:"150px"},{default:t(l=>[H("span",null,M(o.parseTime(l.row.createTime)),1)]),_:1}),a(f,{label:"更新时间",align:"center",prop:"createTime","class-name":"small-padding fixed-width",width:"150px"},{default:t(l=>[H("span",null,M(o.parseTime(l.row.updateTime)),1)]),_:1}),a(f,{label:"操作",width:"170",align:"center","class-name":"small-padding fixed-width",fixed:"right"},{default:t(l=>[v.dataType===e(I).case?c((i(),p(r,{key:0,link:"",type:"primary",icon:"Histogram",onClick:P=>Se(l.row),title:"执行历史"},null,8,["onClick"])),[[g,["hrm:case:history"]]]):B("",!0),c(a(r,{link:"",type:"warning",icon:"Edit",loading:e(m).edite,onClick:P=>se(l.row),title:"编辑"},null,8,["loading","onClick"]),[[g,["hrm:case:edit"]]]),v.dataType===e(I).case?c((i(),p(r,{key:1,link:"",type:"warning",icon:"CaretRight",loading:e(m).run,onClick:P=>oe(l.row),title:"运行"},null,8,["loading","onClick"])),[[g,["hrm:case:run"]]]):B("",!0),c(a(r,{link:"",type:"warning",icon:"CopyDocument",loading:e(m).copy,onClick:P=>we(l.row),title:"复制"},null,8,["loading","onClick"]),[[g,["hrm:case:copy"]]]),c(a(r,{link:"",type:"danger",icon:"Delete",onClick:P=>ue(l.row),title:"删除"},null,8,["onClick"]),[[g,["hrm:case:remove"]]])]),_:1})]),_:1},8,["data"])),[[qe,e(m).page]]),c(a(Pe,{total:e(L),page:e(s).pageNum,"onUpdate:page":n[7]||(n[7]=l=>e(s).pageNum=l),limit:e(s).pageSize,"onUpdate:limit":n[8]||(n[8]=l=>e(s).pageSize=l),onPagination:T},null,8,["total","page","limit"]),[[_e,e(L)>0]]),a(el,{"form-datas":e(S),"data-type":v.dataType,"form-rules":v.formRules,"open-case-edit-dialog":e(x),"onUpdate:openCaseEditDialog":n[9]||(n[9]=l=>C(x)?x.value=l:null),title:e(be)},null,8,["form-datas","data-type","form-rules","open-case-edit-dialog","title"]),v.dataType===e(I).case?(i(),p(re,{key:0,fullscreen:"",title:"【"+((ce=e(K))==null?void 0:ce.caseId)+"】"+((pe=e(K))==null?void 0:pe.caseName),modelValue:e(O),"onUpdate:modelValue":n[10]||(n[10]=l=>C(O)?O.value=l:null),"append-to-body":"","destroy-on-close":""},{default:t(()=>[a(ie,{style:{height:"100%"}},{default:t(()=>[a(de,{style:{"max-height":"calc(100vh - 95px)"}},{default:t(()=>[a(ll,{"run-id":e(te),"view-type":e(Ye).case},null,8,["run-id","view-type"])]),_:1})]),_:1})]),_:1},8,["title","modelValue"])):B("",!0),a(re,{title:(me=e(V))==null?void 0:me.caseName,modelValue:e(k),"onUpdate:modelValue":n[12]||(n[12]=l=>C(k)?k.value=l:null),"append-to-body":"","destroy-on-close":""},{default:t(()=>[a(ie,{style:{height:"100%"}},{default:t(()=>[a(de,{style:{"max-height":"calc(100vh - 95px)"}},{default:t(()=>[a(A,{placeholder:"请输入用例名称",modelValue:e(V).caseName,"onUpdate:modelValue":n[11]||(n[11]=l=>e(V).caseName=l)},{suffix:t(()=>[a(r,{onClick:Ce},{default:t(()=>[_("保存")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["title","modelValue"]),a(al,{"dialog-visible":e(R),"onUpdate:dialogVisible":n[13]||(n[13]=l=>C(R)?R.value=l:null),"run-type":e(I).case,"run-ids":e(D)},null,8,["dialog-visible","run-type","run-ids"])])}}});export{vl as default};
