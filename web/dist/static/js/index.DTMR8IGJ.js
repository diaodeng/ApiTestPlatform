import{a as Pe,r as v,D as Te,J as Ge,d as p,B as ae,o as i,c as _,C as c,I as ue,h as t,e,f as l,l as qe,K as $,L as I,m as g,p as r,G as D,i as h,y as j,n as R,F as De,s as Re}from"./index.D1UU-JKR.js";import{l as Je,c as Fe,r as Ae,g as re,u as Ke,a as Le,d as Be}from"./job.BlkPJtNU.js";import{C as ze}from"./index.BuH4yV84.js";import{A as Oe}from"./ace-editor.C0dgdm4x.js";import"./tools.CngWgkPu.js";import"./ResizeObserver.es.B1PUzC5B.js";const Qe={class:"app-container"},He={class:"dialog-footer"},Me={key:0},We={key:1},Xe={key:0},Ye={key:1},Ze={key:0},el={key:1},ll={key:2},ol={key:3},tl={class:"dialog-footer"},nl=De({name:"Job"}),ml=Object.assign(nl,{setup(al){const se=Pe(),{proxy:m}=Re(),{sys_job_group:P,sys_job_status:M,sys_job_executor:W}=m.useDict("sys_job_group","sys_job_status","sys_job_executor"),{job_run_status:de}=m.useDict("job_run_status"),X=v([]),k=v(!1),J=v(!0),T=v(!0),F=v([]),Y=v(!0),Z=v(!0),A=v(0),K=v(""),U=v(!1),N=v(!1),ee=v(""),ie=Te({form:{},queryParams:{pageNum:1,pageSize:10,jobName:void 0,jobGroup:void 0,status:void 0},rules:{jobName:[{required:!0,message:"任务名称不能为空",trigger:"blur"}],invokeTarget:[{required:!0,message:"调用目标字符串不能为空",trigger:"blur"}],cronExpression:[{required:!0,message:"cron执行表达式不能为空",trigger:"change"}]}}),{queryParams:b,form:a,rules:pe}=Ge(ie);function w(){J.value=!0,Je(b.value).then(u=>{X.value=u.rows,A.value=u.total,J.value=!1})}function me(u,o){return m.selectDictLabel(P.value,u.jobGroup)}function fe(u,o){return m.selectDictLabel(W.value,u.jobExecutor)}function be(){k.value=!1,L()}function L(){a.value={jobId:void 0,jobName:void 0,jobGroup:void 0,invokeTarget:void 0,cronExpression:void 0,misfirePolicy:"1",concurrent:"1",status:"0"},m.resetForm("jobRef")}function B(){b.value.pageNum=1,w()}function _e(){m.resetForm("queryRef"),B()}function ce(u){F.value=u.map(o=>o.jobId),Y.value=u.length!=1,Z.value=!u.length}function ve(u){let o=u.status==="0"?"启用":"停用";m.$modal.confirm('确认要"'+o+'""'+u.jobName+'"任务吗?').then(function(){return Fe(u.jobId,u.status)}).then(()=>{m.$modal.msgSuccess(o+"成功")}).catch(function(){u.status=u.status==="0"?"1":"0"})}function ge(u){m.$modal.confirm('确认要立即执行一次"'+u.jobName+'"任务吗?').then(function(){return Ae(u.jobId,u.jobGroup)}).then(()=>{m.$modal.msgSuccess("执行成功")}).catch(()=>{})}function je(u){re(u.jobId).then(o=>{a.value=o.data,U.value=!0})}function ye(){ee.value=a.value.cronExpression,N.value=!0}function Ve(u){a.value.cronExpression=u}function le(u){const o=u.jobId||0;se.push("/monitor/job-log/index/"+o)}function ke(){L(),k.value=!0,K.value="添加任务"}function oe(u){L();const o=u.jobId||F.value;re(o).then(x=>{a.value=x.data,k.value=!0,K.value="修改任务"})}function we(){m.$refs.jobRef.validate(u=>{u&&(a.value.jobId!=null?Ke(a.value).then(o=>{m.$modal.msgSuccess("修改成功"),k.value=!1,w()}):Le(a.value).then(o=>{m.$modal.msgSuccess("新增成功"),k.value=!1,w()}))})}function te(u){const o=u.jobId||F.value;m.$modal.confirm('是否确认删除定时任务编号为"'+o+'"的数据项?').then(function(){return Be(o)}).then(()=>{w(),m.$modal.msgSuccess("删除成功")}).catch(()=>{})}function xe(){m.download("monitor/job/export",{...b.value},`job_${new Date().getTime()}.xlsx`)}return w(),(u,o)=>{const x=p("el-input"),s=p("el-form-item"),G=p("el-option"),q=p("el-select"),f=p("el-button"),z=p("el-form"),d=p("el-col"),Ce=p("right-toolbar"),O=p("el-row"),V=p("el-table-column"),ne=p("dict-tag"),he=p("el-switch"),S=p("el-tooltip"),Se=p("el-table"),Ue=p("pagination"),Ne=p("question-filled"),Ee=p("el-icon"),$e=p("el-radio"),Q=p("el-radio-group"),E=p("el-radio-button"),H=p("el-dialog"),y=ae("hasPermi"),Ie=ae("loading");return i(),_("div",Qe,[c(e(z,{model:t(b),ref:"queryRef",inline:!0},{default:l(()=>[e(s,{label:"任务名称",prop:"jobName"},{default:l(()=>[e(x,{modelValue:t(b).jobName,"onUpdate:modelValue":o[0]||(o[0]=n=>t(b).jobName=n),placeholder:"请输入任务名称",clearable:"",style:{width:"200px"},onKeyup:qe(B,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"任务组名",prop:"jobGroup"},{default:l(()=>[e(q,{modelValue:t(b).jobGroup,"onUpdate:modelValue":o[1]||(o[1]=n=>t(b).jobGroup=n),placeholder:"请选择任务组名",clearable:"",style:{width:"200px"}},{default:l(()=>[(i(!0),_($,null,I(t(P),n=>(i(),g(G,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"任务状态",prop:"status"},{default:l(()=>[e(q,{modelValue:t(b).status,"onUpdate:modelValue":o[2]||(o[2]=n=>t(b).status=n),placeholder:"请选择任务状态",clearable:"",style:{width:"200px"}},{default:l(()=>[(i(!0),_($,null,I(t(M),n=>(i(),g(G,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,null,{default:l(()=>[e(f,{type:"primary",icon:"Search",onClick:B},{default:l(()=>o[21]||(o[21]=[r("搜索")])),_:1}),e(f,{icon:"Refresh",onClick:_e},{default:l(()=>o[22]||(o[22]=[r("重置")])),_:1})]),_:1})]),_:1},8,["model"]),[[ue,t(T)]]),e(O,{gutter:10,class:"mb8"},{default:l(()=>[e(d,{span:1.5},{default:l(()=>[c((i(),g(f,{type:"primary",plain:"",icon:"Plus",onClick:ke},{default:l(()=>o[23]||(o[23]=[r("新增 ")])),_:1})),[[y,["monitor:job:add"]]])]),_:1}),e(d,{span:1.5},{default:l(()=>[c((i(),g(f,{type:"success",plain:"",icon:"Edit",disabled:t(Y),onClick:oe},{default:l(()=>o[24]||(o[24]=[r("修改 ")])),_:1},8,["disabled"])),[[y,["monitor:job:edit"]]])]),_:1}),e(d,{span:1.5},{default:l(()=>[c((i(),g(f,{type:"danger",plain:"",icon:"Delete",disabled:t(Z),onClick:te},{default:l(()=>o[25]||(o[25]=[r("删除 ")])),_:1},8,["disabled"])),[[y,["monitor:job:remove"]]])]),_:1}),e(d,{span:1.5},{default:l(()=>[c((i(),g(f,{type:"warning",plain:"",icon:"Download",onClick:xe},{default:l(()=>o[26]||(o[26]=[r("导出 ")])),_:1})),[[y,["monitor:job:export"]]])]),_:1}),e(d,{span:1.5},{default:l(()=>[c((i(),g(f,{type:"info",plain:"",icon:"Operation",onClick:le},{default:l(()=>o[27]||(o[27]=[r("日志 ")])),_:1})),[[y,["monitor:job:query"]]])]),_:1}),e(Ce,{showSearch:t(T),"onUpdate:showSearch":o[3]||(o[3]=n=>D(T)?T.value=n:null),onQueryTable:w},null,8,["showSearch"])]),_:1}),c((i(),g(Se,{data:t(X),onSelectionChange:ce},{default:l(()=>[e(V,{type:"selection",width:"55",align:"center"}),e(V,{label:"任务编号",width:"100",align:"center",prop:"jobId"}),e(V,{label:"任务名称",align:"center",prop:"jobName","show-overflow-tooltip":!0}),e(V,{label:"任务组名",align:"center",prop:"jobGroup"},{default:l(n=>[e(ne,{options:t(P),value:n.row.jobGroup},null,8,["options","value"])]),_:1}),e(V,{label:"调用目标字符串",align:"center",prop:"invokeTarget","show-overflow-tooltip":!0}),e(V,{label:"cron执行表达式",align:"center",prop:"cronExpression","show-overflow-tooltip":!0}),e(V,{prop:"status",label:"执行状态",align:"center",width:"70"},{default:l(n=>[e(ne,{options:t(de),value:n.row.runStatus},null,8,["options","value"])]),_:1}),e(V,{label:"状态",align:"center"},{default:l(n=>[e(he,{modelValue:n.row.status,"onUpdate:modelValue":C=>n.row.status=C,"active-value":"0","inactive-value":"1",onChange:C=>ve(n.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(V,{label:"操作",align:"center",width:"200","class-name":"small-padding fixed-width"},{default:l(n=>[e(S,{content:"修改",placement:"top"},{default:l(()=>[c(e(f,{link:"",type:"primary",icon:"Edit",onClick:C=>oe(n.row)},null,8,["onClick"]),[[y,["monitor:job:edit"]]])]),_:2},1024),e(S,{content:"删除",placement:"top"},{default:l(()=>[c(e(f,{link:"",type:"primary",icon:"Delete",onClick:C=>te(n.row)},null,8,["onClick"]),[[y,["monitor:job:remove"]]])]),_:2},1024),e(S,{content:"执行一次",placement:"top"},{default:l(()=>[c(e(f,{link:"",type:"primary",icon:"CaretRight",onClick:C=>ge(n.row)},null,8,["onClick"]),[[y,["monitor:job:changeStatus"]]])]),_:2},1024),e(S,{content:"任务详细",placement:"top"},{default:l(()=>[c(e(f,{link:"",type:"primary",icon:"View",onClick:C=>je(n.row)},null,8,["onClick"]),[[y,["monitor:job:query"]]])]),_:2},1024),e(S,{content:"调度日志",placement:"top"},{default:l(()=>[c(e(f,{link:"",type:"primary",icon:"Operation",onClick:C=>le(n.row)},null,8,["onClick"]),[[y,["monitor:job:query"]]])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Ie,t(J)]]),c(e(Ue,{total:t(A),page:t(b).pageNum,"onUpdate:page":o[4]||(o[4]=n=>t(b).pageNum=n),limit:t(b).pageSize,"onUpdate:limit":o[5]||(o[5]=n=>t(b).pageSize=n),onPagination:w},null,8,["total","page","limit"]),[[ue,t(A)>0]]),e(H,{title:t(K),modelValue:t(k),"onUpdate:modelValue":o[16]||(o[16]=n=>D(k)?k.value=n:null),width:"820px","append-to-body":""},{footer:l(()=>[h("div",He,[e(f,{type:"primary",onClick:we},{default:l(()=>o[36]||(o[36]=[r("确 定")])),_:1}),e(f,{onClick:be},{default:l(()=>o[37]||(o[37]=[r("取 消")])),_:1})])]),default:l(()=>[e(z,{ref:"jobRef",model:t(a),rules:t(pe),"label-width":"120px"},{default:l(()=>[e(O,null,{default:l(()=>[e(d,{span:24},{default:l(()=>[e(s,{label:"任务名称",prop:"jobName"},{default:l(()=>[e(x,{modelValue:t(a).jobName,"onUpdate:modelValue":o[6]||(o[6]=n=>t(a).jobName=n),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"任务分组",prop:"jobGroup"},{default:l(()=>[e(q,{modelValue:t(a).jobGroup,"onUpdate:modelValue":o[7]||(o[7]=n=>t(a).jobGroup=n),placeholder:"请选择"},{default:l(()=>[(i(!0),_($,null,I(t(P),n=>(i(),g(G,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"任务执行器",prop:"jobGroup"},{default:l(()=>[e(q,{modelValue:t(a).jobExecutor,"onUpdate:modelValue":o[8]||(o[8]=n=>t(a).jobExecutor=n),placeholder:"请选择任务执行器"},{default:l(()=>[(i(!0),_($,null,I(t(W),n=>(i(),g(G,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[e(s,{prop:"invokeTarget"},{label:l(()=>[h("span",null,[o[29]||(o[29]=r(" 调用方法 ")),e(S,{placement:"top"},{content:l(()=>o[28]||(o[28]=[h("div",null,[r(" Bean调用示例：ryTask.ryParams('ry') "),h("br"),r("Class类调用示例：com.ruoyi.quartz.task.RyTask.ryParams('ry') "),h("br"),r("参数说明：支持字符串，布尔类型，长整型，浮点型，整型 ")],-1)])),default:l(()=>[e(Ee,null,{default:l(()=>[e(Ne)]),_:1})]),_:1})])]),default:l(()=>[e(x,{modelValue:t(a).invokeTarget,"onUpdate:modelValue":o[9]||(o[9]=n=>t(a).invokeTarget=n),placeholder:"请输入调用目标字符串"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[e(s,{label:"位置参数",prop:"jobArgs"},{default:l(()=>[e(x,{modelValue:t(a).jobArgs,"onUpdate:modelValue":o[10]||(o[10]=n=>t(a).jobArgs=n),placeholder:"请输入位置参数"},null,8,["modelValue"])]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[e(s,{label:"关键字参数",prop:"jobKwargs"},{default:l(()=>[e(Oe,{content:t(a).jobKwargs,"onUpdate:content":o[11]||(o[11]=n=>t(a).jobKwargs=n),lang:"json",themes:"monokai",height:"300px",width:"670px",placeholder:"请输入关键字参数"},null,8,["content"])]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[e(s,{label:"cron表达式",prop:"cronExpression"},{default:l(()=>[e(x,{modelValue:t(a).cronExpression,"onUpdate:modelValue":o[12]||(o[12]=n=>t(a).cronExpression=n),placeholder:"请输入cron执行表达式"},{append:l(()=>[e(f,{type:"primary",onClick:ye},{default:l(()=>o[30]||(o[30]=[r(" 生成表达式 "),h("i",{class:"el-icon-time el-icon--right"},null,-1)])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),t(a).jobId!==void 0?(i(),g(d,{key:0,span:24},{default:l(()=>[e(s,{label:"状态"},{default:l(()=>[e(Q,{modelValue:t(a).status,"onUpdate:modelValue":o[13]||(o[13]=n=>t(a).status=n)},{default:l(()=>[(i(!0),_($,null,I(t(M),n=>(i(),g($e,{key:n.value,label:n.value},{default:l(()=>[r(j(n.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})):R("",!0),e(d,{span:12},{default:l(()=>[e(s,{label:"执行策略",prop:"misfirePolicy"},{default:l(()=>[e(Q,{modelValue:t(a).misfirePolicy,"onUpdate:modelValue":o[14]||(o[14]=n=>t(a).misfirePolicy=n)},{default:l(()=>[e(E,{label:"1"},{default:l(()=>o[31]||(o[31]=[r("立即执行")])),_:1}),e(E,{label:"2"},{default:l(()=>o[32]||(o[32]=[r("执行一次")])),_:1}),e(E,{label:"3"},{default:l(()=>o[33]||(o[33]=[r("放弃执行")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"是否并发",prop:"concurrent"},{default:l(()=>[e(Q,{modelValue:t(a).concurrent,"onUpdate:modelValue":o[15]||(o[15]=n=>t(a).concurrent=n)},{default:l(()=>[e(E,{label:"0"},{default:l(()=>o[34]||(o[34]=[r("允许")])),_:1}),e(E,{label:"1"},{default:l(()=>o[35]||(o[35]=[r("禁止")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),e(H,{title:"Cron表达式生成器",modelValue:t(N),"onUpdate:modelValue":o[18]||(o[18]=n=>D(N)?N.value=n:null),"append-to-body":"","destroy-on-close":""},{default:l(()=>[e(t(ze),{ref:"crontabRef",onHide:o[17]||(o[17]=n=>N.value=!1),onFill:Ve,expression:t(ee)},null,8,["expression"])]),_:1},8,["modelValue"]),e(H,{title:"任务详细",modelValue:t(U),"onUpdate:modelValue":o[20]||(o[20]=n=>D(U)?U.value=n:null),width:"700px","append-to-body":""},{footer:l(()=>[h("div",tl,[e(f,{onClick:o[19]||(o[19]=n=>U.value=!1)},{default:l(()=>o[38]||(o[38]=[r("关 闭")])),_:1})])]),default:l(()=>[e(z,{model:t(a),"label-width":"120px"},{default:l(()=>[e(O,null,{default:l(()=>[e(d,{span:12},{default:l(()=>[e(s,{label:"任务编号："},{default:l(()=>[r(j(t(a).jobId),1)]),_:1}),e(s,{label:"任务名称："},{default:l(()=>[r(j(t(a).jobName),1)]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"任务分组："},{default:l(()=>[r(j(me(t(a))),1)]),_:1}),e(s,{label:"创建时间："},{default:l(()=>[r(j(u.parseTime(t(a).createTime)),1)]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"cron表达式："},{default:l(()=>[r(j(t(a).cronExpression),1)]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"下次执行时间："},{default:l(()=>[r(j(u.parseTime(t(a).nextValidTime)),1)]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"任务执行器："},{default:l(()=>[r(j(fe(t(a))),1)]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[e(s,{label:"调用目标方法："},{default:l(()=>[r(j(t(a).invokeTarget),1)]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[e(s,{label:"位置参数："},{default:l(()=>[r(j(t(a).jobArgs),1)]),_:1})]),_:1}),e(d,{span:24},{default:l(()=>[e(s,{label:"关键字参数："},{default:l(()=>[r(j(t(a).jobKwargs),1)]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"任务状态："},{default:l(()=>[t(a).status==0?(i(),_("div",Me,"正常")):t(a).status==1?(i(),_("div",We,"暂停")):R("",!0)]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"是否并发："},{default:l(()=>[t(a).concurrent==0?(i(),_("div",Xe,"允许")):t(a).concurrent==1?(i(),_("div",Ye,"禁止")):R("",!0)]),_:1})]),_:1}),e(d,{span:12},{default:l(()=>[e(s,{label:"执行策略："},{default:l(()=>[t(a).misfirePolicy=="0"?(i(),_("div",Ze,"默认策略")):t(a).misfirePolicy=="1"?(i(),_("div",el,"立即执行")):t(a).misfirePolicy=="2"?(i(),_("div",ll,"执行一次")):t(a).misfirePolicy=="3"?(i(),_("div",ol,"放弃执行")):R("",!0)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});export{ml as default};
