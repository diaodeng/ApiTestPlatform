{"version":3,"file":"log.DPwlSFt7.js","sources":["../../../src/api/qtr/jobLog.js","../../../src/views/qtr/job/log.vue"],"sourcesContent":["import request from '@/utils/request'\r\n\r\n// 查询调度日志列表\r\nexport function listJobLog(query) {\r\n  return request({\r\n    url: '/qtr/jobLog/list',\r\n    method: 'get',\r\n    params: query\r\n  })\r\n}\r\n\r\n// 删除调度日志\r\nexport function delJobLog(jobLogId) {\r\n  return request({\r\n    url: '/qtr/jobLog/' + jobLogId,\r\n    method: 'delete'\r\n  })\r\n}\r\n\r\n// 清空调度日志\r\nexport function cleanJobLog() {\r\n  return request({\r\n    url: '/qtr/jobLog/clean',\r\n    method: 'delete'\r\n  })\r\n}\r\n","<template>\r\n   <div class=\"app-container\">\r\n      <el-form :model=\"queryParams\" ref=\"queryRef\" :inline=\"true\" v-show=\"showSearch\" label-width=\"68px\">\r\n         <el-form-item label=\"任务名称\" prop=\"jobName\">\r\n            <el-input\r\n               v-model=\"queryParams.jobName\"\r\n               placeholder=\"请输入任务名称\"\r\n               clearable\r\n               style=\"width: 240px\"\r\n               @keyup.enter=\"handleQuery\"\r\n            />\r\n         </el-form-item>\r\n         <el-form-item label=\"任务组名\" prop=\"jobGroup\">\r\n            <el-select\r\n               v-model=\"queryParams.jobGroup\"\r\n               placeholder=\"请选择任务组名\"\r\n               clearable\r\n               style=\"width: 240px\"\r\n            >\r\n               <el-option\r\n                  v-for=\"dict in sys_job_group\"\r\n                  :key=\"dict.value\"\r\n                  :label=\"dict.label\"\r\n                  :value=\"dict.value\"\r\n               />\r\n            </el-select>\r\n         </el-form-item>\r\n         <el-form-item label=\"执行状态\" prop=\"status\">\r\n            <el-select\r\n               v-model=\"queryParams.status\"\r\n               placeholder=\"请选择执行状态\"\r\n               clearable\r\n               style=\"width: 240px\"\r\n            >\r\n               <el-option\r\n                  v-for=\"dict in sys_common_status\"\r\n                  :key=\"dict.value\"\r\n                  :label=\"dict.label\"\r\n                  :value=\"dict.value\"\r\n               />\r\n            </el-select>\r\n         </el-form-item>\r\n         <el-form-item label=\"执行时间\" style=\"width: 308px\">\r\n            <el-date-picker\r\n               v-model=\"dateRange\"\r\n               value-format=\"YYYY-MM-DD\"\r\n               type=\"daterange\"\r\n               range-separator=\"-\"\r\n               start-placeholder=\"开始日期\"\r\n               end-placeholder=\"结束日期\"\r\n            ></el-date-picker>\r\n         </el-form-item>\r\n         <el-form-item>\r\n            <el-button type=\"primary\" icon=\"Search\" @click=\"handleQuery\">搜索</el-button>\r\n            <el-button icon=\"Refresh\" @click=\"resetQuery\">重置</el-button>\r\n         </el-form-item>\r\n      </el-form>\r\n\r\n      <el-row :gutter=\"10\" class=\"mb8\">\r\n         <el-col :span=\"1.5\">\r\n            <el-button\r\n               type=\"danger\"\r\n               plain\r\n               icon=\"Delete\"\r\n               :disabled=\"multiple\"\r\n               @click=\"handleDelete\"\r\n               v-hasPermi=\"['qtr:job:remove']\"\r\n            >删除</el-button>\r\n         </el-col>\r\n         <el-col :span=\"1.5\">\r\n            <el-button\r\n               type=\"danger\"\r\n               plain\r\n               icon=\"Delete\"\r\n               @click=\"handleClean\"\r\n               v-hasPermi=\"['qtr:job:remove']\"\r\n            >清空</el-button>\r\n         </el-col>\r\n         <el-col :span=\"1.5\">\r\n            <el-button\r\n               type=\"warning\"\r\n               plain\r\n               icon=\"Download\"\r\n               @click=\"handleExport\"\r\n               v-hasPermi=\"['qtr:job:export']\"\r\n            >导出</el-button>\r\n         </el-col>\r\n         <el-col :span=\"1.5\">\r\n            <el-button\r\n               type=\"warning\"\r\n               plain\r\n               icon=\"Close\"\r\n               @click=\"handleClose\"\r\n            >关闭</el-button>\r\n         </el-col>\r\n         <right-toolbar v-model:showSearch=\"showSearch\" @queryTable=\"getList\"></right-toolbar>\r\n      </el-row>\r\n\r\n      <el-table v-loading=\"loading\" :data=\"jobLogList\" @selection-change=\"handleSelectionChange\">\r\n         <el-table-column type=\"selection\" width=\"55\" align=\"center\" />\r\n         <el-table-column label=\"日志编号\" width=\"80\" align=\"center\" prop=\"jobLogId\" />\r\n         <el-table-column label=\"任务名称\" align=\"center\" prop=\"jobName\" :show-overflow-tooltip=\"true\" />\r\n         <el-table-column label=\"任务组名\" align=\"center\" prop=\"jobGroup\" :show-overflow-tooltip=\"true\">\r\n            <template #default=\"scope\">\r\n               <dict-tag :options=\"sys_job_group\" :value=\"scope.row.jobGroup\" />\r\n            </template>\r\n         </el-table-column>\r\n         <el-table-column label=\"调用目标字符串\" align=\"center\" prop=\"invokeTarget\" :show-overflow-tooltip=\"true\" />\r\n         <el-table-column label=\"日志信息\" align=\"center\" prop=\"jobMessage\" :show-overflow-tooltip=\"true\" />\r\n         <el-table-column label=\"执行状态\" align=\"center\" prop=\"status\">\r\n            <template #default=\"scope\">\r\n               <dict-tag :options=\"sys_common_status\" :value=\"scope.row.status\" />\r\n            </template>\r\n         </el-table-column>\r\n         <el-table-column label=\"执行时间\" align=\"center\" prop=\"createTime\" width=\"180\">\r\n            <template #default=\"scope\">\r\n               <span>{{ parseTime(scope.row.createTime) }}</span>\r\n            </template>\r\n         </el-table-column>\r\n         <el-table-column label=\"操作\" align=\"center\" class-name=\"small-padding fixed-width\">\r\n            <template #default=\"scope\">\r\n               <el-button link type=\"primary\" icon=\"View\" @click=\"handleView(scope.row)\" v-hasPermi=\"['qtr:job:query']\">详细</el-button>\r\n            </template>\r\n         </el-table-column>\r\n      </el-table>\r\n\r\n      <pagination\r\n         v-show=\"total > 0\"\r\n         :total=\"total\"\r\n         v-model:page=\"queryParams.pageNum\"\r\n         v-model:limit=\"queryParams.pageSize\"\r\n         @pagination=\"getList\"\r\n      />\r\n\r\n      <!-- 调度日志详细 -->\r\n      <el-dialog title=\"调度日志详细\" v-model=\"open\" width=\"700px\" append-to-body>\r\n         <el-form :model=\"form\" label-width=\"100px\">\r\n            <el-row>\r\n               <el-col :span=\"12\">\r\n                  <el-form-item label=\"日志序号：\">{{ form.jobLogId }}</el-form-item>\r\n                  <el-form-item label=\"任务名称：\">{{ form.jobName }}</el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"12\">\r\n                  <el-form-item label=\"任务分组：\">{{ jobGroupFormat(form) }}</el-form-item>\r\n                  <el-form-item label=\"执行时间：\">{{ parseTime(form.createTime) }}</el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"24\">\r\n                  <el-form-item label=\"任务执行器：\">{{ jobExecutorFormat(form) }}</el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"24\">\r\n                  <el-form-item label=\"任务触发器：\">{{ form.jobTrigger }}</el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"24\">\r\n                  <el-form-item label=\"调用方法：\">{{ form.invokeTarget }}</el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"24\">\r\n                  <el-form-item label=\"位置参数：\">{{ form.jobArgs }}</el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"24\">\r\n                  <el-form-item label=\"关键字参数：\">{{ form.jobKwargs }}</el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"24\">\r\n                  <el-form-item label=\"日志信息：\">{{ form.jobMessage }}</el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"24\">\r\n                  <el-form-item label=\"执行状态：\">\r\n                     <div v-if=\"form.status == 0\">正常</div>\r\n                     <div v-else-if=\"form.status == 1\">失败</div>\r\n                  </el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"24\">\r\n                  <el-form-item label=\"异常信息：\" v-if=\"form.status == 1\">{{ form.exceptionInfo }}</el-form-item>\r\n               </el-col>\r\n            </el-row>\r\n         </el-form>\r\n         <template #footer>\r\n            <div class=\"dialog-footer\">\r\n               <el-button @click=\"open = false\">关 闭</el-button>\r\n            </div>\r\n         </template>\r\n      </el-dialog>\r\n   </div>\r\n</template>\r\n\r\n<script setup name=\"QtrJobLog\">\r\nimport { getJob } from \"@/api/qtr/job.js\";\r\nimport { listJobLog, delJobLog, cleanJobLog } from \"@/api/qtr/jobLog.js\";\r\n\r\nconst { proxy } = getCurrentInstance();\r\nconst { sys_common_status, sys_job_group, sys_job_executor } = proxy.useDict(\"sys_common_status\", \"sys_job_group\", \"sys_job_executor\");\r\n\r\nconst jobLogList = ref([]);\r\nconst open = ref(false);\r\nconst loading = ref(true);\r\nconst showSearch = ref(true);\r\nconst ids = ref([]);\r\nconst multiple = ref(true);\r\nconst total = ref(0);\r\nconst dateRange = ref([]);\r\nconst route = useRoute();\r\n\r\nconst data = reactive({\r\n  form: {},\r\n  queryParams: {\r\n    pageNum: 1,\r\n    pageSize: 10,\r\n    dictName: undefined,\r\n    dictType: undefined,\r\n    status: undefined\r\n  }\r\n});\r\n\r\nconst { queryParams, form, rules } = toRefs(data);\r\n\r\n/** 查询调度日志列表 */\r\nfunction getList() {\r\n  loading.value = true;\r\n  listJobLog(proxy.addDateRange(queryParams.value, dateRange.value)).then(response => {\r\n    jobLogList.value = response.rows;\r\n    total.value = response.total;\r\n    loading.value = false;\r\n  });\r\n}\r\n/** 任务组名字典翻译 */\r\nfunction jobGroupFormat(row, column) {\r\n   return proxy.selectDictLabel(sys_job_group.value, row.jobGroup);\r\n}\r\n/** 任务组名字典翻译 */\r\nfunction jobExecutorFormat(row, column) {\r\n   return proxy.selectDictLabel(sys_job_executor.value, row.jobExecutor);\r\n}\r\n// 返回按钮\r\nfunction handleClose() {\r\n  const obj = { path: \"/hrm/qtr/qtr/job\" };\r\n  proxy.$tab.closeOpenPage(obj);\r\n}\r\n/** 搜索按钮操作 */\r\nfunction handleQuery() {\r\n  queryParams.value.pageNum = 1;\r\n  getList();\r\n}\r\n/** 重置按钮操作 */\r\nfunction resetQuery() {\r\n  dateRange.value = [];\r\n  proxy.resetForm(\"queryRef\");\r\n  handleQuery();\r\n}\r\n// 多选框选中数据\r\nfunction handleSelectionChange(selection) {\r\n  ids.value = selection.map(item => item.jobLogId);\r\n  multiple.value = !selection.length;\r\n}\r\n/** 详细按钮操作 */\r\nfunction handleView(row) {\r\n  open.value = true;\r\n  form.value = row;\r\n}\r\n/** 删除按钮操作 */\r\nfunction handleDelete(row) {\r\n  proxy.$modal.confirm('是否确认删除调度日志编号为\"' + ids.value + '\"的数据项?').then(function () {\r\n    return delJobLog(ids.value);\r\n  }).then(() => {\r\n    getList();\r\n    proxy.$modal.msgSuccess(\"删除成功\");\r\n  }).catch(() => {});\r\n}\r\n/** 清空按钮操作 */\r\nfunction handleClean() {\r\n  proxy.$modal.confirm(\"是否确认清空所有调度日志数据项?\").then(function () {\r\n    return cleanJobLog();\r\n  }).then(() => {\r\n    getList();\r\n    proxy.$modal.msgSuccess(\"清空成功\");\r\n  }).catch(() => {});\r\n}\r\n/** 导出按钮操作 */\r\nfunction handleExport() {\r\n  proxy.download(\"qtr/jobLog/export\", {\r\n    ...queryParams.value,\r\n  }, `job_log_${new Date().getTime()}.xlsx`);\r\n}\r\n\r\n(() => {\r\n  const jobId = route.params && route.params.jobId;\r\n  if (jobId !== undefined && jobId != 0) {\r\n    getJob(jobId).then(response => {\r\n      queryParams.value.jobName = response.data.jobName;\r\n      queryParams.value.jobGroup = response.data.jobGroup;\r\n      getList();\r\n    });\r\n  } else {\r\n    getList();\r\n  }\r\n})();\r\n\r\ngetList();\r\n</script>\r\n"],"names":["listJobLog","query","request","delJobLog","jobLogId","cleanJobLog","proxy","getCurrentInstance","sys_common_status","sys_job_group","sys_job_executor","jobLogList","ref","open","loading","showSearch","ids","multiple","total","dateRange","route","useRoute","data","reactive","queryParams","form","rules","toRefs","getList","response","jobGroupFormat","row","column","jobExecutorFormat","handleClose","obj","handleQuery","resetQuery","handleSelectionChange","selection","item","handleView","handleDelete","handleClean","handleExport","jobId","getJob"],"mappings":"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"}