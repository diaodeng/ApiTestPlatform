{"version":3,"file":"index.DCXtv8kc.js","sources":["../../../src/api/monitor/operlog.js","../../../src/views/monitor/operlog/index.vue"],"sourcesContent":["import request from '@/utils/request'\r\n\r\n// 查询操作日志列表\r\nexport function list(query) {\r\n  return request({\r\n    url: '/monitor/operlog/list',\r\n    method: 'get',\r\n    params: query\r\n  })\r\n}\r\n\r\n// 删除操作日志\r\nexport function delOperlog(operId) {\r\n  return request({\r\n    url: '/monitor/operlog/' + operId,\r\n    method: 'delete'\r\n  })\r\n}\r\n\r\n// 清空操作日志\r\nexport function cleanOperlog() {\r\n  return request({\r\n    url: '/monitor/operlog/clean',\r\n    method: 'delete'\r\n  })\r\n}\r\n","<template>\r\n   <div class=\"app-container\">\r\n      <el-form :model=\"queryParams\" ref=\"queryRef\" :inline=\"true\" v-show=\"showSearch\" label-width=\"68px\">\r\n         <el-form-item label=\"操作地址\" prop=\"operIp\">\r\n            <el-input\r\n               v-model=\"queryParams.operIp\"\r\n               placeholder=\"请输入操作地址\"\r\n               clearable\r\n               style=\"width: 240px;\"\r\n               @keyup.enter=\"handleQuery\"\r\n            />\r\n         </el-form-item>\r\n         <el-form-item label=\"系统模块\" prop=\"title\">\r\n            <el-input\r\n               v-model=\"queryParams.title\"\r\n               placeholder=\"请输入系统模块\"\r\n               clearable\r\n               style=\"width: 240px;\"\r\n               @keyup.enter=\"handleQuery\"\r\n            />\r\n         </el-form-item>\r\n         <el-form-item label=\"操作人员\" prop=\"operName\">\r\n            <el-input\r\n               v-model=\"queryParams.operName\"\r\n               placeholder=\"请输入操作人员\"\r\n               clearable\r\n               style=\"width: 240px;\"\r\n               @keyup.enter=\"handleQuery\"\r\n            />\r\n         </el-form-item>\r\n         <el-form-item label=\"类型\" prop=\"businessType\">\r\n            <el-select\r\n               v-model=\"queryParams.businessType\"\r\n               placeholder=\"操作类型\"\r\n               clearable\r\n               style=\"width: 240px\"\r\n            >\r\n               <el-option\r\n                  v-for=\"dict in sys_oper_type\"\r\n                  :key=\"dict.value\"\r\n                  :label=\"dict.label\"\r\n                  :value=\"dict.value\"\r\n               />\r\n            </el-select>\r\n         </el-form-item>\r\n         <el-form-item label=\"状态\" prop=\"status\">\r\n            <el-select\r\n               v-model=\"queryParams.status\"\r\n               placeholder=\"操作状态\"\r\n               clearable\r\n               style=\"width: 240px\"\r\n            >\r\n               <el-option\r\n                  v-for=\"dict in sys_common_status\"\r\n                  :key=\"dict.value\"\r\n                  :label=\"dict.label\"\r\n                  :value=\"dict.value\"\r\n               />\r\n            </el-select>\r\n         </el-form-item>\r\n         <el-form-item label=\"操作时间\" style=\"width: 308px\">\r\n            <el-date-picker\r\n               v-model=\"dateRange\"\r\n               value-format=\"YYYY-MM-DD HH:mm:ss\"\r\n               type=\"daterange\"\r\n               range-separator=\"-\"\r\n               start-placeholder=\"开始日期\"\r\n               end-placeholder=\"结束日期\"\r\n               :default-time=\"[new Date(2000, 1, 1, 0, 0, 0), new Date(2000, 1, 1, 23, 59, 59)]\"\r\n            ></el-date-picker>\r\n         </el-form-item>\r\n         <el-form-item>\r\n            <el-button type=\"primary\" icon=\"Search\" @click=\"handleQuery\">搜索</el-button>\r\n            <el-button icon=\"Refresh\" @click=\"resetQuery\">重置</el-button>\r\n         </el-form-item>\r\n      </el-form>\r\n\r\n      <el-row :gutter=\"10\" class=\"mb8\">\r\n         <el-col :span=\"1.5\">\r\n            <el-button\r\n               type=\"danger\"\r\n               plain\r\n               icon=\"Delete\"\r\n               :disabled=\"multiple\"\r\n               @click=\"handleDelete\"\r\n               v-hasPermi=\"['monitor:operlog:remove']\"\r\n            >删除</el-button>\r\n         </el-col>\r\n         <el-col :span=\"1.5\">\r\n            <el-button\r\n               type=\"danger\"\r\n               plain\r\n               icon=\"Delete\"\r\n               @click=\"handleClean\"\r\n               v-hasPermi=\"['monitor:operlog:remove']\"\r\n            >清空</el-button>\r\n         </el-col>\r\n         <el-col :span=\"1.5\">\r\n            <el-button\r\n               type=\"warning\"\r\n               plain\r\n               icon=\"Download\"\r\n               @click=\"handleExport\"\r\n               v-hasPermi=\"['monitor:operlog:export']\"\r\n            >导出</el-button>\r\n         </el-col>\r\n         <right-toolbar v-model:showSearch=\"showSearch\" @queryTable=\"getList\"></right-toolbar>\r\n      </el-row>\r\n\r\n      <el-table ref=\"operlogRef\" v-loading=\"loading\" :data=\"operlogList\" @selection-change=\"handleSelectionChange\" :default-sort=\"defaultSort\" @sort-change=\"handleSortChange\">\r\n         <el-table-column type=\"selection\" width=\"50\" align=\"center\" />\r\n         <el-table-column label=\"日志编号\" align=\"center\" prop=\"operId\" />\r\n         <el-table-column label=\"系统模块\" align=\"center\" prop=\"title\" :show-overflow-tooltip=\"true\" />\r\n         <el-table-column label=\"操作类型\" align=\"center\" prop=\"businessType\">\r\n            <template #default=\"scope\">\r\n               <dict-tag :options=\"sys_oper_type\" :value=\"scope.row.businessType\" />\r\n            </template>\r\n         </el-table-column>\r\n         <el-table-column label=\"操作人员\" align=\"center\" width=\"110\" prop=\"operName\" :show-overflow-tooltip=\"true\" sortable=\"custom\" :sort-orders=\"['descending', 'ascending']\" />\r\n         <el-table-column label=\"操作地址\" align=\"center\" prop=\"operIp\" width=\"130\" :show-overflow-tooltip=\"true\" />\r\n         <el-table-column label=\"操作状态\" align=\"center\" prop=\"status\">\r\n            <template #default=\"scope\">\r\n               <dict-tag :options=\"sys_common_status\" :value=\"scope.row.status\" />\r\n            </template>\r\n         </el-table-column>\r\n         <el-table-column label=\"操作日期\" align=\"center\" prop=\"operTime\" width=\"180\" sortable=\"custom\" :sort-orders=\"['descending', 'ascending']\">\r\n            <template #default=\"scope\">\r\n               <span>{{ parseTime(scope.row.operTime) }}</span>\r\n            </template>\r\n         </el-table-column>\r\n         <el-table-column label=\"消耗时间\" align=\"center\" prop=\"costTime\" width=\"110\" :show-overflow-tooltip=\"true\" sortable=\"custom\" :sort-orders=\"['descending', 'ascending']\">\r\n            <template #default=\"scope\">\r\n               <span>{{ scope.row.costTime }}毫秒</span>\r\n            </template>\r\n         </el-table-column>\r\n         <el-table-column label=\"操作\" align=\"center\" class-name=\"small-padding fixed-width\">\r\n            <template #default=\"scope\">\r\n               <el-button link type=\"primary\" icon=\"View\" @click=\"handleView(scope.row, scope.index)\" v-hasPermi=\"['monitor:operlog:query']\">详细</el-button>\r\n            </template>\r\n         </el-table-column>\r\n      </el-table>\r\n\r\n      <pagination\r\n         v-show=\"total > 0\"\r\n         :total=\"total\"\r\n         v-model:page=\"queryParams.pageNum\"\r\n         v-model:limit=\"queryParams.pageSize\"\r\n         @pagination=\"getList\"\r\n      />\r\n\r\n      <!-- 操作日志详细 -->\r\n      <el-dialog title=\"操作日志详细\" v-model=\"open\" width=\"800px\" append-to-body>\r\n         <el-form :model=\"form\" label-width=\"100px\">\r\n            <el-row>\r\n               <el-col :span=\"12\">\r\n                  <el-form-item label=\"操作模块：\">{{ form.title }} / {{ typeFormat(form) }}</el-form-item>\r\n                  <el-form-item\r\n                    label=\"登录信息：\"\r\n                  >{{ form.operName }} / {{ form.operIp }} / {{ form.operLocation }}</el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"12\">\r\n                  <el-form-item label=\"请求地址：\">{{ form.operUrl }}</el-form-item>\r\n                  <el-form-item label=\"请求方式：\">{{ form.requestMethod }}</el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"24\">\r\n                  <el-form-item label=\"操作方法：\">{{ form.method }}</el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"24\">\r\n                  <el-form-item label=\"请求参数：\">{{ form.operParam }}</el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"24\">\r\n                  <el-form-item label=\"返回参数：\">{{ form.jsonResult }}</el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"8\">\r\n                  <el-form-item label=\"操作状态：\">\r\n                     <div v-if=\"form.status === 0\">正常</div>\r\n                     <div v-else-if=\"form.status === 1\">失败</div>\r\n                  </el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"8\">\r\n                  <el-form-item label=\"消耗时间：\">{{ form.costTime }}毫秒</el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"8\">\r\n                  <el-form-item label=\"操作时间：\">{{ parseTime(form.operTime) }}</el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"24\">\r\n                  <el-form-item label=\"异常信息：\" v-if=\"form.status === 1\">{{ form.errorMsg }}</el-form-item>\r\n               </el-col>\r\n            </el-row>\r\n         </el-form>\r\n         <template #footer>\r\n            <div class=\"dialog-footer\">\r\n               <el-button @click=\"open = false\">关 闭</el-button>\r\n            </div>\r\n         </template>\r\n      </el-dialog>\r\n   </div>\r\n</template>\r\n\r\n<script setup name=\"Operlog\">\r\nimport { list, delOperlog, cleanOperlog } from \"@/api/monitor/operlog\";\r\n\r\nconst { proxy } = getCurrentInstance();\r\nconst { sys_oper_type, sys_common_status } = proxy.useDict(\"sys_oper_type\",\"sys_common_status\");\r\n\r\nconst operlogList = ref([]);\r\nconst open = ref(false);\r\nconst loading = ref(true);\r\nconst showSearch = ref(true);\r\nconst ids = ref([]);\r\nconst single = ref(true);\r\nconst multiple = ref(true);\r\nconst total = ref(0);\r\nconst title = ref(\"\");\r\nconst dateRange = ref([]);\r\nconst defaultSort = ref({ prop: \"operTime\", order: \"descending\" });\r\n\r\nconst data = reactive({\r\n  form: {},\r\n  queryParams: {\r\n    pageNum: 1,\r\n    pageSize: 10,\r\n    operIp: undefined,\r\n    title: undefined,\r\n    operName: undefined,\r\n    businessType: undefined,\r\n    status: undefined\r\n  }\r\n});\r\n\r\nconst { queryParams, form } = toRefs(data);\r\n\r\n/** 查询登录日志 */\r\nfunction getList() {\r\n  loading.value = true;\r\n  list(proxy.addDateRange(queryParams.value, dateRange.value)).then(response => {\r\n    operlogList.value = response.rows;\r\n    total.value = response.total;\r\n    loading.value = false;\r\n  });\r\n}\r\n/** 操作日志类型字典翻译 */\r\nfunction typeFormat(row, column) {\r\n  return proxy.selectDictLabel(sys_oper_type.value, row.businessType);\r\n}\r\n/** 搜索按钮操作 */\r\nfunction handleQuery() {\r\n  queryParams.value.pageNum = 1;\r\n  getList();\r\n}\r\n/** 重置按钮操作 */\r\nfunction resetQuery() {\r\n  dateRange.value = [];\r\n  proxy.resetForm(\"queryRef\");\r\n  queryParams.value.pageNum = 1;\r\n  proxy.$refs[\"operlogRef\"].sort(defaultSort.value.prop, defaultSort.value.order);\r\n}\r\n/** 多选框选中数据 */\r\nfunction handleSelectionChange(selection) {\r\n  ids.value = selection.map(item => item.operId);\r\n  multiple.value = !selection.length;\r\n}\r\n/** 排序触发事件 */\r\nfunction handleSortChange(column, prop, order) {\r\n  queryParams.value.orderByColumn = column.prop;\r\n  queryParams.value.isAsc = column.order;\r\n  getList();\r\n}\r\n/** 详细按钮操作 */\r\nfunction handleView(row) {\r\n  open.value = true;\r\n  form.value = row;\r\n}\r\n/** 删除按钮操作 */\r\nfunction handleDelete(row) {\r\n  const operIds = row.operId || ids.value;\r\n  proxy.$modal.confirm('是否确认删除日志编号为\"' + operIds + '\"的数据项?').then(function () {\r\n    return delOperlog(operIds);\r\n  }).then(() => {\r\n    getList();\r\n    proxy.$modal.msgSuccess(\"删除成功\");\r\n  }).catch(() => {});\r\n}\r\n/** 清空按钮操作 */\r\nfunction handleClean() {\r\n  proxy.$modal.confirm(\"是否确认清空所有操作日志数据项?\").then(function () {\r\n    return cleanOperlog();\r\n  }).then(() => {\r\n    getList();\r\n    proxy.$modal.msgSuccess(\"清空成功\");\r\n  }).catch(() => {});\r\n}\r\n/** 导出按钮操作 */\r\nfunction handleExport() {\r\n  proxy.download(\"monitor/operlog/export\",{\r\n    ...queryParams.value,\r\n  }, `config_${new Date().getTime()}.xlsx`);\r\n}\r\n\r\ngetList();\r\n</script>\r\n"],"names":["list","query","request","delOperlog","operId","cleanOperlog","proxy","getCurrentInstance","sys_oper_type","sys_common_status","operlogList","ref","open","loading","showSearch","ids","multiple","total","dateRange","defaultSort","data","reactive","queryParams","form","toRefs","getList","response","typeFormat","row","column","handleQuery","resetQuery","handleSelectionChange","selection","item","handleSortChange","prop","order","handleView","handleDelete","operIds","handleClean","handleExport"],"mappings":"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"}