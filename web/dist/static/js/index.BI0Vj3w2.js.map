{"version":3,"file":"index.BI0Vj3w2.js","sources":["../../../src/views/hrm/module/index.vue"],"sourcesContent":["<template>\r\n  <div class=\"app-container\">\r\n    <ModuleTableQuery @select-change=\"handleSelectionChange\" ref=\"moduleQueryViewRef\">\r\n      <template #table-tool>\r\n        <el-col :span=\"1.5\">\r\n          <el-button\r\n              type=\"primary\"\r\n              plain\r\n              icon=\"Plus\"\r\n              @click=\"handleAdd\"\r\n              v-hasPermi=\"['hrm:module:add']\"\r\n          >新增\r\n          </el-button>\r\n        </el-col>\r\n        <el-col :span=\"1.5\">\r\n          <el-button\r\n              type=\"success\"\r\n              plain\r\n              icon=\"Edit\"\r\n              :disabled=\"single\"\r\n              @click=\"handleUpdate\"\r\n              v-hasPermi=\"['hrm:module:edit']\"\r\n          >修改\r\n          </el-button>\r\n        </el-col>\r\n        <el-col :span=\"1.5\">\r\n          <el-button\r\n              type=\"danger\"\r\n              plain\r\n              icon=\"Delete\"\r\n              :disabled=\"multiple\"\r\n              @click=\"handleDelete\"\r\n              v-hasPermi=\"['hrm:module:remove']\"\r\n          >删除\r\n          </el-button>\r\n        </el-col>\r\n        <el-col :span=\"1.5\">\r\n          <el-button\r\n              type=\"warning\"\r\n              plain\r\n              icon=\"Download\"\r\n              @click=\"handleExport\"\r\n              v-hasPermi=\"['hrm:module:export']\"\r\n          >导出\r\n          </el-button>\r\n        </el-col>\r\n        <el-col :span=\"1.5\">\r\n          <el-button type=\"warning\" icon=\"CaretRight\" @click=\"runTest\"\r\n                     v-hasPermi=\"['hrm:case:run']\" title=\"运行\">\r\n            执行\r\n          </el-button>\r\n        </el-col>\r\n      </template>\r\n      <template #tableOperate=\"{scope}\">\r\n        <el-button link type=\"primary\"\r\n                   icon=\"Edit\"\r\n                   @click=\"handleUpdate(scope.row)\"\r\n                   :loading=\"loading\"\r\n                   v-hasPermi=\"['hrm:module:edit']\">\r\n        </el-button>\r\n        <el-button link type=\"primary\" icon=\"Delete\" @click=\"handleDelete(scope.row)\"\r\n                   v-hasPermi=\"['hrm:module:remove']\">\r\n        </el-button>\r\n      </template>\r\n    </ModuleTableQuery>\r\n\r\n    <!-- 添加或修改模块对话框 -->\r\n    <el-dialog :title=\"title\" v-model=\"open\" width=\"600px\" append-to-body>\r\n      <el-form ref=\"postRef\" :model=\"form\" :rules=\"rules\" label-width=\"100px\">\r\n        <el-form-item label=\"模块名称\" prop=\"moduleName\">\r\n          <el-input v-model=\"form.moduleName\" placeholder=\"请输入模块名称\"/>\r\n        </el-form-item>\r\n        <el-form-item label=\"所属项目\" prop=\"projectId\">\r\n          <el-select v-model=\"form.projectId\" placeholder=\"请选择\">\r\n            <el-option\r\n                v-for=\"option in projectOptions\"\r\n                :key=\"option.projectId\"\r\n                :label=\"option.projectName\"\r\n                :value=\"option.projectId\">\r\n            </el-option>\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"测试负责人\" prop=\"testUser\">\r\n          <el-input v-model=\"form.testUser\" placeholder=\"请输入测试负责人\"/>\r\n        </el-form-item>\r\n        <el-form-item label=\"模块顺序\" prop=\"sort\">\r\n          <el-input-number v-model=\"form.sort\" controls-position=\"right\" :min=\"0\"/>\r\n        </el-form-item>\r\n        <el-form-item label=\"模块状态\" prop=\"status\">\r\n          <el-radio-group v-model=\"form.status\">\r\n            <el-radio\r\n                v-for=\"dict in qtr_data_status\"\r\n                :key=\"dict.value * 1\"\r\n                :value=\"dict.value * 1\"\r\n            >{{ dict.label }}\r\n            </el-radio>\r\n          </el-radio-group>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"简要描述\" prop=\"simpleDesc\">\r\n          <el-input type=\"textarea\" :rows=\"4\" v-model=\"form.simpleDesc\" placeholder=\"简要描述\" maxlength=\"100\"/>\r\n        </el-form-item>\r\n\r\n\r\n        <el-form-item label=\"其他信息\" prop=\"otherDesc\">\r\n          <el-input type=\"textarea\" :rows=\"4\" v-model=\"form.otherDesc\" placeholder=\"其他信息\" maxlength=\"100\"/>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"备注\" prop=\"remark\">\r\n          <el-input v-model=\"form.remark\" type=\"textarea\" placeholder=\"请输入内容\"/>\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <div class=\"dialog-footer\">\r\n          <el-button type=\"primary\" @click=\"submitForm\">确 定</el-button>\r\n          <el-button @click=\"cancel\">取 消</el-button>\r\n        </div>\r\n      </template>\r\n    </el-dialog>\r\n\r\n    <!-- 运行用例对话框 -->\r\n    <RunDialog v-model:dialog-visible=\"runDialogShow\" :run-type=\"RunTypeEnum.module\" :run-ids=\"runIds\"></RunDialog>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport {addModule, delModule, getModule, listModule, updateModule} from \"@/api/hrm/module\";\r\nimport {listProject} from \"@/api/hrm/project\";\r\nimport {RunTypeEnum, StatusNewEnum} from \"@/components/hrm/enum.js\";\r\nimport RunDialog from \"@/components/hrm/common/run/run_dialog.vue\";\r\nimport ModuleTableQuery from \"@/components/hrm/util-data-table/module-table-query.vue\";\r\nimport {ElMessageBox} from \"element-plus\";\r\n\r\nconst {proxy} = getCurrentInstance();\r\nconst {qtr_data_status} = proxy.useDict(\"qtr_data_status\");\r\n\r\nconst moduleList = ref([]);\r\nconst projectOptions = ref([]);\r\nconst open = ref(false);\r\nconst loading = ref(false);\r\nconst showSearch = ref(true);\r\nconst ids = ref([]);\r\nconst single = ref(true);\r\nconst multiple = ref(true);\r\nconst total = ref(0);\r\nconst title = ref(\"\");\r\n\r\nconst runDialogShow = ref(false);\r\nconst runIds = ref([]);\r\nconst moduleQueryViewRef = ref(null);\r\n\r\nconst data = reactive({\r\n  form: {\r\n    testUser: undefined\r\n  },\r\n  queryParams: {\r\n    pageNum: 1,\r\n    pageSize: 10,\r\n    projectId: undefined,\r\n    moduleName: undefined,\r\n    status: undefined\r\n  },\r\n  rules: {\r\n    moduleName: [{required: true, message: \"模块名称不能为空\", trigger: \"blur\"}],\r\n    projectId: [{required: true, message: \"所属项目不能为空\", trigger: \"blur\"}],\r\n    testUser: [{required: true, message: \"测试负责人不能为空\", trigger: \"blur\"}],\r\n    sort: [{required: true, message: \"模块顺序不能为空\", trigger: \"blur\"}]\r\n  }\r\n});\r\n\r\nconst {queryParams, form, rules} = toRefs(data);\r\n\r\n/** 查询项目列表 */\r\nfunction getProjectSelect() {\r\n  listProject({isPage: false}).then(response => {\r\n    projectOptions.value = response.data;\r\n  });\r\n}\r\n\r\n/** 取消按钮 */\r\nfunction cancel() {\r\n  open.value = false;\r\n  reset();\r\n}\r\n\r\n/** 表单重置 */\r\nfunction reset() {\r\n  form.value = {\r\n    moduleId: undefined,\r\n    projectId: undefined,\r\n    moduleName: undefined,\r\n    sort: 0,\r\n    status: StatusNewEnum.normal.value,\r\n    remark: undefined\r\n  };\r\n  proxy.resetForm(\"postRef\");\r\n}\r\n\r\n\r\n/** 多选框选中数据 */\r\nfunction handleSelectionChange(selection) {\r\n  ids.value = selection.map(item => item.moduleId);\r\n  runIds.value = ids.value;\r\n  single.value = selection.length != 1;\r\n  multiple.value = !selection.length;\r\n}\r\n\r\n/** 新增按钮操作 */\r\nfunction handleAdd() {\r\n  reset();\r\n  open.value = true;\r\n  title.value = \"添加模块\";\r\n}\r\n\r\n/** 修改按钮操作 */\r\nfunction handleUpdate(row) {\r\n  loading.value = true;\r\n  reset();\r\n  const moduleId = row.moduleId || ids.value;\r\n  getModule(moduleId).then(response => {\r\n    form.value = response.data;\r\n    open.value = true;\r\n    title.value = \"修改模块\";\r\n  }).finally(()=>{\r\n    loading.value = false;\r\n  });\r\n}\r\n\r\n/** 提交按钮 */\r\nfunction submitForm() {\r\n  proxy.$refs[\"postRef\"].validate(valid => {\r\n    if (valid) {\r\n      if (form.value.moduleId != undefined) {\r\n        updateModule(form.value).then(response => {\r\n          proxy.$modal.msgSuccess(\"修改成功\");\r\n          open.value = false;\r\n          moduleQueryViewRef.value.handleQuery();\r\n        });\r\n      } else {\r\n        addModule(form.value).then(response => {\r\n          proxy.$modal.msgSuccess(\"新增成功\");\r\n          open.value = false;\r\n          moduleQueryViewRef.value.handleQuery();\r\n        });\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n/** 删除按钮操作 */\r\nfunction handleDelete(row) {\r\n  const moduleIds = row.moduleId || ids.value;\r\n  proxy.$modal.confirm('是否确认删除模块编号为\"' + moduleIds + '\"的数据项？').then(function () {\r\n    return delModule(moduleIds);\r\n  }).then(() => {\r\n    moduleQueryViewRef.value.handleQuery();\r\n    proxy.$modal.msgSuccess(\"删除成功\");\r\n  }).catch(() => {\r\n  });\r\n}\r\n\r\n/** 导出按钮操作 */\r\nfunction handleExport() {\r\n  proxy.download(\"hrm/module/export\", {\r\n    ...queryParams.value\r\n  }, `Module_${new Date().getTime()}.xlsx`);\r\n}\r\n\r\n/** 运行用例 */\r\nfunction runTest(row) {\r\n  if (row && \"moduleId\" in row && row.moduleId) {\r\n    runIds.value = [row.moduleId];\r\n  }\r\n  if (!runIds.value || runIds.value.length === 0) {\r\n    ElMessageBox.alert('请选择要运行的模块', \"提示！\", {type: 'warning'});\r\n    return;\r\n  }\r\n  runDialogShow.value = true;\r\n}\r\n\r\nonMounted(() => {\r\n  getProjectSelect();\r\n});\r\n\r\n</script>\r\n"],"names":["proxy","getCurrentInstance","qtr_data_status","ref","projectOptions","open","loading","ids","single","multiple","title","runDialogShow","runIds","moduleQueryViewRef","data","reactive","queryParams","form","rules","toRefs","getProjectSelect","listProject","response","cancel","reset","StatusNewEnum","handleSelectionChange","selection","item","handleAdd","handleUpdate","row","moduleId","getModule","submitForm","valid","updateModule","addModule","handleDelete","moduleIds","delModule","handleExport","runTest","ElMessageBox","onMounted"],"mappings":"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"}