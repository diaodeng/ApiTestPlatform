import{X as L,F as Ie,av as Ae,A as ie,r as k,J as Ve,au as T,e as g,c as B,o as b,O as ue,f as n,l as t,i as o,h as H,j as E,k as O,aw as Ee,n as y,ax as Me,p as pe,ay as Re,E as Fe,d as Ue,C as Pe,w as qe,ab as _e,H as $e,I as ye,K as $,P as Be,y as He,a7 as de}from"./index.DLM0P_FN.js";import{C as Oe,a as Le,_ as We,S as je,b as Ke,c as Xe,d as ze,g as Je}from"./run-detail.DBJ4uq6l.js";import{_ as Qe}from"./edit-label-text.BOMgfxCg.js";import{C,H as P,R as Ye,r as Ge}from"./enum.BYy-eByp.js";import{r as Ze}from"./tools.De_J0dJF.js";import"./data-template.BrUbBjfC.js";import"./run_detail.BJTn3gqP.js";import"./report.CGKmgNVL.js";import"./case.ClJHBfiF.js";import"./table-variables.B-u5fhkB.js";import"./ace-editor.DzAKNVzR.js";import"./ResizeObserver.es.B1PUzC5B.js";import"./module.CsavA2LQ.js";import"./project.NehpJ71d.js";import"./env-selector.BKBox_zM.js";import"./env.DaAQ5naB.js";import"./forward.CYnhzzK1.js";import"./agent.DUVcbZuN.js";function et(I){return L({url:"/hrm/api/mult/tree",method:"get",params:I})}function tt(I){return L({url:"/hrm/api/detail/"+I,method:"get"})}function se(I){return L({url:"/hrm/api",method:"post",data:I})}function re(I){return L({url:"/hrm/api",method:"put",data:I})}function at(I){return L({url:"/hrm/api/"+I,method:"delete"})}function lt(I){return L({url:"/hrm/api/copyAsCase",method:"post",data:I})}const nt=["onDblclick","onClick","onMouseenter","onMouseleave"],ot={key:4},it=Ie({__name:"tree-view",props:{dataSource:{},dataSourceModifiers:{},filterText:{},filterTextModifiers:{},treeRef:{},treeRefModifiers:{}},emits:Ae(["nodeDbClick","delNode","filter","addNode","moveNode","editNode","currentNodeChange"],["update:dataSource","update:filterText","update:treeRef"]),setup(I,{emit:K}){const G=ie(I,"dataSource");ie(I,"filterText");const Z=ie(I,"treeRef"),A=k({e:null,data:null,node:null,nodeRef:null}),S=Ve({show:!1,x:0,y:0,data:[{title:"新增文件夹",apiType:C.folder,icon:"Menu"},{title:"新增http请求",apiType:C.http,icon:"Menu",divided:!0},{title:"新增websocket请求",apiType:C.websocket,icon:"Menu",divided:!0}],onSelect:s=>{W(A.value.data,s.apiType)}}),V=K,f=(s,i,u,N)=>{};function r(s,i,u,N){s.preventDefault(),A.value.e=s,A.value.data=i,A.value.node=u,A.value.nodeRef=N,S.x=s.clientX,S.y=s.clientY,S.show=!0}const w={key:"apiId",children:"children",label:"name",isLeaf:"isParent",parentId:"parentId"},W=(s,i)=>{if(!s.isParent){T.warning("只能在文件夹中新增节点");return}const u=Ze(10),x={id:null,name:"新增API",children:[],isNew:!0,apiId:u,isParent:i===C.folder,parentId:s.apiId,type:i!==C.folder?P.api:P.folder,apiType:i,edit:!1};s.children||(s.children=[]),s.children.splice(0,0,x),V("addNode",i,x,s)},M=(s,i,u)=>{Fe.confirm(`确定删除吗？
对应目录下的所有内容都将被删除`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{console.log(u),at(u.apiId).then(N=>{const x=i.parent,v=x.data.children||x.data,_=v.findIndex(m=>m.apiId===u.apiId);v.splice(_,1),T.success("删除成功"),V("delNode",u)}).catch(()=>{})}).catch(()=>{})},q=(s,i,u)=>{V("nodeDbClick",s,i,u)};function p(s,i,u){return!s||i.name.indexOf(s)!==-1||i.title.indexOf(s)!==-1}const R=(s,i)=>{},D=(s,i,u)=>{},U=(s,i,u)=>{},X=(s,i,u)=>{console.log("tree drag over:",i.label)},z=(s,i,u,N)=>{if(u==="none")return!1},J=(s,i,u,N)=>{let x=null,v=s.data.apiId,_=0;u==="inner"?x=i.data.apiId:(u==="after"||u==="before")&&(x=i.parent.data.apiId),x!==v&&V("moveNode",x,v,_)},ee=(s,i,u)=>!(!i.data.isParent&&u==="inner"||i.data.apiId===s.data.apiId),j=(s,i,u)=>{V("editNode",s,i,u)},te=(s,i)=>{V("currentNodeChange",s,i)};return(s,i)=>{const u=g("el-icon"),N=g("el-button"),x=g("el-tree");return b(),B(ue,null,[n(Oe,{visible:t(S).show,"onUpdate:visible":i[0]||(i[0]=v=>t(S).show=v),x:t(S).x,y:t(S).y,onSelect:t(S).onSelect,menus:t(S).data},null,8,["visible","x","y","onSelect","menus"]),n(x,{style:{"max-width":"600px"},data:G.value,"highlight-current":"",props:w,"node-key":"apiId","expand-on-click-node":!1,ref_key:"treeRef",ref:Z,"filter-node-method":p,onNodeContextmenu:r,draggable:"","allow-drop":ee,onNodeDragStart:R,onNodeDragEnter:D,onNodeDragLeave:U,onNodeDragOver:X,onNodeDragEnd:z,onNodeDrop:J,onCurrentChange:te},{default:o(({node:v,data:_})=>[H("span",{onDblclick:m=>{q(m,v,_)},onClick:m=>{f(_,v,void 0,m)},onMouseenter:m=>{v.data.edit=!0},onMouseleave:m=>{v.data.edit=!1}},[_.apiType===t(C).folder?(b(),E(u,{key:0},{default:o(()=>[n(t(Ee))]),_:1})):_.apiType===t(C).http?(b(),E(N,{key:1,type:"success",link:""},{default:o(()=>i[1]||(i[1]=[y("RQ")])),_:1,__:[1]})):_.apiType===t(C).websocket?(b(),E(N,{key:2,type:"primary",link:""},{default:o(()=>i[2]||(i[2]=[y("WS")])),_:1,__:[2]})):_.apiType===t(C).webui?(b(),E(N,{key:3,type:"warning",link:""},{default:o(()=>i[3]||(i[3]=[y("WB")])),_:1,__:[3]})):O("",!0),H("span",null,[n(Qe,{content:_.name,"onUpdate:content":m=>_.name=m,"show-edite":v.data.edit,"onUpdate:showEdite":m=>v.data.edit=m,onEdite:m=>{j(m,_,v)}},null,8,["content","onUpdate:content","show-edite","onUpdate:showEdite","onEdite"])]),v.data.edit?(b(),B("span",ot,[_.apiType===t(C).folder?(b(),E(u,{key:0,color:"green",onClick:pe(m=>{r(m,_,v,void 0)},["stop"])},{default:o(()=>[n(t(Me))]),_:2},1032,["onClick"])):O("",!0),n(u,{color:"red",onClick:pe(m=>M(m,v,_),["stop"])},{default:o(()=>[n(t(Re))]),_:2},1032,["onClick"])])):O("",!0)],40,nt)]),_:1},8,["data"])],64)}}}),dt={class:"app-container",style:{height:"100%"}},st={style:{display:"flex"}},rt={style:{margin:"0px",padding:"0px"}},ut=["onDblclick"],pt={key:0,style:{"flex-grow":"1",display:"flex","flex-direction":"column"}},ft=Ie({name:"Api"}),Et=Object.assign(ft,{setup(I){const{proxy:K}=Ue(),{sys_normal_disable:G}=K.useDict("sys_normal_disable"),{hrm_data_type:Z}=K.useDict("hrm_data_type");de("hrm_data_type",Z),de("sys_normal_disable",G);const A=k([]),S=k({}),V=k({parentId:null,name:null}),f=k([]),r=k(f.value[0]||null),w=k(0),W=k({runHistoryDialog:!1}),M=k(!1),q=k(!0),p=k({page:!1,loadApiTree:!1,loadApiInfo:!1,saveApi:!1,debugApi:!1,preSaveDialog:!1,preSaveFolderDialog:!1,filter:!1}),R=k(""),D=k(null),U=k();Pe(()=>{j(),Le().then(a=>{S.value=a.data})});const X=k(null);qe(()=>r.value,a=>{const e=_e(a),l=e?{request:e.requestInfo,type:e.type,name:e.name,caseId:e.apiId}:{};X.value=l}),de("hrm_case_config_list",S);function z(a){p.value.saveApi=!0;let e=_e(r.value);if(e=structuredClone(e),e.type=P.api,e.requestInfo.teststeps.forEach(l=>{l.result=null}),e.id&&e.apiId&&!e.isNew)a==="copy2case"?lt(e).then(l=>{T({message:"API成功另存为CASE",type:"success"})}).catch(l=>{T.error("API另存为CASE失败")}).finally(()=>{p.value.saveApi=!1,p.value.preSaveDialog=!1}):re(e).then(l=>{T({message:"API保存成功",type:"success"}),J(l,e.apiId)}).catch(l=>{T({message:"API保存失败",type:"success"})}).finally(()=>{p.value.saveApi=!1,p.value.preSaveDialog=!1});else{const l=e.apiId;delete e.isNew,delete e.apiId,delete e.id,se(e).then(c=>{T({message:"API保存成功",type:"success"}),J(c,l)}).finally(()=>{p.value.saveApi=!1,p.value.preSaveDialog=!1})}}function J(a,e){a&&a.data&&a.data.apiId&&(r.value.apiId=a.data.apiId);let l=a;if(l){let c=D.value.getNode(e);c.data.apiId=l.data.apiId,c.data.name=l.data.name,c.data.isNew=!1,c.apiId=l.data.apiId,c.name=l.data.name,f.value.forEach(F=>{F.apiId===e&&(F.apiId=l.data.apiId,w.value=l.data.apiId)})}}function ee(){let a=null;U.value&&(a=U.apiId,a=D.value.getNode(a)?a:null),p.value.preSaveFolderDialog=!0;let e=V.value;e.type=P.folder,e.apiType=C.folder,e.parentId=a,se(e).then(l=>{a?D.value.getNode(a).data.children.splice(0,0,l.data):A.value.splice(0,0,l.data),T({message:"Folder保存成功",type:"success"})}).finally(()=>{p.value.preSaveFolderDialog=!1})}function j(){D.value.setCurrentKey(null,!1),M.value=!0,et({onlySelf:q.value}).then(a=>{A.value=a.data}).finally(()=>{M.value=!1})}function te(a,e,l){if(e.data.isParent)e.expanded=!e.expanded;else{const c=e.data.apiId,F=f.value.findIndex(h=>h.apiId===c);if(F!==-1)w.value=c,r.value=f.value[F],M.value=!1;else{if(M.value=!0,e.data.isNew){let h=Je(e.data.apiType);h.isNew=!0,h.type=e.data.type,h.apiType=e.data.apiType,h.requestInfo.name=e.name,h.parentId=e.data.parentId,h.apiId=e.data.apiId,f.value.push(h),r.value=f.value[f.value.length-1],w.value=h.apiId,f.value[0].isEmpty&&f.value.splice(0,1),M.value=!1;return}tt(e.data.apiId).then(h=>{f.value.push(h.data),r.value=f.value[f.value.length-1],w.value=h.data.apiId,f.value[0].isEmpty&&f.value.splice(0,1),console.log("当前tab："+w.value)}).catch(()=>{}).finally(()=>{M.value=!1})}}}function s(a){const e=f.value.findIndex(l=>l.apiId===a.apiId);e!==-1&&f.value.splice(e,1)}function i(a,e){const l=f.value.findIndex(c=>c.apiId===e);l!==-1&&(f.value.length===1?r.value=!1:f.value.length-1===l?(r.value=f.value[l-1],w.value=r.value.apiId):(r.value=f.value[l+1],w.value=r.value.apiId),f.value.splice(l,1),console.log("删除了tab:"+e))}function u(a,e){}function N(a){const e=f.value.findIndex(l=>l.apiId===a);r.value=f.value[e],w.value=a,D.value.setCurrentKey(a)}function x(a){for(const e in a.data)r.value.requestInfo.teststeps.find(l=>l.step_id===e).result=a.data[e]}function v(){p.value.filter=!0,D.value.filter(R.value),p.value.filter=!1}const _=(a,e,l)=>{re({parentId:a,apiId:e}).then(c=>{T.success("移动节点成功")}).catch(c=>{})},m=(a,e,l)=>{re({name:e.name,apiId:e.apiId}).then(c=>{T.success("修改成功")}).catch(c=>{})},be=(a,e,l)=>{if(a!==C.folder)return;let c=a===C.folder?P.folder:P.api;se({type:c,apiType:a,name:e.name,parentId:l.apiId}).then(F=>{T.success("文件夹【"+e.name+"】新增成功")}).catch(F=>{})};function xe(){if(!r.value){T.warning("请先选择一个接口");return}W.value.runHistoryDialog=!0}function he(a,e){!a||a&&a.type===P.folder||f.value.findIndex(c=>c.apiId===a.apiId)===-1||(w.value=a.apiId,N(a.apiId))}function ke(){p.value.preSaveFolderDialog=!0;let a=D.value.getCurrentNode();a&&!a.isParent&&(a=D.value.getNode(a.patentId)),a?U.value=a:U.value=null}return(a,e)=>{var ce,ve,me;const l=g("el-button"),c=g("el-dropdown-item"),F=g("el-dropdown-menu"),h=g("el-dropdown"),ae=g("el-row"),Ce=g("el-checkbox"),Q=g("el-input"),we=g("el-col"),Ne=g("el-scrollbar"),De=g("el-badge"),Se=g("el-tab-pane"),Te=g("el-tabs"),Y=g("el-text"),le=g("el-container"),ne=g("el-main"),oe=g("el-dialog"),fe=$e("loading");return ye((b(),B("div",dt,[n(ae,{gutter:10},{default:o(()=>[n(l,{onClick:j,icon:"RefreshRight"}),n(l,{onClick:ke,type:"primary"},{default:o(()=>e[20]||(e[20]=[y("新增文件夹")])),_:1,__:[20]}),e[25]||(e[25]=H("span",{style:{"flex-grow":"1"}},null,-1)),ye((b(),E(h,{"split-button":"",type:"primary",onClick:e[2]||(e[2]=d=>t(p).preSaveDialog=!0),disabled:t(p).saveApi},{dropdown:o(()=>[n(F,null,{default:o(()=>[n(c,{onClick:e[0]||(e[0]=d=>{z("copy2case")})},{default:o(()=>e[21]||(e[21]=[y("另存为用例")])),_:1,__:[21]}),n(c,{disabled:"",onClick:e[1]||(e[1]=d=>console.log("复制API"))},{default:o(()=>e[22]||(e[22]=[y("复制")])),_:1,__:[22]}),n(c,{onClick:xe},{default:o(()=>e[23]||(e[23]=[y("执行历史")])),_:1,__:[23]})]),_:1})]),default:o(()=>[e[24]||(e[24]=y(" 保存 "))]),_:1,__:[24]},8,["disabled"])),[[fe,t(p).saveApi]]),n(We,{"run-type":t(Ye).api,"case-data":t(X),onDebugRun:x},null,8,["run-type","case-data"])]),_:1,__:[25]}),n(le,null,{default:o(()=>[n(je,{"left-width":"250px","window-height":"calc(100vh - 156px)"},{left:o(()=>[n(ae,null,{default:o(()=>[n(Ce,{modelValue:t(q),"onUpdate:modelValue":e[3]||(e[3]=d=>$(q)?q.value=d:null),onChange:j},{default:o(()=>e[26]||(e[26]=[y("仅自己的数据")])),_:1,__:[26]},8,["modelValue"])]),_:1}),n(ae,null,{default:o(()=>[n(we,{span:24},{default:o(()=>[n(Q,{modelValue:t(R),"onUpdate:modelValue":e[4]||(e[4]=d=>$(R)?R.value=d:null),clearable:"",placeholder:"输入名称或者接口或者path"},{suffix:o(()=>[n(l,{icon:"Search",type:"info",onClick:v,loading:t(p).filter,disabled:t(p).filter,link:""},null,8,["loading","disabled"])]),_:1},8,["modelValue"])]),_:1})]),_:1}),n(Ne,{height:"calc(100% - 70px)"},{default:o(()=>[H("div",st,[n(it,{"data-source":t(A),"onUpdate:dataSource":e[5]||(e[5]=d=>$(A)?A.value=d:null),onNodeDbClick:te,"filter-text":t(R),"onUpdate:filterText":e[6]||(e[6]=d=>$(R)?R.value=d:null),"tree-ref":t(D),"onUpdate:treeRef":e[7]||(e[7]=d=>$(D)?D.value=d:null),onDelNode:s,onMoveNode:_,onEditNode:m,onAddNode:be,onCurrentNodeChange:he},null,8,["data-source","filter-text","tree-ref"])])]),_:1})]),right:o(()=>[n(le,{style:{display:"flex","flex-direction":"column",height:"100%","padding-left":"5px"}},{default:o(()=>[n(Te,{type:"card",modelValue:t(w),"onUpdate:modelValue":e[8]||(e[8]=d=>$(w)?w.value=d:null),onTabClick:u,onTabChange:N},{default:o(()=>[(b(!0),B(ue,null,Be(t(f),(d,ct)=>(b(),E(Se,{label:d.name,key:d.requestInfo.teststeps[0].step_id,name:d.apiId},{label:o(()=>[n(De,{"is-dot":"",hidden:!d.modify},{default:o(()=>[H("span",rt,[H("span",{onDblclick:ge=>{N(d.apiId)}},He(d.name),41,ut),n(l,{onClick:pe(ge=>{i(ge,d.apiId)},["stop"]),icon:"Close",link:""},null,8,["onClick"])])]),_:2},1032,["hidden"])]),_:2},1032,["label","name"]))),128))]),_:1},8,["modelValue"]),t(r)?(b(),B(ue,{key:0},[t(r)?(b(),B("div",pt,[t(r).requestInfo.teststeps[0].step_type===t(C).http?(b(),E(Ke,{key:0,"step-detail-data":t(r).requestInfo.teststeps[0],"onUpdate:stepDetailData":e[9]||(e[9]=d=>t(r).requestInfo.teststeps[0]=d),"request-container-height":"calc(100vh - 165px)"},null,8,["step-detail-data"])):O("",!0),t(r).requestInfo.teststeps[0].step_type===t(C).websocket?(b(),E(Xe,{key:1,"step-detail-data":t(r).requestInfo.teststeps[0],"onUpdate:stepDetailData":e[10]||(e[10]=d=>t(r).requestInfo.teststeps[0]=d),"step-container-height":"calc(100vh - 245px)"},null,8,["step-detail-data"])):O("",!0)])):O("",!0)],64)):(b(),E(Y,{key:1,type:"warning",size:"large"},{default:o(()=>e[27]||(e[27]=[y("请选择api或者新增api")])),_:1,__:[27]}))]),_:1})]),_:1})]),_:1}),n(oe,{title:(ce=t(r))==null?void 0:ce.name,onClose:e[13]||(e[13]=d=>t(p).preSaveDialog=!1),modelValue:t(p).preSaveDialog,"onUpdate:modelValue":e[14]||(e[14]=d=>t(p).preSaveDialog=d)},{default:o(()=>[n(ne,null,{default:o(()=>[n(Q,{modelValue:t(r).name,"onUpdate:modelValue":e[11]||(e[11]=d=>t(r).name=d),placeholder:"请输入名称"},{prepend:o(()=>[n(Y,null,{default:o(()=>e[28]||(e[28]=[y("API名称:")])),_:1,__:[28]})]),_:1},8,["modelValue"])]),_:1}),n(l,{type:"info",onClick:e[12]||(e[12]=d=>t(p).preSaveDialog=!1)},{default:o(()=>e[29]||(e[29]=[y("取消")])),_:1,__:[29]}),n(l,{type:"primary",onClick:z,disabled:t(p).saveApi,loading:t(p).saveApi},{default:o(()=>e[30]||(e[30]=[y("保存 ")])),_:1,__:[30]},8,["disabled","loading"])]),_:1},8,["title","modelValue"]),n(oe,{title:t(V).name,onClose:e[17]||(e[17]=d=>t(p).preSaveFolderDialog=!1),modelValue:t(p).preSaveFolderDialog,"onUpdate:modelValue":e[18]||(e[18]=d=>t(p).preSaveFolderDialog=d)},{default:o(()=>[n(ne,null,{default:o(()=>[n(Q,{"model-value":t(U)?t(U).name:"根目录",placeholder:"请输入文件夹名称",disabled:""},{prepend:o(()=>[n(Y,null,{default:o(()=>e[31]||(e[31]=[y("父级目录:")])),_:1,__:[31]})]),_:1},8,["model-value"]),n(Q,{modelValue:t(V).name,"onUpdate:modelValue":e[15]||(e[15]=d=>t(V).name=d),placeholder:"请输入文件夹名称",style:{"padding-top":"5px"}},{prepend:o(()=>[n(Y,null,{default:o(()=>e[32]||(e[32]=[y("文件夹名称:")])),_:1,__:[32]})]),_:1},8,["modelValue"])]),_:1}),n(l,{type:"info",onClick:e[16]||(e[16]=d=>t(p).preSaveFolderDialog=!1)},{default:o(()=>e[33]||(e[33]=[y("取消")])),_:1,__:[33]}),n(l,{type:"primary",onClick:ee,disabled:t(p).saveApi},{default:o(()=>e[34]||(e[34]=[y("保存")])),_:1,__:[34]},8,["disabled"])]),_:1},8,["title","modelValue"]),n(oe,{fullscreen:"",title:"【"+((ve=t(r))==null?void 0:ve.apiId)+"】"+((me=t(r))==null?void 0:me.name),modelValue:t(W).runHistoryDialog,"onUpdate:modelValue":e[19]||(e[19]=d=>t(W).runHistoryDialog=d),"append-to-body":"","destroy-on-close":""},{default:o(()=>[n(le,{style:{height:"100%"}},{default:o(()=>[n(ne,{style:{"max-height":"calc(100vh - 95px)"}},{default:o(()=>[n(ze,{"run-id":t(r).apiId,"view-type":t(Ge).api},null,8,["run-id","view-type"])]),_:1})]),_:1})]),_:1},8,["title","modelValue"])])),[[fe,t(M)]])}}});export{Et as default};
//# sourceMappingURL=index.KJjMzpPj.js.map
