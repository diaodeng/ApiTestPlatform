{"version":3,"file":"authRole.CSsFxiZA.js","sources":["../../../src/views/system/user/authRole.vue"],"sourcesContent":["<template>\r\n   <div class=\"app-container\">\r\n      <h4 class=\"form-header h4\">基本信息</h4>\r\n      <el-form :model=\"form\" label-width=\"80px\">\r\n         <el-row>\r\n            <el-col :span=\"8\" :offset=\"2\">\r\n               <el-form-item label=\"用户昵称\" prop=\"nickName\">\r\n                  <el-input v-model=\"form.nickName\" disabled />\r\n               </el-form-item>\r\n            </el-col>\r\n            <el-col :span=\"8\" :offset=\"2\">\r\n               <el-form-item label=\"登录账号\" prop=\"userName\">\r\n                  <el-input v-model=\"form.userName\" disabled />\r\n               </el-form-item>\r\n            </el-col>\r\n         </el-row>\r\n      </el-form>\r\n\r\n      <h4 class=\"form-header h4\">角色信息</h4>\r\n      <el-table v-loading=\"loading\" :row-key=\"getRowKey\" @row-click=\"clickRow\" ref=\"roleRef\" @selection-change=\"handleSelectionChange\" :data=\"roles.slice((pageNum - 1) * pageSize, pageNum * pageSize)\">\r\n         <el-table-column label=\"序号\" width=\"55\" type=\"index\" align=\"center\">\r\n            <template #default=\"scope\">\r\n               <span>{{ (pageNum - 1) * pageSize + scope.$index + 1 }}</span>\r\n            </template>\r\n         </el-table-column>\r\n         <el-table-column type=\"selection\" :reserve-selection=\"true\" width=\"55\"></el-table-column>\r\n         <el-table-column label=\"角色编号\" align=\"center\" prop=\"roleId\" />\r\n         <el-table-column label=\"角色名称\" align=\"center\" prop=\"roleName\" />\r\n         <el-table-column label=\"权限字符\" align=\"center\" prop=\"roleKey\" />\r\n         <el-table-column label=\"创建时间\" align=\"center\" prop=\"createTime\" width=\"180\">\r\n            <template #default=\"scope\">\r\n               <span>{{ parseTime(scope.row.createTime) }}</span>\r\n            </template>\r\n         </el-table-column>\r\n      </el-table>\r\n\r\n      <pagination v-show=\"total > 0\" :total=\"total\" v-model:page=\"pageNum\" v-model:limit=\"pageSize\" />\r\n\r\n      <el-form label-width=\"100px\">\r\n         <div style=\"text-align: center;margin-left:-120px;margin-top:30px;\">\r\n            <el-button type=\"primary\" @click=\"submitForm()\">提交</el-button>\r\n            <el-button @click=\"close()\">返回</el-button>\r\n         </div>\r\n      </el-form>\r\n   </div>\r\n</template>\r\n\r\n<script setup name=\"AuthRole\">\r\nimport { getAuthRole, updateAuthRole } from \"@/api/system/user\";\r\n\r\nconst route = useRoute();\r\nconst { proxy } = getCurrentInstance();\r\n\r\nconst loading = ref(true);\r\nconst total = ref(0);\r\nconst pageNum = ref(1);\r\nconst pageSize = ref(10);\r\nconst roleIds = ref([]);\r\nconst roles = ref([]);\r\nconst form = ref({\r\n  nickName: undefined,\r\n  userName: undefined,\r\n  userId: undefined\r\n});\r\n\r\n/** 单击选中行数据 */\r\nfunction clickRow(row) {\r\n  proxy.$refs[\"roleRef\"].toggleRowSelection(row);\r\n};\r\n/** 多选框选中数据 */\r\nfunction handleSelectionChange(selection) {\r\n  roleIds.value = selection.map(item => item.roleId);\r\n};\r\n/** 保存选中的数据编号 */\r\nfunction getRowKey(row) {\r\n  return row.roleId;\r\n};\r\n/** 关闭按钮 */\r\nfunction close() {\r\n  const obj = { path: \"/system/user\" };\r\n  proxy.$tab.closeOpenPage(obj);\r\n};\r\n/** 提交按钮 */\r\nfunction submitForm() {\r\n  const userId = form.value.userId;\r\n  const rIds = roleIds.value.join(\",\");\r\n  updateAuthRole({ userId: userId, roleIds: rIds }).then(response => {\r\n    proxy.$modal.msgSuccess(\"授权成功\");\r\n    close();\r\n  });\r\n};\r\n\r\n(() => {\r\n  const userId = route.params && route.params.userId;\r\n  if (userId) {\r\n    loading.value = true;\r\n    getAuthRole(userId).then(response => {\r\n      form.value = response.user;\r\n      roles.value = response.roles;\r\n      total.value = roles.value.length;\r\n      nextTick(() => {\r\n        roles.value.forEach(row => {\r\n          if (row.flag) {\r\n            proxy.$refs[\"roleRef\"].toggleRowSelection(row);\r\n          }\r\n        });\r\n      });\r\n      loading.value = false;\r\n    });\r\n  }\r\n})();\r\n</script>\r\n"],"names":["route","useRoute","proxy","getCurrentInstance","loading","ref","total","pageNum","pageSize","roleIds","roles","form","clickRow","row","handleSelectionChange","selection","item","getRowKey","close","obj","submitForm","userId","rIds","updateAuthRole","response","getAuthRole","nextTick"],"mappings":"qXAkDA,MAAMA,EAAQC,EAAQ,EAChB,CAAE,MAAAC,CAAK,EAAKC,IAEZC,EAAUC,EAAI,EAAI,EAClBC,EAAQD,EAAI,CAAC,EACbE,EAAUF,EAAI,CAAC,EACfG,EAAWH,EAAI,EAAE,EACjBI,EAAUJ,EAAI,CAAA,CAAE,EAChBK,EAAQL,EAAI,CAAA,CAAE,EACdM,EAAON,EAAI,CACf,SAAU,OACV,SAAU,OACV,OAAQ,MACV,CAAC,EAGD,SAASO,EAASC,EAAK,CACrBX,EAAM,MAAM,QAAW,mBAAmBW,CAAG,CAC/C,CAEA,SAASC,EAAsBC,EAAW,CACxCN,EAAQ,MAAQM,EAAU,IAAIC,GAAQA,EAAK,MAAM,CACnD,CAEA,SAASC,EAAUJ,EAAK,CACtB,OAAOA,EAAI,MACb,CAEA,SAASK,GAAQ,CACf,MAAMC,EAAM,CAAE,KAAM,gBACpBjB,EAAM,KAAK,cAAciB,CAAG,CAC9B,CAEA,SAASC,GAAa,CACpB,MAAMC,EAASV,EAAK,MAAM,OACpBW,EAAOb,EAAQ,MAAM,KAAK,GAAG,EACnCc,EAAe,CAAE,OAAQF,EAAQ,QAASC,EAAM,EAAE,KAAKE,GAAY,CACjEtB,EAAM,OAAO,WAAW,MAAM,EAC9BgB,GACJ,CAAG,CACH,CAEA,OAAC,IAAM,CACL,MAAMG,EAASrB,EAAM,QAAUA,EAAM,OAAO,OACxCqB,IACFjB,EAAQ,MAAQ,GAChBqB,EAAYJ,CAAM,EAAE,KAAKG,GAAY,CACnCb,EAAK,MAAQa,EAAS,KACtBd,EAAM,MAAQc,EAAS,MACvBlB,EAAM,MAAQI,EAAM,MAAM,OAC1BgB,EAAS,IAAM,CACbhB,EAAM,MAAM,QAAQG,GAAO,CACrBA,EAAI,MACNX,EAAM,MAAM,QAAW,mBAAmBW,CAAG,CAEzD,CAAS,CACT,CAAO,EACDT,EAAQ,MAAQ,EACtB,CAAK,EAEL"}