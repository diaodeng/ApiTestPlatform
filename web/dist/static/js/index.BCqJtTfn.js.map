{"version":3,"file":"index.BCqJtTfn.js","sources":["../../../src/api/system/dept.js","../../../src/views/system/dept/index.vue"],"sourcesContent":["import request from '@/utils/request'\r\n\r\n// 查询部门列表\r\nexport function listDept(query) {\r\n  return request({\r\n    url: '/system/dept/list',\r\n    method: 'get',\r\n    params: query\r\n  })\r\n}\r\n\r\n// 查询部门列表（排除节点）\r\nexport function listDeptExcludeChild(deptId) {\r\n  return request({\r\n    url: '/system/dept/list/exclude/' + deptId,\r\n    method: 'get'\r\n  })\r\n}\r\n\r\n// 查询部门详细\r\nexport function getDept(deptId) {\r\n  return request({\r\n    url: '/system/dept/' + deptId,\r\n    method: 'get'\r\n  })\r\n}\r\n\r\n// 新增部门\r\nexport function addDept(data) {\r\n  return request({\r\n    url: '/system/dept',\r\n    method: 'post',\r\n    data: data\r\n  })\r\n}\r\n\r\n// 修改部门\r\nexport function updateDept(data) {\r\n  return request({\r\n    url: '/system/dept',\r\n    method: 'put',\r\n    data: data\r\n  })\r\n}\r\n\r\n// 删除部门\r\nexport function delDept(deptId) {\r\n  return request({\r\n    url: '/system/dept/' + deptId,\r\n    method: 'delete'\r\n  })\r\n}","<template>\r\n   <div class=\"app-container\">\r\n      <el-form :model=\"queryParams\" ref=\"queryRef\" :inline=\"true\" v-show=\"showSearch\">\r\n         <el-form-item label=\"部门名称\" prop=\"deptName\">\r\n            <el-input\r\n               v-model=\"queryParams.deptName\"\r\n               placeholder=\"请输入部门名称\"\r\n               clearable\r\n               style=\"width: 200px\"\r\n               @keyup.enter=\"handleQuery\"\r\n            />\r\n         </el-form-item>\r\n         <el-form-item label=\"状态\" prop=\"status\">\r\n            <el-select v-model=\"queryParams.status\" placeholder=\"部门状态\" clearable style=\"width: 200px\">\r\n               <el-option\r\n                  v-for=\"dict in sys_normal_disable\"\r\n                  :key=\"dict.value\"\r\n                  :label=\"dict.label\"\r\n                  :value=\"dict.value\"\r\n               />\r\n            </el-select>\r\n         </el-form-item>\r\n         <el-form-item>\r\n            <el-button type=\"primary\" icon=\"Search\" @click=\"handleQuery\">搜索</el-button>\r\n            <el-button icon=\"Refresh\" @click=\"resetQuery\">重置</el-button>\r\n         </el-form-item>\r\n      </el-form>\r\n\r\n      <el-row :gutter=\"10\" class=\"mb8\">\r\n         <el-col :span=\"1.5\">\r\n            <el-button\r\n               type=\"primary\"\r\n               plain\r\n               icon=\"Plus\"\r\n               @click=\"handleAdd\"\r\n               v-hasPermi=\"['system:dept:add']\"\r\n            >新增</el-button>\r\n         </el-col>\r\n         <el-col :span=\"1.5\">\r\n            <el-button\r\n               type=\"info\"\r\n               plain\r\n               icon=\"Sort\"\r\n               @click=\"toggleExpandAll\"\r\n            >展开/折叠</el-button>\r\n         </el-col>\r\n         <right-toolbar v-model:showSearch=\"showSearch\" @queryTable=\"getList\"></right-toolbar>\r\n      </el-row>\r\n\r\n      <el-table\r\n         v-if=\"refreshTable\"\r\n         v-loading=\"loading\"\r\n         :data=\"deptList\"\r\n         row-key=\"deptId\"\r\n         :default-expand-all=\"isExpandAll\"\r\n         :tree-props=\"{ children: 'children', hasChildren: 'hasChildren' }\"\r\n      >\r\n         <el-table-column prop=\"deptName\" label=\"部门名称\" width=\"260\"></el-table-column>\r\n         <el-table-column prop=\"orderNum\" label=\"排序\" width=\"200\"></el-table-column>\r\n         <el-table-column prop=\"status\" label=\"状态\" width=\"100\">\r\n            <template #default=\"scope\">\r\n               <dict-tag :options=\"sys_normal_disable\" :value=\"scope.row.status\" />\r\n            </template>\r\n         </el-table-column>\r\n         <el-table-column label=\"创建时间\" align=\"center\" prop=\"createTime\" width=\"200\">\r\n            <template #default=\"scope\">\r\n               <span>{{ parseTime(scope.row.createTime) }}</span>\r\n            </template>\r\n         </el-table-column>\r\n         <el-table-column label=\"操作\" align=\"center\" class-name=\"small-padding fixed-width\">\r\n            <template #default=\"scope\">\r\n               <el-button link type=\"primary\" icon=\"Edit\" @click=\"handleUpdate(scope.row)\" v-hasPermi=\"['system:dept:edit']\">修改</el-button>\r\n               <el-button link type=\"primary\" icon=\"Plus\" @click=\"handleAdd(scope.row)\" v-hasPermi=\"['system:dept:add']\">新增</el-button>\r\n               <el-button v-if=\"scope.row.parentId != 0\" link type=\"primary\" icon=\"Delete\" @click=\"handleDelete(scope.row)\" v-hasPermi=\"['system:dept:remove']\">删除</el-button>\r\n            </template>\r\n         </el-table-column>\r\n      </el-table>\r\n\r\n      <!-- 添加或修改部门对话框 -->\r\n      <el-dialog :title=\"title\" v-model=\"open\" width=\"600px\" append-to-body>\r\n         <el-form ref=\"deptRef\" :model=\"form\" :rules=\"rules\" label-width=\"80px\">\r\n            <el-row>\r\n               <el-col :span=\"24\" v-if=\"form.parentId !== 0\">\r\n                  <el-form-item label=\"上级部门\" prop=\"parentId\">\r\n                     <el-tree-select\r\n                        v-model=\"form.parentId\"\r\n                        :data=\"deptOptions\"\r\n                        :props=\"{ value: 'deptId', label: 'deptName', children: 'children' }\"\r\n                        value-key=\"deptId\"\r\n                        placeholder=\"选择上级部门\"\r\n                        check-strictly\r\n                     />\r\n                  </el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"12\">\r\n                  <el-form-item label=\"部门名称\" prop=\"deptName\">\r\n                     <el-input v-model=\"form.deptName\" placeholder=\"请输入部门名称\" />\r\n                  </el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"12\">\r\n                  <el-form-item label=\"显示排序\" prop=\"orderNum\">\r\n                     <el-input-number v-model=\"form.orderNum\" controls-position=\"right\" :min=\"0\" />\r\n                  </el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"12\">\r\n                  <el-form-item label=\"负责人\" prop=\"leader\">\r\n                     <el-input v-model=\"form.leader\" placeholder=\"请输入负责人\" maxlength=\"20\" />\r\n                  </el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"12\">\r\n                  <el-form-item label=\"联系电话\" prop=\"phone\">\r\n                     <el-input v-model=\"form.phone\" placeholder=\"请输入联系电话\" maxlength=\"11\" />\r\n                  </el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"12\">\r\n                  <el-form-item label=\"邮箱\" prop=\"email\">\r\n                     <el-input v-model=\"form.email\" placeholder=\"请输入邮箱\" maxlength=\"50\" />\r\n                  </el-form-item>\r\n               </el-col>\r\n               <el-col :span=\"12\">\r\n                  <el-form-item label=\"部门状态\">\r\n                     <el-radio-group v-model=\"form.status\">\r\n                        <el-radio\r\n                           v-for=\"dict in sys_normal_disable\"\r\n                           :key=\"dict.value\"\r\n                           :label=\"dict.value\"\r\n                        >{{ dict.label }}</el-radio>\r\n                     </el-radio-group>\r\n                  </el-form-item>\r\n               </el-col>\r\n            </el-row>\r\n         </el-form>\r\n         <template #footer>\r\n            <div class=\"dialog-footer\">\r\n               <el-button type=\"primary\" @click=\"submitForm\">确 定</el-button>\r\n               <el-button @click=\"cancel\">取 消</el-button>\r\n            </div>\r\n         </template>\r\n      </el-dialog>\r\n   </div>\r\n</template>\r\n\r\n<script setup name=\"Dept\">\r\nimport { listDept, getDept, delDept, addDept, updateDept, listDeptExcludeChild } from \"@/api/system/dept\";\r\n\r\nconst { proxy } = getCurrentInstance();\r\nconst { sys_normal_disable } = proxy.useDict(\"sys_normal_disable\");\r\n\r\nconst deptList = ref([]);\r\nconst open = ref(false);\r\nconst loading = ref(true);\r\nconst showSearch = ref(true);\r\nconst title = ref(\"\");\r\nconst deptOptions = ref([]);\r\nconst isExpandAll = ref(true);\r\nconst refreshTable = ref(true);\r\n\r\nconst data = reactive({\r\n  form: {},\r\n  queryParams: {\r\n    deptName: undefined,\r\n    status: undefined\r\n  },\r\n  rules: {\r\n    parentId: [{ required: true, message: \"上级部门不能为空\", trigger: \"blur\" }],\r\n    deptName: [{ required: true, message: \"部门名称不能为空\", trigger: \"blur\" }],\r\n    orderNum: [{ required: true, message: \"显示排序不能为空\", trigger: \"blur\" }],\r\n    email: [{ type: \"email\", message: \"请输入正确的邮箱地址\", trigger: [\"blur\", \"change\"] }],\r\n    phone: [{ pattern: /^1[3|4|5|6|7|8|9][0-9]\\d{8}$/, message: \"请输入正确的手机号码\", trigger: \"blur\" }]\r\n  },\r\n});\r\n\r\nconst { queryParams, form, rules } = toRefs(data);\r\n\r\n/** 查询部门列表 */\r\nfunction getList() {\r\n  loading.value = true;\r\n  listDept(queryParams.value).then(response => {\r\n    deptList.value = proxy.handleTree(response.data, \"deptId\");\r\n    loading.value = false;\r\n  });\r\n}\r\n/** 取消按钮 */\r\nfunction cancel() {\r\n  open.value = false;\r\n  reset();\r\n}\r\n/** 表单重置 */\r\nfunction reset() {\r\n  form.value = {\r\n    deptId: undefined,\r\n    parentId: undefined,\r\n    deptName: undefined,\r\n    orderNum: 0,\r\n    leader: undefined,\r\n    phone: undefined,\r\n    email: undefined,\r\n    status: \"0\"\r\n  };\r\n  proxy.resetForm(\"deptRef\");\r\n}\r\n/** 搜索按钮操作 */\r\nfunction handleQuery() {\r\n  getList();\r\n}\r\n/** 重置按钮操作 */\r\nfunction resetQuery() {\r\n  proxy.resetForm(\"queryRef\");\r\n  handleQuery();\r\n}\r\n/** 新增按钮操作 */\r\nfunction handleAdd(row) {\r\n  reset();\r\n  listDept().then(response => {\r\n    deptOptions.value = proxy.handleTree(response.data, \"deptId\");\r\n  });\r\n  if (row != undefined) {\r\n    form.value.parentId = row.deptId;\r\n  }\r\n  open.value = true;\r\n  title.value = \"添加部门\";\r\n}\r\n/** 展开/折叠操作 */\r\nfunction toggleExpandAll() {\r\n  refreshTable.value = false;\r\n  isExpandAll.value = !isExpandAll.value;\r\n  nextTick(() => {\r\n    refreshTable.value = true;\r\n  });\r\n}\r\n/** 修改按钮操作 */\r\nfunction handleUpdate(row) {\r\n  reset();\r\n  listDeptExcludeChild(row.deptId).then(response => {\r\n    deptOptions.value = proxy.handleTree(response.data, \"deptId\");\r\n  });\r\n  getDept(row.deptId).then(response => {\r\n    form.value = response.data;\r\n    open.value = true;\r\n    title.value = \"修改部门\";\r\n  });\r\n}\r\n/** 提交按钮 */\r\nfunction submitForm() {\r\n  proxy.$refs[\"deptRef\"].validate(valid => {\r\n    if (valid) {\r\n      if (form.value.deptId != undefined) {\r\n        updateDept(form.value).then(response => {\r\n          proxy.$modal.msgSuccess(\"修改成功\");\r\n          open.value = false;\r\n          getList();\r\n        });\r\n      } else {\r\n        addDept(form.value).then(response => {\r\n          proxy.$modal.msgSuccess(\"新增成功\");\r\n          open.value = false;\r\n          getList();\r\n        });\r\n      }\r\n    }\r\n  });\r\n}\r\n/** 删除按钮操作 */\r\nfunction handleDelete(row) {\r\n  proxy.$modal.confirm('是否确认删除名称为\"' + row.deptName + '\"的数据项?').then(function() {\r\n    return delDept(row.deptId);\r\n  }).then(() => {\r\n    getList();\r\n    proxy.$modal.msgSuccess(\"删除成功\");\r\n  }).catch(() => {});\r\n}\r\n\r\ngetList();\r\n</script>\r\n"],"names":["listDept","query","request","listDeptExcludeChild","deptId","getDept","addDept","data","updateDept","delDept","proxy","getCurrentInstance","sys_normal_disable","deptList","ref","open","loading","showSearch","title","deptOptions","isExpandAll","refreshTable","reactive","queryParams","form","rules","toRefs","getList","response","cancel","reset","handleQuery","resetQuery","handleAdd","row","toggleExpandAll","nextTick","handleUpdate","submitForm","valid","handleDelete"],"mappings":"kNAGO,SAASA,EAASC,EAAO,CAC9B,OAAOC,EAAQ,CACb,IAAK,oBACL,OAAQ,MACR,OAAQD,CACZ,CAAG,CACH,CAGO,SAASE,GAAqBC,EAAQ,CAC3C,OAAOF,EAAQ,CACb,IAAK,6BAA+BE,EACpC,OAAQ,KACZ,CAAG,CACH,CAGO,SAASC,GAAQD,EAAQ,CAC9B,OAAOF,EAAQ,CACb,IAAK,gBAAkBE,EACvB,OAAQ,KACZ,CAAG,CACH,CAGO,SAASE,GAAQC,EAAM,CAC5B,OAAOL,EAAQ,CACb,IAAK,eACL,OAAQ,OACR,KAAMK,CACV,CAAG,CACH,CAGO,SAASC,GAAWD,EAAM,CAC/B,OAAOL,EAAQ,CACb,IAAK,eACL,OAAQ,MACR,KAAMK,CACV,CAAG,CACH,CAGO,SAASE,GAAQL,EAAQ,CAC9B,OAAOF,EAAQ,CACb,IAAK,gBAAkBE,EACvB,OAAQ,QACZ,CAAG,CACH,gHC8FA,KAAM,CAAE,MAAAM,CAAK,EAAKC,KACZ,CAAE,mBAAAC,CAAkB,EAAKF,EAAM,QAAQ,oBAAoB,EAE3DG,EAAWC,EAAI,CAAA,CAAE,EACjBC,EAAOD,EAAI,EAAK,EAChBE,EAAUF,EAAI,EAAI,EAClBG,EAAaH,EAAI,EAAI,EACrBI,EAAQJ,EAAI,EAAE,EACdK,EAAcL,EAAI,CAAA,CAAE,EACpBM,EAAcN,EAAI,EAAI,EACtBO,EAAeP,EAAI,EAAI,EAEvBP,EAAOe,GAAS,CACpB,KAAM,CAAE,EACR,YAAa,CACX,SAAU,OACV,OAAQ,MACT,EACD,MAAO,CACL,SAAU,CAAC,CAAE,SAAU,GAAM,QAAS,WAAY,QAAS,OAAQ,EACnE,SAAU,CAAC,CAAE,SAAU,GAAM,QAAS,WAAY,QAAS,OAAQ,EACnE,SAAU,CAAC,CAAE,SAAU,GAAM,QAAS,WAAY,QAAS,OAAQ,EACnE,MAAO,CAAC,CAAE,KAAM,QAAS,QAAS,aAAc,QAAS,CAAC,OAAQ,QAAQ,EAAG,EAC7E,MAAO,CAAC,CAAE,QAAS,+BAAgC,QAAS,aAAc,QAAS,OAAQ,CAC5F,CACH,CAAC,EAEK,CAAE,YAAAC,EAAa,KAAAC,EAAM,MAAAC,CAAO,EAAGC,GAAOnB,CAAI,EAGhD,SAASoB,GAAU,CACjBX,EAAQ,MAAQ,GAChBhB,EAASuB,EAAY,KAAK,EAAE,KAAKK,GAAY,CAC3Cf,EAAS,MAAQH,EAAM,WAAWkB,EAAS,KAAM,QAAQ,EACzDZ,EAAQ,MAAQ,EACpB,CAAG,CACH,CAEA,SAASa,GAAS,CAChBd,EAAK,MAAQ,GACbe,GACF,CAEA,SAASA,GAAQ,CACfN,EAAK,MAAQ,CACX,OAAQ,OACR,SAAU,OACV,SAAU,OACV,SAAU,EACV,OAAQ,OACR,MAAO,OACP,MAAO,OACP,OAAQ,GACZ,EACEd,EAAM,UAAU,SAAS,CAC3B,CAEA,SAASqB,GAAc,CACrBJ,GACF,CAEA,SAASK,GAAa,CACpBtB,EAAM,UAAU,UAAU,EAC1BqB,GACF,CAEA,SAASE,EAAUC,EAAK,CACtBJ,IACA9B,EAAU,EAAC,KAAK4B,GAAY,CAC1BT,EAAY,MAAQT,EAAM,WAAWkB,EAAS,KAAM,QAAQ,CAChE,CAAG,EACGM,GAAO,OACTV,EAAK,MAAM,SAAWU,EAAI,QAE5BnB,EAAK,MAAQ,GACbG,EAAM,MAAQ,MAChB,CAEA,SAASiB,GAAkB,CACzBd,EAAa,MAAQ,GACrBD,EAAY,MAAQ,CAACA,EAAY,MACjCgB,GAAS,IAAM,CACbf,EAAa,MAAQ,EACzB,CAAG,CACH,CAEA,SAASgB,EAAaH,EAAK,CACzBJ,IACA3B,GAAqB+B,EAAI,MAAM,EAAE,KAAKN,GAAY,CAChDT,EAAY,MAAQT,EAAM,WAAWkB,EAAS,KAAM,QAAQ,CAChE,CAAG,EACDvB,GAAQ6B,EAAI,MAAM,EAAE,KAAKN,GAAY,CACnCJ,EAAK,MAAQI,EAAS,KACtBb,EAAK,MAAQ,GACbG,EAAM,MAAQ,MAClB,CAAG,CACH,CAEA,SAASoB,IAAa,CACpB5B,EAAM,MAAM,QAAW,SAAS6B,GAAS,CACnCA,IACEf,EAAK,MAAM,QAAU,KACvBhB,GAAWgB,EAAK,KAAK,EAAE,KAAKI,GAAY,CACtClB,EAAM,OAAO,WAAW,MAAM,EAC9BK,EAAK,MAAQ,GACbY,GACV,CAAS,EAEDrB,GAAQkB,EAAK,KAAK,EAAE,KAAKI,GAAY,CACnClB,EAAM,OAAO,WAAW,MAAM,EAC9BK,EAAK,MAAQ,GACbY,GACV,CAAS,EAGT,CAAG,CACH,CAEA,SAASa,GAAaN,EAAK,CACzBxB,EAAM,OAAO,QAAQ,aAAewB,EAAI,SAAW,QAAQ,EAAE,KAAK,UAAW,CAC3E,OAAOzB,GAAQyB,EAAI,MAAM,CAC7B,CAAG,EAAE,KAAK,IAAM,CACZP,IACAjB,EAAM,OAAO,WAAW,MAAM,CAClC,CAAG,EAAE,MAAM,IAAM,CAAA,CAAE,CACnB,CAEA,OAAAiB"}